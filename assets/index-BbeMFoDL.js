(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();const QT=()=>{};var Nf={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gg=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let r=n.charCodeAt(i);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},ZT=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const r=n[t++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=n[t++];e[i++]=String.fromCharCode((r&31)<<6|s&63)}else if(r>239&&r<365){const s=n[t++],o=n[t++],a=n[t++],c=((r&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[i++]=String.fromCharCode(55296+(c>>10)),e[i++]=String.fromCharCode(56320+(c&1023))}else{const s=n[t++],o=n[t++];e[i++]=String.fromCharCode((r&15)<<12|(s&63)<<6|o&63)}}return e.join("")},yg={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<n.length;r+=3){const s=n[r],o=r+1<n.length,a=o?n[r+1]:0,c=r+2<n.length,d=c?n[r+2]:0,h=s>>2,p=(s&3)<<4|a>>4;let g=(a&15)<<2|d>>6,_=d&63;c||(_=64,o||(g=64)),i.push(t[h],t[p],t[g],t[_])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(gg(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):ZT(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<n.length;){const s=t[n.charAt(r++)],a=r<n.length?t[n.charAt(r)]:0;++r;const d=r<n.length?t[n.charAt(r)]:64;++r;const p=r<n.length?t[n.charAt(r)]:64;if(++r,s==null||a==null||d==null||p==null)throw new jT;const g=s<<2|a>>4;if(i.push(g),d!==64){const _=a<<4&240|d>>2;if(i.push(_),p!==64){const C=d<<6&192|p;i.push(C)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class jT extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const eE=function(n){const e=gg(n);return yg.encodeByteArray(e,!0)},pa=function(n){return eE(n).replace(/\./g,"")},_g=function(n){try{return yg.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vg(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tE=()=>vg().__FIREBASE_DEFAULTS__,nE=()=>{if(typeof process>"u"||typeof Nf>"u")return;const n=Nf.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},iE=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&_g(n[1]);return e&&JSON.parse(e)},Qa=()=>{try{return QT()||tE()||nE()||iE()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Tg=n=>{var e,t;return(t=(e=Qa())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},rE=n=>{const e=Tg(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},Eg=()=>{var n;return(n=Qa())===null||n===void 0?void 0:n.config},Ig=n=>{var e;return(e=Qa())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sE{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function br(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Cg(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oE(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",r=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[pa(JSON.stringify(t)),pa(JSON.stringify(o)),""].join(".")}const Ts={};function aE(){const n={prod:[],emulator:[]};for(const e of Object.keys(Ts))Ts[e]?n.emulator.push(e):n.prod.push(e);return n}function lE(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Vf=!1;function wg(n,e){if(typeof window>"u"||typeof document>"u"||!br(window.location.host)||Ts[n]===e||Ts[n]||Vf)return;Ts[n]=e;function t(g){return`__firebase__banner__${g}`}const i="__firebase__banner",s=aE().prod.length>0;function o(){const g=document.getElementById(i);g&&g.remove()}function a(g){g.style.display="flex",g.style.background="#7faaf0",g.style.position="fixed",g.style.bottom="5px",g.style.left="5px",g.style.padding=".5em",g.style.borderRadius="5px",g.style.alignItems="center"}function c(g,_){g.setAttribute("width","24"),g.setAttribute("id",_),g.setAttribute("height","24"),g.setAttribute("viewBox","0 0 24 24"),g.setAttribute("fill","none"),g.style.marginLeft="-6px"}function d(){const g=document.createElement("span");return g.style.cursor="pointer",g.style.marginLeft="16px",g.style.fontSize="24px",g.innerHTML=" &times;",g.onclick=()=>{Vf=!0,o()},g}function h(g,_){g.setAttribute("id",_),g.innerText="Learn more",g.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",g.setAttribute("target","__blank"),g.style.paddingLeft="5px",g.style.textDecoration="underline"}function p(){const g=lE(i),_=t("text"),C=document.getElementById(_)||document.createElement("span"),P=t("learnmore"),x=document.getElementById(P)||document.createElement("a"),F=t("preprendIcon"),L=document.getElementById(F)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(g.created){const V=g.element;a(V),h(x,P);const O=d();c(L,F),V.append(L,C,x,O),document.body.appendChild(V)}s?(C.innerText="Preview backend disconnected.",L.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(L.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,C.innerText="Preview backend running in this workspace."),C.setAttribute("id",_)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qe(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function uE(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(qe())}function Ag(){var n;const e=(n=Qa())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function cE(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function dE(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function fE(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function hE(){const n=qe();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Sg(){return!Ag()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Rg(){return!Ag()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Pg(){try{return typeof indexedDB=="object"}catch{return!1}}function pE(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var s;e(((s=r.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mE="FirebaseError";class dn extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=mE,Object.setPrototypeOf(this,dn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Qs.prototype.create)}}class Qs{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],o=s?gE(s,i):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new dn(r,a,i)}}function gE(n,e){return n.replace(yE,(t,i)=>{const r=e[i];return r!=null?String(r):`<${i}?>`})}const yE=/\{\$([^}]+)}/g;function _E(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function On(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const r of t){if(!i.includes(r))return!1;const s=n[r],o=e[r];if(Lf(s)&&Lf(o)){if(!On(s,o))return!1}else if(s!==o)return!1}for(const r of i)if(!t.includes(r))return!1;return!0}function Lf(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zs(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function ds(n){const e={};return n.replace(/^\?/,"").split("&").forEach(i=>{if(i){const[r,s]=i.split("=");e[decodeURIComponent(r)]=decodeURIComponent(s)}}),e}function fs(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function vE(n,e){const t=new TE(n,e);return t.subscribe.bind(t)}class TE{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let r;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");EE(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:i},r.next===void 0&&(r.next=eu),r.error===void 0&&(r.error=eu),r.complete===void 0&&(r.complete=eu);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function EE(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function eu(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ve(n){return n&&n._delegate?n._delegate:n}class gi{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ti="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IE{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new sE;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&i.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const i=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(wE(e))try{this.getOrInitializeService({instanceIdentifier:ti})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:r});i.resolve(s)}catch{}}}}clearInstance(e=ti){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ti){return this.instances.has(e)}getOptions(e=ti){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);i===a&&o.resolve(r)}return r}onInit(e,t){var i;const r=this.normalizeInstanceIdentifier(t),s=(i=this.onInitCallbacks.get(r))!==null&&i!==void 0?i:new Set;s.add(e),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const r of i)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:CE(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=ti){return this.component?this.component.multipleInstances?e:ti:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function CE(n){return n===ti?void 0:n}function wE(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AE{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new IE(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var le;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(le||(le={}));const SE={debug:le.DEBUG,verbose:le.VERBOSE,info:le.INFO,warn:le.WARN,error:le.ERROR,silent:le.SILENT},RE=le.INFO,PE={[le.DEBUG]:"log",[le.VERBOSE]:"log",[le.INFO]:"info",[le.WARN]:"warn",[le.ERROR]:"error"},xE=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),r=PE[e];if(r)console[r](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Cc{constructor(e){this.name=e,this._logLevel=RE,this._logHandler=xE,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in le))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?SE[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,le.DEBUG,...e),this._logHandler(this,le.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,le.VERBOSE,...e),this._logHandler(this,le.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,le.INFO,...e),this._logHandler(this,le.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,le.WARN,...e),this._logHandler(this,le.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,le.ERROR,...e),this._logHandler(this,le.ERROR,...e)}}const kE=(n,e)=>e.some(t=>n instanceof t);let Ff,Uf;function bE(){return Ff||(Ff=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ME(){return Uf||(Uf=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const xg=new WeakMap,vu=new WeakMap,kg=new WeakMap,tu=new WeakMap,wc=new WeakMap;function DE(n){const e=new Promise((t,i)=>{const r=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(Mn(n.result)),r()},o=()=>{i(n.error),r()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&xg.set(t,n)}).catch(()=>{}),wc.set(e,n),e}function NE(n){if(vu.has(n))return;const e=new Promise((t,i)=>{const r=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),r()},o=()=>{i(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});vu.set(n,e)}let Tu={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return vu.get(n);if(e==="objectStoreNames")return n.objectStoreNames||kg.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Mn(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function VE(n){Tu=n(Tu)}function LE(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const i=n.call(nu(this),e,...t);return kg.set(i,e.sort?e.sort():[e]),Mn(i)}:ME().includes(n)?function(...e){return n.apply(nu(this),e),Mn(xg.get(this))}:function(...e){return Mn(n.apply(nu(this),e))}}function FE(n){return typeof n=="function"?LE(n):(n instanceof IDBTransaction&&NE(n),kE(n,bE())?new Proxy(n,Tu):n)}function Mn(n){if(n instanceof IDBRequest)return DE(n);if(tu.has(n))return tu.get(n);const e=FE(n);return e!==n&&(tu.set(n,e),wc.set(e,n)),e}const nu=n=>wc.get(n);function UE(n,e,{blocked:t,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(n,e),a=Mn(o);return i&&o.addEventListener("upgradeneeded",c=>{i(Mn(o.result),c.oldVersion,c.newVersion,Mn(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{s&&c.addEventListener("close",()=>s()),r&&c.addEventListener("versionchange",d=>r(d.oldVersion,d.newVersion,d))}).catch(()=>{}),a}const OE=["get","getKey","getAll","getAllKeys","count"],BE=["put","add","delete","clear"],iu=new Map;function Of(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(iu.get(e))return iu.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,r=BE.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(r||OE.includes(t)))return;const s=async function(o,...a){const c=this.transaction(o,r?"readwrite":"readonly");let d=c.store;return i&&(d=d.index(a.shift())),(await Promise.all([d[t](...a),r&&c.done]))[0]};return iu.set(e,s),s}VE(n=>({...n,get:(e,t,i)=>Of(e,t)||n.get(e,t,i),has:(e,t)=>!!Of(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qE{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if($E(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function $E(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Eu="@firebase/app",Bf="0.13.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const on=new Cc("@firebase/app"),GE="@firebase/app-compat",HE="@firebase/analytics-compat",zE="@firebase/analytics",WE="@firebase/app-check-compat",KE="@firebase/app-check",JE="@firebase/auth",YE="@firebase/auth-compat",XE="@firebase/database",QE="@firebase/data-connect",ZE="@firebase/database-compat",jE="@firebase/functions",eI="@firebase/functions-compat",tI="@firebase/installations",nI="@firebase/installations-compat",iI="@firebase/messaging",rI="@firebase/messaging-compat",sI="@firebase/performance",oI="@firebase/performance-compat",aI="@firebase/remote-config",lI="@firebase/remote-config-compat",uI="@firebase/storage",cI="@firebase/storage-compat",dI="@firebase/firestore",fI="@firebase/ai",hI="@firebase/firestore-compat",pI="firebase",mI="11.10.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iu="[DEFAULT]",gI={[Eu]:"fire-core",[GE]:"fire-core-compat",[zE]:"fire-analytics",[HE]:"fire-analytics-compat",[KE]:"fire-app-check",[WE]:"fire-app-check-compat",[JE]:"fire-auth",[YE]:"fire-auth-compat",[XE]:"fire-rtdb",[QE]:"fire-data-connect",[ZE]:"fire-rtdb-compat",[jE]:"fire-fn",[eI]:"fire-fn-compat",[tI]:"fire-iid",[nI]:"fire-iid-compat",[iI]:"fire-fcm",[rI]:"fire-fcm-compat",[sI]:"fire-perf",[oI]:"fire-perf-compat",[aI]:"fire-rc",[lI]:"fire-rc-compat",[uI]:"fire-gcs",[cI]:"fire-gcs-compat",[dI]:"fire-fst",[hI]:"fire-fst-compat",[fI]:"fire-vertex","fire-js":"fire-js",[pI]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ma=new Map,yI=new Map,Cu=new Map;function qf(n,e){try{n.container.addComponent(e)}catch(t){on.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function cr(n){const e=n.name;if(Cu.has(e))return on.debug(`There were multiple attempts to register component ${e}.`),!1;Cu.set(e,n);for(const t of ma.values())qf(t,n);for(const t of yI.values())qf(t,n);return!0}function Ac(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Et(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _I={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Dn=new Qs("app","Firebase",_I);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vI{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new gi("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Dn.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mr=mI;function bg(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const i=Object.assign({name:Iu,automaticDataCollectionEnabled:!0},e),r=i.name;if(typeof r!="string"||!r)throw Dn.create("bad-app-name",{appName:String(r)});if(t||(t=Eg()),!t)throw Dn.create("no-options");const s=ma.get(r);if(s){if(On(t,s.options)&&On(i,s.config))return s;throw Dn.create("duplicate-app",{appName:r})}const o=new AE(r);for(const c of Cu.values())o.addComponent(c);const a=new vI(t,i,o);return ma.set(r,a),a}function Mg(n=Iu){const e=ma.get(n);if(!e&&n===Iu&&Eg())return bg();if(!e)throw Dn.create("no-app",{appName:n});return e}function Nn(n,e,t){var i;let r=(i=gI[n])!==null&&i!==void 0?i:n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),on.warn(a.join(" "));return}cr(new gi(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TI="firebase-heartbeat-database",EI=1,Ds="firebase-heartbeat-store";let ru=null;function Dg(){return ru||(ru=UE(TI,EI,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Ds)}catch(t){console.warn(t)}}}}).catch(n=>{throw Dn.create("idb-open",{originalErrorMessage:n.message})})),ru}async function II(n){try{const t=(await Dg()).transaction(Ds),i=await t.objectStore(Ds).get(Ng(n));return await t.done,i}catch(e){if(e instanceof dn)on.warn(e.message);else{const t=Dn.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});on.warn(t.message)}}}async function $f(n,e){try{const i=(await Dg()).transaction(Ds,"readwrite");await i.objectStore(Ds).put(e,Ng(n)),await i.done}catch(t){if(t instanceof dn)on.warn(t.message);else{const i=Dn.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});on.warn(i.message)}}}function Ng(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CI=1024,wI=30;class AI{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new RI(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var e,t;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Gf();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:r}),this._heartbeatsCache.heartbeats.length>wI){const o=PI(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(i){on.warn(i)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Gf(),{heartbeatsToSend:i,unsentEntries:r}=SI(this._heartbeatsCache.heartbeats),s=pa(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return on.warn(t),""}}}function Gf(){return new Date().toISOString().substring(0,10)}function SI(n,e=CI){const t=[];let i=n.slice();for(const r of n){const s=t.find(o=>o.agent===r.agent);if(s){if(s.dates.push(r.date),Hf(t)>e){s.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),Hf(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class RI{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Pg()?pE().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await II(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return $f(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return $f(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Hf(n){return pa(JSON.stringify({version:2,heartbeats:n})).length}function PI(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let i=1;i<n.length;i++)n[i].date<t&&(t=n[i].date,e=i);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xI(n){cr(new gi("platform-logger",e=>new qE(e),"PRIVATE")),cr(new gi("heartbeat",e=>new AI(e),"PRIVATE")),Nn(Eu,Bf,n),Nn(Eu,Bf,"esm2017"),Nn("fire-js","")}xI("");function Sc(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t}function Vg(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const kI=Vg,Lg=new Qs("auth","Firebase",Vg());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ga=new Cc("@firebase/auth");function bI(n,...e){ga.logLevel<=le.WARN&&ga.warn(`Auth (${Mr}): ${n}`,...e)}function Yo(n,...e){ga.logLevel<=le.ERROR&&ga.error(`Auth (${Mr}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dt(n,...e){throw Rc(n,...e)}function Ot(n,...e){return Rc(n,...e)}function Fg(n,e,t){const i=Object.assign(Object.assign({},kI()),{[e]:t});return new Qs("auth","Firebase",i).create(e,{appName:n.name})}function nn(n){return Fg(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Rc(n,...e){if(typeof n!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return Lg.create(n,...e)}function ee(n,e,...t){if(!n)throw Rc(e,...t)}function jt(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Yo(e),new Error(e)}function an(n,e){n||jt(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wu(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function MI(){return zf()==="http:"||zf()==="https:"}function zf(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DI(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(MI()||dE()||"connection"in navigator)?navigator.onLine:!0}function NI(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class js{constructor(e,t){this.shortDelay=e,this.longDelay=t,an(t>e,"Short delay should be less than long delay!"),this.isMobile=uE()||fE()}get(){return DI()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pc(n,e){an(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ug{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;jt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;jt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;jt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VI={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LI=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],FI=new js(3e4,6e4);function zn(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Wn(n,e,t,i,r={}){return Og(n,r,async()=>{let s={},o={};i&&(e==="GET"?o=i:s={body:JSON.stringify(i)});const a=Zs(Object.assign({key:n.config.apiKey},o)).slice(1),c=await n._getAdditionalHeaders();c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode);const d=Object.assign({method:e,headers:c},s);return cE()||(d.referrerPolicy="no-referrer"),n.emulatorConfig&&br(n.emulatorConfig.host)&&(d.credentials="include"),Ug.fetch()(await Bg(n,n.config.apiHost,t,a),d)})}async function Og(n,e,t){n._canInitEmulator=!1;const i=Object.assign(Object.assign({},VI),e);try{const r=new OI(n),s=await Promise.race([t(),r.promise]);r.clearNetworkTimeout();const o=await s.json();if("needConfirmation"in o)throw Oo(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const a=s.ok?o.errorMessage:o.error.message,[c,d]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Oo(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Oo(n,"email-already-in-use",o);if(c==="USER_DISABLED")throw Oo(n,"user-disabled",o);const h=i[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Fg(n,h,d);Dt(n,h)}}catch(r){if(r instanceof dn)throw r;Dt(n,"network-request-failed",{message:String(r)})}}async function eo(n,e,t,i,r={}){const s=await Wn(n,e,t,i,r);return"mfaPendingCredential"in s&&Dt(n,"multi-factor-auth-required",{_serverResponse:s}),s}async function Bg(n,e,t,i){const r=`${e}${t}?${i}`,s=n,o=s.config.emulator?Pc(n.config,r):`${n.config.apiScheme}://${r}`;return LI.includes(t)&&(await s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(o).toString():o}function UI(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class OI{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(Ot(this.auth,"network-request-failed")),FI.get())})}}function Oo(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const r=Ot(n,e,i);return r.customData._tokenResponse=t,r}function Wf(n){return n!==void 0&&n.enterprise!==void 0}class BI{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return UI(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function qI(n,e){return Wn(n,"GET","/v2/recaptchaConfig",zn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $I(n,e){return Wn(n,"POST","/v1/accounts:delete",e)}async function ya(n,e){return Wn(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Es(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function GI(n,e=!1){const t=Ve(n),i=await t.getIdToken(e),r=xc(i);ee(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const s=typeof r.firebase=="object"?r.firebase:void 0,o=s==null?void 0:s.sign_in_provider;return{claims:r,token:i,authTime:Es(su(r.auth_time)),issuedAtTime:Es(su(r.iat)),expirationTime:Es(su(r.exp)),signInProvider:o||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}}function su(n){return Number(n)*1e3}function xc(n){const[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return Yo("JWT malformed, contained fewer than 3 sections"),null;try{const r=_g(t);return r?JSON.parse(r):(Yo("Failed to decode base64 JWT payload"),null)}catch(r){return Yo("Caught error parsing JWT payload as JSON",r==null?void 0:r.toString()),null}}function Kf(n){const e=xc(n);return ee(e,"internal-error"),ee(typeof e.exp<"u","internal-error"),ee(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ns(n,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof dn&&HI(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function HI({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zI{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const r=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Au{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Es(this.lastLoginAt),this.creationTime=Es(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _a(n){var e;const t=n.auth,i=await n.getIdToken(),r=await Ns(n,ya(t,{idToken:i}));ee(r==null?void 0:r.users.length,t,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?qg(s.providerUserInfo):[],a=KI(n.providerData,o),c=n.isAnonymous,d=!(n.email&&s.passwordHash)&&!(a!=null&&a.length),h=c?d:!1,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Au(s.createdAt,s.lastLoginAt),isAnonymous:h};Object.assign(n,p)}async function WI(n){const e=Ve(n);await _a(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function KI(n,e){return[...n.filter(i=>!e.some(r=>r.providerId===i.providerId)),...e]}function qg(n){return n.map(e=>{var{providerId:t}=e,i=Sc(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JI(n,e){const t=await Og(n,{},async()=>{const i=Zs({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:s}=n.config,o=await Bg(n,r,"/v1/token",`key=${s}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:a,body:i};return n.emulatorConfig&&br(n.emulatorConfig.host)&&(c.credentials="include"),Ug.fetch()(o,c)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function YI(n,e){return Wn(n,"POST","/v2/accounts:revokeToken",zn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rr{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ee(e.idToken,"internal-error"),ee(typeof e.idToken<"u","internal-error"),ee(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Kf(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ee(e.length!==0,"internal-error");const t=Kf(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ee(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:r,expiresIn:s}=await JI(e,t);this.updateTokensAndExpiration(i,r,Number(s))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:r,expirationTime:s}=t,o=new rr;return i&&(ee(typeof i=="string","internal-error",{appName:e}),o.refreshToken=i),r&&(ee(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),s&&(ee(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new rr,this.toJSON())}_performRefresh(){return jt("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tn(n,e){ee(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class bt{constructor(e){var{uid:t,auth:i,stsTokenManager:r}=e,s=Sc(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new zI(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Au(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Ns(this,this.stsTokenManager.getToken(this.auth,e));return ee(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return GI(this,e)}reload(){return WI(this)}_assign(e){this!==e&&(ee(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new bt(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){ee(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await _a(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Et(this.auth.app))return Promise.reject(nn(this.auth));const e=await this.getIdToken();return await Ns(this,$I(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,r,s,o,a,c,d,h;const p=(i=t.displayName)!==null&&i!==void 0?i:void 0,g=(r=t.email)!==null&&r!==void 0?r:void 0,_=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,C=(o=t.photoURL)!==null&&o!==void 0?o:void 0,P=(a=t.tenantId)!==null&&a!==void 0?a:void 0,x=(c=t._redirectEventId)!==null&&c!==void 0?c:void 0,F=(d=t.createdAt)!==null&&d!==void 0?d:void 0,L=(h=t.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:V,emailVerified:O,isAnonymous:U,providerData:q,stsTokenManager:I}=t;ee(V&&I,e,"internal-error");const T=rr.fromJSON(this.name,I);ee(typeof V=="string",e,"internal-error"),Tn(p,e.name),Tn(g,e.name),ee(typeof O=="boolean",e,"internal-error"),ee(typeof U=="boolean",e,"internal-error"),Tn(_,e.name),Tn(C,e.name),Tn(P,e.name),Tn(x,e.name),Tn(F,e.name),Tn(L,e.name);const E=new bt({uid:V,auth:e,email:g,emailVerified:O,displayName:p,isAnonymous:U,photoURL:C,phoneNumber:_,tenantId:P,stsTokenManager:T,createdAt:F,lastLoginAt:L});return q&&Array.isArray(q)&&(E.providerData=q.map(R=>Object.assign({},R))),x&&(E._redirectEventId=x),E}static async _fromIdTokenResponse(e,t,i=!1){const r=new rr;r.updateFromServerResponse(t);const s=new bt({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:i});return await _a(s),s}static async _fromGetAccountInfoResponse(e,t,i){const r=t.users[0];ee(r.localId!==void 0,"internal-error");const s=r.providerUserInfo!==void 0?qg(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!(s!=null&&s.length),a=new rr;a.updateFromIdToken(i);const c=new bt({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:o}),d={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:s,metadata:new Au(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(s!=null&&s.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jf=new Map;function en(n){an(n instanceof Function,"Expected a class definition");let e=Jf.get(n);return e?(an(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Jf.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $g{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}$g.type="NONE";const Yf=$g;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xo(n,e,t){return`firebase:${n}:${e}:${t}`}class sr{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:r,name:s}=this.auth;this.fullUserKey=Xo(this.userKey,r.apiKey,s),this.fullPersistenceKey=Xo("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await ya(this.auth,{idToken:e}).catch(()=>{});return t?bt._fromGetAccountInfoResponse(this.auth,t,e):null}return bt._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new sr(en(Yf),e,i);const r=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let s=r[0]||en(Yf);const o=Xo(i,e.config.apiKey,e.name);let a=null;for(const d of t)try{const h=await d._get(o);if(h){let p;if(typeof h=="string"){const g=await ya(e,{idToken:h}).catch(()=>{});if(!g)break;p=await bt._fromGetAccountInfoResponse(e,g,h)}else p=bt._fromJSON(e,h);d!==s&&(a=p),s=d;break}}catch{}const c=r.filter(d=>d._shouldAllowMigration);return!s._shouldAllowMigration||!c.length?new sr(s,e,i):(s=c[0],a&&await s._set(o,a.toJSON()),await Promise.all(t.map(async d=>{if(d!==s)try{await d._remove(o)}catch{}})),new sr(s,e,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xf(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Wg(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Gg(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Jg(e))return"Blackberry";if(Yg(e))return"Webos";if(Hg(e))return"Safari";if((e.includes("chrome/")||zg(e))&&!e.includes("edge/"))return"Chrome";if(Kg(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if((i==null?void 0:i.length)===2)return i[1]}return"Other"}function Gg(n=qe()){return/firefox\//i.test(n)}function Hg(n=qe()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function zg(n=qe()){return/crios\//i.test(n)}function Wg(n=qe()){return/iemobile/i.test(n)}function Kg(n=qe()){return/android/i.test(n)}function Jg(n=qe()){return/blackberry/i.test(n)}function Yg(n=qe()){return/webos/i.test(n)}function kc(n=qe()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function XI(n=qe()){var e;return kc(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function QI(){return hE()&&document.documentMode===10}function Xg(n=qe()){return kc(n)||Kg(n)||Yg(n)||Jg(n)||/windows phone/i.test(n)||Wg(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qg(n,e=[]){let t;switch(n){case"Browser":t=Xf(qe());break;case"Worker":t=`${Xf(qe())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Mr}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZI{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=s=>new Promise((o,a)=>{try{const c=e(s);o(c)}catch(c){a(c)}});i.onAbort=t,this.queue.push(i);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const i of this.queue)await i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(const r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i==null?void 0:i.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jI(n,e={}){return Wn(n,"GET","/v2/passwordPolicy",zn(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eC=6;class tC{constructor(e){var t,i,r,s;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:eC,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(r=(i=e.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&r!==void 0?r:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,i,r,s,o,a;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(t=c.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),c.isValid&&(c.isValid=(i=c.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(r=c.containsLowercaseLetter)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(s=c.containsUppercaseLetter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(o=c.containsNumericCharacter)!==null&&o!==void 0?o:!0),c.isValid&&(c.isValid=(a=c.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),c}validatePasswordLengthOptions(e,t){const i=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let r=0;r<e.length;r++)i=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,r,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nC{constructor(e,t,i,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Qf(this),this.idTokenSubscription=new Qf(this),this.beforeStateQueue=new ZI(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Lg,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=en(t)),this._initializationPromise=this.queue(async()=>{var i,r,s;if(!this._deleted&&(this.persistenceManager=await sr.create(this,e),(i=this._resolvePersistenceManagerAvailable)===null||i===void 0||i.call(this),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await ya(this,{idToken:e}),i=await bt._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Et(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const i=await this.assertedPersistence.getCurrentUser();let r=i,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=r==null?void 0:r._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===a)&&(c!=null&&c.user)&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return ee(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await _a(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=NI()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Et(this.app))return Promise.reject(nn(this));const t=e?Ve(e):null;return t&&ee(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ee(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Et(this.app)?Promise.reject(nn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Et(this.app)?Promise.reject(nn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(en(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await jI(this),t=new tC(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Qs("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const i=this.onAuthStateChanged(()=>{i(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),await YI(this,i)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&en(e)||this._popupRedirectResolver;ee(t,this,"argument-error"),this.redirectPersistenceManager=await sr.create(this,[en(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,r){if(this._deleted)return()=>{};const s=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ee(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof t=="function"){const c=e.addObserver(t,i,r);return()=>{o=!0,c()}}else{const c=e.addObserver(t);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ee(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Qg(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const i=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());i&&(t["X-Firebase-Client"]=i);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;if(Et(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&bI(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Di(n){return Ve(n)}class Qf{constructor(e){this.auth=e,this.observer=null,this.addObserver=vE(t=>this.observer=t)}get next(){return ee(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Za={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function iC(n){Za=n}function Zg(n){return Za.loadJS(n)}function rC(){return Za.recaptchaEnterpriseScript}function sC(){return Za.gapiScript}function oC(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class aC{constructor(){this.enterprise=new lC}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class lC{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const uC="recaptcha-enterprise",jg="NO_RECAPTCHA";class cC{constructor(e){this.type=uC,this.auth=Di(e)}async verify(e="verify",t=!1){async function i(s){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise(async(o,a)=>{qI(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const d=new BI(c);return s.tenantId==null?s._agentRecaptchaConfig=d:s._tenantRecaptchaConfigs[s.tenantId]=d,o(d.siteKey)}}).catch(c=>{a(c)})})}function r(s,o,a){const c=window.grecaptcha;Wf(c)?c.enterprise.ready(()=>{c.enterprise.execute(s,{action:e}).then(d=>{o(d)}).catch(()=>{o(jg)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new aC().execute("siteKey",{action:"verify"}):new Promise((s,o)=>{i(this.auth).then(a=>{if(!t&&Wf(window.grecaptcha))r(a,s,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=rC();c.length!==0&&(c+=a),Zg(c).then(()=>{r(a,s,o)}).catch(d=>{o(d)})}}).catch(a=>{o(a)})})}}async function Zf(n,e,t,i=!1,r=!1){const s=new cC(n);let o;if(r)o=jg;else try{o=await s.verify(t)}catch{o=await s.verify(t,!0)}const a=Object.assign({},e);if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const c=a.phoneEnrollmentInfo.phoneNumber,d=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:d,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const c=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return i?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Su(n,e,t,i,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await Zf(n,e,t,t==="getOobCode");return i(n,o)}else return i(n,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await Zf(n,e,t,t==="getOobCode");return i(n,a)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dC(n,e){const t=Ac(n,"auth");if(t.isInitialized()){const r=t.getImmediate(),s=t.getOptions();if(On(s,e??{}))return r;Dt(r,"already-initialized")}return t.initialize({options:e})}function fC(n,e){const t=(e==null?void 0:e.persistence)||[],i=(Array.isArray(t)?t:[t]).map(en);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e==null?void 0:e.popupRedirectResolver)}function hC(n,e,t){const i=Di(n);ee(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const r=!1,s=ey(e),{host:o,port:a}=pC(e),c=a===null?"":`:${a}`,d={url:`${s}//${o}${c}/`},h=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!i._canInitEmulator){ee(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),ee(On(d,i.config.emulator)&&On(h,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=d,i.emulatorConfig=h,i.settings.appVerificationDisabledForTesting=!0,br(o)?(Cg(`${s}//${o}${c}`),wg("Auth",!0)):mC()}function ey(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function pC(n){const e=ey(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const s=r[1];return{host:s,port:jf(i.substr(s.length+1))}}else{const[s,o]=i.split(":");return{host:s,port:jf(o)}}}function jf(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function mC(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bc{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return jt("not implemented")}_getIdTokenResponse(e){return jt("not implemented")}_linkToIdToken(e,t){return jt("not implemented")}_getReauthenticationResolver(e){return jt("not implemented")}}async function gC(n,e){return Wn(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yC(n,e){return eo(n,"POST","/v1/accounts:signInWithPassword",zn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _C(n,e){return eo(n,"POST","/v1/accounts:signInWithEmailLink",zn(n,e))}async function vC(n,e){return eo(n,"POST","/v1/accounts:signInWithEmailLink",zn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vs extends bc{constructor(e,t,i,r=null){super("password",i),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Vs(e,t,"password")}static _fromEmailAndCode(e,t,i=null){return new Vs(e,t,"emailLink",i)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Su(e,t,"signInWithPassword",yC);case"emailLink":return _C(e,{email:this._email,oobCode:this._password});default:Dt(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const i={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Su(e,i,"signUpPassword",gC);case"emailLink":return vC(e,{idToken:t,email:this._email,oobCode:this._password});default:Dt(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function or(n,e){return eo(n,"POST","/v1/accounts:signInWithIdp",zn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TC="http://localhost";class yi extends bc{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new yi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Dt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:r}=t,s=Sc(t,["providerId","signInMethod"]);if(!i||!r)return null;const o=new yi(i,r);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return or(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,or(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,or(e,t)}buildRequest(){const e={requestUri:TC,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Zs(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EC(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function IC(n){const e=ds(fs(n)).link,t=e?ds(fs(e)).deep_link_id:null,i=ds(fs(n)).deep_link_id;return(i?ds(fs(i)).link:null)||i||t||e||n}class Mc{constructor(e){var t,i,r,s,o,a;const c=ds(fs(e)),d=(t=c.apiKey)!==null&&t!==void 0?t:null,h=(i=c.oobCode)!==null&&i!==void 0?i:null,p=EC((r=c.mode)!==null&&r!==void 0?r:null);ee(d&&h&&p,"argument-error"),this.apiKey=d,this.operation=p,this.code=h,this.continueUrl=(s=c.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(o=c.lang)!==null&&o!==void 0?o:null,this.tenantId=(a=c.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=IC(e);try{return new Mc(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dr{constructor(){this.providerId=Dr.PROVIDER_ID}static credential(e,t){return Vs._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const i=Mc.parseLink(t);return ee(i,"argument-error"),Vs._fromEmailAndCode(e,i.code,i.tenantId)}}Dr.PROVIDER_ID="password";Dr.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Dr.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ty{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class to extends ty{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sn extends to{constructor(){super("facebook.com")}static credential(e){return yi._fromParams({providerId:Sn.PROVIDER_ID,signInMethod:Sn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Sn.credentialFromTaggedObject(e)}static credentialFromError(e){return Sn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Sn.credential(e.oauthAccessToken)}catch{return null}}}Sn.FACEBOOK_SIGN_IN_METHOD="facebook.com";Sn.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rn extends to{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return yi._fromParams({providerId:Rn.PROVIDER_ID,signInMethod:Rn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Rn.credentialFromTaggedObject(e)}static credentialFromError(e){return Rn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return Rn.credential(t,i)}catch{return null}}}Rn.GOOGLE_SIGN_IN_METHOD="google.com";Rn.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pn extends to{constructor(){super("github.com")}static credential(e){return yi._fromParams({providerId:Pn.PROVIDER_ID,signInMethod:Pn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Pn.credentialFromTaggedObject(e)}static credentialFromError(e){return Pn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Pn.credential(e.oauthAccessToken)}catch{return null}}}Pn.GITHUB_SIGN_IN_METHOD="github.com";Pn.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xn extends to{constructor(){super("twitter.com")}static credential(e,t){return yi._fromParams({providerId:xn.PROVIDER_ID,signInMethod:xn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return xn.credentialFromTaggedObject(e)}static credentialFromError(e){return xn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return xn.credential(t,i)}catch{return null}}}xn.TWITTER_SIGN_IN_METHOD="twitter.com";xn.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CC(n,e){return eo(n,"POST","/v1/accounts:signUp",zn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _i{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,r=!1){const s=await bt._fromIdTokenResponse(e,i,r),o=eh(i);return new _i({user:s,providerId:o,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const r=eh(i);return new _i({user:e,providerId:r,_tokenResponse:i,operationType:t})}}function eh(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va extends dn{constructor(e,t,i,r){var s;super(t.code,t.message),this.operationType=i,this.user=r,Object.setPrototypeOf(this,va.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,r){return new va(e,t,i,r)}}function ny(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?va._fromErrorAndOperation(n,s,e,i):s})}async function wC(n,e,t=!1){const i=await Ns(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return _i._forOperation(n,"link",i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AC(n,e,t=!1){const{auth:i}=n;if(Et(i.app))return Promise.reject(nn(i));const r="reauthenticate";try{const s=await Ns(n,ny(i,r,e,n),t);ee(s.idToken,i,"internal-error");const o=xc(s.idToken);ee(o,i,"internal-error");const{sub:a}=o;return ee(n.uid===a,i,"user-mismatch"),_i._forOperation(n,r,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&Dt(i,"user-mismatch"),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iy(n,e,t=!1){if(Et(n.app))return Promise.reject(nn(n));const i="signIn",r=await ny(n,i,e),s=await _i._fromIdTokenResponse(n,i,r);return t||await n._updateCurrentUser(s.user),s}async function SC(n,e){return iy(Di(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ry(n){const e=Di(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function RC(n,e,t){if(Et(n.app))return Promise.reject(nn(n));const i=Di(n),o=await Su(i,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",CC).catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&ry(n),c}),a=await _i._fromIdTokenResponse(i,"signIn",o);return await i._updateCurrentUser(a.user),a}function PC(n,e,t){return Et(n.app)?Promise.reject(nn(n)):SC(Ve(n),Dr.credential(e,t)).catch(async i=>{throw i.code==="auth/password-does-not-meet-requirements"&&ry(n),i})}function xC(n,e,t,i){return Ve(n).onIdTokenChanged(e,t,i)}function kC(n,e,t){return Ve(n).beforeAuthStateChanged(e,t)}function bC(n,e,t,i){return Ve(n).onAuthStateChanged(e,t,i)}function MC(n){return Ve(n).signOut()}const Ta="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sy{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ta,"1"),this.storage.removeItem(Ta),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DC=1e3,NC=10;class oy extends sy{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Xg(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),r=this.localCache[t];i!==r&&e(t,r,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,c)=>{this.notifyListeners(o,c)});return}const i=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const o=this.storage.getItem(i);!t&&this.localCache[i]===o||this.notifyListeners(i,o)},s=this.storage.getItem(i);QI()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,NC):r()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const r of Array.from(i))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},DC)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}oy.type="LOCAL";const VC=oy;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ay extends sy{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}ay.type="SESSION";const ly=ay;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LC(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ja{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const i=new ja(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:r,data:s}=t.data,o=this.handlersMap[r];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:r});const a=Array.from(o).map(async d=>d(t.origin,s)),c=await LC(a);t.ports[0].postMessage({status:"done",eventId:i,eventType:r,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ja.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dc(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FC{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,o;return new Promise((a,c)=>{const d=Dc("",20);r.port1.start();const h=setTimeout(()=>{c(new Error("unsupported_event"))},i);o={messageChannel:r,onMessage(p){const g=p;if(g.data.eventId===d)switch(g.data.status){case"ack":clearTimeout(h),s=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(g.data.response);break;default:clearTimeout(h),clearTimeout(s),c(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bt(){return window}function UC(n){Bt().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uy(){return typeof Bt().WorkerGlobalScope<"u"&&typeof Bt().importScripts=="function"}async function OC(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function BC(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function qC(){return uy()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cy="firebaseLocalStorageDb",$C=1,Ea="firebaseLocalStorage",dy="fbase_key";class no{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function el(n,e){return n.transaction([Ea],e?"readwrite":"readonly").objectStore(Ea)}function GC(){const n=indexedDB.deleteDatabase(cy);return new no(n).toPromise()}function Ru(){const n=indexedDB.open(cy,$C);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(Ea,{keyPath:dy})}catch(r){t(r)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains(Ea)?e(i):(i.close(),await GC(),e(await Ru()))})})}async function th(n,e,t){const i=el(n,!0).put({[dy]:e,value:t});return new no(i).toPromise()}async function HC(n,e){const t=el(n,!1).get(e),i=await new no(t).toPromise();return i===void 0?null:i.value}function nh(n,e){const t=el(n,!0).delete(e);return new no(t).toPromise()}const zC=800,WC=3;class fy{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Ru(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>WC)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return uy()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ja._getInstance(qC()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await OC(),!this.activeServiceWorker)return;this.sender=new FC(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);i&&!((e=i[0])===null||e===void 0)&&e.fulfilled&&!((t=i[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||BC()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Ru();return await th(e,Ta,"1"),await nh(e,Ta),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>th(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>HC(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>nh(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const s=el(r,!1).getAll();return new no(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;if(e.length!==0)for(const{fbase_key:r,value:s}of e)i.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(s)&&(this.notifyListeners(r,s),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!i.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const r of Array.from(i))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),zC)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}fy.type="LOCAL";const KC=fy;new js(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JC(n,e){return e?en(e):(ee(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nc extends bc{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return or(e,this._buildIdpRequest())}_linkToIdToken(e,t){return or(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return or(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function YC(n){return iy(n.auth,new Nc(n),n.bypassAuthState)}function XC(n){const{auth:e,user:t}=n;return ee(t,e,"internal-error"),AC(t,new Nc(n),n.bypassAuthState)}async function QC(n){const{auth:e,user:t}=n;return ee(t,e,"internal-error"),wC(t,new Nc(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hy{constructor(e,t,i,r,s=!1){this.auth=e,this.resolver=i,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:r,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:t,sessionId:i,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return YC;case"linkViaPopup":case"linkViaRedirect":return QC;case"reauthViaPopup":case"reauthViaRedirect":return XC;default:Dt(this.auth,"internal-error")}}resolve(e){an(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){an(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZC=new js(2e3,1e4);class tr extends hy{constructor(e,t,i,r,s){super(e,t,r,s),this.provider=i,this.authWindow=null,this.pollId=null,tr.currentPopupAction&&tr.currentPopupAction.cancel(),tr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ee(e,this.auth,"internal-error"),e}async onExecution(){an(this.filter.length===1,"Popup operations only handle one event");const e=Dc();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Ot(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Ot(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,tr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;if(!((i=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ot(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,ZC.get())};e()}}tr.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jC="pendingRedirect",Qo=new Map;class ew extends hy{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}async execute(){let e=Qo.get(this.auth._key());if(!e){try{const i=await tw(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}Qo.set(this.auth._key(),e)}return this.bypassAuthState||Qo.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function tw(n,e){const t=rw(e),i=iw(n);if(!await i._isAvailable())return!1;const r=await i._get(t)==="true";return await i._remove(t),r}function nw(n,e){Qo.set(n._key(),e)}function iw(n){return en(n._redirectPersistence)}function rw(n){return Xo(jC,n.config.apiKey,n.name)}async function sw(n,e,t=!1){if(Et(n.app))return Promise.reject(nn(n));const i=Di(n),r=JC(i,e),o=await new ew(i,r,t).execute();return o&&!t&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ow=10*60*1e3;class aw{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!lw(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!py(e)){const r=((i=e.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";t.onError(Ot(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=ow&&this.cachedEventUids.clear(),this.cachedEventUids.has(ih(e))}saveEventToCache(e){this.cachedEventUids.add(ih(e)),this.lastProcessedEventTime=Date.now()}}function ih(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function py({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function lw(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return py(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uw(n,e={}){return Wn(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cw=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,dw=/^https?/;async function fw(n){if(n.config.emulator)return;const{authorizedDomains:e}=await uw(n);for(const t of e)try{if(hw(t))return}catch{}Dt(n,"unauthorized-domain")}function hw(n){const e=wu(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===i}if(!dw.test(t))return!1;if(cw.test(n))return i===n;const r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pw=new js(3e4,6e4);function rh(){const n=Bt().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function mw(n){return new Promise((e,t)=>{var i,r,s;function o(){rh(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{rh(),t(Ot(n,"network-request-failed"))},timeout:pw.get()})}if(!((r=(i=Bt().gapi)===null||i===void 0?void 0:i.iframes)===null||r===void 0)&&r.Iframe)e(gapi.iframes.getContext());else if(!((s=Bt().gapi)===null||s===void 0)&&s.load)o();else{const a=oC("iframefcb");return Bt()[a]=()=>{gapi.load?o():t(Ot(n,"network-request-failed"))},Zg(`${sC()}?onload=${a}`).catch(c=>t(c))}}).catch(e=>{throw Zo=null,e})}let Zo=null;function gw(n){return Zo=Zo||mw(n),Zo}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yw=new js(5e3,15e3),_w="__/auth/iframe",vw="emulator/auth/iframe",Tw={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Ew=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Iw(n){const e=n.config;ee(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Pc(e,vw):`https://${n.config.authDomain}/${_w}`,i={apiKey:e.apiKey,appName:n.name,v:Mr},r=Ew.get(n.config.apiHost);r&&(i.eid=r);const s=n._getFrameworks();return s.length&&(i.fw=s.join(",")),`${t}?${Zs(i).slice(1)}`}async function Cw(n){const e=await gw(n),t=Bt().gapi;return ee(t,n,"internal-error"),e.open({where:document.body,url:Iw(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Tw,dontclear:!0},i=>new Promise(async(r,s)=>{await i.restyle({setHideOnLeave:!1});const o=Ot(n,"network-request-failed"),a=Bt().setTimeout(()=>{s(o)},yw.get());function c(){Bt().clearTimeout(a),r(i)}i.ping(c).then(c,()=>{s(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ww={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Aw=500,Sw=600,Rw="_blank",Pw="http://localhost";class sh{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function xw(n,e,t,i=Aw,r=Sw){const s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const c=Object.assign(Object.assign({},ww),{width:i.toString(),height:r.toString(),top:s,left:o}),d=qe().toLowerCase();t&&(a=zg(d)?Rw:t),Gg(d)&&(e=e||Pw,c.scrollbars="yes");const h=Object.entries(c).reduce((g,[_,C])=>`${g}${_}=${C},`,"");if(XI(d)&&a!=="_self")return kw(e||"",a),new sh(null);const p=window.open(e||"",a,h);ee(p,n,"popup-blocked");try{p.focus()}catch{}return new sh(p)}function kw(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bw="__/auth/handler",Mw="emulator/auth/handler",Dw=encodeURIComponent("fac");async function oh(n,e,t,i,r,s){ee(n.config.authDomain,n,"auth-domain-config-required"),ee(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:Mr,eventId:r};if(e instanceof ty){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",_E(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,p]of Object.entries({}))o[h]=p}if(e instanceof to){const h=e.getScopes().filter(p=>p!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const c=await n._getAppCheckToken(),d=c?`#${Dw}=${encodeURIComponent(c)}`:"";return`${Nw(n)}?${Zs(a).slice(1)}${d}`}function Nw({config:n}){return n.emulator?Pc(n,Mw):`https://${n.authDomain}/${bw}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ou="webStorageSupport";class Vw{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ly,this._completeRedirectFn=sw,this._overrideRedirectResult=nw}async _openPopup(e,t,i,r){var s;an((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");const o=await oh(e,t,i,wu(),r);return xw(e,o,Dc())}async _openRedirect(e,t,i,r){await this._originValidation(e);const s=await oh(e,t,i,wu(),r);return UC(s),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:s}=this.eventManagers[t];return r?Promise.resolve(r):(an(s,"If manager is not set, promise should be"),s)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){const t=await Cw(e),i=new aw(e);return t.register("authEvent",r=>(ee(r==null?void 0:r.authEvent,e,"invalid-auth-event"),{status:i.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(ou,{type:ou},r=>{var s;const o=(s=r==null?void 0:r[0])===null||s===void 0?void 0:s[ou];o!==void 0&&t(!!o),Dt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=fw(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Xg()||Hg()||kc()}}const Lw=Vw;var ah="@firebase/auth",lh="1.10.8";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fw{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{e((i==null?void 0:i.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ee(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uw(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Ow(n){cr(new gi("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=i.options;ee(o&&!o.includes(":"),"invalid-api-key",{appName:i.name});const c={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Qg(n)},d=new nC(i,r,s,c);return fC(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),cr(new gi("auth-internal",e=>{const t=Di(e.getProvider("auth").getImmediate());return(i=>new Fw(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Nn(ah,lh,Uw(n)),Nn(ah,lh,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bw=5*60,qw=Ig("authIdTokenMaxAge")||Bw;let uh=null;const $w=n=>async e=>{const t=e&&await e.getIdTokenResult(),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>qw)return;const r=t==null?void 0:t.token;uh!==r&&(uh=r,await fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function Gw(n=Mg()){const e=Ac(n,"auth");if(e.isInitialized())return e.getImmediate();const t=dC(n,{popupRedirectResolver:Lw,persistence:[KC,VC,ly]}),i=Ig("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(i,location.origin);if(location.origin===s.origin){const o=$w(s.toString());kC(t,o,()=>o(t.currentUser)),xC(t,a=>o(a))}}const r=Tg("auth");return r&&hC(t,`http://${r}`),t}function Hw(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}iC({loadJS(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=r=>{const s=Ot("internal-error");s.customData=r,t(s)},i.type="text/javascript",i.charset="UTF-8",Hw().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Ow("Browser");var ch=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Vn,my;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(I,T){function E(){}E.prototype=T.prototype,I.D=T.prototype,I.prototype=new E,I.prototype.constructor=I,I.C=function(R,w,k){for(var S=Array(arguments.length-2),Tt=2;Tt<arguments.length;Tt++)S[Tt-2]=arguments[Tt];return T.prototype[w].apply(R,S)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(i,t),i.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(I,T,E){E||(E=0);var R=Array(16);if(typeof T=="string")for(var w=0;16>w;++w)R[w]=T.charCodeAt(E++)|T.charCodeAt(E++)<<8|T.charCodeAt(E++)<<16|T.charCodeAt(E++)<<24;else for(w=0;16>w;++w)R[w]=T[E++]|T[E++]<<8|T[E++]<<16|T[E++]<<24;T=I.g[0],E=I.g[1],w=I.g[2];var k=I.g[3],S=T+(k^E&(w^k))+R[0]+3614090360&4294967295;T=E+(S<<7&4294967295|S>>>25),S=k+(w^T&(E^w))+R[1]+3905402710&4294967295,k=T+(S<<12&4294967295|S>>>20),S=w+(E^k&(T^E))+R[2]+606105819&4294967295,w=k+(S<<17&4294967295|S>>>15),S=E+(T^w&(k^T))+R[3]+3250441966&4294967295,E=w+(S<<22&4294967295|S>>>10),S=T+(k^E&(w^k))+R[4]+4118548399&4294967295,T=E+(S<<7&4294967295|S>>>25),S=k+(w^T&(E^w))+R[5]+1200080426&4294967295,k=T+(S<<12&4294967295|S>>>20),S=w+(E^k&(T^E))+R[6]+2821735955&4294967295,w=k+(S<<17&4294967295|S>>>15),S=E+(T^w&(k^T))+R[7]+4249261313&4294967295,E=w+(S<<22&4294967295|S>>>10),S=T+(k^E&(w^k))+R[8]+1770035416&4294967295,T=E+(S<<7&4294967295|S>>>25),S=k+(w^T&(E^w))+R[9]+2336552879&4294967295,k=T+(S<<12&4294967295|S>>>20),S=w+(E^k&(T^E))+R[10]+4294925233&4294967295,w=k+(S<<17&4294967295|S>>>15),S=E+(T^w&(k^T))+R[11]+2304563134&4294967295,E=w+(S<<22&4294967295|S>>>10),S=T+(k^E&(w^k))+R[12]+1804603682&4294967295,T=E+(S<<7&4294967295|S>>>25),S=k+(w^T&(E^w))+R[13]+4254626195&4294967295,k=T+(S<<12&4294967295|S>>>20),S=w+(E^k&(T^E))+R[14]+2792965006&4294967295,w=k+(S<<17&4294967295|S>>>15),S=E+(T^w&(k^T))+R[15]+1236535329&4294967295,E=w+(S<<22&4294967295|S>>>10),S=T+(w^k&(E^w))+R[1]+4129170786&4294967295,T=E+(S<<5&4294967295|S>>>27),S=k+(E^w&(T^E))+R[6]+3225465664&4294967295,k=T+(S<<9&4294967295|S>>>23),S=w+(T^E&(k^T))+R[11]+643717713&4294967295,w=k+(S<<14&4294967295|S>>>18),S=E+(k^T&(w^k))+R[0]+3921069994&4294967295,E=w+(S<<20&4294967295|S>>>12),S=T+(w^k&(E^w))+R[5]+3593408605&4294967295,T=E+(S<<5&4294967295|S>>>27),S=k+(E^w&(T^E))+R[10]+38016083&4294967295,k=T+(S<<9&4294967295|S>>>23),S=w+(T^E&(k^T))+R[15]+3634488961&4294967295,w=k+(S<<14&4294967295|S>>>18),S=E+(k^T&(w^k))+R[4]+3889429448&4294967295,E=w+(S<<20&4294967295|S>>>12),S=T+(w^k&(E^w))+R[9]+568446438&4294967295,T=E+(S<<5&4294967295|S>>>27),S=k+(E^w&(T^E))+R[14]+3275163606&4294967295,k=T+(S<<9&4294967295|S>>>23),S=w+(T^E&(k^T))+R[3]+4107603335&4294967295,w=k+(S<<14&4294967295|S>>>18),S=E+(k^T&(w^k))+R[8]+1163531501&4294967295,E=w+(S<<20&4294967295|S>>>12),S=T+(w^k&(E^w))+R[13]+2850285829&4294967295,T=E+(S<<5&4294967295|S>>>27),S=k+(E^w&(T^E))+R[2]+4243563512&4294967295,k=T+(S<<9&4294967295|S>>>23),S=w+(T^E&(k^T))+R[7]+1735328473&4294967295,w=k+(S<<14&4294967295|S>>>18),S=E+(k^T&(w^k))+R[12]+2368359562&4294967295,E=w+(S<<20&4294967295|S>>>12),S=T+(E^w^k)+R[5]+4294588738&4294967295,T=E+(S<<4&4294967295|S>>>28),S=k+(T^E^w)+R[8]+2272392833&4294967295,k=T+(S<<11&4294967295|S>>>21),S=w+(k^T^E)+R[11]+1839030562&4294967295,w=k+(S<<16&4294967295|S>>>16),S=E+(w^k^T)+R[14]+4259657740&4294967295,E=w+(S<<23&4294967295|S>>>9),S=T+(E^w^k)+R[1]+2763975236&4294967295,T=E+(S<<4&4294967295|S>>>28),S=k+(T^E^w)+R[4]+1272893353&4294967295,k=T+(S<<11&4294967295|S>>>21),S=w+(k^T^E)+R[7]+4139469664&4294967295,w=k+(S<<16&4294967295|S>>>16),S=E+(w^k^T)+R[10]+3200236656&4294967295,E=w+(S<<23&4294967295|S>>>9),S=T+(E^w^k)+R[13]+681279174&4294967295,T=E+(S<<4&4294967295|S>>>28),S=k+(T^E^w)+R[0]+3936430074&4294967295,k=T+(S<<11&4294967295|S>>>21),S=w+(k^T^E)+R[3]+3572445317&4294967295,w=k+(S<<16&4294967295|S>>>16),S=E+(w^k^T)+R[6]+76029189&4294967295,E=w+(S<<23&4294967295|S>>>9),S=T+(E^w^k)+R[9]+3654602809&4294967295,T=E+(S<<4&4294967295|S>>>28),S=k+(T^E^w)+R[12]+3873151461&4294967295,k=T+(S<<11&4294967295|S>>>21),S=w+(k^T^E)+R[15]+530742520&4294967295,w=k+(S<<16&4294967295|S>>>16),S=E+(w^k^T)+R[2]+3299628645&4294967295,E=w+(S<<23&4294967295|S>>>9),S=T+(w^(E|~k))+R[0]+4096336452&4294967295,T=E+(S<<6&4294967295|S>>>26),S=k+(E^(T|~w))+R[7]+1126891415&4294967295,k=T+(S<<10&4294967295|S>>>22),S=w+(T^(k|~E))+R[14]+2878612391&4294967295,w=k+(S<<15&4294967295|S>>>17),S=E+(k^(w|~T))+R[5]+4237533241&4294967295,E=w+(S<<21&4294967295|S>>>11),S=T+(w^(E|~k))+R[12]+1700485571&4294967295,T=E+(S<<6&4294967295|S>>>26),S=k+(E^(T|~w))+R[3]+2399980690&4294967295,k=T+(S<<10&4294967295|S>>>22),S=w+(T^(k|~E))+R[10]+4293915773&4294967295,w=k+(S<<15&4294967295|S>>>17),S=E+(k^(w|~T))+R[1]+2240044497&4294967295,E=w+(S<<21&4294967295|S>>>11),S=T+(w^(E|~k))+R[8]+1873313359&4294967295,T=E+(S<<6&4294967295|S>>>26),S=k+(E^(T|~w))+R[15]+4264355552&4294967295,k=T+(S<<10&4294967295|S>>>22),S=w+(T^(k|~E))+R[6]+2734768916&4294967295,w=k+(S<<15&4294967295|S>>>17),S=E+(k^(w|~T))+R[13]+1309151649&4294967295,E=w+(S<<21&4294967295|S>>>11),S=T+(w^(E|~k))+R[4]+4149444226&4294967295,T=E+(S<<6&4294967295|S>>>26),S=k+(E^(T|~w))+R[11]+3174756917&4294967295,k=T+(S<<10&4294967295|S>>>22),S=w+(T^(k|~E))+R[2]+718787259&4294967295,w=k+(S<<15&4294967295|S>>>17),S=E+(k^(w|~T))+R[9]+3951481745&4294967295,I.g[0]=I.g[0]+T&4294967295,I.g[1]=I.g[1]+(w+(S<<21&4294967295|S>>>11))&4294967295,I.g[2]=I.g[2]+w&4294967295,I.g[3]=I.g[3]+k&4294967295}i.prototype.u=function(I,T){T===void 0&&(T=I.length);for(var E=T-this.blockSize,R=this.B,w=this.h,k=0;k<T;){if(w==0)for(;k<=E;)r(this,I,k),k+=this.blockSize;if(typeof I=="string"){for(;k<T;)if(R[w++]=I.charCodeAt(k++),w==this.blockSize){r(this,R),w=0;break}}else for(;k<T;)if(R[w++]=I[k++],w==this.blockSize){r(this,R),w=0;break}}this.h=w,this.o+=T},i.prototype.v=function(){var I=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);I[0]=128;for(var T=1;T<I.length-8;++T)I[T]=0;var E=8*this.o;for(T=I.length-8;T<I.length;++T)I[T]=E&255,E/=256;for(this.u(I),I=Array(16),T=E=0;4>T;++T)for(var R=0;32>R;R+=8)I[E++]=this.g[T]>>>R&255;return I};function s(I,T){var E=a;return Object.prototype.hasOwnProperty.call(E,I)?E[I]:E[I]=T(I)}function o(I,T){this.h=T;for(var E=[],R=!0,w=I.length-1;0<=w;w--){var k=I[w]|0;R&&k==T||(E[w]=k,R=!1)}this.g=E}var a={};function c(I){return-128<=I&&128>I?s(I,function(T){return new o([T|0],0>T?-1:0)}):new o([I|0],0>I?-1:0)}function d(I){if(isNaN(I)||!isFinite(I))return p;if(0>I)return x(d(-I));for(var T=[],E=1,R=0;I>=E;R++)T[R]=I/E|0,E*=4294967296;return new o(T,0)}function h(I,T){if(I.length==0)throw Error("number format error: empty string");if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(I.charAt(0)=="-")return x(h(I.substring(1),T));if(0<=I.indexOf("-"))throw Error('number format error: interior "-" character');for(var E=d(Math.pow(T,8)),R=p,w=0;w<I.length;w+=8){var k=Math.min(8,I.length-w),S=parseInt(I.substring(w,w+k),T);8>k?(k=d(Math.pow(T,k)),R=R.j(k).add(d(S))):(R=R.j(E),R=R.add(d(S)))}return R}var p=c(0),g=c(1),_=c(16777216);n=o.prototype,n.m=function(){if(P(this))return-x(this).m();for(var I=0,T=1,E=0;E<this.g.length;E++){var R=this.i(E);I+=(0<=R?R:4294967296+R)*T,T*=4294967296}return I},n.toString=function(I){if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(C(this))return"0";if(P(this))return"-"+x(this).toString(I);for(var T=d(Math.pow(I,6)),E=this,R="";;){var w=O(E,T).g;E=F(E,w.j(T));var k=((0<E.g.length?E.g[0]:E.h)>>>0).toString(I);if(E=w,C(E))return k+R;for(;6>k.length;)k="0"+k;R=k+R}},n.i=function(I){return 0>I?0:I<this.g.length?this.g[I]:this.h};function C(I){if(I.h!=0)return!1;for(var T=0;T<I.g.length;T++)if(I.g[T]!=0)return!1;return!0}function P(I){return I.h==-1}n.l=function(I){return I=F(this,I),P(I)?-1:C(I)?0:1};function x(I){for(var T=I.g.length,E=[],R=0;R<T;R++)E[R]=~I.g[R];return new o(E,~I.h).add(g)}n.abs=function(){return P(this)?x(this):this},n.add=function(I){for(var T=Math.max(this.g.length,I.g.length),E=[],R=0,w=0;w<=T;w++){var k=R+(this.i(w)&65535)+(I.i(w)&65535),S=(k>>>16)+(this.i(w)>>>16)+(I.i(w)>>>16);R=S>>>16,k&=65535,S&=65535,E[w]=S<<16|k}return new o(E,E[E.length-1]&-2147483648?-1:0)};function F(I,T){return I.add(x(T))}n.j=function(I){if(C(this)||C(I))return p;if(P(this))return P(I)?x(this).j(x(I)):x(x(this).j(I));if(P(I))return x(this.j(x(I)));if(0>this.l(_)&&0>I.l(_))return d(this.m()*I.m());for(var T=this.g.length+I.g.length,E=[],R=0;R<2*T;R++)E[R]=0;for(R=0;R<this.g.length;R++)for(var w=0;w<I.g.length;w++){var k=this.i(R)>>>16,S=this.i(R)&65535,Tt=I.i(w)>>>16,st=I.i(w)&65535;E[2*R+2*w]+=S*st,L(E,2*R+2*w),E[2*R+2*w+1]+=k*st,L(E,2*R+2*w+1),E[2*R+2*w+1]+=S*Tt,L(E,2*R+2*w+1),E[2*R+2*w+2]+=k*Tt,L(E,2*R+2*w+2)}for(R=0;R<T;R++)E[R]=E[2*R+1]<<16|E[2*R];for(R=T;R<2*T;R++)E[R]=0;return new o(E,0)};function L(I,T){for(;(I[T]&65535)!=I[T];)I[T+1]+=I[T]>>>16,I[T]&=65535,T++}function V(I,T){this.g=I,this.h=T}function O(I,T){if(C(T))throw Error("division by zero");if(C(I))return new V(p,p);if(P(I))return T=O(x(I),T),new V(x(T.g),x(T.h));if(P(T))return T=O(I,x(T)),new V(x(T.g),T.h);if(30<I.g.length){if(P(I)||P(T))throw Error("slowDivide_ only works with positive integers.");for(var E=g,R=T;0>=R.l(I);)E=U(E),R=U(R);var w=q(E,1),k=q(R,1);for(R=q(R,2),E=q(E,2);!C(R);){var S=k.add(R);0>=S.l(I)&&(w=w.add(E),k=S),R=q(R,1),E=q(E,1)}return T=F(I,w.j(T)),new V(w,T)}for(w=p;0<=I.l(T);){for(E=Math.max(1,Math.floor(I.m()/T.m())),R=Math.ceil(Math.log(E)/Math.LN2),R=48>=R?1:Math.pow(2,R-48),k=d(E),S=k.j(T);P(S)||0<S.l(I);)E-=R,k=d(E),S=k.j(T);C(k)&&(k=g),w=w.add(k),I=F(I,S)}return new V(w,I)}n.A=function(I){return O(this,I).h},n.and=function(I){for(var T=Math.max(this.g.length,I.g.length),E=[],R=0;R<T;R++)E[R]=this.i(R)&I.i(R);return new o(E,this.h&I.h)},n.or=function(I){for(var T=Math.max(this.g.length,I.g.length),E=[],R=0;R<T;R++)E[R]=this.i(R)|I.i(R);return new o(E,this.h|I.h)},n.xor=function(I){for(var T=Math.max(this.g.length,I.g.length),E=[],R=0;R<T;R++)E[R]=this.i(R)^I.i(R);return new o(E,this.h^I.h)};function U(I){for(var T=I.g.length+1,E=[],R=0;R<T;R++)E[R]=I.i(R)<<1|I.i(R-1)>>>31;return new o(E,I.h)}function q(I,T){var E=T>>5;T%=32;for(var R=I.g.length-E,w=[],k=0;k<R;k++)w[k]=0<T?I.i(k+E)>>>T|I.i(k+E+1)<<32-T:I.i(k+E);return new o(w,I.h)}i.prototype.digest=i.prototype.v,i.prototype.reset=i.prototype.s,i.prototype.update=i.prototype.u,my=i,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=d,o.fromString=h,Vn=o}).apply(typeof ch<"u"?ch:typeof self<"u"?self:typeof window<"u"?window:{});var Bo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var gy,hs,yy,jo,Pu,_y,vy,Ty;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(f,m,y){return f==Array.prototype||f==Object.prototype||(f[m]=y.value),f};function t(f){f=[typeof globalThis=="object"&&globalThis,f,typeof window=="object"&&window,typeof self=="object"&&self,typeof Bo=="object"&&Bo];for(var m=0;m<f.length;++m){var y=f[m];if(y&&y.Math==Math)return y}throw Error("Cannot find global object")}var i=t(this);function r(f,m){if(m)e:{var y=i;f=f.split(".");for(var v=0;v<f.length-1;v++){var M=f[v];if(!(M in y))break e;y=y[M]}f=f[f.length-1],v=y[f],m=m(v),m!=v&&m!=null&&e(y,f,{configurable:!0,writable:!0,value:m})}}function s(f,m){f instanceof String&&(f+="");var y=0,v=!1,M={next:function(){if(!v&&y<f.length){var D=y++;return{value:m(D,f[D]),done:!1}}return v=!0,{done:!0,value:void 0}}};return M[Symbol.iterator]=function(){return M},M}r("Array.prototype.values",function(f){return f||function(){return s(this,function(m,y){return y})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function c(f){var m=typeof f;return m=m!="object"?m:f?Array.isArray(f)?"array":m:"null",m=="array"||m=="object"&&typeof f.length=="number"}function d(f){var m=typeof f;return m=="object"&&f!=null||m=="function"}function h(f,m,y){return f.call.apply(f.bind,arguments)}function p(f,m,y){if(!f)throw Error();if(2<arguments.length){var v=Array.prototype.slice.call(arguments,2);return function(){var M=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(M,v),f.apply(m,M)}}return function(){return f.apply(m,arguments)}}function g(f,m,y){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:p,g.apply(null,arguments)}function _(f,m){var y=Array.prototype.slice.call(arguments,1);return function(){var v=y.slice();return v.push.apply(v,arguments),f.apply(this,v)}}function C(f,m){function y(){}y.prototype=m.prototype,f.aa=m.prototype,f.prototype=new y,f.prototype.constructor=f,f.Qb=function(v,M,D){for(var z=Array(arguments.length-2),Ie=2;Ie<arguments.length;Ie++)z[Ie-2]=arguments[Ie];return m.prototype[M].apply(v,z)}}function P(f){const m=f.length;if(0<m){const y=Array(m);for(let v=0;v<m;v++)y[v]=f[v];return y}return[]}function x(f,m){for(let y=1;y<arguments.length;y++){const v=arguments[y];if(c(v)){const M=f.length||0,D=v.length||0;f.length=M+D;for(let z=0;z<D;z++)f[M+z]=v[z]}else f.push(v)}}class F{constructor(m,y){this.i=m,this.j=y,this.h=0,this.g=null}get(){let m;return 0<this.h?(this.h--,m=this.g,this.g=m.next,m.next=null):m=this.i(),m}}function L(f){return/^[\s\xa0]*$/.test(f)}function V(){var f=a.navigator;return f&&(f=f.userAgent)?f:""}function O(f){return O[" "](f),f}O[" "]=function(){};var U=V().indexOf("Gecko")!=-1&&!(V().toLowerCase().indexOf("webkit")!=-1&&V().indexOf("Edge")==-1)&&!(V().indexOf("Trident")!=-1||V().indexOf("MSIE")!=-1)&&V().indexOf("Edge")==-1;function q(f,m,y){for(const v in f)m.call(y,f[v],v,f)}function I(f,m){for(const y in f)m.call(void 0,f[y],y,f)}function T(f){const m={};for(const y in f)m[y]=f[y];return m}const E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function R(f,m){let y,v;for(let M=1;M<arguments.length;M++){v=arguments[M];for(y in v)f[y]=v[y];for(let D=0;D<E.length;D++)y=E[D],Object.prototype.hasOwnProperty.call(v,y)&&(f[y]=v[y])}}function w(f){var m=1;f=f.split(":");const y=[];for(;0<m&&f.length;)y.push(f.shift()),m--;return f.length&&y.push(f.join(":")),y}function k(f){a.setTimeout(()=>{throw f},0)}function S(){var f=kl;let m=null;return f.g&&(m=f.g,f.g=f.g.next,f.g||(f.h=null),m.next=null),m}class Tt{constructor(){this.h=this.g=null}add(m,y){const v=st.get();v.set(m,y),this.h?this.h.next=v:this.g=v,this.h=v}}var st=new F(()=>new $r,f=>f.reset());class $r{constructor(){this.next=this.g=this.h=null}set(m,y){this.h=m,this.g=y,this.next=null}reset(){this.next=this.g=this.h=null}}let Gr,Hr=!1,kl=new Tt,Dd=()=>{const f=a.Promise.resolve(void 0);Gr=()=>{f.then(yT)}};var yT=()=>{for(var f;f=S();){try{f.h.call(f.g)}catch(y){k(y)}var m=st;m.j(f),100>m.h&&(m.h++,f.next=m.g,m.g=f)}Hr=!1};function gn(){this.s=this.s,this.C=this.C}gn.prototype.s=!1,gn.prototype.ma=function(){this.s||(this.s=!0,this.N())},gn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ye(f,m){this.type=f,this.g=this.target=m,this.defaultPrevented=!1}Ye.prototype.h=function(){this.defaultPrevented=!0};var _T=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var f=!1,m=Object.defineProperty({},"passive",{get:function(){f=!0}});try{const y=()=>{};a.addEventListener("test",y,m),a.removeEventListener("test",y,m)}catch{}return f}();function zr(f,m){if(Ye.call(this,f?f.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,f){var y=this.type=f.type,v=f.changedTouches&&f.changedTouches.length?f.changedTouches[0]:null;if(this.target=f.target||f.srcElement,this.g=m,m=f.relatedTarget){if(U){e:{try{O(m.nodeName);var M=!0;break e}catch{}M=!1}M||(m=null)}}else y=="mouseover"?m=f.fromElement:y=="mouseout"&&(m=f.toElement);this.relatedTarget=m,v?(this.clientX=v.clientX!==void 0?v.clientX:v.pageX,this.clientY=v.clientY!==void 0?v.clientY:v.pageY,this.screenX=v.screenX||0,this.screenY=v.screenY||0):(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0),this.button=f.button,this.key=f.key||"",this.ctrlKey=f.ctrlKey,this.altKey=f.altKey,this.shiftKey=f.shiftKey,this.metaKey=f.metaKey,this.pointerId=f.pointerId||0,this.pointerType=typeof f.pointerType=="string"?f.pointerType:vT[f.pointerType]||"",this.state=f.state,this.i=f,f.defaultPrevented&&zr.aa.h.call(this)}}C(zr,Ye);var vT={2:"touch",3:"pen",4:"mouse"};zr.prototype.h=function(){zr.aa.h.call(this);var f=this.i;f.preventDefault?f.preventDefault():f.returnValue=!1};var To="closure_listenable_"+(1e6*Math.random()|0),TT=0;function ET(f,m,y,v,M){this.listener=f,this.proxy=null,this.src=m,this.type=y,this.capture=!!v,this.ha=M,this.key=++TT,this.da=this.fa=!1}function Eo(f){f.da=!0,f.listener=null,f.proxy=null,f.src=null,f.ha=null}function Io(f){this.src=f,this.g={},this.h=0}Io.prototype.add=function(f,m,y,v,M){var D=f.toString();f=this.g[D],f||(f=this.g[D]=[],this.h++);var z=Ml(f,m,v,M);return-1<z?(m=f[z],y||(m.fa=!1)):(m=new ET(m,this.src,D,!!v,M),m.fa=y,f.push(m)),m};function bl(f,m){var y=m.type;if(y in f.g){var v=f.g[y],M=Array.prototype.indexOf.call(v,m,void 0),D;(D=0<=M)&&Array.prototype.splice.call(v,M,1),D&&(Eo(m),f.g[y].length==0&&(delete f.g[y],f.h--))}}function Ml(f,m,y,v){for(var M=0;M<f.length;++M){var D=f[M];if(!D.da&&D.listener==m&&D.capture==!!y&&D.ha==v)return M}return-1}var Dl="closure_lm_"+(1e6*Math.random()|0),Nl={};function Nd(f,m,y,v,M){if(Array.isArray(m)){for(var D=0;D<m.length;D++)Nd(f,m[D],y,v,M);return null}return y=Fd(y),f&&f[To]?f.K(m,y,d(v)?!!v.capture:!1,M):IT(f,m,y,!1,v,M)}function IT(f,m,y,v,M,D){if(!m)throw Error("Invalid event type");var z=d(M)?!!M.capture:!!M,Ie=Ll(f);if(Ie||(f[Dl]=Ie=new Io(f)),y=Ie.add(m,y,v,z,D),y.proxy)return y;if(v=CT(),y.proxy=v,v.src=f,v.listener=y,f.addEventListener)_T||(M=z),M===void 0&&(M=!1),f.addEventListener(m.toString(),v,M);else if(f.attachEvent)f.attachEvent(Ld(m.toString()),v);else if(f.addListener&&f.removeListener)f.addListener(v);else throw Error("addEventListener and attachEvent are unavailable.");return y}function CT(){function f(y){return m.call(f.src,f.listener,y)}const m=wT;return f}function Vd(f,m,y,v,M){if(Array.isArray(m))for(var D=0;D<m.length;D++)Vd(f,m[D],y,v,M);else v=d(v)?!!v.capture:!!v,y=Fd(y),f&&f[To]?(f=f.i,m=String(m).toString(),m in f.g&&(D=f.g[m],y=Ml(D,y,v,M),-1<y&&(Eo(D[y]),Array.prototype.splice.call(D,y,1),D.length==0&&(delete f.g[m],f.h--)))):f&&(f=Ll(f))&&(m=f.g[m.toString()],f=-1,m&&(f=Ml(m,y,v,M)),(y=-1<f?m[f]:null)&&Vl(y))}function Vl(f){if(typeof f!="number"&&f&&!f.da){var m=f.src;if(m&&m[To])bl(m.i,f);else{var y=f.type,v=f.proxy;m.removeEventListener?m.removeEventListener(y,v,f.capture):m.detachEvent?m.detachEvent(Ld(y),v):m.addListener&&m.removeListener&&m.removeListener(v),(y=Ll(m))?(bl(y,f),y.h==0&&(y.src=null,m[Dl]=null)):Eo(f)}}}function Ld(f){return f in Nl?Nl[f]:Nl[f]="on"+f}function wT(f,m){if(f.da)f=!0;else{m=new zr(m,this);var y=f.listener,v=f.ha||f.src;f.fa&&Vl(f),f=y.call(v,m)}return f}function Ll(f){return f=f[Dl],f instanceof Io?f:null}var Fl="__closure_events_fn_"+(1e9*Math.random()>>>0);function Fd(f){return typeof f=="function"?f:(f[Fl]||(f[Fl]=function(m){return f.handleEvent(m)}),f[Fl])}function Xe(){gn.call(this),this.i=new Io(this),this.M=this,this.F=null}C(Xe,gn),Xe.prototype[To]=!0,Xe.prototype.removeEventListener=function(f,m,y,v){Vd(this,f,m,y,v)};function ot(f,m){var y,v=f.F;if(v)for(y=[];v;v=v.F)y.push(v);if(f=f.M,v=m.type||m,typeof m=="string")m=new Ye(m,f);else if(m instanceof Ye)m.target=m.target||f;else{var M=m;m=new Ye(v,f),R(m,M)}if(M=!0,y)for(var D=y.length-1;0<=D;D--){var z=m.g=y[D];M=Co(z,v,!0,m)&&M}if(z=m.g=f,M=Co(z,v,!0,m)&&M,M=Co(z,v,!1,m)&&M,y)for(D=0;D<y.length;D++)z=m.g=y[D],M=Co(z,v,!1,m)&&M}Xe.prototype.N=function(){if(Xe.aa.N.call(this),this.i){var f=this.i,m;for(m in f.g){for(var y=f.g[m],v=0;v<y.length;v++)Eo(y[v]);delete f.g[m],f.h--}}this.F=null},Xe.prototype.K=function(f,m,y,v){return this.i.add(String(f),m,!1,y,v)},Xe.prototype.L=function(f,m,y,v){return this.i.add(String(f),m,!0,y,v)};function Co(f,m,y,v){if(m=f.i.g[String(m)],!m)return!0;m=m.concat();for(var M=!0,D=0;D<m.length;++D){var z=m[D];if(z&&!z.da&&z.capture==y){var Ie=z.listener,ze=z.ha||z.src;z.fa&&bl(f.i,z),M=Ie.call(ze,v)!==!1&&M}}return M&&!v.defaultPrevented}function Ud(f,m,y){if(typeof f=="function")y&&(f=g(f,y));else if(f&&typeof f.handleEvent=="function")f=g(f.handleEvent,f);else throw Error("Invalid listener argument");return 2147483647<Number(m)?-1:a.setTimeout(f,m||0)}function Od(f){f.g=Ud(()=>{f.g=null,f.i&&(f.i=!1,Od(f))},f.l);const m=f.h;f.h=null,f.m.apply(null,m)}class AT extends gn{constructor(m,y){super(),this.m=m,this.l=y,this.h=null,this.i=!1,this.g=null}j(m){this.h=arguments,this.g?this.i=!0:Od(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Wr(f){gn.call(this),this.h=f,this.g={}}C(Wr,gn);var Bd=[];function qd(f){q(f.g,function(m,y){this.g.hasOwnProperty(y)&&Vl(m)},f),f.g={}}Wr.prototype.N=function(){Wr.aa.N.call(this),qd(this)},Wr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ul=a.JSON.stringify,ST=a.JSON.parse,RT=class{stringify(f){return a.JSON.stringify(f,void 0)}parse(f){return a.JSON.parse(f,void 0)}};function Ol(){}Ol.prototype.h=null;function $d(f){return f.h||(f.h=f.i())}function Gd(){}var Kr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Bl(){Ye.call(this,"d")}C(Bl,Ye);function ql(){Ye.call(this,"c")}C(ql,Ye);var Yn={},Hd=null;function wo(){return Hd=Hd||new Xe}Yn.La="serverreachability";function zd(f){Ye.call(this,Yn.La,f)}C(zd,Ye);function Jr(f){const m=wo();ot(m,new zd(m))}Yn.STAT_EVENT="statevent";function Wd(f,m){Ye.call(this,Yn.STAT_EVENT,f),this.stat=m}C(Wd,Ye);function at(f){const m=wo();ot(m,new Wd(m,f))}Yn.Ma="timingevent";function Kd(f,m){Ye.call(this,Yn.Ma,f),this.size=m}C(Kd,Ye);function Yr(f,m){if(typeof f!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){f()},m)}function Xr(){this.g=!0}Xr.prototype.xa=function(){this.g=!1};function PT(f,m,y,v,M,D){f.info(function(){if(f.g)if(D)for(var z="",Ie=D.split("&"),ze=0;ze<Ie.length;ze++){var me=Ie[ze].split("=");if(1<me.length){var Qe=me[0];me=me[1];var Ze=Qe.split("_");z=2<=Ze.length&&Ze[1]=="type"?z+(Qe+"="+me+"&"):z+(Qe+"=redacted&")}}else z=null;else z=D;return"XMLHTTP REQ ("+v+") [attempt "+M+"]: "+m+`
`+y+`
`+z})}function xT(f,m,y,v,M,D,z){f.info(function(){return"XMLHTTP RESP ("+v+") [ attempt "+M+"]: "+m+`
`+y+`
`+D+" "+z})}function Ui(f,m,y,v){f.info(function(){return"XMLHTTP TEXT ("+m+"): "+bT(f,y)+(v?" "+v:"")})}function kT(f,m){f.info(function(){return"TIMEOUT: "+m})}Xr.prototype.info=function(){};function bT(f,m){if(!f.g)return m;if(!m)return null;try{var y=JSON.parse(m);if(y){for(f=0;f<y.length;f++)if(Array.isArray(y[f])){var v=y[f];if(!(2>v.length)){var M=v[1];if(Array.isArray(M)&&!(1>M.length)){var D=M[0];if(D!="noop"&&D!="stop"&&D!="close")for(var z=1;z<M.length;z++)M[z]=""}}}}return Ul(y)}catch{return m}}var Ao={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Jd={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},$l;function So(){}C(So,Ol),So.prototype.g=function(){return new XMLHttpRequest},So.prototype.i=function(){return{}},$l=new So;function yn(f,m,y,v){this.j=f,this.i=m,this.l=y,this.R=v||1,this.U=new Wr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Yd}function Yd(){this.i=null,this.g="",this.h=!1}var Xd={},Gl={};function Hl(f,m,y){f.L=1,f.v=ko(Qt(m)),f.m=y,f.P=!0,Qd(f,null)}function Qd(f,m){f.F=Date.now(),Ro(f),f.A=Qt(f.v);var y=f.A,v=f.R;Array.isArray(v)||(v=[String(v)]),ff(y.i,"t",v),f.C=0,y=f.j.J,f.h=new Yd,f.g=kf(f.j,y?m:null,!f.m),0<f.O&&(f.M=new AT(g(f.Y,f,f.g),f.O)),m=f.U,y=f.g,v=f.ca;var M="readystatechange";Array.isArray(M)||(M&&(Bd[0]=M.toString()),M=Bd);for(var D=0;D<M.length;D++){var z=Nd(y,M[D],v||m.handleEvent,!1,m.h||m);if(!z)break;m.g[z.key]=z}m=f.H?T(f.H):{},f.m?(f.u||(f.u="POST"),m["Content-Type"]="application/x-www-form-urlencoded",f.g.ea(f.A,f.u,f.m,m)):(f.u="GET",f.g.ea(f.A,f.u,null,m)),Jr(),PT(f.i,f.u,f.A,f.l,f.R,f.m)}yn.prototype.ca=function(f){f=f.target;const m=this.M;m&&Zt(f)==3?m.j():this.Y(f)},yn.prototype.Y=function(f){try{if(f==this.g)e:{const Ze=Zt(this.g);var m=this.g.Ba();const qi=this.g.Z();if(!(3>Ze)&&(Ze!=3||this.g&&(this.h.h||this.g.oa()||vf(this.g)))){this.J||Ze!=4||m==7||(m==8||0>=qi?Jr(3):Jr(2)),zl(this);var y=this.g.Z();this.X=y;t:if(Zd(this)){var v=vf(this.g);f="";var M=v.length,D=Zt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Xn(this),Qr(this);var z="";break t}this.h.i=new a.TextDecoder}for(m=0;m<M;m++)this.h.h=!0,f+=this.h.i.decode(v[m],{stream:!(D&&m==M-1)});v.length=0,this.h.g+=f,this.C=0,z=this.h.g}else z=this.g.oa();if(this.o=y==200,xT(this.i,this.u,this.A,this.l,this.R,Ze,y),this.o){if(this.T&&!this.K){t:{if(this.g){var Ie,ze=this.g;if((Ie=ze.g?ze.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!L(Ie)){var me=Ie;break t}}me=null}if(y=me)Ui(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Wl(this,y);else{this.o=!1,this.s=3,at(12),Xn(this),Qr(this);break e}}if(this.P){y=!0;let Pt;for(;!this.J&&this.C<z.length;)if(Pt=MT(this,z),Pt==Gl){Ze==4&&(this.s=4,at(14),y=!1),Ui(this.i,this.l,null,"[Incomplete Response]");break}else if(Pt==Xd){this.s=4,at(15),Ui(this.i,this.l,z,"[Invalid Chunk]"),y=!1;break}else Ui(this.i,this.l,Pt,null),Wl(this,Pt);if(Zd(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ze!=4||z.length!=0||this.h.h||(this.s=1,at(16),y=!1),this.o=this.o&&y,!y)Ui(this.i,this.l,z,"[Invalid Chunked Response]"),Xn(this),Qr(this);else if(0<z.length&&!this.W){this.W=!0;var Qe=this.j;Qe.g==this&&Qe.ba&&!Qe.M&&(Qe.j.info("Great, no buffering proxy detected. Bytes received: "+z.length),Zl(Qe),Qe.M=!0,at(11))}}else Ui(this.i,this.l,z,null),Wl(this,z);Ze==4&&Xn(this),this.o&&!this.J&&(Ze==4?Sf(this.j,this):(this.o=!1,Ro(this)))}else YT(this.g),y==400&&0<z.indexOf("Unknown SID")?(this.s=3,at(12)):(this.s=0,at(13)),Xn(this),Qr(this)}}}catch{}finally{}};function Zd(f){return f.g?f.u=="GET"&&f.L!=2&&f.j.Ca:!1}function MT(f,m){var y=f.C,v=m.indexOf(`
`,y);return v==-1?Gl:(y=Number(m.substring(y,v)),isNaN(y)?Xd:(v+=1,v+y>m.length?Gl:(m=m.slice(v,v+y),f.C=v+y,m)))}yn.prototype.cancel=function(){this.J=!0,Xn(this)};function Ro(f){f.S=Date.now()+f.I,jd(f,f.I)}function jd(f,m){if(f.B!=null)throw Error("WatchDog timer not null");f.B=Yr(g(f.ba,f),m)}function zl(f){f.B&&(a.clearTimeout(f.B),f.B=null)}yn.prototype.ba=function(){this.B=null;const f=Date.now();0<=f-this.S?(kT(this.i,this.A),this.L!=2&&(Jr(),at(17)),Xn(this),this.s=2,Qr(this)):jd(this,this.S-f)};function Qr(f){f.j.G==0||f.J||Sf(f.j,f)}function Xn(f){zl(f);var m=f.M;m&&typeof m.ma=="function"&&m.ma(),f.M=null,qd(f.U),f.g&&(m=f.g,f.g=null,m.abort(),m.ma())}function Wl(f,m){try{var y=f.j;if(y.G!=0&&(y.g==f||Kl(y.h,f))){if(!f.K&&Kl(y.h,f)&&y.G==3){try{var v=y.Da.g.parse(m)}catch{v=null}if(Array.isArray(v)&&v.length==3){var M=v;if(M[0]==0){e:if(!y.u){if(y.g)if(y.g.F+3e3<f.F)Lo(y),No(y);else break e;Ql(y),at(18)}}else y.za=M[1],0<y.za-y.T&&37500>M[2]&&y.F&&y.v==0&&!y.C&&(y.C=Yr(g(y.Za,y),6e3));if(1>=nf(y.h)&&y.ca){try{y.ca()}catch{}y.ca=void 0}}else Zn(y,11)}else if((f.K||y.g==f)&&Lo(y),!L(m))for(M=y.Da.g.parse(m),m=0;m<M.length;m++){let me=M[m];if(y.T=me[0],me=me[1],y.G==2)if(me[0]=="c"){y.K=me[1],y.ia=me[2];const Qe=me[3];Qe!=null&&(y.la=Qe,y.j.info("VER="+y.la));const Ze=me[4];Ze!=null&&(y.Aa=Ze,y.j.info("SVER="+y.Aa));const qi=me[5];qi!=null&&typeof qi=="number"&&0<qi&&(v=1.5*qi,y.L=v,y.j.info("backChannelRequestTimeoutMs_="+v)),v=y;const Pt=f.g;if(Pt){const Uo=Pt.g?Pt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Uo){var D=v.h;D.g||Uo.indexOf("spdy")==-1&&Uo.indexOf("quic")==-1&&Uo.indexOf("h2")==-1||(D.j=D.l,D.g=new Set,D.h&&(Jl(D,D.h),D.h=null))}if(v.D){const jl=Pt.g?Pt.g.getResponseHeader("X-HTTP-Session-Id"):null;jl&&(v.ya=jl,Ce(v.I,v.D,jl))}}y.G=3,y.l&&y.l.ua(),y.ba&&(y.R=Date.now()-f.F,y.j.info("Handshake RTT: "+y.R+"ms")),v=y;var z=f;if(v.qa=xf(v,v.J?v.ia:null,v.W),z.K){rf(v.h,z);var Ie=z,ze=v.L;ze&&(Ie.I=ze),Ie.B&&(zl(Ie),Ro(Ie)),v.g=z}else wf(v);0<y.i.length&&Vo(y)}else me[0]!="stop"&&me[0]!="close"||Zn(y,7);else y.G==3&&(me[0]=="stop"||me[0]=="close"?me[0]=="stop"?Zn(y,7):Xl(y):me[0]!="noop"&&y.l&&y.l.ta(me),y.v=0)}}Jr(4)}catch{}}var DT=class{constructor(f,m){this.g=f,this.map=m}};function ef(f){this.l=f||10,a.PerformanceNavigationTiming?(f=a.performance.getEntriesByType("navigation"),f=0<f.length&&(f[0].nextHopProtocol=="hq"||f[0].nextHopProtocol=="h2")):f=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=f?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function tf(f){return f.h?!0:f.g?f.g.size>=f.j:!1}function nf(f){return f.h?1:f.g?f.g.size:0}function Kl(f,m){return f.h?f.h==m:f.g?f.g.has(m):!1}function Jl(f,m){f.g?f.g.add(m):f.h=m}function rf(f,m){f.h&&f.h==m?f.h=null:f.g&&f.g.has(m)&&f.g.delete(m)}ef.prototype.cancel=function(){if(this.i=sf(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const f of this.g.values())f.cancel();this.g.clear()}};function sf(f){if(f.h!=null)return f.i.concat(f.h.D);if(f.g!=null&&f.g.size!==0){let m=f.i;for(const y of f.g.values())m=m.concat(y.D);return m}return P(f.i)}function NT(f){if(f.V&&typeof f.V=="function")return f.V();if(typeof Map<"u"&&f instanceof Map||typeof Set<"u"&&f instanceof Set)return Array.from(f.values());if(typeof f=="string")return f.split("");if(c(f)){for(var m=[],y=f.length,v=0;v<y;v++)m.push(f[v]);return m}m=[],y=0;for(v in f)m[y++]=f[v];return m}function VT(f){if(f.na&&typeof f.na=="function")return f.na();if(!f.V||typeof f.V!="function"){if(typeof Map<"u"&&f instanceof Map)return Array.from(f.keys());if(!(typeof Set<"u"&&f instanceof Set)){if(c(f)||typeof f=="string"){var m=[];f=f.length;for(var y=0;y<f;y++)m.push(y);return m}m=[],y=0;for(const v in f)m[y++]=v;return m}}}function of(f,m){if(f.forEach&&typeof f.forEach=="function")f.forEach(m,void 0);else if(c(f)||typeof f=="string")Array.prototype.forEach.call(f,m,void 0);else for(var y=VT(f),v=NT(f),M=v.length,D=0;D<M;D++)m.call(void 0,v[D],y&&y[D],f)}var af=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function LT(f,m){if(f){f=f.split("&");for(var y=0;y<f.length;y++){var v=f[y].indexOf("="),M=null;if(0<=v){var D=f[y].substring(0,v);M=f[y].substring(v+1)}else D=f[y];m(D,M?decodeURIComponent(M.replace(/\+/g," ")):"")}}}function Qn(f){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,f instanceof Qn){this.h=f.h,Po(this,f.j),this.o=f.o,this.g=f.g,xo(this,f.s),this.l=f.l;var m=f.i,y=new es;y.i=m.i,m.g&&(y.g=new Map(m.g),y.h=m.h),lf(this,y),this.m=f.m}else f&&(m=String(f).match(af))?(this.h=!1,Po(this,m[1]||"",!0),this.o=Zr(m[2]||""),this.g=Zr(m[3]||"",!0),xo(this,m[4]),this.l=Zr(m[5]||"",!0),lf(this,m[6]||"",!0),this.m=Zr(m[7]||"")):(this.h=!1,this.i=new es(null,this.h))}Qn.prototype.toString=function(){var f=[],m=this.j;m&&f.push(jr(m,uf,!0),":");var y=this.g;return(y||m=="file")&&(f.push("//"),(m=this.o)&&f.push(jr(m,uf,!0),"@"),f.push(encodeURIComponent(String(y)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y=this.s,y!=null&&f.push(":",String(y))),(y=this.l)&&(this.g&&y.charAt(0)!="/"&&f.push("/"),f.push(jr(y,y.charAt(0)=="/"?OT:UT,!0))),(y=this.i.toString())&&f.push("?",y),(y=this.m)&&f.push("#",jr(y,qT)),f.join("")};function Qt(f){return new Qn(f)}function Po(f,m,y){f.j=y?Zr(m,!0):m,f.j&&(f.j=f.j.replace(/:$/,""))}function xo(f,m){if(m){if(m=Number(m),isNaN(m)||0>m)throw Error("Bad port number "+m);f.s=m}else f.s=null}function lf(f,m,y){m instanceof es?(f.i=m,$T(f.i,f.h)):(y||(m=jr(m,BT)),f.i=new es(m,f.h))}function Ce(f,m,y){f.i.set(m,y)}function ko(f){return Ce(f,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),f}function Zr(f,m){return f?m?decodeURI(f.replace(/%25/g,"%2525")):decodeURIComponent(f):""}function jr(f,m,y){return typeof f=="string"?(f=encodeURI(f).replace(m,FT),y&&(f=f.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f):null}function FT(f){return f=f.charCodeAt(0),"%"+(f>>4&15).toString(16)+(f&15).toString(16)}var uf=/[#\/\?@]/g,UT=/[#\?:]/g,OT=/[#\?]/g,BT=/[#\?@]/g,qT=/#/g;function es(f,m){this.h=this.g=null,this.i=f||null,this.j=!!m}function _n(f){f.g||(f.g=new Map,f.h=0,f.i&&LT(f.i,function(m,y){f.add(decodeURIComponent(m.replace(/\+/g," ")),y)}))}n=es.prototype,n.add=function(f,m){_n(this),this.i=null,f=Oi(this,f);var y=this.g.get(f);return y||this.g.set(f,y=[]),y.push(m),this.h+=1,this};function cf(f,m){_n(f),m=Oi(f,m),f.g.has(m)&&(f.i=null,f.h-=f.g.get(m).length,f.g.delete(m))}function df(f,m){return _n(f),m=Oi(f,m),f.g.has(m)}n.forEach=function(f,m){_n(this),this.g.forEach(function(y,v){y.forEach(function(M){f.call(m,M,v,this)},this)},this)},n.na=function(){_n(this);const f=Array.from(this.g.values()),m=Array.from(this.g.keys()),y=[];for(let v=0;v<m.length;v++){const M=f[v];for(let D=0;D<M.length;D++)y.push(m[v])}return y},n.V=function(f){_n(this);let m=[];if(typeof f=="string")df(this,f)&&(m=m.concat(this.g.get(Oi(this,f))));else{f=Array.from(this.g.values());for(let y=0;y<f.length;y++)m=m.concat(f[y])}return m},n.set=function(f,m){return _n(this),this.i=null,f=Oi(this,f),df(this,f)&&(this.h-=this.g.get(f).length),this.g.set(f,[m]),this.h+=1,this},n.get=function(f,m){return f?(f=this.V(f),0<f.length?String(f[0]):m):m};function ff(f,m,y){cf(f,m),0<y.length&&(f.i=null,f.g.set(Oi(f,m),P(y)),f.h+=y.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const f=[],m=Array.from(this.g.keys());for(var y=0;y<m.length;y++){var v=m[y];const D=encodeURIComponent(String(v)),z=this.V(v);for(v=0;v<z.length;v++){var M=D;z[v]!==""&&(M+="="+encodeURIComponent(String(z[v]))),f.push(M)}}return this.i=f.join("&")};function Oi(f,m){return m=String(m),f.j&&(m=m.toLowerCase()),m}function $T(f,m){m&&!f.j&&(_n(f),f.i=null,f.g.forEach(function(y,v){var M=v.toLowerCase();v!=M&&(cf(this,v),ff(this,M,y))},f)),f.j=m}function GT(f,m){const y=new Xr;if(a.Image){const v=new Image;v.onload=_(vn,y,"TestLoadImage: loaded",!0,m,v),v.onerror=_(vn,y,"TestLoadImage: error",!1,m,v),v.onabort=_(vn,y,"TestLoadImage: abort",!1,m,v),v.ontimeout=_(vn,y,"TestLoadImage: timeout",!1,m,v),a.setTimeout(function(){v.ontimeout&&v.ontimeout()},1e4),v.src=f}else m(!1)}function HT(f,m){const y=new Xr,v=new AbortController,M=setTimeout(()=>{v.abort(),vn(y,"TestPingServer: timeout",!1,m)},1e4);fetch(f,{signal:v.signal}).then(D=>{clearTimeout(M),D.ok?vn(y,"TestPingServer: ok",!0,m):vn(y,"TestPingServer: server error",!1,m)}).catch(()=>{clearTimeout(M),vn(y,"TestPingServer: error",!1,m)})}function vn(f,m,y,v,M){try{M&&(M.onload=null,M.onerror=null,M.onabort=null,M.ontimeout=null),v(y)}catch{}}function zT(){this.g=new RT}function WT(f,m,y){const v=y||"";try{of(f,function(M,D){let z=M;d(M)&&(z=Ul(M)),m.push(v+D+"="+encodeURIComponent(z))})}catch(M){throw m.push(v+"type="+encodeURIComponent("_badmap")),M}}function bo(f){this.l=f.Ub||null,this.j=f.eb||!1}C(bo,Ol),bo.prototype.g=function(){return new Mo(this.l,this.j)},bo.prototype.i=function(f){return function(){return f}}({});function Mo(f,m){Xe.call(this),this.D=f,this.o=m,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}C(Mo,Xe),n=Mo.prototype,n.open=function(f,m){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=f,this.A=m,this.readyState=1,ns(this)},n.send=function(f){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const m={headers:this.u,method:this.B,credentials:this.m,cache:void 0};f&&(m.body=f),(this.D||a).fetch(new Request(this.A,m)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ts(this)),this.readyState=0},n.Sa=function(f){if(this.g&&(this.l=f,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=f.headers,this.readyState=2,ns(this)),this.g&&(this.readyState=3,ns(this),this.g)))if(this.responseType==="arraybuffer")f.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in f){if(this.j=f.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;hf(this)}else f.text().then(this.Ra.bind(this),this.ga.bind(this))};function hf(f){f.j.read().then(f.Pa.bind(f)).catch(f.ga.bind(f))}n.Pa=function(f){if(this.g){if(this.o&&f.value)this.response.push(f.value);else if(!this.o){var m=f.value?f.value:new Uint8Array(0);(m=this.v.decode(m,{stream:!f.done}))&&(this.response=this.responseText+=m)}f.done?ts(this):ns(this),this.readyState==3&&hf(this)}},n.Ra=function(f){this.g&&(this.response=this.responseText=f,ts(this))},n.Qa=function(f){this.g&&(this.response=f,ts(this))},n.ga=function(){this.g&&ts(this)};function ts(f){f.readyState=4,f.l=null,f.j=null,f.v=null,ns(f)}n.setRequestHeader=function(f,m){this.u.append(f,m)},n.getResponseHeader=function(f){return this.h&&this.h.get(f.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const f=[],m=this.h.entries();for(var y=m.next();!y.done;)y=y.value,f.push(y[0]+": "+y[1]),y=m.next();return f.join(`\r
`)};function ns(f){f.onreadystatechange&&f.onreadystatechange.call(f)}Object.defineProperty(Mo.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(f){this.m=f?"include":"same-origin"}});function pf(f){let m="";return q(f,function(y,v){m+=v,m+=":",m+=y,m+=`\r
`}),m}function Yl(f,m,y){e:{for(v in y){var v=!1;break e}v=!0}v||(y=pf(y),typeof f=="string"?y!=null&&encodeURIComponent(String(y)):Ce(f,m,y))}function xe(f){Xe.call(this),this.headers=new Map,this.o=f||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}C(xe,Xe);var KT=/^https?$/i,JT=["POST","PUT"];n=xe.prototype,n.Ha=function(f){this.J=f},n.ea=function(f,m,y,v){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+f);m=m?m.toUpperCase():"GET",this.D=f,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():$l.g(),this.v=this.o?$d(this.o):$d($l),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(m,String(f),!0),this.B=!1}catch(D){mf(this,D);return}if(f=y||"",y=new Map(this.headers),v)if(Object.getPrototypeOf(v)===Object.prototype)for(var M in v)y.set(M,v[M]);else if(typeof v.keys=="function"&&typeof v.get=="function")for(const D of v.keys())y.set(D,v.get(D));else throw Error("Unknown input type for opt_headers: "+String(v));v=Array.from(y.keys()).find(D=>D.toLowerCase()=="content-type"),M=a.FormData&&f instanceof a.FormData,!(0<=Array.prototype.indexOf.call(JT,m,void 0))||v||M||y.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[D,z]of y)this.g.setRequestHeader(D,z);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{_f(this),this.u=!0,this.g.send(f),this.u=!1}catch(D){mf(this,D)}};function mf(f,m){f.h=!1,f.g&&(f.j=!0,f.g.abort(),f.j=!1),f.l=m,f.m=5,gf(f),Do(f)}function gf(f){f.A||(f.A=!0,ot(f,"complete"),ot(f,"error"))}n.abort=function(f){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=f||7,ot(this,"complete"),ot(this,"abort"),Do(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Do(this,!0)),xe.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?yf(this):this.bb())},n.bb=function(){yf(this)};function yf(f){if(f.h&&typeof o<"u"&&(!f.v[1]||Zt(f)!=4||f.Z()!=2)){if(f.u&&Zt(f)==4)Ud(f.Ea,0,f);else if(ot(f,"readystatechange"),Zt(f)==4){f.h=!1;try{const z=f.Z();e:switch(z){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var m=!0;break e;default:m=!1}var y;if(!(y=m)){var v;if(v=z===0){var M=String(f.D).match(af)[1]||null;!M&&a.self&&a.self.location&&(M=a.self.location.protocol.slice(0,-1)),v=!KT.test(M?M.toLowerCase():"")}y=v}if(y)ot(f,"complete"),ot(f,"success");else{f.m=6;try{var D=2<Zt(f)?f.g.statusText:""}catch{D=""}f.l=D+" ["+f.Z()+"]",gf(f)}}finally{Do(f)}}}}function Do(f,m){if(f.g){_f(f);const y=f.g,v=f.v[0]?()=>{}:null;f.g=null,f.v=null,m||ot(f,"ready");try{y.onreadystatechange=v}catch{}}}function _f(f){f.I&&(a.clearTimeout(f.I),f.I=null)}n.isActive=function(){return!!this.g};function Zt(f){return f.g?f.g.readyState:0}n.Z=function(){try{return 2<Zt(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(f){if(this.g){var m=this.g.responseText;return f&&m.indexOf(f)==0&&(m=m.substring(f.length)),ST(m)}};function vf(f){try{if(!f.g)return null;if("response"in f.g)return f.g.response;switch(f.H){case"":case"text":return f.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in f.g)return f.g.mozResponseArrayBuffer}return null}catch{return null}}function YT(f){const m={};f=(f.g&&2<=Zt(f)&&f.g.getAllResponseHeaders()||"").split(`\r
`);for(let v=0;v<f.length;v++){if(L(f[v]))continue;var y=w(f[v]);const M=y[0];if(y=y[1],typeof y!="string")continue;y=y.trim();const D=m[M]||[];m[M]=D,D.push(y)}I(m,function(v){return v.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function is(f,m,y){return y&&y.internalChannelParams&&y.internalChannelParams[f]||m}function Tf(f){this.Aa=0,this.i=[],this.j=new Xr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=is("failFast",!1,f),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=is("baseRetryDelayMs",5e3,f),this.cb=is("retryDelaySeedMs",1e4,f),this.Wa=is("forwardChannelMaxRetries",2,f),this.wa=is("forwardChannelRequestTimeoutMs",2e4,f),this.pa=f&&f.xmlHttpFactory||void 0,this.Xa=f&&f.Tb||void 0,this.Ca=f&&f.useFetchStreams||!1,this.L=void 0,this.J=f&&f.supportsCrossDomainXhr||!1,this.K="",this.h=new ef(f&&f.concurrentRequestLimit),this.Da=new zT,this.P=f&&f.fastHandshake||!1,this.O=f&&f.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=f&&f.Rb||!1,f&&f.xa&&this.j.xa(),f&&f.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&f&&f.detectBufferingProxy||!1,this.ja=void 0,f&&f.longPollingTimeout&&0<f.longPollingTimeout&&(this.ja=f.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Tf.prototype,n.la=8,n.G=1,n.connect=function(f,m,y,v){at(0),this.W=f,this.H=m||{},y&&v!==void 0&&(this.H.OSID=y,this.H.OAID=v),this.F=this.X,this.I=xf(this,null,this.W),Vo(this)};function Xl(f){if(Ef(f),f.G==3){var m=f.U++,y=Qt(f.I);if(Ce(y,"SID",f.K),Ce(y,"RID",m),Ce(y,"TYPE","terminate"),rs(f,y),m=new yn(f,f.j,m),m.L=2,m.v=ko(Qt(y)),y=!1,a.navigator&&a.navigator.sendBeacon)try{y=a.navigator.sendBeacon(m.v.toString(),"")}catch{}!y&&a.Image&&(new Image().src=m.v,y=!0),y||(m.g=kf(m.j,null),m.g.ea(m.v)),m.F=Date.now(),Ro(m)}Pf(f)}function No(f){f.g&&(Zl(f),f.g.cancel(),f.g=null)}function Ef(f){No(f),f.u&&(a.clearTimeout(f.u),f.u=null),Lo(f),f.h.cancel(),f.s&&(typeof f.s=="number"&&a.clearTimeout(f.s),f.s=null)}function Vo(f){if(!tf(f.h)&&!f.s){f.s=!0;var m=f.Ga;Gr||Dd(),Hr||(Gr(),Hr=!0),kl.add(m,f),f.B=0}}function XT(f,m){return nf(f.h)>=f.h.j-(f.s?1:0)?!1:f.s?(f.i=m.D.concat(f.i),!0):f.G==1||f.G==2||f.B>=(f.Va?0:f.Wa)?!1:(f.s=Yr(g(f.Ga,f,m),Rf(f,f.B)),f.B++,!0)}n.Ga=function(f){if(this.s)if(this.s=null,this.G==1){if(!f){this.U=Math.floor(1e5*Math.random()),f=this.U++;const M=new yn(this,this.j,f);let D=this.o;if(this.S&&(D?(D=T(D),R(D,this.S)):D=this.S),this.m!==null||this.O||(M.H=D,D=null),this.P)e:{for(var m=0,y=0;y<this.i.length;y++){t:{var v=this.i[y];if("__data__"in v.map&&(v=v.map.__data__,typeof v=="string")){v=v.length;break t}v=void 0}if(v===void 0)break;if(m+=v,4096<m){m=y;break e}if(m===4096||y===this.i.length-1){m=y+1;break e}}m=1e3}else m=1e3;m=Cf(this,M,m),y=Qt(this.I),Ce(y,"RID",f),Ce(y,"CVER",22),this.D&&Ce(y,"X-HTTP-Session-Id",this.D),rs(this,y),D&&(this.O?m="headers="+encodeURIComponent(String(pf(D)))+"&"+m:this.m&&Yl(y,this.m,D)),Jl(this.h,M),this.Ua&&Ce(y,"TYPE","init"),this.P?(Ce(y,"$req",m),Ce(y,"SID","null"),M.T=!0,Hl(M,y,null)):Hl(M,y,m),this.G=2}}else this.G==3&&(f?If(this,f):this.i.length==0||tf(this.h)||If(this))};function If(f,m){var y;m?y=m.l:y=f.U++;const v=Qt(f.I);Ce(v,"SID",f.K),Ce(v,"RID",y),Ce(v,"AID",f.T),rs(f,v),f.m&&f.o&&Yl(v,f.m,f.o),y=new yn(f,f.j,y,f.B+1),f.m===null&&(y.H=f.o),m&&(f.i=m.D.concat(f.i)),m=Cf(f,y,1e3),y.I=Math.round(.5*f.wa)+Math.round(.5*f.wa*Math.random()),Jl(f.h,y),Hl(y,v,m)}function rs(f,m){f.H&&q(f.H,function(y,v){Ce(m,v,y)}),f.l&&of({},function(y,v){Ce(m,v,y)})}function Cf(f,m,y){y=Math.min(f.i.length,y);var v=f.l?g(f.l.Na,f.l,f):null;e:{var M=f.i;let D=-1;for(;;){const z=["count="+y];D==-1?0<y?(D=M[0].g,z.push("ofs="+D)):D=0:z.push("ofs="+D);let Ie=!0;for(let ze=0;ze<y;ze++){let me=M[ze].g;const Qe=M[ze].map;if(me-=D,0>me)D=Math.max(0,M[ze].g-100),Ie=!1;else try{WT(Qe,z,"req"+me+"_")}catch{v&&v(Qe)}}if(Ie){v=z.join("&");break e}}}return f=f.i.splice(0,y),m.D=f,v}function wf(f){if(!f.g&&!f.u){f.Y=1;var m=f.Fa;Gr||Dd(),Hr||(Gr(),Hr=!0),kl.add(m,f),f.v=0}}function Ql(f){return f.g||f.u||3<=f.v?!1:(f.Y++,f.u=Yr(g(f.Fa,f),Rf(f,f.v)),f.v++,!0)}n.Fa=function(){if(this.u=null,Af(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var f=2*this.R;this.j.info("BP detection timer enabled: "+f),this.A=Yr(g(this.ab,this),f)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,at(10),No(this),Af(this))};function Zl(f){f.A!=null&&(a.clearTimeout(f.A),f.A=null)}function Af(f){f.g=new yn(f,f.j,"rpc",f.Y),f.m===null&&(f.g.H=f.o),f.g.O=0;var m=Qt(f.qa);Ce(m,"RID","rpc"),Ce(m,"SID",f.K),Ce(m,"AID",f.T),Ce(m,"CI",f.F?"0":"1"),!f.F&&f.ja&&Ce(m,"TO",f.ja),Ce(m,"TYPE","xmlhttp"),rs(f,m),f.m&&f.o&&Yl(m,f.m,f.o),f.L&&(f.g.I=f.L);var y=f.g;f=f.ia,y.L=1,y.v=ko(Qt(m)),y.m=null,y.P=!0,Qd(y,f)}n.Za=function(){this.C!=null&&(this.C=null,No(this),Ql(this),at(19))};function Lo(f){f.C!=null&&(a.clearTimeout(f.C),f.C=null)}function Sf(f,m){var y=null;if(f.g==m){Lo(f),Zl(f),f.g=null;var v=2}else if(Kl(f.h,m))y=m.D,rf(f.h,m),v=1;else return;if(f.G!=0){if(m.o)if(v==1){y=m.m?m.m.length:0,m=Date.now()-m.F;var M=f.B;v=wo(),ot(v,new Kd(v,y)),Vo(f)}else wf(f);else if(M=m.s,M==3||M==0&&0<m.X||!(v==1&&XT(f,m)||v==2&&Ql(f)))switch(y&&0<y.length&&(m=f.h,m.i=m.i.concat(y)),M){case 1:Zn(f,5);break;case 4:Zn(f,10);break;case 3:Zn(f,6);break;default:Zn(f,2)}}}function Rf(f,m){let y=f.Ta+Math.floor(Math.random()*f.cb);return f.isActive()||(y*=2),y*m}function Zn(f,m){if(f.j.info("Error code "+m),m==2){var y=g(f.fb,f),v=f.Xa;const M=!v;v=new Qn(v||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Po(v,"https"),ko(v),M?GT(v.toString(),y):HT(v.toString(),y)}else at(2);f.G=0,f.l&&f.l.sa(m),Pf(f),Ef(f)}n.fb=function(f){f?(this.j.info("Successfully pinged google.com"),at(2)):(this.j.info("Failed to ping google.com"),at(1))};function Pf(f){if(f.G=0,f.ka=[],f.l){const m=sf(f.h);(m.length!=0||f.i.length!=0)&&(x(f.ka,m),x(f.ka,f.i),f.h.i.length=0,P(f.i),f.i.length=0),f.l.ra()}}function xf(f,m,y){var v=y instanceof Qn?Qt(y):new Qn(y);if(v.g!="")m&&(v.g=m+"."+v.g),xo(v,v.s);else{var M=a.location;v=M.protocol,m=m?m+"."+M.hostname:M.hostname,M=+M.port;var D=new Qn(null);v&&Po(D,v),m&&(D.g=m),M&&xo(D,M),y&&(D.l=y),v=D}return y=f.D,m=f.ya,y&&m&&Ce(v,y,m),Ce(v,"VER",f.la),rs(f,v),v}function kf(f,m,y){if(m&&!f.J)throw Error("Can't create secondary domain capable XhrIo object.");return m=f.Ca&&!f.pa?new xe(new bo({eb:y})):new xe(f.pa),m.Ha(f.J),m}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function bf(){}n=bf.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Fo(){}Fo.prototype.g=function(f,m){return new gt(f,m)};function gt(f,m){Xe.call(this),this.g=new Tf(m),this.l=f,this.h=m&&m.messageUrlParams||null,f=m&&m.messageHeaders||null,m&&m.clientProtocolHeaderRequired&&(f?f["X-Client-Protocol"]="webchannel":f={"X-Client-Protocol":"webchannel"}),this.g.o=f,f=m&&m.initMessageHeaders||null,m&&m.messageContentType&&(f?f["X-WebChannel-Content-Type"]=m.messageContentType:f={"X-WebChannel-Content-Type":m.messageContentType}),m&&m.va&&(f?f["X-WebChannel-Client-Profile"]=m.va:f={"X-WebChannel-Client-Profile":m.va}),this.g.S=f,(f=m&&m.Sb)&&!L(f)&&(this.g.m=f),this.v=m&&m.supportsCrossDomainXhr||!1,this.u=m&&m.sendRawJson||!1,(m=m&&m.httpSessionIdParam)&&!L(m)&&(this.g.D=m,f=this.h,f!==null&&m in f&&(f=this.h,m in f&&delete f[m])),this.j=new Bi(this)}C(gt,Xe),gt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},gt.prototype.close=function(){Xl(this.g)},gt.prototype.o=function(f){var m=this.g;if(typeof f=="string"){var y={};y.__data__=f,f=y}else this.u&&(y={},y.__data__=Ul(f),f=y);m.i.push(new DT(m.Ya++,f)),m.G==3&&Vo(m)},gt.prototype.N=function(){this.g.l=null,delete this.j,Xl(this.g),delete this.g,gt.aa.N.call(this)};function Mf(f){Bl.call(this),f.__headers__&&(this.headers=f.__headers__,this.statusCode=f.__status__,delete f.__headers__,delete f.__status__);var m=f.__sm__;if(m){e:{for(const y in m){f=y;break e}f=void 0}(this.i=f)&&(f=this.i,m=m!==null&&f in m?m[f]:void 0),this.data=m}else this.data=f}C(Mf,Bl);function Df(){ql.call(this),this.status=1}C(Df,ql);function Bi(f){this.g=f}C(Bi,bf),Bi.prototype.ua=function(){ot(this.g,"a")},Bi.prototype.ta=function(f){ot(this.g,new Mf(f))},Bi.prototype.sa=function(f){ot(this.g,new Df)},Bi.prototype.ra=function(){ot(this.g,"b")},Fo.prototype.createWebChannel=Fo.prototype.g,gt.prototype.send=gt.prototype.o,gt.prototype.open=gt.prototype.m,gt.prototype.close=gt.prototype.close,Ty=function(){return new Fo},vy=function(){return wo()},_y=Yn,Pu={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ao.NO_ERROR=0,Ao.TIMEOUT=8,Ao.HTTP_ERROR=6,jo=Ao,Jd.COMPLETE="complete",yy=Jd,Gd.EventType=Kr,Kr.OPEN="a",Kr.CLOSE="b",Kr.ERROR="c",Kr.MESSAGE="d",Xe.prototype.listen=Xe.prototype.K,hs=Gd,xe.prototype.listenOnce=xe.prototype.L,xe.prototype.getLastError=xe.prototype.Ka,xe.prototype.getLastErrorCode=xe.prototype.Ba,xe.prototype.getStatus=xe.prototype.Z,xe.prototype.getResponseJson=xe.prototype.Oa,xe.prototype.getResponseText=xe.prototype.oa,xe.prototype.send=xe.prototype.ea,xe.prototype.setWithCredentials=xe.prototype.Ha,gy=xe}).apply(typeof Bo<"u"?Bo:typeof self<"u"?self:typeof window<"u"?window:{});const dh="@firebase/firestore",fh="4.8.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class We{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}We.UNAUTHENTICATED=new We(null),We.GOOGLE_CREDENTIALS=new We("google-credentials-uid"),We.FIRST_PARTY=new We("first-party-uid"),We.MOCK_USER=new We("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Nr="11.10.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vi=new Cc("@firebase/firestore");function Yi(){return vi.logLevel}function B(n,...e){if(vi.logLevel<=le.DEBUG){const t=e.map(Vc);vi.debug(`Firestore (${Nr}): ${n}`,...t)}}function ut(n,...e){if(vi.logLevel<=le.ERROR){const t=e.map(Vc);vi.error(`Firestore (${Nr}): ${n}`,...t)}}function Wt(n,...e){if(vi.logLevel<=le.WARN){const t=e.map(Vc);vi.warn(`Firestore (${Nr}): ${n}`,...t)}}function Vc(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y(n,e,t){let i="Unexpected state";typeof e=="string"?i=e:t=e,Ey(n,i,t)}function Ey(n,e,t){let i=`FIRESTORE (${Nr}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{i+=" CONTEXT: "+JSON.stringify(t)}catch{i+=" CONTEXT: "+t}throw ut(i),new Error(i)}function Q(n,e,t,i){let r="Unexpected state";typeof t=="string"?r=t:i=t,n||Ey(e,r,i)}function re(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class H extends dn{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iy{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class zw{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(We.UNAUTHENTICATED))}shutdown(){}}class Ww{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Kw{constructor(e){this.t=e,this.currentUser=We.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Q(this.o===void 0,42304);let i=this.i;const r=c=>this.i!==i?(i=this.i,t(c)):Promise.resolve();let s=new rn;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new rn,e.enqueueRetryable(()=>r(this.currentUser))};const o=()=>{const c=s;e.enqueueRetryable(async()=>{await c.promise,await r(this.currentUser)})},a=c=>{B("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?a(c):(B("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new rn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(B("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(Q(typeof i.accessToken=="string",31837,{l:i}),new Iy(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Q(e===null||typeof e=="string",2055,{h:e}),new We(e)}}class Jw{constructor(e,t,i){this.P=e,this.T=t,this.I=i,this.type="FirstParty",this.user=We.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Yw{constructor(e,t,i){this.P=e,this.T=t,this.I=i}getToken(){return Promise.resolve(new Jw(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(We.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class hh{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Xw{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Et(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Q(this.o===void 0,3512);const i=s=>{s.error!=null&&B("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.m;return this.m=s.token,B("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>i(s))};const r=s=>{B("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?r(s):B("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new hh(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Q(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new hh(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qw(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cy(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lc{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let i="";for(;i.length<20;){const r=Qw(40);for(let s=0;s<r.length;++s)i.length<20&&r[s]<t&&(i+=e.charAt(r[s]%62))}return i}}function te(n,e){return n<e?-1:n>e?1:0}function xu(n,e){let t=0;for(;t<n.length&&t<e.length;){const i=n.codePointAt(t),r=e.codePointAt(t);if(i!==r){if(i<128&&r<128)return te(i,r);{const s=Cy(),o=Zw(s.encode(ph(n,t)),s.encode(ph(e,t)));return o!==0?o:te(i,r)}}t+=i>65535?2:1}return te(n.length,e.length)}function ph(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function Zw(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return te(n[t],e[t]);return te(n.length,e.length)}function dr(n,e,t){return n.length===e.length&&n.every((i,r)=>t(i,e[r]))}function wy(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mh="__name__";class Nt{constructor(e,t,i){t===void 0?t=0:t>e.length&&Y(637,{offset:t,range:e.length}),i===void 0?i=e.length-t:i>e.length-t&&Y(1746,{length:i,range:e.length-t}),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return Nt.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Nt?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let r=0;r<i;r++){const s=Nt.compareSegments(e.get(r),t.get(r));if(s!==0)return s}return te(e.length,t.length)}static compareSegments(e,t){const i=Nt.isNumericId(e),r=Nt.isNumericId(t);return i&&!r?-1:!i&&r?1:i&&r?Nt.extractNumericId(e).compare(Nt.extractNumericId(t)):xu(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Vn.fromString(e.substring(4,e.length-2))}}class ye extends Nt{construct(e,t,i){return new ye(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new H(N.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(r=>r.length>0))}return new ye(t)}static emptyPath(){return new ye([])}}const jw=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Pe extends Nt{construct(e,t,i){return new Pe(e,t,i)}static isValidIdentifier(e){return jw.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Pe.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===mh}static keyField(){return new Pe([mh])}static fromServerFormat(e){const t=[];let i="",r=0;const s=()=>{if(i.length===0)throw new H(N.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let o=!1;for(;r<e.length;){const a=e[r];if(a==="\\"){if(r+1===e.length)throw new H(N.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[r+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new H(N.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=c,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(i+=a,r++):(s(),r++)}if(s(),o)throw new H(N.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Pe(t)}static emptyPath(){return new Pe([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W{constructor(e){this.path=e}static fromPath(e){return new W(ye.fromString(e))}static fromName(e){return new W(ye.fromString(e).popFirst(5))}static empty(){return new W(ye.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ye.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ye.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new W(new ye(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ay(n,e,t){if(!t)throw new H(N.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function eA(n,e,t,i){if(e===!0&&i===!0)throw new H(N.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function gh(n){if(!W.isDocumentKey(n))throw new H(N.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function yh(n){if(W.isDocumentKey(n))throw new H(N.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Sy(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function tl(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(i){return i.constructor?i.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Y(12329,{type:typeof n})}function pt(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new H(N.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=tl(n);throw new H(N.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ue(n,e){const t={typeString:n};return e&&(t.value=e),t}function io(n,e){if(!Sy(n))throw new H(N.INVALID_ARGUMENT,"JSON must be an object");let t;for(const i in e)if(e[i]){const r=e[i].typeString,s="value"in e[i]?{value:e[i].value}:void 0;if(!(i in n)){t=`JSON missing required field: '${i}'`;break}const o=n[i];if(r&&typeof o!==r){t=`JSON field '${i}' must be a ${r}.`;break}if(s!==void 0&&o!==s.value){t=`Expected '${i}' field to equal '${s.value}'`;break}}if(t)throw new H(N.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _h=-62135596800,vh=1e6;class ue{static now(){return ue.fromMillis(Date.now())}static fromDate(e){return ue.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor((e-1e3*t)*vh);return new ue(t,i)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new H(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new H(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<_h)throw new H(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new H(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/vh}_compareTo(e){return this.seconds===e.seconds?te(this.nanoseconds,e.nanoseconds):te(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ue._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(io(e,ue._jsonSchema))return new ue(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-_h;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ue._jsonSchemaVersion="firestore/timestamp/1.0",ue._jsonSchema={type:Ue("string",ue._jsonSchemaVersion),seconds:Ue("number"),nanoseconds:Ue("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j{static fromTimestamp(e){return new j(e)}static min(){return new j(new ue(0,0))}static max(){return new j(new ue(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ls=-1;class Ia{constructor(e,t,i,r){this.indexId=e,this.collectionGroup=t,this.fields=i,this.indexState=r}}function ku(n){return n.fields.find(e=>e.kind===2)}function ni(n){return n.fields.filter(e=>e.kind!==2)}Ia.UNKNOWN_ID=-1;class ea{constructor(e,t){this.fieldPath=e,this.kind=t}}class Fs{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Fs(0,vt.min())}}function tA(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=j.fromTimestamp(i===1e9?new ue(t+1,0):new ue(t,i));return new vt(r,W.empty(),e)}function Ry(n){return new vt(n.readTime,n.key,Ls)}class vt{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new vt(j.min(),W.empty(),Ls)}static max(){return new vt(j.max(),W.empty(),Ls)}}function Fc(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=W.comparator(n.documentKey,e.documentKey),t!==0?t:te(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Py="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class xy{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ni(n){if(n.code!==N.FAILED_PRECONDITION||n.message!==Py)throw n;B("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Y(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new b((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(i,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof b?t:b.resolve(t)}catch(t){return b.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):b.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):b.reject(t)}static resolve(e){return new b((t,i)=>{t(e)})}static reject(e){return new b((t,i)=>{i(e)})}static waitFor(e){return new b((t,i)=>{let r=0,s=0,o=!1;e.forEach(a=>{++r,a.next(()=>{++s,o&&s===r&&t()},c=>i(c))}),o=!0,s===r&&t()})}static or(e){let t=b.resolve(!1);for(const i of e)t=t.next(r=>r?b.resolve(r):i());return t}static forEach(e,t){const i=[];return e.forEach((r,s)=>{i.push(t.call(this,r,s))}),this.waitFor(i)}static mapArray(e,t){return new b((i,r)=>{const s=e.length,o=new Array(s);let a=0;for(let c=0;c<s;c++){const d=c;t(e[d]).next(h=>{o[d]=h,++a,a===s&&i(o)},h=>r(h))}})}static doWhile(e,t){return new b((i,r)=>{const s=()=>{e()===!0?t().next(()=>{s()},r):i()};s()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yt="SimpleDb";class nl{static open(e,t,i,r){try{return new nl(t,e.transaction(r,i))}catch(s){throw new Is(t,s)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new rn,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Is(e,t.error)):this.S.resolve()},this.transaction.onerror=i=>{const r=Uc(i.target.error);this.S.reject(new Is(e,r))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(B(yt,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new iA(t)}}class Ln{static delete(e){return B(yt,"Removing database:",e),ri(vg().indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!Pg())return!1;if(Ln.F())return!0;const e=qe(),t=Ln.M(e),i=0<t&&t<10,r=ky(e),s=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||i||s)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.O)==="YES"}static N(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),i=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(i)}constructor(e,t,i){this.name=e,this.version=t,this.B=i,this.L=null,Ln.M(qe())===12.2&&ut("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async k(e){return this.db||(B(yt,"Opening database:",this.name),this.db=await new Promise((t,i)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=s=>{const o=s.target.result;t(o)},r.onblocked=()=>{i(new Is(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=s=>{const o=s.target.error;o.name==="VersionError"?i(new H(N.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?i(new H(N.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):i(new Is(e,o))},r.onupgradeneeded=s=>{B(yt,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);const o=s.target.result;if(this.L!==null&&this.L!==s.oldVersion)throw new Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${s.oldVersion}, event.newVersion=${s.newVersion}, db.version=${o.version}`);this.B.q(o,r.transaction,s.oldVersion,this.version).next(()=>{B(yt,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",t=>{const i=t.target;this.L=i.version},{passive:!0})),this.db.addEventListener("versionchange",t=>{var i;t.newVersion===null&&(Wt('Received "versionchange" event with newVersion===null; notifying the registered DatabaseDeletedListener, if any'),(i=this.databaseDeletedListener)===null||i===void 0||i.call(this))},{passive:!0}),this.db}setDatabaseDeletedListener(e){if(this.databaseDeletedListener)throw new Error("setDatabaseDeletedListener() may only be called once, and it has already been called");this.databaseDeletedListener=e}async runTransaction(e,t,i,r){const s=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.k(e);const a=nl.open(this.db,e,s?"readonly":"readwrite",i),c=r(a).next(d=>(a.v(),d)).catch(d=>(a.abort(d),b.reject(d))).toPromise();return c.catch(()=>{}),await a.D,c}catch(a){const c=a,d=c.name!=="FirebaseError"&&o<3;if(B(yt,"Transaction failed with error:",c.message,"Retrying:",d),this.close(),!d)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}function ky(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class nA{constructor(e){this.$=e,this.U=!1,this.K=null}get isDone(){return this.U}get W(){return this.K}set cursor(e){this.$=e}done(){this.U=!0}G(e){this.K=e}delete(){return ri(this.$.delete())}}class Is extends H{constructor(e,t){super(N.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Kn(n){return n.name==="IndexedDbTransactionError"}class iA{constructor(e){this.store=e}put(e,t){let i;return t!==void 0?(B(yt,"PUT",this.store.name,e,t),i=this.store.put(t,e)):(B(yt,"PUT",this.store.name,"<auto-key>",e),i=this.store.put(e)),ri(i)}add(e){return B(yt,"ADD",this.store.name,e,e),ri(this.store.add(e))}get(e){return ri(this.store.get(e)).next(t=>(t===void 0&&(t=null),B(yt,"GET",this.store.name,e,t),t))}delete(e){return B(yt,"DELETE",this.store.name,e),ri(this.store.delete(e))}count(){return B(yt,"COUNT",this.store.name),ri(this.store.count())}j(e,t){const i=this.options(e,t),r=i.index?this.store.index(i.index):this.store;if(typeof r.getAll=="function"){const s=r.getAll(i.range);return new b((o,a)=>{s.onerror=c=>{a(c.target.error)},s.onsuccess=c=>{o(c.target.result)}})}{const s=this.cursor(i),o=[];return this.J(s,(a,c)=>{o.push(c)}).next(()=>o)}}H(e,t){const i=this.store.getAll(e,t===null?void 0:t);return new b((r,s)=>{i.onerror=o=>{s(o.target.error)},i.onsuccess=o=>{r(o.target.result)}})}Y(e,t){B(yt,"DELETE ALL",this.store.name);const i=this.options(e,t);i.Z=!1;const r=this.cursor(i);return this.J(r,(s,o,a)=>a.delete())}X(e,t){let i;t?i=e:(i={},t=e);const r=this.cursor(i);return this.J(r,t)}ee(e){const t=this.cursor({});return new b((i,r)=>{t.onerror=s=>{const o=Uc(s.target.error);r(o)},t.onsuccess=s=>{const o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():i()}):i()}})}J(e,t){const i=[];return new b((r,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void r();const c=new nA(a),d=t(a.primaryKey,a.value,c);if(d instanceof b){const h=d.catch(p=>(c.done(),b.reject(p)));i.push(h)}c.isDone?r():c.W===null?a.continue():a.continue(c.W)}}).next(()=>b.waitFor(i))}options(e,t){let i;return e!==void 0&&(typeof e=="string"?i=e:t=e),{index:i,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const i=this.store.index(e.index);return e.Z?i.openKeyCursor(e.range,t):i.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ri(n){return new b((e,t)=>{n.onsuccess=i=>{const r=i.target.result;e(r)},n.onerror=i=>{const r=Uc(i.target.error);t(r)}})}let Th=!1;function Uc(n){const e=Ln.M(qe());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const i=new H("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Th||(Th=!0,setTimeout(()=>{throw i},0)),i}}return n}const Cs="IndexBackfiller";class rA{constructor(e,t){this.asyncQueue=e,this.te=t,this.task=null}start(){this.ne(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ne(e){B(Cs,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const t=await this.te.re();B(Cs,`Documents written: ${t}`)}catch(t){Kn(t)?B(Cs,"Ignoring IndexedDB error during index backfill: ",t):await Ni(t)}await this.ne(6e4)})}}class sA{constructor(e,t){this.localStore=e,this.persistence=t}async re(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.ie(t,e))}ie(e,t){const i=new Set;let r=t,s=!0;return b.doWhile(()=>s===!0&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!i.has(o))return B(Cs,`Processing collection: ${o}`),this.se(e,o,r).next(a=>{r-=a,i.add(o)});s=!1})).next(()=>t-r)}se(e,t,i){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,i).next(s=>{const o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.oe(r,s)).next(a=>(B(Cs,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}oe(e,t){let i=e;return t.changes.forEach((r,s)=>{const o=Ry(s);Fc(o,i)>0&&(i=o)}),new vt(i.readTime,i.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=i=>this._e(i),this.ae=i=>t.writeSequenceNumber(i))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ae&&this.ae(e),e}}wt.ue=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ci=-1;function il(n){return n==null}function Us(n){return n===0&&1/n==-1/0}function oA(n){return typeof n=="number"&&Number.isInteger(n)&&!Us(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ca="";function it(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Eh(e)),e=aA(n.get(t),e);return Eh(e)}function aA(n,e){let t=e;const i=n.length;for(let r=0;r<i;r++){const s=n.charAt(r);switch(s){case"\0":t+="";break;case Ca:t+="";break;default:t+=s}}return t}function Eh(n){return n+Ca+""}function Vt(n){const e=n.length;if(Q(e>=2,64408,{path:n}),e===2)return Q(n.charAt(0)===Ca&&n.charAt(1)==="",56145,{path:n}),ye.emptyPath();const t=e-2,i=[];let r="";for(let s=0;s<e;){const o=n.indexOf(Ca,s);switch((o<0||o>t)&&Y(50515,{path:n}),n.charAt(o+1)){case"":const a=n.substring(s,o);let c;r.length===0?c=a:(r+=a,c=r,r=""),i.push(c);break;case"":r+=n.substring(s,o),r+="\0";break;case"":r+=n.substring(s,o+1);break;default:Y(61167,{path:n})}s=o+2}return new ye(i)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ii="remoteDocuments",ro="owner",$i="owner",Os="mutationQueues",lA="userId",xt="mutations",Ih="batchId",li="userMutationsIndex",Ch=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ta(n,e){return[n,it(e)]}function by(n,e,t){return[n,it(e),t]}const uA={},fr="documentMutations",wa="remoteDocumentsV14",cA=["prefixPath","collectionGroup","readTime","documentId"],na="documentKeyIndex",dA=["prefixPath","collectionGroup","documentId"],My="collectionGroupIndex",fA=["collectionGroup","readTime","prefixPath","documentId"],Bs="remoteDocumentGlobal",bu="remoteDocumentGlobalKey",hr="targets",Dy="queryTargetsIndex",hA=["canonicalId","targetId"],pr="targetDocuments",pA=["targetId","path"],Oc="documentTargetsIndex",mA=["path","targetId"],Aa="targetGlobalKey",di="targetGlobal",qs="collectionParents",gA=["collectionId","parent"],mr="clientMetadata",yA="clientId",rl="bundles",_A="bundleId",sl="namedQueries",vA="name",Bc="indexConfiguration",TA="indexId",Mu="collectionGroupIndex",EA="collectionGroup",ws="indexState",IA=["indexId","uid"],Ny="sequenceNumberIndex",CA=["uid","sequenceNumber"],As="indexEntries",wA=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Vy="documentKeyIndex",AA=["indexId","uid","orderedDocumentKey"],ol="documentOverlays",SA=["userId","collectionPath","documentId"],Du="collectionPathOverlayIndex",RA=["userId","collectionPath","largestBatchId"],Ly="collectionGroupOverlayIndex",PA=["userId","collectionGroup","largestBatchId"],qc="globals",xA="name",Fy=[Os,xt,fr,ii,hr,ro,di,pr,mr,Bs,qs,rl,sl],kA=[...Fy,ol],Uy=[Os,xt,fr,wa,hr,ro,di,pr,mr,Bs,qs,rl,sl,ol],Oy=Uy,$c=[...Oy,Bc,ws,As],bA=$c,By=[...$c,qc],MA=By;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nu extends xy{constructor(e,t){super(),this.ce=e,this.currentSequenceNumber=t}}function $e(n,e){const t=re(n);return Ln.N(t.ce,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wh(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Jn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function qy(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Re{constructor(e,t){this.comparator=e,this.root=t||Ke.EMPTY}insert(e,t){return new Re(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ke.BLACK,null,null))}remove(e){return new Re(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ke.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const r=this.comparator(e,i.key);if(r===0)return t+i.left.size;r<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){const e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new qo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new qo(this.root,e,this.comparator,!1)}getReverseIterator(){return new qo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new qo(this.root,e,this.comparator,!0)}}class qo{constructor(e,t,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?i(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ke{constructor(e,t,i,r,s){this.key=e,this.value=t,this.color=i??Ke.RED,this.left=r??Ke.EMPTY,this.right=s??Ke.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,r,s){return new Ke(e??this.key,t??this.value,i??this.color,r??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let r=this;const s=i(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,i),null):s===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,i)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Ke.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return Ke.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ke.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ke.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Y(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Y(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Y(27949);return e+(this.isRed()?0:1)}}Ke.EMPTY=null,Ke.RED=!0,Ke.BLACK=!1;Ke.EMPTY=new class{constructor(){this.size=0}get key(){throw Y(57766)}get value(){throw Y(16141)}get color(){throw Y(16727)}get left(){throw Y(29726)}get right(){throw Y(36894)}copy(e,t,i,r,s){return this}insert(e,t,i){return new Ke(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ve{constructor(e){this.comparator=e,this.data=new Re(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const r=i.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ah(this.data.getIterator())}getIteratorFrom(e){return new Ah(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof ve)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=i.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ve(this.comparator);return t.data=e,t}}class Ah{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Gi(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ht{constructor(e){this.fields=e,e.sort(Pe.comparator)}static empty(){return new ht([])}unionWith(e){let t=new ve(Pe.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new ht(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return dr(this.fields,e.fields,(t,i)=>t.isEqual(i))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $y extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oe{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(r){try{return atob(r)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new $y("Invalid base64 string: "+s):s}}(e);return new Oe(t)}static fromUint8Array(e){const t=function(r){let s="";for(let o=0;o<r.length;++o)s+=String.fromCharCode(r[o]);return s}(e);return new Oe(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return te(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Oe.EMPTY_BYTE_STRING=new Oe("");const DA=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ln(n){if(Q(!!n,39018),typeof n=="string"){let e=0;const t=DA.exec(n);if(Q(!!t,46558,{timestamp:n}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Ae(n.seconds),nanos:Ae(n.nanos)}}function Ae(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function un(n){return typeof n=="string"?Oe.fromBase64String(n):Oe.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gy="server_timestamp",Hy="__type__",zy="__previous_value__",Wy="__local_write_time__";function Gc(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[Hy])===null||t===void 0?void 0:t.stringValue)===Gy}function al(n){const e=n.mapValue.fields[zy];return Gc(e)?al(e):e}function $s(n){const e=ln(n.mapValue.fields[Wy].timestampValue);return new ue(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NA{constructor(e,t,i,r,s,o,a,c,d,h){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=d,this.isUsingEmulator=h}}const Sa="(default)";class Ti{constructor(e,t){this.projectId=e,this.database=t||Sa}static empty(){return new Ti("","")}get isDefaultDatabase(){return this.database===Sa}isEqual(e){return e instanceof Ti&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hc="__type__",Ky="__max__",bn={mapValue:{fields:{__type__:{stringValue:Ky}}}},zc="__vector__",gr="value",ia={nullValue:"NULL_VALUE"};function Bn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Gc(n)?4:Jy(n)?9007199254740991:ll(n)?10:11:Y(28295,{value:n})}function Kt(n,e){if(n===e)return!0;const t=Bn(n);if(t!==Bn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return $s(n).isEqual($s(e));case 3:return function(r,s){if(typeof r.timestampValue=="string"&&typeof s.timestampValue=="string"&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;const o=ln(r.timestampValue),a=ln(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(r,s){return un(r.bytesValue).isEqual(un(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,s){return Ae(r.geoPointValue.latitude)===Ae(s.geoPointValue.latitude)&&Ae(r.geoPointValue.longitude)===Ae(s.geoPointValue.longitude)}(n,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return Ae(r.integerValue)===Ae(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){const o=Ae(r.doubleValue),a=Ae(s.doubleValue);return o===a?Us(o)===Us(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return dr(n.arrayValue.values||[],e.arrayValue.values||[],Kt);case 10:case 11:return function(r,s){const o=r.mapValue.fields||{},a=s.mapValue.fields||{};if(wh(o)!==wh(a))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!Kt(o[c],a[c])))return!1;return!0}(n,e);default:return Y(52216,{left:n})}}function Gs(n,e){return(n.values||[]).find(t=>Kt(t,e))!==void 0}function qn(n,e){if(n===e)return 0;const t=Bn(n),i=Bn(e);if(t!==i)return te(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return te(n.booleanValue,e.booleanValue);case 2:return function(s,o){const a=Ae(s.integerValue||s.doubleValue),c=Ae(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(n,e);case 3:return Sh(n.timestampValue,e.timestampValue);case 4:return Sh($s(n),$s(e));case 5:return xu(n.stringValue,e.stringValue);case 6:return function(s,o){const a=un(s),c=un(o);return a.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){const a=s.split("/"),c=o.split("/");for(let d=0;d<a.length&&d<c.length;d++){const h=te(a[d],c[d]);if(h!==0)return h}return te(a.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){const a=te(Ae(s.latitude),Ae(o.latitude));return a!==0?a:te(Ae(s.longitude),Ae(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Rh(n.arrayValue,e.arrayValue);case 10:return function(s,o){var a,c,d,h;const p=s.fields||{},g=o.fields||{},_=(a=p[gr])===null||a===void 0?void 0:a.arrayValue,C=(c=g[gr])===null||c===void 0?void 0:c.arrayValue,P=te(((d=_==null?void 0:_.values)===null||d===void 0?void 0:d.length)||0,((h=C==null?void 0:C.values)===null||h===void 0?void 0:h.length)||0);return P!==0?P:Rh(_,C)}(n.mapValue,e.mapValue);case 11:return function(s,o){if(s===bn.mapValue&&o===bn.mapValue)return 0;if(s===bn.mapValue)return 1;if(o===bn.mapValue)return-1;const a=s.fields||{},c=Object.keys(a),d=o.fields||{},h=Object.keys(d);c.sort(),h.sort();for(let p=0;p<c.length&&p<h.length;++p){const g=xu(c[p],h[p]);if(g!==0)return g;const _=qn(a[c[p]],d[h[p]]);if(_!==0)return _}return te(c.length,h.length)}(n.mapValue,e.mapValue);default:throw Y(23264,{le:t})}}function Sh(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return te(n,e);const t=ln(n),i=ln(e),r=te(t.seconds,i.seconds);return r!==0?r:te(t.nanos,i.nanos)}function Rh(n,e){const t=n.values||[],i=e.values||[];for(let r=0;r<t.length&&r<i.length;++r){const s=qn(t[r],i[r]);if(s)return s}return te(t.length,i.length)}function yr(n){return Vu(n)}function Vu(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const i=ln(t);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return un(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return W.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let i="[",r=!0;for(const s of t.values||[])r?r=!1:i+=",",i+=Vu(s);return i+"]"}(n.arrayValue):"mapValue"in n?function(t){const i=Object.keys(t.fields||{}).sort();let r="{",s=!0;for(const o of i)s?s=!1:r+=",",r+=`${o}:${Vu(t.fields[o])}`;return r+"}"}(n.mapValue):Y(61005,{value:n})}function ra(n){switch(Bn(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=al(n);return e?16+ra(e):16;case 5:return 2*n.stringValue.length;case 6:return un(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(i){return(i.values||[]).reduce((r,s)=>r+ra(s),0)}(n.arrayValue);case 10:case 11:return function(i){let r=0;return Jn(i.fields,(s,o)=>{r+=s.length+ra(o)}),r}(n.mapValue);default:throw Y(13486,{value:n})}}function Hs(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Lu(n){return!!n&&"integerValue"in n}function zs(n){return!!n&&"arrayValue"in n}function Ph(n){return!!n&&"nullValue"in n}function xh(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function sa(n){return!!n&&"mapValue"in n}function ll(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[Hc])===null||t===void 0?void 0:t.stringValue)===zc}function Ss(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Jn(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=Ss(i)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ss(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Jy(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Ky}const Yy={mapValue:{fields:{[Hc]:{stringValue:zc},[gr]:{arrayValue:{}}}}};function VA(n){return"nullValue"in n?ia:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Hs(Ti.empty(),W.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?ll(n)?Yy:{mapValue:{}}:Y(35942,{value:n})}function LA(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Hs(Ti.empty(),W.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?Yy:"mapValue"in n?ll(n)?{mapValue:{}}:bn:Y(61959,{value:n})}function kh(n,e){const t=qn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function bh(n,e){const t=qn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tt{constructor(e){this.value=e}static empty(){return new tt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!sa(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ss(t)}setAll(e){let t=Pe.emptyPath(),i={},r=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const c=this.getFieldsMap(t);this.applyChanges(c,i,r),i={},r=[],t=a.popLast()}o?i[a.lastSegment()]=Ss(o):r.push(a.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,i,r)}delete(e){const t=this.field(e.popLast());sa(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Kt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let r=t.mapValue.fields[e.get(i)];sa(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,i){Jn(t,(r,s)=>e[r]=s);for(const r of i)delete e[r]}clone(){return new tt(Ss(this.value))}}function Xy(n){const e=[];return Jn(n.fields,(t,i)=>{const r=new Pe([t]);if(sa(i)){const s=Xy(i.mapValue).fields;if(s.length===0)e.push(r);else for(const o of s)e.push(r.child(o))}else e.push(r)}),new ht(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ke{constructor(e,t,i,r,s,o,a){this.key=e,this.documentType=t,this.version=i,this.readTime=r,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new ke(e,0,j.min(),j.min(),j.min(),tt.empty(),0)}static newFoundDocument(e,t,i,r){return new ke(e,1,t,j.min(),i,r,0)}static newNoDocument(e,t){return new ke(e,2,t,j.min(),j.min(),tt.empty(),0)}static newUnknownDocument(e,t){return new ke(e,3,t,j.min(),j.min(),tt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(j.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=tt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=tt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=j.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ke&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ke(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _r{constructor(e,t){this.position=e,this.inclusive=t}}function Mh(n,e,t){let i=0;for(let r=0;r<n.position.length;r++){const s=e[r],o=n.position[r];if(s.field.isKeyField()?i=W.comparator(W.fromName(o.referenceValue),t.key):i=qn(o,t.data.field(s.field)),s.dir==="desc"&&(i*=-1),i!==0)break}return i}function Dh(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Kt(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ra{constructor(e,t="asc"){this.field=e,this.dir=t}}function FA(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qy{}class ce extends Qy{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new UA(e,t,i):t==="array-contains"?new qA(e,i):t==="in"?new i_(e,i):t==="not-in"?new $A(e,i):t==="array-contains-any"?new GA(e,i):new ce(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new OA(e,i):new BA(e,i)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(qn(t,this.value)):t!==null&&Bn(this.value)===Bn(t)&&this.matchesComparison(qn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Y(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class _e extends Qy{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new _e(e,t)}matches(e){return vr(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}}function vr(n){return n.op==="and"}function Fu(n){return n.op==="or"}function Wc(n){return Zy(n)&&vr(n)}function Zy(n){for(const e of n.filters)if(e instanceof _e)return!1;return!0}function Uu(n){if(n instanceof ce)return n.field.canonicalString()+n.op.toString()+yr(n.value);if(Wc(n))return n.filters.map(e=>Uu(e)).join(",");{const e=n.filters.map(t=>Uu(t)).join(",");return`${n.op}(${e})`}}function jy(n,e){return n instanceof ce?function(i,r){return r instanceof ce&&i.op===r.op&&i.field.isEqual(r.field)&&Kt(i.value,r.value)}(n,e):n instanceof _e?function(i,r){return r instanceof _e&&i.op===r.op&&i.filters.length===r.filters.length?i.filters.reduce((s,o,a)=>s&&jy(o,r.filters[a]),!0):!1}(n,e):void Y(19439)}function e_(n,e){const t=n.filters.concat(e);return _e.create(t,n.op)}function t_(n){return n instanceof ce?function(t){return`${t.field.canonicalString()} ${t.op} ${yr(t.value)}`}(n):n instanceof _e?function(t){return t.op.toString()+" {"+t.getFilters().map(t_).join(" ,")+"}"}(n):"Filter"}class UA extends ce{constructor(e,t,i){super(e,t,i),this.key=W.fromName(i.referenceValue)}matches(e){const t=W.comparator(e.key,this.key);return this.matchesComparison(t)}}class OA extends ce{constructor(e,t){super(e,"in",t),this.keys=n_("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class BA extends ce{constructor(e,t){super(e,"not-in",t),this.keys=n_("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function n_(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(i=>W.fromName(i.referenceValue))}class qA extends ce{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return zs(t)&&Gs(t.arrayValue,this.value)}}class i_ extends ce{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Gs(this.value.arrayValue,t)}}class $A extends ce{constructor(e,t){super(e,"not-in",t)}matches(e){if(Gs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Gs(this.value.arrayValue,t)}}class GA extends ce{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!zs(t)||!t.arrayValue.values)&&t.arrayValue.values.some(i=>Gs(this.value.arrayValue,i))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HA{constructor(e,t=null,i=[],r=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=o,this.endAt=a,this.Pe=null}}function Ou(n,e=null,t=[],i=[],r=null,s=null,o=null){return new HA(n,e,t,i,r,s,o)}function Ei(n){const e=re(n);if(e.Pe===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>Uu(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>function(s){return s.field.canonicalString()+s.dir}(i)).join(","),il(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>yr(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>yr(i)).join(",")),e.Pe=t}return e.Pe}function so(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!FA(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!jy(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Dh(n.startAt,e.startAt)&&Dh(n.endAt,e.endAt)}function Pa(n){return W.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function xa(n,e){return n.filters.filter(t=>t instanceof ce&&t.field.isEqual(e))}function Nh(n,e,t){let i=ia,r=!0;for(const s of xa(n,e)){let o=ia,a=!0;switch(s.op){case"<":case"<=":o=VA(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=ia}kh({value:i,inclusive:r},{value:o,inclusive:a})<0&&(i=o,r=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];kh({value:i,inclusive:r},{value:o,inclusive:t.inclusive})<0&&(i=o,r=t.inclusive);break}}return{value:i,inclusive:r}}function Vh(n,e,t){let i=bn,r=!0;for(const s of xa(n,e)){let o=bn,a=!0;switch(s.op){case">=":case">":o=LA(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=bn}bh({value:i,inclusive:r},{value:o,inclusive:a})>0&&(i=o,r=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];bh({value:i,inclusive:r},{value:o,inclusive:t.inclusive})>0&&(i=o,r=t.inclusive);break}}return{value:i,inclusive:r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oo{constructor(e,t=null,i=[],r=[],s=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}}function zA(n,e,t,i,r,s,o,a){return new oo(n,e,t,i,r,s,o,a)}function ul(n){return new oo(n)}function Lh(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function r_(n){return n.collectionGroup!==null}function Rs(n){const e=re(n);if(e.Te===null){e.Te=[];const t=new Set;for(const s of e.explicitOrderBy)e.Te.push(s),t.add(s.field.canonicalString());const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new ve(Pe.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(d=>{d.isInequality()&&(a=a.add(d.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Te.push(new Ra(s,i))}),t.has(Pe.keyField().canonicalString())||e.Te.push(new Ra(Pe.keyField(),i))}return e.Te}function At(n){const e=re(n);return e.Ie||(e.Ie=WA(e,Rs(n))),e.Ie}function WA(n,e){if(n.limitType==="F")return Ou(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(r=>{const s=r.dir==="desc"?"asc":"desc";return new Ra(r.field,s)});const t=n.endAt?new _r(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new _r(n.startAt.position,n.startAt.inclusive):null;return Ou(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function Bu(n,e){const t=n.filters.concat([e]);return new oo(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function qu(n,e,t){return new oo(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function cl(n,e){return so(At(n),At(e))&&n.limitType===e.limitType}function s_(n){return`${Ei(At(n))}|lt:${n.limitType}`}function Xi(n){return`Query(target=${function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map(r=>t_(r)).join(", ")}]`),il(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map(r=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(r)).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map(r=>yr(r)).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map(r=>yr(r)).join(",")),`Target(${i})`}(At(n))}; limitType=${n.limitType})`}function ao(n,e){return e.isFoundDocument()&&function(i,r){const s=r.key.path;return i.collectionGroup!==null?r.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(s):W.isDocumentKey(i.path)?i.path.isEqual(s):i.path.isImmediateParentOf(s)}(n,e)&&function(i,r){for(const s of Rs(i))if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1;return!0}(n,e)&&function(i,r){for(const s of i.filters)if(!s.matches(r))return!1;return!0}(n,e)&&function(i,r){return!(i.startAt&&!function(o,a,c){const d=Mh(o,a,c);return o.inclusive?d<=0:d<0}(i.startAt,Rs(i),r)||i.endAt&&!function(o,a,c){const d=Mh(o,a,c);return o.inclusive?d>=0:d>0}(i.endAt,Rs(i),r))}(n,e)}function KA(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function o_(n){return(e,t)=>{let i=!1;for(const r of Rs(n)){const s=JA(r,e,t);if(s!==0)return s;i=i||r.field.isKeyField()}return 0}}function JA(n,e,t){const i=n.field.isKeyField()?W.comparator(e.key,t.key):function(s,o,a){const c=o.data.field(s),d=a.data.field(s);return c!==null&&d!==null?qn(c,d):Y(42886)}(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return Y(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(const[r,s]of i)if(this.equalsFn(r,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const i=this.mapKeyFn(e),r=this.inner[i];if(r===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return i.length===1?delete this.inner[t]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Jn(this.inner,(t,i)=>{for(const[r,s]of i)e(r,s)})}isEmpty(){return qy(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YA=new Re(W.comparator);function _t(){return YA}const a_=new Re(W.comparator);function ps(...n){let e=a_;for(const t of n)e=e.insert(t.key,t);return e}function l_(n){let e=a_;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function Lt(){return Ps()}function u_(){return Ps()}function Ps(){return new fn(n=>n.toString(),(n,e)=>n.isEqual(e))}const XA=new Re(W.comparator),QA=new ve(W.comparator);function ae(...n){let e=QA;for(const t of n)e=e.add(t);return e}const ZA=new ve(te);function jA(){return ZA}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kc(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Us(e)?"-0":e}}function c_(n){return{integerValue:""+n}}function d_(n,e){return oA(e)?c_(e):Kc(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dl{constructor(){this._=void 0}}function eS(n,e,t){return n instanceof Ws?function(r,s){const o={fields:{[Hy]:{stringValue:Gy},[Wy]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&Gc(s)&&(s=al(s)),s&&(o.fields[zy]=s),{mapValue:o}}(t,e):n instanceof Ii?h_(n,e):n instanceof Tr?p_(n,e):function(r,s){const o=f_(r,s),a=Fh(o)+Fh(r.Ee);return Lu(o)&&Lu(r.Ee)?c_(a):Kc(r.serializer,a)}(n,e)}function tS(n,e,t){return n instanceof Ii?h_(n,e):n instanceof Tr?p_(n,e):t}function f_(n,e){return n instanceof Er?function(i){return Lu(i)||function(s){return!!s&&"doubleValue"in s}(i)}(e)?e:{integerValue:0}:null}class Ws extends dl{}class Ii extends dl{constructor(e){super(),this.elements=e}}function h_(n,e){const t=m_(e);for(const i of n.elements)t.some(r=>Kt(r,i))||t.push(i);return{arrayValue:{values:t}}}class Tr extends dl{constructor(e){super(),this.elements=e}}function p_(n,e){let t=m_(e);for(const i of n.elements)t=t.filter(r=>!Kt(r,i));return{arrayValue:{values:t}}}class Er extends dl{constructor(e,t){super(),this.serializer=e,this.Ee=t}}function Fh(n){return Ae(n.integerValue||n.doubleValue)}function m_(n){return zs(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jc{constructor(e,t){this.field=e,this.transform=t}}function nS(n,e){return n.field.isEqual(e.field)&&function(i,r){return i instanceof Ii&&r instanceof Ii||i instanceof Tr&&r instanceof Tr?dr(i.elements,r.elements,Kt):i instanceof Er&&r instanceof Er?Kt(i.Ee,r.Ee):i instanceof Ws&&r instanceof Ws}(n.transform,e.transform)}class iS{constructor(e,t){this.version=e,this.transformResults=t}}class Be{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Be}static exists(e){return new Be(void 0,e)}static updateTime(e){return new Be(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function oa(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class fl{}function g_(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new lo(n.key,Be.none()):new Vr(n.key,n.data,Be.none());{const t=n.data,i=tt.empty();let r=new ve(Pe.comparator);for(let s of e.fields)if(!r.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?i.delete(s):i.set(s,o),r=r.add(s)}return new hn(n.key,i,new ht(r.toArray()),Be.none())}}function rS(n,e,t){n instanceof Vr?function(r,s,o){const a=r.value.clone(),c=Oh(r.fieldTransforms,s,o.transformResults);a.setAll(c),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof hn?function(r,s,o){if(!oa(r.precondition,s))return void s.convertToUnknownDocument(o.version);const a=Oh(r.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(y_(r)),c.setAll(a),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):function(r,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function xs(n,e,t,i){return n instanceof Vr?function(s,o,a,c){if(!oa(s.precondition,o))return a;const d=s.value.clone(),h=Bh(s.fieldTransforms,c,o);return d.setAll(h),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),null}(n,e,t,i):n instanceof hn?function(s,o,a,c){if(!oa(s.precondition,o))return a;const d=Bh(s.fieldTransforms,c,o),h=o.data;return h.setAll(y_(s)),h.setAll(d),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(p=>p.field))}(n,e,t,i):function(s,o,a){return oa(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function sS(n,e){let t=null;for(const i of n.fieldTransforms){const r=e.data.field(i.field),s=f_(i.transform,r||null);s!=null&&(t===null&&(t=tt.empty()),t.set(i.field,s))}return t||null}function Uh(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(i,r){return i===void 0&&r===void 0||!(!i||!r)&&dr(i,r,(s,o)=>nS(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Vr extends fl{constructor(e,t,i,r=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class hn extends fl{constructor(e,t,i,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function y_(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}}),e}function Oh(n,e,t){const i=new Map;Q(n.length===t.length,32656,{Ae:t.length,Re:n.length});for(let r=0;r<t.length;r++){const s=n[r],o=s.transform,a=e.data.field(s.field);i.set(s.field,tS(o,a,t[r]))}return i}function Bh(n,e,t){const i=new Map;for(const r of n){const s=r.transform,o=t.data.field(r.field);i.set(r.field,eS(s,o,e))}return i}class lo extends fl{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class __ extends fl{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yc{constructor(e,t,i,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const s=this.mutations[r];s.key.isEqual(e.key)&&rS(s,e,i[r])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=xs(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=xs(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=u_();return this.mutations.forEach(r=>{const s=e.get(r.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=t.has(r.key)?null:a;const c=g_(o,a);c!==null&&i.set(r.key,c),o.isValidDocument()||o.convertToNoDocument(j.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ae())}isEqual(e){return this.batchId===e.batchId&&dr(this.mutations,e.mutations,(t,i)=>Uh(t,i))&&dr(this.baseMutations,e.baseMutations,(t,i)=>Uh(t,i))}}class Xc{constructor(e,t,i,r){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=r}static from(e,t,i){Q(e.mutations.length===i.length,58842,{Ve:e.mutations.length,me:i.length});let r=function(){return XA}();const s=e.mutations;for(let o=0;o<s.length;o++)r=r.insert(s[o].key,i[o].version);return new Xc(e,t,i,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qc{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oS{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Le,fe;function aS(n){switch(n){case N.OK:return Y(64938);case N.CANCELLED:case N.UNKNOWN:case N.DEADLINE_EXCEEDED:case N.RESOURCE_EXHAUSTED:case N.INTERNAL:case N.UNAVAILABLE:case N.UNAUTHENTICATED:return!1;case N.INVALID_ARGUMENT:case N.NOT_FOUND:case N.ALREADY_EXISTS:case N.PERMISSION_DENIED:case N.FAILED_PRECONDITION:case N.ABORTED:case N.OUT_OF_RANGE:case N.UNIMPLEMENTED:case N.DATA_LOSS:return!0;default:return Y(15467,{code:n})}}function v_(n){if(n===void 0)return ut("GRPC error has no .code"),N.UNKNOWN;switch(n){case Le.OK:return N.OK;case Le.CANCELLED:return N.CANCELLED;case Le.UNKNOWN:return N.UNKNOWN;case Le.DEADLINE_EXCEEDED:return N.DEADLINE_EXCEEDED;case Le.RESOURCE_EXHAUSTED:return N.RESOURCE_EXHAUSTED;case Le.INTERNAL:return N.INTERNAL;case Le.UNAVAILABLE:return N.UNAVAILABLE;case Le.UNAUTHENTICATED:return N.UNAUTHENTICATED;case Le.INVALID_ARGUMENT:return N.INVALID_ARGUMENT;case Le.NOT_FOUND:return N.NOT_FOUND;case Le.ALREADY_EXISTS:return N.ALREADY_EXISTS;case Le.PERMISSION_DENIED:return N.PERMISSION_DENIED;case Le.FAILED_PRECONDITION:return N.FAILED_PRECONDITION;case Le.ABORTED:return N.ABORTED;case Le.OUT_OF_RANGE:return N.OUT_OF_RANGE;case Le.UNIMPLEMENTED:return N.UNIMPLEMENTED;case Le.DATA_LOSS:return N.DATA_LOSS;default:return Y(39323,{code:n})}}(fe=Le||(Le={}))[fe.OK=0]="OK",fe[fe.CANCELLED=1]="CANCELLED",fe[fe.UNKNOWN=2]="UNKNOWN",fe[fe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",fe[fe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",fe[fe.NOT_FOUND=5]="NOT_FOUND",fe[fe.ALREADY_EXISTS=6]="ALREADY_EXISTS",fe[fe.PERMISSION_DENIED=7]="PERMISSION_DENIED",fe[fe.UNAUTHENTICATED=16]="UNAUTHENTICATED",fe[fe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",fe[fe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",fe[fe.ABORTED=10]="ABORTED",fe[fe.OUT_OF_RANGE=11]="OUT_OF_RANGE",fe[fe.UNIMPLEMENTED=12]="UNIMPLEMENTED",fe[fe.INTERNAL=13]="INTERNAL",fe[fe.UNAVAILABLE=14]="UNAVAILABLE",fe[fe.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lS=new Vn([4294967295,4294967295],0);function qh(n){const e=Cy().encode(n),t=new my;return t.update(e),new Uint8Array(t.digest())}function $h(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Vn([t,i],0),new Vn([r,s],0)]}class Zc{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new ms(`Invalid padding: ${t}`);if(i<0)throw new ms(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new ms(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new ms(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=Vn.fromNumber(this.fe)}pe(e,t,i){let r=e.add(t.multiply(Vn.fromNumber(i)));return r.compare(lS)===1&&(r=new Vn([r.getBits(0),r.getBits(1)],0)),r.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.fe===0)return!1;const t=qh(e),[i,r]=$h(t);for(let s=0;s<this.hashCount;s++){const o=this.pe(i,r,s);if(!this.ye(o))return!1}return!0}static create(e,t,i){const r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new Zc(s,r,t);return i.forEach(a=>o.insert(a)),o}insert(e){if(this.fe===0)return;const t=qh(e),[i,r]=$h(t);for(let s=0;s<this.hashCount;s++){const o=this.pe(i,r,s);this.we(o)}}we(e){const t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}}class ms extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hl{constructor(e,t,i,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,i){const r=new Map;return r.set(e,uo.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new hl(j.min(),r,new Re(te),_t(),ae())}}class uo{constructor(e,t,i,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new uo(i,t,ae(),ae(),ae())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(e,t,i,r){this.Se=e,this.removedTargetIds=t,this.key=i,this.be=r}}class T_{constructor(e,t){this.targetId=e,this.De=t}}class E_{constructor(e,t,i=Oe.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=r}}class Gh{constructor(){this.ve=0,this.Ce=Hh(),this.Fe=Oe.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=ae(),t=ae(),i=ae();return this.Ce.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:i=i.add(r);break;default:Y(38017,{changeType:s})}}),new uo(this.Fe,this.Me,e,t,i)}ke(){this.xe=!1,this.Ce=Hh()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,Q(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}}class uS{constructor(e){this.We=e,this.Ge=new Map,this.ze=_t(),this.je=$o(),this.Je=$o(),this.He=new Re(te)}Ye(e){for(const t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(const t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{const i=this.tt(t);switch(e.state){case 0:this.nt(t)&&i.Be(e.resumeToken);break;case 1:i.Ue(),i.Oe||i.ke(),i.Be(e.resumeToken);break;case 2:i.Ue(),i.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(i.Ke(),i.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),i.Be(e.resumeToken));break;default:Y(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((i,r)=>{this.nt(r)&&t(r)})}it(e){const t=e.targetId,i=e.De.count,r=this.st(t);if(r){const s=r.target;if(Pa(s))if(i===0){const o=new W(s.path);this.Xe(t,o,ke.newNoDocument(o,j.min()))}else Q(i===1,20013,{expectedCount:i});else{const o=this.ot(t);if(o!==i){const a=this._t(e),c=a?this.ut(a,e,o):1;if(c!==0){this.rt(t);const d=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(t,d)}}}}}_t(e){const t=e.De.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:i="",padding:r=0},hashCount:s=0}=t;let o,a;try{o=un(i).toUint8Array()}catch(c){if(c instanceof $y)return Wt("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new Zc(o,r,s)}catch(c){return Wt(c instanceof ms?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.fe===0?null:a}ut(e,t,i){return t.De.count===i-this.ht(e,t.targetId)?0:2}ht(e,t){const i=this.We.getRemoteKeysForTarget(t);let r=0;return i.forEach(s=>{const o=this.We.lt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Xe(t,s,null),r++)}),r}Pt(e){const t=new Map;this.Ge.forEach((s,o)=>{const a=this.st(o);if(a){if(s.current&&Pa(a.target)){const c=new W(a.target.path);this.Tt(c).has(o)||this.It(o,c)||this.Xe(o,c,ke.newNoDocument(c,e))}s.Ne&&(t.set(o,s.Le()),s.ke())}});let i=ae();this.Je.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{const d=this.st(c);return!d||d.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(i=i.add(s))}),this.ze.forEach((s,o)=>o.setReadTime(e));const r=new hl(e,t,this.He,this.ze,i);return this.ze=_t(),this.je=$o(),this.Je=$o(),this.He=new Re(te),r}Ze(e,t){if(!this.nt(e))return;const i=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,i),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,i){if(!this.nt(e))return;const r=this.tt(e);this.It(e,t)?r.qe(t,1):r.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),i&&(this.ze=this.ze.insert(t,i))}removeTarget(e){this.Ge.delete(e)}ot(e){const t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new Gh,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new ve(te),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new ve(te),this.je=this.je.insert(e,t)),t}nt(e){const t=this.st(e)!==null;return t||B("WatchChangeAggregator","Detected inactive target",e),t}st(e){const t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new Gh),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}}function $o(){return new Re(W.comparator)}function Hh(){return new Re(W.comparator)}const cS={asc:"ASCENDING",desc:"DESCENDING"},dS={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},fS={and:"AND",or:"OR"};class hS{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function $u(n,e){return n.useProto3Json||il(e)?e:{value:e}}function Ir(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function I_(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function pS(n,e){return Ir(n,e.toTimestamp())}function dt(n){return Q(!!n,49232),j.fromTimestamp(function(t){const i=ln(t);return new ue(i.seconds,i.nanos)}(n))}function jc(n,e){return Gu(n,e).canonicalString()}function Gu(n,e){const t=function(r){return new ye(["projects",r.projectId,"databases",r.database])}(n).child("documents");return e===void 0?t:t.child(e)}function C_(n){const e=ye.fromString(n);return Q(M_(e),10190,{key:e.toString()}),e}function ka(n,e){return jc(n.databaseId,e.path)}function fi(n,e){const t=C_(e);if(t.get(1)!==n.databaseId.projectId)throw new H(N.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new H(N.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new W(S_(t))}function w_(n,e){return jc(n.databaseId,e)}function A_(n){const e=C_(n);return e.length===4?ye.emptyPath():S_(e)}function Hu(n){return new ye(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function S_(n){return Q(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function zh(n,e,t){return{name:ka(n,e),fields:t.value.mapValue.fields}}function mS(n,e,t){const i=fi(n,e.name),r=dt(e.updateTime),s=e.createTime?dt(e.createTime):j.min(),o=new tt({mapValue:{fields:e.fields}}),a=ke.newFoundDocument(i,r,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function gS(n,e){let t;if("targetChange"in e){e.targetChange;const i=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:Y(39313,{state:d})}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=function(d,h){return d.useProto3Json?(Q(h===void 0||typeof h=="string",58123),Oe.fromBase64String(h||"")):(Q(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),Oe.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(d){const h=d.code===void 0?N.UNKNOWN:v_(d.code);return new H(h,d.message||"")}(o);t=new E_(i,r,s,a||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const r=fi(n,i.document.name),s=dt(i.document.updateTime),o=i.document.createTime?dt(i.document.createTime):j.min(),a=new tt({mapValue:{fields:i.document.fields}}),c=ke.newFoundDocument(r,s,o,a),d=i.targetIds||[],h=i.removedTargetIds||[];t=new aa(d,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const r=fi(n,i.document),s=i.readTime?dt(i.readTime):j.min(),o=ke.newNoDocument(r,s),a=i.removedTargetIds||[];t=new aa([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const r=fi(n,i.document),s=i.removedTargetIds||[];t=new aa([],s,r,null)}else{if(!("filter"in e))return Y(11601,{At:e});{e.filter;const i=e.filter;i.targetId;const{count:r=0,unchangedNames:s}=i,o=new oS(r,s),a=i.targetId;t=new T_(a,o)}}return t}function ba(n,e){let t;if(e instanceof Vr)t={update:zh(n,e.key,e.value)};else if(e instanceof lo)t={delete:ka(n,e.key)};else if(e instanceof hn)t={update:zh(n,e.key,e.data),updateMask:IS(e.fieldMask)};else{if(!(e instanceof __))return Y(16599,{Rt:e.type});t={verify:ka(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>function(s,o){const a=o.transform;if(a instanceof Ws)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Ii)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Tr)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Er)return{fieldPath:o.field.canonicalString(),increment:a.Ee};throw Y(20930,{transform:o.transform})}(0,i))),e.precondition.isNone||(t.currentDocument=function(r,s){return s.updateTime!==void 0?{updateTime:pS(r,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:Y(27497)}(n,e.precondition)),t}function zu(n,e){const t=e.currentDocument?function(s){return s.updateTime!==void 0?Be.updateTime(dt(s.updateTime)):s.exists!==void 0?Be.exists(s.exists):Be.none()}(e.currentDocument):Be.none(),i=e.updateTransforms?e.updateTransforms.map(r=>function(o,a){let c=null;if("setToServerValue"in a)Q(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),c=new Ws;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];c=new Ii(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];c=new Tr(h)}else"increment"in a?c=new Er(o,a.increment):Y(16584,{proto:a});const d=Pe.fromServerFormat(a.fieldPath);return new Jc(d,c)}(n,r)):[];if(e.update){e.update.name;const r=fi(n,e.update.name),s=new tt({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(c){const d=c.fieldPaths||[];return new ht(d.map(h=>Pe.fromServerFormat(h)))}(e.updateMask);return new hn(r,s,o,t,i)}return new Vr(r,s,t,i)}if(e.delete){const r=fi(n,e.delete);return new lo(r,t)}if(e.verify){const r=fi(n,e.verify);return new __(r,t)}return Y(1463,{proto:e})}function yS(n,e){return n&&n.length>0?(Q(e!==void 0,14353),n.map(t=>function(r,s){let o=r.updateTime?dt(r.updateTime):dt(s);return o.isEqual(j.min())&&(o=dt(s)),new iS(o,r.transformResults||[])}(t,e))):[]}function R_(n,e){return{documents:[w_(n,e.path)]}}function P_(n,e){const t={structuredQuery:{}},i=e.path;let r;e.collectionGroup!==null?(r=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=w_(n,r);const s=function(d){if(d.length!==0)return b_(_e.create(d,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const o=function(d){if(d.length!==0)return d.map(h=>function(g){return{field:Qi(g.field),direction:vS(g.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=$u(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{Vt:t,parent:r}}function x_(n){let e=A_(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let r=null;if(i>0){Q(i===1,65062);const h=t.from[0];h.allDescendants?r=h.collectionId:e=e.child(h.collectionId)}let s=[];t.where&&(s=function(p){const g=k_(p);return g instanceof _e&&Wc(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(p){return p.map(g=>function(C){return new Ra(Zi(C.field),function(x){switch(x){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(C.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(p){let g;return g=typeof p=="object"?p.value:p,il(g)?null:g}(t.limit));let c=null;t.startAt&&(c=function(p){const g=!!p.before,_=p.values||[];return new _r(_,g)}(t.startAt));let d=null;return t.endAt&&(d=function(p){const g=!p.before,_=p.values||[];return new _r(_,g)}(t.endAt)),zA(e,r,o,s,a,"F",c,d)}function _S(n,e){const t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Y(28987,{purpose:r})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function k_(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const i=Zi(t.unaryFilter.field);return ce.create(i,"==",{doubleValue:NaN});case"IS_NULL":const r=Zi(t.unaryFilter.field);return ce.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Zi(t.unaryFilter.field);return ce.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Zi(t.unaryFilter.field);return ce.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Y(61313);default:return Y(60726)}}(n):n.fieldFilter!==void 0?function(t){return ce.create(Zi(t.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Y(58110);default:return Y(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return _e.create(t.compositeFilter.filters.map(i=>k_(i)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return Y(1026)}}(t.compositeFilter.op))}(n):Y(30097,{filter:n})}function vS(n){return cS[n]}function TS(n){return dS[n]}function ES(n){return fS[n]}function Qi(n){return{fieldPath:n.canonicalString()}}function Zi(n){return Pe.fromServerFormat(n.fieldPath)}function b_(n){return n instanceof ce?function(t){if(t.op==="=="){if(xh(t.value))return{unaryFilter:{field:Qi(t.field),op:"IS_NAN"}};if(Ph(t.value))return{unaryFilter:{field:Qi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(xh(t.value))return{unaryFilter:{field:Qi(t.field),op:"IS_NOT_NAN"}};if(Ph(t.value))return{unaryFilter:{field:Qi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Qi(t.field),op:TS(t.op),value:t.value}}}(n):n instanceof _e?function(t){const i=t.getFilters().map(r=>b_(r));return i.length===1?i[0]:{compositeFilter:{op:ES(t.op),filters:i}}}(n):Y(54877,{filter:n})}function IS(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function M_(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tn{constructor(e,t,i,r,s=j.min(),o=j.min(),a=Oe.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new tn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new tn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new tn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new tn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D_{constructor(e){this.gt=e}}function CS(n,e){let t;if(e.document)t=mS(n.gt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const i=W.fromSegments(e.noDocument.path),r=wi(e.noDocument.readTime);t=ke.newNoDocument(i,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Y(56709);{const i=W.fromSegments(e.unknownDocument.path),r=wi(e.unknownDocument.version);t=ke.newUnknownDocument(i,r)}}return e.readTime&&t.setReadTime(function(r){const s=new ue(r[0],r[1]);return j.fromTimestamp(s)}(e.readTime)),t}function Wh(n,e){const t=e.key,i={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Ma(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())i.document=function(s,o){return{name:ka(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Ir(s,o.version.toTimestamp()),createTime:Ir(s,o.createTime.toTimestamp())}}(n.gt,e);else if(e.isNoDocument())i.noDocument={path:t.path.toArray(),readTime:Ci(e.version)};else{if(!e.isUnknownDocument())return Y(57904,{document:e});i.unknownDocument={path:t.path.toArray(),version:Ci(e.version)}}return i}function Ma(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Ci(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function wi(n){const e=new ue(n.seconds,n.nanoseconds);return j.fromTimestamp(e)}function si(n,e){const t=(e.baseMutations||[]).map(s=>zu(n.gt,s));for(let s=0;s<e.mutations.length-1;++s){const o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){const a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}const i=e.mutations.map(s=>zu(n.gt,s)),r=ue.fromMillis(e.localWriteTimeMs);return new Yc(e.batchId,r,t,i)}function gs(n){const e=wi(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?wi(n.lastLimboFreeSnapshotVersion):j.min();let i;return i=function(s){return s.documents!==void 0}(n.query)?function(s){const o=s.documents.length;return Q(o===1,1966,{count:o}),At(ul(A_(s.documents[0])))}(n.query):function(s){return At(x_(s))}(n.query),new tn(i,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Oe.fromBase64String(n.resumeToken))}function N_(n,e){const t=Ci(e.snapshotVersion),i=Ci(e.lastLimboFreeSnapshotVersion);let r;r=Pa(e.target)?R_(n.gt,e.target):P_(n.gt,e.target).Vt;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ei(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function V_(n){const e=x_({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?qu(e,e.limit,"L"):e}function au(n,e){return new Qc(e.largestBatchId,zu(n.gt,e.overlayMutation))}function Kh(n,e){const t=e.path.lastSegment();return[n,it(e.path.popLast()),t]}function Jh(n,e,t,i){return{indexId:n,uid:e,sequenceNumber:t,readTime:Ci(i.readTime),documentKey:it(i.documentKey.path),largestBatchId:i.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wS{getBundleMetadata(e,t){return Yh(e).get(t).next(i=>{if(i)return function(s){return{id:s.bundleId,createTime:wi(s.createTime),version:s.version}}(i)})}saveBundleMetadata(e,t){return Yh(e).put(function(r){return{bundleId:r.id,createTime:Ci(dt(r.createTime)),version:r.version}}(t))}getNamedQuery(e,t){return Xh(e).get(t).next(i=>{if(i)return function(s){return{name:s.name,query:V_(s.bundledQuery),readTime:wi(s.readTime)}}(i)})}saveNamedQuery(e,t){return Xh(e).put(function(r){return{name:r.name,readTime:Ci(dt(r.readTime)),bundledQuery:r.bundledQuery}}(t))}}function Yh(n){return $e(n,rl)}function Xh(n){return $e(n,sl)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pl{constructor(e,t){this.serializer=e,this.userId=t}static yt(e,t){const i=t.uid||"";return new pl(e,i)}getOverlay(e,t){return ss(e).get(Kh(this.userId,t)).next(i=>i?au(this.serializer,i):null)}getOverlays(e,t){const i=Lt();return b.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){const r=[];return i.forEach((s,o)=>{const a=new Qc(t,o);r.push(this.wt(e,a))}),b.waitFor(r)}removeOverlaysForBatchId(e,t,i){const r=new Set;t.forEach(o=>r.add(it(o.getCollectionPath())));const s=[];return r.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,i],[this.userId,o,i+1],!1,!0);s.push(ss(e).Y(Du,a))}),b.waitFor(s)}getOverlaysForCollection(e,t,i){const r=Lt(),s=it(t),o=IDBKeyRange.bound([this.userId,s,i],[this.userId,s,Number.POSITIVE_INFINITY],!0);return ss(e).j(Du,o).next(a=>{for(const c of a){const d=au(this.serializer,c);r.set(d.getKey(),d)}return r})}getOverlaysForCollectionGroup(e,t,i,r){const s=Lt();let o;const a=IDBKeyRange.bound([this.userId,t,i],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ss(e).X({index:Ly,range:a},(c,d,h)=>{const p=au(this.serializer,d);s.size()<r||p.largestBatchId===o?(s.set(p.getKey(),p),o=p.largestBatchId):h.done()}).next(()=>s)}wt(e,t){return ss(e).put(function(r,s,o){const[a,c,d]=Kh(s,o.mutation.key);return{userId:s,collectionPath:c,documentId:d,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:ba(r.gt,o.mutation)}}(this.serializer,this.userId,t))}}function ss(n){return $e(n,ol)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AS{St(e){return $e(e,qc)}getSessionToken(e){return this.St(e).get("sessionToken").next(t=>{const i=t==null?void 0:t.value;return i?Oe.fromUint8Array(i):Oe.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oi{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(e.booleanValue?1:0);else if("integerValue"in e)this.Ct(t,15),t.Ft(Ae(e.integerValue));else if("doubleValue"in e){const i=Ae(e.doubleValue);isNaN(i)?this.Ct(t,13):(this.Ct(t,15),Us(i)?t.Ft(0):t.Ft(i))}else if("timestampValue"in e){let i=e.timestampValue;this.Ct(t,20),typeof i=="string"&&(i=ln(i)),t.Mt(`${i.seconds||""}`),t.Ft(i.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(un(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){const i=e.geoPointValue;this.Ct(t,45),t.Ft(i.latitude||0),t.Ft(i.longitude||0)}else"mapValue"in e?Jy(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):ll(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):Y(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){const i=e.fields||{};this.Ct(t,55);for(const r of Object.keys(i))this.xt(r,t),this.Dt(i[r],t)}Lt(e,t){var i,r;const s=e.fields||{};this.Ct(t,53);const o=gr,a=((r=(i=s[o].arrayValue)===null||i===void 0?void 0:i.values)===null||r===void 0?void 0:r.length)||0;this.Ct(t,15),t.Ft(Ae(a)),this.xt(o,t),this.Dt(s[o],t)}qt(e,t){const i=e.values||[];this.Ct(t,50);for(const r of i)this.Dt(r,t)}Bt(e,t){this.Ct(t,37),W.fromName(e).path.forEach(i=>{this.Ct(t,60),this.$t(i,t)})}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}}oi.Ut=new oi;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hi=255;function SS(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function Qh(n){const e=64-function(i){let r=0;for(let s=0;s<8;++s){const o=SS(255&i[s]);if(r+=o,o!==8)break}return r}(n);return Math.ceil(e/8)}class RS{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Kt(e){const t=e[Symbol.iterator]();let i=t.next();for(;!i.done;)this.Wt(i.value),i=t.next();this.Gt()}zt(e){const t=e[Symbol.iterator]();let i=t.next();for(;!i.done;)this.jt(i.value),i=t.next();this.Jt()}Ht(e){for(const t of e){const i=t.charCodeAt(0);if(i<128)this.Wt(i);else if(i<2048)this.Wt(960|i>>>6),this.Wt(128|63&i);else if(t<"\uD800"||"\uDBFF"<t)this.Wt(480|i>>>12),this.Wt(128|63&i>>>6),this.Wt(128|63&i);else{const r=t.codePointAt(0);this.Wt(240|r>>>18),this.Wt(128|63&r>>>12),this.Wt(128|63&r>>>6),this.Wt(128|63&r)}}this.Gt()}Yt(e){for(const t of e){const i=t.charCodeAt(0);if(i<128)this.jt(i);else if(i<2048)this.jt(960|i>>>6),this.jt(128|63&i);else if(t<"\uD800"||"\uDBFF"<t)this.jt(480|i>>>12),this.jt(128|63&i>>>6),this.jt(128|63&i);else{const r=t.codePointAt(0);this.jt(240|r>>>18),this.jt(128|63&r>>>12),this.jt(128|63&r>>>6),this.jt(128|63&r)}}this.Jt()}Zt(e){const t=this.Xt(e),i=Qh(t);this.en(1+i),this.buffer[this.position++]=255&i;for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=255&t[r]}tn(e){const t=this.Xt(e),i=Qh(t);this.en(1+i),this.buffer[this.position++]=~(255&i);for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}nn(){this.rn(Hi),this.rn(255)}sn(){this._n(Hi),this._n(255)}reset(){this.position=0}seed(e){this.en(e.length),this.buffer.set(e,this.position),this.position+=e.length}an(){return this.buffer.slice(0,this.position)}Xt(e){const t=function(s){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),i=!!(128&t[0]);t[0]^=i?255:128;for(let r=1;r<t.length;++r)t[r]^=i?255:0;return t}Wt(e){const t=255&e;t===0?(this.rn(0),this.rn(255)):t===Hi?(this.rn(Hi),this.rn(0)):this.rn(t)}jt(e){const t=255&e;t===0?(this._n(0),this._n(255)):t===Hi?(this._n(Hi),this._n(0)):this._n(e)}Gt(){this.rn(0),this.rn(1)}Jt(){this._n(0),this._n(1)}rn(e){this.en(1),this.buffer[this.position++]=e}_n(e){this.en(1),this.buffer[this.position++]=~e}en(e){const t=e+this.position;if(t<=this.buffer.length)return;let i=2*this.buffer.length;i<t&&(i=t);const r=new Uint8Array(i);r.set(this.buffer),this.buffer=r}}class PS{constructor(e){this.un=e}Nt(e){this.un.Kt(e)}Mt(e){this.un.Ht(e)}Ft(e){this.un.Zt(e)}vt(){this.un.nn()}}class xS{constructor(e){this.un=e}Nt(e){this.un.zt(e)}Mt(e){this.un.Yt(e)}Ft(e){this.un.tn(e)}vt(){this.un.sn()}}class os{constructor(){this.un=new RS,this.cn=new PS(this.un),this.ln=new xS(this.un)}seed(e){this.un.seed(e)}hn(e){return e===0?this.cn:this.ln}an(){return this.un.an()}reset(){this.un.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ai{constructor(e,t,i,r){this.Pn=e,this.Tn=t,this.In=i,this.dn=r}En(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,i=new Uint8Array(t);return i.set(this.dn,0),t!==e?i.set([0],this.dn.length):++i[i.length-1],new ai(this.Pn,this.Tn,this.In,i)}An(e,t,i){return{indexId:this.Pn,uid:e,arrayValue:la(this.In),directionalValue:la(this.dn),orderedDocumentKey:la(t),documentKey:i.path.toArray()}}Rn(e,t,i){const r=this.An(e,t,i);return[r.indexId,r.uid,r.arrayValue,r.directionalValue,r.orderedDocumentKey,r.documentKey]}}function En(n,e){let t=n.Pn-e.Pn;return t!==0?t:(t=Zh(n.In,e.In),t!==0?t:(t=Zh(n.dn,e.dn),t!==0?t:W.comparator(n.Tn,e.Tn)))}function Zh(n,e){for(let t=0;t<n.length&&t<e.length;++t){const i=n[t]-e[t];if(i!==0)return i}return n.length-e.length}function la(n){return Rg()?function(t){let i="";for(let r=0;r<t.length;r++)i+=String.fromCharCode(t[r]);return i}(n):n}function jh(n){return typeof n!="string"?n:function(t){const i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return i}(n)}class ep{constructor(e){this.Vn=new ve((t,i)=>Pe.comparator(t.field,i.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.mn=e.orderBy,this.fn=[];for(const t of e.filters){const i=t;i.isInequality()?this.Vn=this.Vn.add(i):this.fn.push(i)}}get gn(){return this.Vn.size>1}pn(e){if(Q(e.collectionGroup===this.collectionId,49279),this.gn)return!1;const t=ku(e);if(t!==void 0&&!this.yn(t))return!1;const i=ni(e);let r=new Set,s=0,o=0;for(;s<i.length&&this.yn(i[s]);++s)r=r.add(i[s].fieldPath.canonicalString());if(s===i.length)return!0;if(this.Vn.size>0){const a=this.Vn.getIterator().getNext();if(!r.has(a.field.canonicalString())){const c=i[s];if(!this.wn(a,c)||!this.Sn(this.mn[o++],c))return!1}++s}for(;s<i.length;++s){const a=i[s];if(o>=this.mn.length||!this.Sn(this.mn[o++],a))return!1}return!0}bn(){if(this.gn)return null;let e=new ve(Pe.comparator);const t=[];for(const i of this.fn)if(!i.field.isKeyField())if(i.op==="array-contains"||i.op==="array-contains-any")t.push(new ea(i.field,2));else{if(e.has(i.field))continue;e=e.add(i.field),t.push(new ea(i.field,0))}for(const i of this.mn)i.field.isKeyField()||e.has(i.field)||(e=e.add(i.field),t.push(new ea(i.field,i.dir==="asc"?0:1)));return new Ia(Ia.UNKNOWN_ID,this.collectionId,t,Fs.empty())}yn(e){for(const t of this.fn)if(this.wn(t,e))return!0;return!1}wn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const i=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===i}Sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L_(n){var e,t;if(Q(n instanceof ce||n instanceof _e,20012),n instanceof ce){if(n instanceof i_){const r=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>ce.create(n.field,"==",s)))||[];return _e.create(r,"or")}return n}const i=n.filters.map(r=>L_(r));return _e.create(i,n.op)}function kS(n){if(n.getFilters().length===0)return[];const e=Ju(L_(n));return Q(F_(e),7391),Wu(e)||Ku(e)?[e]:e.getFilters()}function Wu(n){return n instanceof ce}function Ku(n){return n instanceof _e&&Wc(n)}function F_(n){return Wu(n)||Ku(n)||function(t){if(t instanceof _e&&Fu(t)){for(const i of t.getFilters())if(!Wu(i)&&!Ku(i))return!1;return!0}return!1}(n)}function Ju(n){if(Q(n instanceof ce||n instanceof _e,34018),n instanceof ce)return n;if(n.filters.length===1)return Ju(n.filters[0]);const e=n.filters.map(i=>Ju(i));let t=_e.create(e,n.op);return t=Da(t),F_(t)?t:(Q(t instanceof _e,64498),Q(vr(t),40251),Q(t.filters.length>1,57927),t.filters.reduce((i,r)=>ed(i,r)))}function ed(n,e){let t;return Q(n instanceof ce||n instanceof _e,38388),Q(e instanceof ce||e instanceof _e,25473),t=n instanceof ce?e instanceof ce?function(r,s){return _e.create([r,s],"and")}(n,e):tp(n,e):e instanceof ce?tp(e,n):function(r,s){if(Q(r.filters.length>0&&s.filters.length>0,48005),vr(r)&&vr(s))return e_(r,s.getFilters());const o=Fu(r)?r:s,a=Fu(r)?s:r,c=o.filters.map(d=>ed(d,a));return _e.create(c,"or")}(n,e),Da(t)}function tp(n,e){if(vr(e))return e_(e,n.getFilters());{const t=e.filters.map(i=>ed(n,i));return _e.create(t,"or")}}function Da(n){if(Q(n instanceof ce||n instanceof _e,11850),n instanceof ce)return n;const e=n.getFilters();if(e.length===1)return Da(e[0]);if(Zy(n))return n;const t=e.map(r=>Da(r)),i=[];return t.forEach(r=>{r instanceof ce?i.push(r):r instanceof _e&&(r.op===n.op?i.push(...r.filters):i.push(r))}),i.length===1?i[0]:_e.create(i,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bS{constructor(){this.Dn=new td}addToCollectionParentIndex(e,t){return this.Dn.add(t),b.resolve()}getCollectionParents(e,t){return b.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return b.resolve()}deleteFieldIndex(e,t){return b.resolve()}deleteAllFieldIndexes(e){return b.resolve()}createTargetIndexes(e,t){return b.resolve()}getDocumentsMatchingTarget(e,t){return b.resolve(null)}getIndexType(e,t){return b.resolve(0)}getFieldIndexes(e,t){return b.resolve([])}getNextCollectionGroupToUpdate(e){return b.resolve(null)}getMinOffset(e,t){return b.resolve(vt.min())}getMinOffsetFromCollectionGroup(e,t){return b.resolve(vt.min())}updateCollectionGroup(e,t,i){return b.resolve()}updateIndexEntries(e,t){return b.resolve()}}class td{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),r=this.index[t]||new ve(ye.comparator),s=!r.has(i);return this.index[t]=r.add(i),s}has(e){const t=e.lastSegment(),i=e.popLast(),r=this.index[t];return r&&r.has(i)}getEntries(e){return(this.index[e]||new ve(ye.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const np="IndexedDbIndexManager",Go=new Uint8Array(0);class MS{constructor(e,t){this.databaseId=t,this.vn=new td,this.Cn=new fn(i=>Ei(i),(i,r)=>so(i,r)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const i=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});const s={collectionId:i,parent:it(r)};return ip(e).put(s)}return b.resolve()}getCollectionParents(e,t){const i=[],r=IDBKeyRange.bound([t,""],[wy(t),""],!1,!0);return ip(e).j(r).next(s=>{for(const o of s){if(o.collectionId!==t)break;i.push(Vt(o.parent))}return i})}addFieldIndex(e,t){const i=as(e),r=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete r.indexId;const s=i.add(r);if(t.indexState){const o=Wi(e);return s.next(a=>{o.put(Jh(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const i=as(e),r=Wi(e),s=zi(e);return i.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=as(e),i=zi(e),r=Wi(e);return t.Y().next(()=>i.Y()).next(()=>r.Y())}createTargetIndexes(e,t){return b.forEach(this.Fn(t),i=>this.getIndexType(e,i).next(r=>{if(r===0||r===1){const s=new ep(i).bn();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const i=zi(e);let r=!0;const s=new Map;return b.forEach(this.Fn(t),o=>this.Mn(e,o).next(a=>{r&&(r=!!a),s.set(o,a)})).next(()=>{if(r){let o=ae();const a=[];return b.forEach(s,(c,d)=>{B(np,`Using index ${function(V){return`id=${V.indexId}|cg=${V.collectionGroup}|f=${V.fields.map(O=>`${O.fieldPath}:${O.kind}`).join(",")}`}(c)} to execute ${Ei(t)}`);const h=function(V,O){const U=ku(O);if(U===void 0)return null;for(const q of xa(V,U.fieldPath))switch(q.op){case"array-contains-any":return q.value.arrayValue.values||[];case"array-contains":return[q.value]}return null}(d,c),p=function(V,O){const U=new Map;for(const q of ni(O))for(const I of xa(V,q.fieldPath))switch(I.op){case"==":case"in":U.set(q.fieldPath.canonicalString(),I.value);break;case"not-in":case"!=":return U.set(q.fieldPath.canonicalString(),I.value),Array.from(U.values())}return null}(d,c),g=function(V,O){const U=[];let q=!0;for(const I of ni(O)){const T=I.kind===0?Nh(V,I.fieldPath,V.startAt):Vh(V,I.fieldPath,V.startAt);U.push(T.value),q&&(q=T.inclusive)}return new _r(U,q)}(d,c),_=function(V,O){const U=[];let q=!0;for(const I of ni(O)){const T=I.kind===0?Vh(V,I.fieldPath,V.endAt):Nh(V,I.fieldPath,V.endAt);U.push(T.value),q&&(q=T.inclusive)}return new _r(U,q)}(d,c),C=this.xn(c,d,g),P=this.xn(c,d,_),x=this.On(c,d,p),F=this.Nn(c.indexId,h,C,g.inclusive,P,_.inclusive,x);return b.forEach(F,L=>i.H(L,t.limit).next(V=>{V.forEach(O=>{const U=W.fromSegments(O.documentKey);o.has(U)||(o=o.add(U),a.push(U))})}))}).next(()=>a)}return b.resolve(null)})}Fn(e){let t=this.Cn.get(e);return t||(e.filters.length===0?t=[e]:t=kS(_e.create(e.filters,"and")).map(i=>Ou(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t),t)}Nn(e,t,i,r,s,o,a){const c=(t!=null?t.length:1)*Math.max(i.length,s.length),d=c/(t!=null?t.length:1),h=[];for(let p=0;p<c;++p){const g=t?this.Bn(t[p/d]):Go,_=this.Ln(e,g,i[p%d],r),C=this.kn(e,g,s[p%d],o),P=a.map(x=>this.Ln(e,g,x,!0));h.push(...this.createRange(_,C,P))}return h}Ln(e,t,i,r){const s=new ai(e,W.empty(),t,i);return r?s:s.En()}kn(e,t,i,r){const s=new ai(e,W.empty(),t,i);return r?s.En():s}Mn(e,t){const i=new ep(t),r=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(s=>{let o=null;for(const a of s)i.pn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let i=2;const r=this.Fn(t);return b.forEach(r,s=>this.Mn(e,s).next(o=>{o?i!==0&&o.fields.length<function(c){let d=new ve(Pe.comparator),h=!1;for(const p of c.filters)for(const g of p.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?h=!0:d=d.add(g.field));for(const p of c.orderBy)p.field.isKeyField()||(d=d.add(p.field));return d.size+(h?1:0)}(s)&&(i=1):i=0})).next(()=>function(o){return o.limit!==null}(t)&&r.length>1&&i===2?1:i)}qn(e,t){const i=new os;for(const r of ni(e)){const s=t.data.field(r.fieldPath);if(s==null)return null;const o=i.hn(r.kind);oi.Ut.bt(s,o)}return i.an()}Bn(e){const t=new os;return oi.Ut.bt(e,t.hn(0)),t.an()}Qn(e,t){const i=new os;return oi.Ut.bt(Hs(this.databaseId,t),i.hn(function(s){const o=ni(s);return o.length===0?0:o[o.length-1].kind}(e))),i.an()}On(e,t,i){if(i===null)return[];let r=[];r.push(new os);let s=0;for(const o of ni(e)){const a=i[s++];for(const c of r)if(this.$n(t,o.fieldPath)&&zs(a))r=this.Un(r,o,a);else{const d=c.hn(o.kind);oi.Ut.bt(a,d)}}return this.Kn(r)}xn(e,t,i){return this.On(e,t,i.position)}Kn(e){const t=[];for(let i=0;i<e.length;++i)t[i]=e[i].an();return t}Un(e,t,i){const r=[...e],s=[];for(const o of i.arrayValue.values||[])for(const a of r){const c=new os;c.seed(a.an()),oi.Ut.bt(o,c.hn(t.kind)),s.push(c)}return s}$n(e,t){return!!e.filters.find(i=>i instanceof ce&&i.field.isEqual(t)&&(i.op==="in"||i.op==="not-in"))}getFieldIndexes(e,t){const i=as(e),r=Wi(e);return(t?i.j(Mu,IDBKeyRange.bound(t,t)):i.j()).next(s=>{const o=[];return b.forEach(s,a=>r.get([a.indexId,this.uid]).next(c=>{o.push(function(h,p){const g=p?new Fs(p.sequenceNumber,new vt(wi(p.readTime),new W(Vt(p.documentKey)),p.largestBatchId)):Fs.empty(),_=h.fields.map(([C,P])=>new ea(Pe.fromServerFormat(C),P));return new Ia(h.indexId,h.collectionGroup,_,g)}(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((i,r)=>{const s=i.indexState.sequenceNumber-r.indexState.sequenceNumber;return s!==0?s:te(i.collectionGroup,r.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,i){const r=as(e),s=Wi(e);return this.Wn(e).next(o=>r.j(Mu,IDBKeyRange.bound(t,t)).next(a=>b.forEach(a,c=>s.put(Jh(c.indexId,this.uid,o,i)))))}updateIndexEntries(e,t){const i=new Map;return b.forEach(t,(r,s)=>{const o=i.get(r.collectionGroup);return(o?b.resolve(o):this.getFieldIndexes(e,r.collectionGroup)).next(a=>(i.set(r.collectionGroup,a),b.forEach(a,c=>this.Gn(e,r,c).next(d=>{const h=this.zn(s,c);return d.isEqual(h)?b.resolve():this.jn(e,s,c,d,h)}))))})}Jn(e,t,i,r){return zi(e).put(r.An(this.uid,this.Qn(i,t.key),t.key))}Hn(e,t,i,r){return zi(e).delete(r.Rn(this.uid,this.Qn(i,t.key),t.key))}Gn(e,t,i){const r=zi(e);let s=new ve(En);return r.X({index:Vy,range:IDBKeyRange.only([i.indexId,this.uid,la(this.Qn(i,t))])},(o,a)=>{s=s.add(new ai(i.indexId,t,jh(a.arrayValue),jh(a.directionalValue)))}).next(()=>s)}zn(e,t){let i=new ve(En);const r=this.qn(t,e);if(r==null)return i;const s=ku(t);if(s!=null){const o=e.data.field(s.fieldPath);if(zs(o))for(const a of o.arrayValue.values||[])i=i.add(new ai(t.indexId,e.key,this.Bn(a),r))}else i=i.add(new ai(t.indexId,e.key,Go,r));return i}jn(e,t,i,r,s){B(np,"Updating index entries for document '%s'",t.key);const o=[];return function(c,d,h,p,g){const _=c.getIterator(),C=d.getIterator();let P=Gi(_),x=Gi(C);for(;P||x;){let F=!1,L=!1;if(P&&x){const V=h(P,x);V<0?L=!0:V>0&&(F=!0)}else P!=null?L=!0:F=!0;F?(p(x),x=Gi(C)):L?(g(P),P=Gi(_)):(P=Gi(_),x=Gi(C))}}(r,s,En,a=>{o.push(this.Jn(e,t,i,a))},a=>{o.push(this.Hn(e,t,i,a))}),b.waitFor(o)}Wn(e){let t=1;return Wi(e).X({index:Ny,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,r,s)=>{s.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,i){i=i.sort((o,a)=>En(o,a)).filter((o,a,c)=>!a||En(o,c[a-1])!==0);const r=[];r.push(e);for(const o of i){const a=En(o,e),c=En(o,t);if(a===0)r[0]=e.En();else if(a>0&&c<0)r.push(o),r.push(o.En());else if(c>0)break}r.push(t);const s=[];for(let o=0;o<r.length;o+=2){if(this.Yn(r[o],r[o+1]))return[];const a=r[o].Rn(this.uid,Go,W.empty()),c=r[o+1].Rn(this.uid,Go,W.empty());s.push(IDBKeyRange.bound(a,c))}return s}Yn(e,t){return En(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(rp)}getMinOffset(e,t){return b.mapArray(this.Fn(t),i=>this.Mn(e,i).next(r=>r||Y(44426))).next(rp)}}function ip(n){return $e(n,qs)}function zi(n){return $e(n,As)}function as(n){return $e(n,Bc)}function Wi(n){return $e(n,ws)}function rp(n){Q(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let i=1;i<n.length;i++){const r=n[i].indexState.offset;Fc(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new vt(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sp={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},U_=41943040;class et{static withCacheSize(e){return new et(e,et.DEFAULT_COLLECTION_PERCENTILE,et.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O_(n,e,t){const i=n.store(xt),r=n.store(fr),s=[],o=IDBKeyRange.only(t.batchId);let a=0;const c=i.X({range:o},(h,p,g)=>(a++,g.delete()));s.push(c.next(()=>{Q(a===1,47070,{batchId:t.batchId})}));const d=[];for(const h of t.mutations){const p=by(e,h.key.path,t.batchId);s.push(r.delete(p)),d.push(h.key)}return b.waitFor(s).next(()=>d)}function Na(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Y(14731);e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */et.DEFAULT_COLLECTION_PERCENTILE=10,et.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,et.DEFAULT=new et(U_,et.DEFAULT_COLLECTION_PERCENTILE,et.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),et.DISABLED=new et(-1,0,0);class ml{constructor(e,t,i,r){this.userId=e,this.serializer=t,this.indexManager=i,this.referenceDelegate=r,this.Zn={}}static yt(e,t,i,r){Q(e.uid!=="",64387);const s=e.isAuthenticated()?e.uid:"";return new ml(s,t,i,r)}checkEmpty(e){let t=!0;const i=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return In(e).X({index:li,range:i},(r,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,i,r){const s=ji(e),o=In(e);return o.add({}).next(a=>{Q(typeof a=="number",49019);const c=new Yc(a,t,i,r),d=function(_,C,P){const x=P.baseMutations.map(L=>ba(_.gt,L)),F=P.mutations.map(L=>ba(_.gt,L));return{userId:C,batchId:P.batchId,localWriteTimeMs:P.localWriteTime.toMillis(),baseMutations:x,mutations:F}}(this.serializer,this.userId,c),h=[];let p=new ve((g,_)=>te(g.canonicalString(),_.canonicalString()));for(const g of r){const _=by(this.userId,g.key.path,a);p=p.add(g.key.path.popLast()),h.push(o.put(d)),h.push(s.put(_,uA))}return p.forEach(g=>{h.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Zn[a]=c.keys()}),b.waitFor(h).next(()=>c)})}lookupMutationBatch(e,t){return In(e).get(t).next(i=>i?(Q(i.userId===this.userId,48,"Unexpected user for mutation batch",{userId:i.userId,batchId:t}),si(this.serializer,i)):null)}Xn(e,t){return this.Zn[t]?b.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(i=>{if(i){const r=i.keys();return this.Zn[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){const i=t+1,r=IDBKeyRange.lowerBound([this.userId,i]);let s=null;return In(e).X({index:li,range:r},(o,a,c)=>{a.userId===this.userId&&(Q(a.batchId>=i,47524,{er:i}),s=si(this.serializer,a)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let i=ci;return In(e).X({index:li,range:t,reverse:!0},(r,s,o)=>{i=s.batchId,o.done()}).next(()=>i)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,ci],[this.userId,Number.POSITIVE_INFINITY]);return In(e).j(li,t).next(i=>i.map(r=>si(this.serializer,r)))}getAllMutationBatchesAffectingDocumentKey(e,t){const i=ta(this.userId,t.path),r=IDBKeyRange.lowerBound(i),s=[];return ji(e).X({range:r},(o,a,c)=>{const[d,h,p]=o,g=Vt(h);if(d===this.userId&&t.path.isEqual(g))return In(e).get(p).next(_=>{if(!_)throw Y(61480,{tr:o,batchId:p});Q(_.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:_.userId,batchId:p}),s.push(si(this.serializer,_))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new ve(te);const r=[];return t.forEach(s=>{const o=ta(this.userId,s.path),a=IDBKeyRange.lowerBound(o),c=ji(e).X({range:a},(d,h,p)=>{const[g,_,C]=d,P=Vt(_);g===this.userId&&s.path.isEqual(P)?i=i.add(C):p.done()});r.push(c)}),b.waitFor(r).next(()=>this.nr(e,i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,r=i.length+1,s=ta(this.userId,i),o=IDBKeyRange.lowerBound(s);let a=new ve(te);return ji(e).X({range:o},(c,d,h)=>{const[p,g,_]=c,C=Vt(g);p===this.userId&&i.isPrefixOf(C)?C.length===r&&(a=a.add(_)):h.done()}).next(()=>this.nr(e,a))}nr(e,t){const i=[],r=[];return t.forEach(s=>{r.push(In(e).get(s).next(o=>{if(o===null)throw Y(35274,{batchId:s});Q(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:s}),i.push(si(this.serializer,o))}))}),b.waitFor(r).next(()=>i)}removeMutationBatch(e,t){return O_(e.ce,this.userId,t).next(i=>(e.addOnCommittedListener(()=>{this.rr(t.batchId)}),b.forEach(i,r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))}rr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return b.resolve();const i=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),r=[];return ji(e).X({range:i},(s,o,a)=>{if(s[0]===this.userId){const c=Vt(s[1]);r.push(c)}else a.done()}).next(()=>{Q(r.length===0,56720,{ir:r.map(s=>s.canonicalString())})})})}containsKey(e,t){return B_(e,this.userId,t)}sr(e){return q_(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:ci,lastStreamToken:""})}}function B_(n,e,t){const i=ta(e,t.path),r=i[1],s=IDBKeyRange.lowerBound(i);let o=!1;return ji(n).X({range:s,Z:!0},(a,c,d)=>{const[h,p,g]=a;h===e&&p===r&&(o=!0),d.done()}).next(()=>o)}function In(n){return $e(n,xt)}function ji(n){return $e(n,fr)}function q_(n){return $e(n,Os)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ai{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new Ai(0)}static ur(){return new Ai(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DS{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.cr(e).next(t=>{const i=new Ai(t.highestTargetId);return t.highestTargetId=i.next(),this.lr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.cr(e).next(t=>j.fromTimestamp(new ue(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.cr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,i){return this.cr(e).next(r=>(r.highestListenSequenceNumber=t,i&&(r.lastRemoteSnapshotVersion=i.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.lr(e,r)))}addTargetData(e,t){return this.hr(e,t).next(()=>this.cr(e).next(i=>(i.targetCount+=1,this.Pr(t,i),this.lr(e,i))))}updateTargetData(e,t){return this.hr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ki(e).delete(t.targetId)).next(()=>this.cr(e)).next(i=>(Q(i.targetCount>0,8065),i.targetCount-=1,this.lr(e,i)))}removeTargets(e,t,i){let r=0;const s=[];return Ki(e).X((o,a)=>{const c=gs(a);c.sequenceNumber<=t&&i.get(c.targetId)===null&&(r++,s.push(this.removeTargetData(e,c)))}).next(()=>b.waitFor(s)).next(()=>r)}forEachTarget(e,t){return Ki(e).X((i,r)=>{const s=gs(r);t(s)})}cr(e){return op(e).get(Aa).next(t=>(Q(t!==null,2888),t))}lr(e,t){return op(e).put(Aa,t)}hr(e,t){return Ki(e).put(N_(this.serializer,t))}Pr(e,t){let i=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,i=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,i=!0),i}getTargetCount(e){return this.cr(e).next(t=>t.targetCount)}getTargetData(e,t){const i=Ei(t),r=IDBKeyRange.bound([i,Number.NEGATIVE_INFINITY],[i,Number.POSITIVE_INFINITY]);let s=null;return Ki(e).X({range:r,index:Dy},(o,a,c)=>{const d=gs(a);so(t,d.target)&&(s=d,c.done())}).next(()=>s)}addMatchingKeys(e,t,i){const r=[],s=kn(e);return t.forEach(o=>{const a=it(o.path);r.push(s.put({targetId:i,path:a})),r.push(this.referenceDelegate.addReference(e,i,o))}),b.waitFor(r)}removeMatchingKeys(e,t,i){const r=kn(e);return b.forEach(t,s=>{const o=it(s.path);return b.waitFor([r.delete([i,o]),this.referenceDelegate.removeReference(e,i,s)])})}removeMatchingKeysForTargetId(e,t){const i=kn(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return i.delete(r)}getMatchingKeysForTargetId(e,t){const i=IDBKeyRange.bound([t],[t+1],!1,!0),r=kn(e);let s=ae();return r.X({range:i,Z:!0},(o,a,c)=>{const d=Vt(o[1]),h=new W(d);s=s.add(h)}).next(()=>s)}containsKey(e,t){const i=it(t.path),r=IDBKeyRange.bound([i],[wy(i)],!1,!0);let s=0;return kn(e).X({index:Oc,Z:!0,range:r},([o,a],c,d)=>{o!==0&&(s++,d.done())}).next(()=>s>0)}Et(e,t){return Ki(e).get(t).next(i=>i?gs(i):null)}}function Ki(n){return $e(n,hr)}function op(n){return $e(n,di)}function kn(n){return $e(n,pr)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ap="LruGarbageCollector",NS=1048576;function lp([n,e],[t,i]){const r=te(n,t);return r===0?te(e,i):r}class VS{constructor(e){this.Tr=e,this.buffer=new ve(lp),this.Ir=0}dr(){return++this.Ir}Er(e){const t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{const i=this.buffer.last();lp(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}}class $_{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(e){B(ap,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Kn(t)?B(ap,"Ignoring IndexedDB error during garbage collection: ",t):await Ni(t)}await this.Rr(3e5)})}}class LS{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(i=>Math.floor(t/100*i))}nthSequenceNumber(e,t){if(t===0)return b.resolve(wt.ue);const i=new VS(t);return this.Vr.forEachTarget(e,r=>i.Er(r.sequenceNumber)).next(()=>this.Vr.gr(e,r=>i.Er(r))).next(()=>i.maxValue)}removeTargets(e,t,i){return this.Vr.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(B("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(sp)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(B("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),sp):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let i,r,s,o,a,c,d;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(B("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),r=this.params.maximumSequenceNumbersToCollect):r=p,o=Date.now(),this.nthSequenceNumber(e,r))).next(p=>(i=p,a=Date.now(),this.removeTargets(e,i,t))).next(p=>(s=p,c=Date.now(),this.removeOrphanedDocuments(e,i))).next(p=>(d=Date.now(),Yi()<=le.DEBUG&&B("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${r} in `+(a-o)+`ms
	Removed ${s} targets in `+(c-a)+`ms
	Removed ${p} documents in `+(d-c)+`ms
Total Duration: ${d-h}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:p})))}}function G_(n,e){return new LS(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FS{constructor(e,t){this.db=e,this.garbageCollector=G_(this,t)}mr(e){const t=this.yr(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(r=>i+r))}yr(e){let t=0;return this.gr(e,i=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}gr(e,t){return this.wr(e,(i,r)=>t(r))}addReference(e,t,i){return Ho(e,i)}removeReference(e,t,i){return Ho(e,i)}removeTargets(e,t,i){return this.db.getTargetCache().removeTargets(e,t,i)}markPotentiallyOrphaned(e,t){return Ho(e,t)}Sr(e,t){return function(r,s){let o=!1;return q_(r).ee(a=>B_(r,a,s).next(c=>(c&&(o=!0),b.resolve(!c)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let s=0;return this.wr(e,(o,a)=>{if(a<=t){const c=this.Sr(e,o).next(d=>{if(!d)return s++,i.getEntry(e,o).next(()=>(i.removeEntry(o,j.min()),kn(e).delete(function(p){return[0,it(p.path)]}(o))))});r.push(c)}}).next(()=>b.waitFor(r)).next(()=>i.apply(e)).next(()=>s)}removeTarget(e,t){const i=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,i)}updateLimboDocument(e,t){return Ho(e,t)}wr(e,t){const i=kn(e);let r,s=wt.ue;return i.X({index:Oc},([o,a],{path:c,sequenceNumber:d})=>{o===0?(s!==wt.ue&&t(new W(Vt(r)),s),s=d,r=c):s=wt.ue}).next(()=>{s!==wt.ue&&t(new W(Vt(r)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Ho(n,e){return kn(n).put(function(i,r){return{targetId:0,path:it(i.path),sequenceNumber:r}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H_{constructor(){this.changes=new fn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ke.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return i!==void 0?b.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class US{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,i){return jn(e).put(i)}removeEntry(e,t,i){return jn(e).delete(function(s,o){const a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Ma(o),a[a.length-1]]}(t,i))}updateMetadata(e,t){return this.getMetadata(e).next(i=>(i.byteSize+=t,this.br(e,i)))}getEntry(e,t){let i=ke.newInvalidDocument(t);return jn(e).X({index:na,range:IDBKeyRange.only(ls(t))},(r,s)=>{i=this.Dr(t,s)}).next(()=>i)}vr(e,t){let i={size:0,document:ke.newInvalidDocument(t)};return jn(e).X({index:na,range:IDBKeyRange.only(ls(t))},(r,s)=>{i={document:this.Dr(t,s),size:Na(s)}}).next(()=>i)}getEntries(e,t){let i=_t();return this.Cr(e,t,(r,s)=>{const o=this.Dr(r,s);i=i.insert(r,o)}).next(()=>i)}Fr(e,t){let i=_t(),r=new Re(W.comparator);return this.Cr(e,t,(s,o)=>{const a=this.Dr(s,o);i=i.insert(s,a),r=r.insert(s,Na(o))}).next(()=>({documents:i,Mr:r}))}Cr(e,t,i){if(t.isEmpty())return b.resolve();let r=new ve(dp);t.forEach(c=>r=r.add(c));const s=IDBKeyRange.bound(ls(r.first()),ls(r.last())),o=r.getIterator();let a=o.getNext();return jn(e).X({index:na,range:s},(c,d,h)=>{const p=W.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;a&&dp(a,p)<0;)i(a,null),a=o.getNext();a&&a.isEqual(p)&&(i(a,d),a=o.hasNext()?o.getNext():null),a?h.G(ls(a)):h.done()}).next(()=>{for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,i,r,s){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Ma(i.readTime),i.documentKey.path.isEmpty()?"":i.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return jn(e).j(IDBKeyRange.bound(a,c,!0)).next(d=>{s==null||s.incrementDocumentReadCount(d.length);let h=_t();for(const p of d){const g=this.Dr(W.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);g.isFoundDocument()&&(ao(t,g)||r.has(g.key))&&(h=h.insert(g.key,g))}return h})}getAllFromCollectionGroup(e,t,i,r){let s=_t();const o=cp(t,i),a=cp(t,vt.max());return jn(e).X({index:My,range:IDBKeyRange.bound(o,a,!0)},(c,d,h)=>{const p=this.Dr(W.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);s=s.insert(p.key,p),s.size===r&&h.done()}).next(()=>s)}newChangeBuffer(e){return new OS(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return up(e).get(bu).next(t=>(Q(!!t,20021),t))}br(e,t){return up(e).put(bu,t)}Dr(e,t){if(t){const i=CS(this.serializer,t);if(!(i.isNoDocument()&&i.version.isEqual(j.min())))return i}return ke.newInvalidDocument(e)}}function z_(n){return new US(n)}class OS extends H_{constructor(e,t){super(),this.Or=e,this.trackRemovals=t,this.Nr=new fn(i=>i.toString(),(i,r)=>i.isEqual(r))}applyChanges(e){const t=[];let i=0,r=new ve((s,o)=>te(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{const a=this.Nr.get(s);if(t.push(this.Or.removeEntry(e,s,a.readTime)),o.isValidDocument()){const c=Wh(this.Or.serializer,o);r=r.add(s.path.popLast());const d=Na(c);i+=d-a.size,t.push(this.Or.addEntry(e,s,c))}else if(i-=a.size,this.trackRemovals){const c=Wh(this.Or.serializer,o.convertToNoDocument(j.min()));t.push(this.Or.addEntry(e,s,c))}}),r.forEach(s=>{t.push(this.Or.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.Or.updateMetadata(e,i)),b.waitFor(t)}getFromCache(e,t){return this.Or.vr(e,t).next(i=>(this.Nr.set(t,{size:i.size,readTime:i.document.readTime}),i.document))}getAllFromCache(e,t){return this.Or.Fr(e,t).next(({documents:i,Mr:r})=>(r.forEach((s,o)=>{this.Nr.set(s,{size:o,readTime:i.get(s).readTime})}),i))}}function up(n){return $e(n,Bs)}function jn(n){return $e(n,wa)}function ls(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function cp(n,e){const t=e.documentKey.path.toArray();return[n,Ma(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function dp(n,e){const t=n.path.toArray(),i=e.path.toArray();let r=0;for(let s=0;s<t.length-2&&s<i.length-2;++s)if(r=te(t[s],i[s]),r)return r;return r=te(t.length,i.length),r||(r=te(t[t.length-2],i[i.length-2]),r||te(t[t.length-1],i[i.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BS{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W_{constructor(e,t,i,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=r}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(i=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(i!==null&&xs(i.mutation,r,ht.empty(),ue.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,ae()).next(()=>i))}getLocalViewOfDocuments(e,t,i=ae()){const r=Lt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,i).next(s=>{let o=ps();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const i=Lt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,ae()))}populateOverlays(e,t,i){const r=[];return i.forEach(s=>{t.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,i,r){let s=_t();const o=Ps(),a=function(){return Ps()}();return t.forEach((c,d)=>{const h=i.get(d.key);r.has(d.key)&&(h===void 0||h.mutation instanceof hn)?s=s.insert(d.key,d):h!==void 0?(o.set(d.key,h.mutation.getFieldMask()),xs(h.mutation,d,h.mutation.getFieldMask(),ue.now())):o.set(d.key,ht.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((d,h)=>o.set(d,h)),t.forEach((d,h)=>{var p;return a.set(d,new BS(h,(p=o.get(d))!==null&&p!==void 0?p:null))}),a))}recalculateAndSaveOverlays(e,t){const i=Ps();let r=new Re((o,a)=>o-a),s=ae();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(c=>{const d=t.get(c);if(d===null)return;let h=i.get(c)||ht.empty();h=a.applyToLocalView(d,h),i.set(c,h);const p=(r.get(a.batchId)||ae()).add(c);r=r.insert(a.batchId,p)})}).next(()=>{const o=[],a=r.getReverseIterator();for(;a.hasNext();){const c=a.getNext(),d=c.key,h=c.value,p=u_();h.forEach(g=>{if(!s.has(g)){const _=g_(t.get(g),i.get(g));_!==null&&p.set(g,_),s=s.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,d,p))}return b.waitFor(o)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i,r){return function(o){return W.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):r_(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,r):this.getDocumentsMatchingCollectionQuery(e,t,i,r)}getNextDocuments(e,t,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,r).next(s=>{const o=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,r-s.size):b.resolve(Lt());let a=Ls,c=s;return o.next(d=>b.forEach(d,(h,p)=>(a<p.largestBatchId&&(a=p.largestBatchId),s.get(h)?b.resolve():this.remoteDocumentCache.getEntry(e,h).next(g=>{c=c.insert(h,g)}))).next(()=>this.populateOverlays(e,d,s)).next(()=>this.computeViews(e,c,d,ae())).next(h=>({batchId:a,changes:l_(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new W(t)).next(i=>{let r=ps();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,i,r){const s=t.collectionGroup;let o=ps();return this.indexManager.getCollectionParents(e,s).next(a=>b.forEach(a,c=>{const d=function(p,g){return new oo(g,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(t,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,d,i,r).next(h=>{h.forEach((p,g)=>{o=o.insert(p,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,i,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,s,r))).next(o=>{s.forEach((c,d)=>{const h=d.getKey();o.get(h)===null&&(o=o.insert(h,ke.newInvalidDocument(h)))});let a=ps();return o.forEach((c,d)=>{const h=s.get(c);h!==void 0&&xs(h.mutation,d,ht.empty(),ue.now()),ao(t,d)&&(a=a.insert(c,d))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qS{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return b.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,function(r){return{id:r.id,version:r.version,createTime:dt(r.createTime)}}(t)),b.resolve()}getNamedQuery(e,t){return b.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,function(r){return{name:r.name,query:V_(r.bundledQuery),readTime:dt(r.readTime)}}(t)),b.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $S{constructor(){this.overlays=new Re(W.comparator),this.kr=new Map}getOverlay(e,t){return b.resolve(this.overlays.get(t))}getOverlays(e,t){const i=Lt();return b.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((r,s)=>{this.wt(e,t,s)}),b.resolve()}removeOverlaysForBatchId(e,t,i){const r=this.kr.get(i);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.kr.delete(i)),b.resolve()}getOverlaysForCollection(e,t,i){const r=Lt(),s=t.length+1,o=new W(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const c=a.getNext().value,d=c.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===s&&c.largestBatchId>i&&r.set(c.getKey(),c)}return b.resolve(r)}getOverlaysForCollectionGroup(e,t,i,r){let s=new Re((d,h)=>d-h);const o=this.overlays.getIterator();for(;o.hasNext();){const d=o.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>i){let h=s.get(d.largestBatchId);h===null&&(h=Lt(),s=s.insert(d.largestBatchId,h)),h.set(d.getKey(),d)}}const a=Lt(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((d,h)=>a.set(d,h)),!(a.size()>=r)););return b.resolve(a)}wt(e,t,i){const r=this.overlays.get(i.key);if(r!==null){const o=this.kr.get(r.largestBatchId).delete(i.key);this.kr.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(i.key,new Qc(t,i));let s=this.kr.get(t);s===void 0&&(s=ae(),this.kr.set(t,s)),this.kr.set(t,s.add(i.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GS{constructor(){this.sessionToken=Oe.EMPTY_BYTE_STRING}getSessionToken(e){return b.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,b.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nd{constructor(){this.qr=new ve(Ge.Qr),this.$r=new ve(Ge.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){const i=new Ge(e,t);this.qr=this.qr.add(i),this.$r=this.$r.add(i)}Kr(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.Wr(new Ge(e,t))}Gr(e,t){e.forEach(i=>this.removeReference(i,t))}zr(e){const t=new W(new ye([])),i=new Ge(t,e),r=new Ge(t,e+1),s=[];return this.$r.forEachInRange([i,r],o=>{this.Wr(o),s.push(o.key)}),s}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){const t=new W(new ye([])),i=new Ge(t,e),r=new Ge(t,e+1);let s=ae();return this.$r.forEachInRange([i,r],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new Ge(e,0),i=this.qr.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}}class Ge{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return W.comparator(e.key,t.key)||te(e.Hr,t.Hr)}static Ur(e,t){return te(e.Hr,t.Hr)||W.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HS{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new ve(Ge.Qr)}checkEmpty(e){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,r){const s=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Yc(s,t,i,r);this.mutationQueue.push(o);for(const a of r)this.Yr=this.Yr.add(new Ge(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return b.resolve(o)}lookupMutationBatch(e,t){return b.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,r=this.Xr(i),s=r<0?0:r;return b.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?ci:this.er-1)}getAllMutationBatches(e){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new Ge(t,0),r=new Ge(t,Number.POSITIVE_INFINITY),s=[];return this.Yr.forEachInRange([i,r],o=>{const a=this.Zr(o.Hr);s.push(a)}),b.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new ve(te);return t.forEach(r=>{const s=new Ge(r,0),o=new Ge(r,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([s,o],a=>{i=i.add(a.Hr)})}),b.resolve(this.ei(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,r=i.length+1;let s=i;W.isDocumentKey(s)||(s=s.child(""));const o=new Ge(new W(s),0);let a=new ve(te);return this.Yr.forEachWhile(c=>{const d=c.key.path;return!!i.isPrefixOf(d)&&(d.length===r&&(a=a.add(c.Hr)),!0)},o),b.resolve(this.ei(a))}ei(e){const t=[];return e.forEach(i=>{const r=this.Zr(i);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){Q(this.ti(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let i=this.Yr;return b.forEach(t.mutations,r=>{const s=new Ge(r.key,t.batchId);return i=i.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Yr=i})}rr(e){}containsKey(e,t){const i=new Ge(t,0),r=this.Yr.firstAfterOrEqual(i);return b.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,b.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zS{constructor(e){this.ni=e,this.docs=function(){return new Re(W.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,r=this.docs.get(i),s=r?r.size:0,o=this.ni(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return b.resolve(i?i.document.mutableCopy():ke.newInvalidDocument(t))}getEntries(e,t){let i=_t();return t.forEach(r=>{const s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():ke.newInvalidDocument(r))}),b.resolve(i)}getDocumentsMatchingQuery(e,t,i,r){let s=_t();const o=t.path,a=new W(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){const{key:d,value:{document:h}}=c.getNext();if(!o.isPrefixOf(d.path))break;d.path.length>o.length+1||Fc(Ry(h),i)<=0||(r.has(h.key)||ao(t,h))&&(s=s.insert(h.key,h.mutableCopy()))}return b.resolve(s)}getAllFromCollectionGroup(e,t,i,r){Y(9500)}ri(e,t){return b.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new WS(this)}getSize(e){return b.resolve(this.size)}}class WS extends H_{constructor(e){super(),this.Or=e}applyChanges(e){const t=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?t.push(this.Or.addEntry(e,r)):this.Or.removeEntry(i)}),b.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KS{constructor(e){this.persistence=e,this.ii=new fn(t=>Ei(t),so),this.lastRemoteSnapshotVersion=j.min(),this.highestTargetId=0,this.si=0,this.oi=new nd,this.targetCount=0,this._i=Ai.ar()}forEachTarget(e,t){return this.ii.forEach((i,r)=>t(r)),b.resolve()}getLastRemoteSnapshotVersion(e){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return b.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.si&&(this.si=t),b.resolve()}hr(e){this.ii.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this._i=new Ai(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,b.resolve()}updateTargetData(e,t){return this.hr(t),b.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,b.resolve()}removeTargets(e,t,i){let r=0;const s=[];return this.ii.forEach((o,a)=>{a.sequenceNumber<=t&&i.get(a.targetId)===null&&(this.ii.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),b.waitFor(s).next(()=>r)}getTargetCount(e){return b.resolve(this.targetCount)}getTargetData(e,t){const i=this.ii.get(t)||null;return b.resolve(i)}addMatchingKeys(e,t,i){return this.oi.Kr(t,i),b.resolve()}removeMatchingKeys(e,t,i){this.oi.Gr(t,i);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(o=>{s.push(r.markPotentiallyOrphaned(e,o))}),b.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),b.resolve()}getMatchingKeysForTargetId(e,t){const i=this.oi.Jr(t);return b.resolve(i)}containsKey(e,t){return b.resolve(this.oi.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class id{constructor(e,t){this.ai={},this.overlays={},this.ui=new wt(0),this.ci=!1,this.ci=!0,this.li=new GS,this.referenceDelegate=e(this),this.hi=new KS(this),this.indexManager=new bS,this.remoteDocumentCache=function(r){return new zS(r)}(i=>this.referenceDelegate.Pi(i)),this.serializer=new D_(t),this.Ti=new qS(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new $S,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.ai[e.toKey()];return i||(i=new HS(t,this.referenceDelegate),this.ai[e.toKey()]=i),i}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,i){B("MemoryPersistence","Starting transaction:",e);const r=new JS(this.ui.next());return this.referenceDelegate.Ii(),i(r).next(s=>this.referenceDelegate.di(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}Ei(e,t){return b.or(Object.values(this.ai).map(i=>()=>i.containsKey(e,t)))}}class JS extends xy{constructor(e){super(),this.currentSequenceNumber=e}}class gl{constructor(e){this.persistence=e,this.Ai=new nd,this.Ri=null}static Vi(e){return new gl(e)}get mi(){if(this.Ri)return this.Ri;throw Y(60996)}addReference(e,t,i){return this.Ai.addReference(i,t),this.mi.delete(i.toString()),b.resolve()}removeReference(e,t,i){return this.Ai.removeReference(i,t),this.mi.add(i.toString()),b.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),b.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(r=>this.mi.add(r.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(s=>this.mi.add(s.toString()))}).next(()=>i.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.mi,i=>{const r=W.fromPath(i);return this.fi(e,r).next(s=>{s||t.removeEntry(r,j.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(i=>{i?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return b.or([()=>b.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class Va{constructor(e,t){this.persistence=e,this.gi=new fn(i=>it(i.path),(i,r)=>i.isEqual(r)),this.garbageCollector=G_(this,t)}static Vi(e,t){return new Va(e,t)}Ii(){}di(e){return b.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){const t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(i=>t.next(r=>i+r))}yr(e){let t=0;return this.gr(e,i=>{t++}).next(()=>t)}gr(e,t){return b.forEach(this.gi,(i,r)=>this.Sr(e,i,r).next(s=>s?b.resolve():t(r)))}removeTargets(e,t,i){return this.persistence.getTargetCache().removeTargets(e,t,i)}removeOrphanedDocuments(e,t){let i=0;const r=this.persistence.getRemoteDocumentCache(),s=r.newChangeBuffer();return r.ri(e,o=>this.Sr(e,o,t).next(a=>{a||(i++,s.removeEntry(o,j.min()))})).next(()=>s.apply(e)).next(()=>i)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),b.resolve()}removeTarget(e,t){const i=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,i)}addReference(e,t,i){return this.gi.set(i,e.currentSequenceNumber),b.resolve()}removeReference(e,t,i){return this.gi.set(i,e.currentSequenceNumber),b.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),b.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=ra(e.data.value)),t}Sr(e,t,i){return b.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const r=this.gi.get(t);return b.resolve(r!==void 0&&r>i)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YS{constructor(e){this.serializer=e}q(e,t,i,r){const s=new nl("createOrUpgrade",t);i<1&&r>=1&&(function(c){c.createObjectStore(ro)}(e),function(c){c.createObjectStore(Os,{keyPath:lA}),c.createObjectStore(xt,{keyPath:Ih,autoIncrement:!0}).createIndex(li,Ch,{unique:!0}),c.createObjectStore(fr)}(e),fp(e),function(c){c.createObjectStore(ii)}(e));let o=b.resolve();return i<3&&r>=3&&(i!==0&&(function(c){c.deleteObjectStore(pr),c.deleteObjectStore(hr),c.deleteObjectStore(di)}(e),fp(e)),o=o.next(()=>function(c){const d=c.store(di),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:j.min().toTimestamp(),targetCount:0};return d.put(Aa,h)}(s))),i<4&&r>=4&&(i!==0&&(o=o.next(()=>function(c,d){return d.store(xt).j().next(p=>{c.deleteObjectStore(xt),c.createObjectStore(xt,{keyPath:Ih,autoIncrement:!0}).createIndex(li,Ch,{unique:!0});const g=d.store(xt),_=p.map(C=>g.put(C));return b.waitFor(_)})}(e,s))),o=o.next(()=>{(function(c){c.createObjectStore(mr,{keyPath:yA})})(e)})),i<5&&r>=5&&(o=o.next(()=>this.pi(s))),i<6&&r>=6&&(o=o.next(()=>(function(c){c.createObjectStore(Bs)}(e),this.yi(s)))),i<7&&r>=7&&(o=o.next(()=>this.wi(s))),i<8&&r>=8&&(o=o.next(()=>this.Si(e,s))),i<9&&r>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),i<10&&r>=10&&(o=o.next(()=>this.bi(s))),i<11&&r>=11&&(o=o.next(()=>{(function(c){c.createObjectStore(rl,{keyPath:_A})})(e),function(c){c.createObjectStore(sl,{keyPath:vA})}(e)})),i<12&&r>=12&&(o=o.next(()=>{(function(c){const d=c.createObjectStore(ol,{keyPath:SA});d.createIndex(Du,RA,{unique:!1}),d.createIndex(Ly,PA,{unique:!1})})(e)})),i<13&&r>=13&&(o=o.next(()=>function(c){const d=c.createObjectStore(wa,{keyPath:cA});d.createIndex(na,dA),d.createIndex(My,fA)}(e)).next(()=>this.Di(e,s)).next(()=>e.deleteObjectStore(ii))),i<14&&r>=14&&(o=o.next(()=>this.Ci(e,s))),i<15&&r>=15&&(o=o.next(()=>function(c){c.createObjectStore(Bc,{keyPath:TA,autoIncrement:!0}).createIndex(Mu,EA,{unique:!1}),c.createObjectStore(ws,{keyPath:IA}).createIndex(Ny,CA,{unique:!1}),c.createObjectStore(As,{keyPath:wA}).createIndex(Vy,AA,{unique:!1})}(e))),i<16&&r>=16&&(o=o.next(()=>{t.objectStore(ws).clear()}).next(()=>{t.objectStore(As).clear()})),i<17&&r>=17&&(o=o.next(()=>{(function(c){c.createObjectStore(qc,{keyPath:xA})})(e)})),i<18&&r>=18&&Rg()&&(o=o.next(()=>{t.objectStore(ws).clear()}).next(()=>{t.objectStore(As).clear()})),o}yi(e){let t=0;return e.store(ii).X((i,r)=>{t+=Na(r)}).next(()=>{const i={byteSize:t};return e.store(Bs).put(bu,i)})}pi(e){const t=e.store(Os),i=e.store(xt);return t.j().next(r=>b.forEach(r,s=>{const o=IDBKeyRange.bound([s.userId,ci],[s.userId,s.lastAcknowledgedBatchId]);return i.j(li,o).next(a=>b.forEach(a,c=>{Q(c.userId===s.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});const d=si(this.serializer,c);return O_(e,s.userId,d).next(()=>{})}))}))}wi(e){const t=e.store(pr),i=e.store(ii);return e.store(di).get(Aa).next(r=>{const s=[];return i.X((o,a)=>{const c=new ye(o),d=function(p){return[0,it(p)]}(c);s.push(t.get(d).next(h=>h?b.resolve():(p=>t.put({targetId:0,path:it(p),sequenceNumber:r.highestListenSequenceNumber}))(c)))}).next(()=>b.waitFor(s))})}Si(e,t){e.createObjectStore(qs,{keyPath:gA});const i=t.store(qs),r=new td,s=o=>{if(r.add(o)){const a=o.lastSegment(),c=o.popLast();return i.put({collectionId:a,parent:it(c)})}};return t.store(ii).X({Z:!0},(o,a)=>{const c=new ye(o);return s(c.popLast())}).next(()=>t.store(fr).X({Z:!0},([o,a,c],d)=>{const h=Vt(a);return s(h.popLast())}))}bi(e){const t=e.store(hr);return t.X((i,r)=>{const s=gs(r),o=N_(this.serializer,s);return t.put(o)})}Di(e,t){const i=t.store(ii),r=[];return i.X((s,o)=>{const a=t.store(wa),c=function(p){return p.document?new W(ye.fromString(p.document.name).popFirst(5)):p.noDocument?W.fromSegments(p.noDocument.path):p.unknownDocument?W.fromSegments(p.unknownDocument.path):Y(36783)}(o).path.toArray(),d={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};r.push(a.put(d))}).next(()=>b.waitFor(r))}Ci(e,t){const i=t.store(xt),r=z_(this.serializer),s=new id(gl.Vi,this.serializer.gt);return i.j().next(o=>{const a=new Map;return o.forEach(c=>{var d;let h=(d=a.get(c.userId))!==null&&d!==void 0?d:ae();si(this.serializer,c).keys().forEach(p=>h=h.add(p)),a.set(c.userId,h)}),b.forEach(a,(c,d)=>{const h=new We(d),p=pl.yt(this.serializer,h),g=s.getIndexManager(h),_=ml.yt(h,this.serializer,g,s.referenceDelegate);return new W_(r,_,p,g).recalculateAndSaveOverlaysForDocumentKeys(new Nu(t,wt.ue),c).next()})})}}function fp(n){n.createObjectStore(pr,{keyPath:pA}).createIndex(Oc,mA,{unique:!0}),n.createObjectStore(hr,{keyPath:"targetId"}).createIndex(Dy,hA,{unique:!0}),n.createObjectStore(di)}const Cn="IndexedDbPersistence",lu=18e5,uu=5e3,cu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",XS="main";class rd{constructor(e,t,i,r,s,o,a,c,d,h,p=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=i,this.Fi=s,this.window=o,this.document=a,this.Mi=d,this.xi=h,this.Oi=p,this.ui=null,this.ci=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ni=null,this.inForeground=!1,this.Bi=null,this.Li=null,this.ki=Number.NEGATIVE_INFINITY,this.qi=g=>Promise.resolve(),!rd.C())throw new H(N.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new FS(this,r),this.Qi=t+XS,this.serializer=new D_(c),this.$i=new Ln(this.Qi,this.Oi,new YS(this.serializer)),this.li=new AS,this.hi=new DS(this.referenceDelegate,this.serializer),this.remoteDocumentCache=z_(this.serializer),this.Ti=new wS,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,h===!1&&ut(Cn,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ki().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new H(N.FAILED_PRECONDITION,cu);return this.Wi(),this.Gi(),this.zi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.hi.getHighestSequenceNumber(e))}).then(e=>{this.ui=new wt(e,this.Mi)}).then(()=>{this.ci=!0}).catch(e=>(this.$i&&this.$i.close(),Promise.reject(e)))}ji(e){return this.qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.$i.setDatabaseDeletedListener(e)}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Fi.enqueueAndForget(async()=>{this.started&&await this.Ki()}))}Ki(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>zo(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Ji(e).next(t=>{t||(this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)))})}).next(()=>this.Hi(e)).next(t=>this.isPrimary&&!t?this.Yi(e).next(()=>!1):!!t&&this.Zi(e).next(()=>!0))).catch(e=>{if(Kn(e))return B(Cn,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return B(Cn,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Fi.enqueueRetryable(()=>this.qi(e)),this.isPrimary=e})}Ji(e){return us(e).get($i).next(t=>b.resolve(this.Xi(t)))}es(e){return zo(e).delete(this.clientId)}async ts(){if(this.isPrimary&&!this.ns(this.ki,lu)){this.ki=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const i=$e(t,mr);return i.j().next(r=>{const s=this.rs(r,lu),o=r.filter(a=>s.indexOf(a)===-1);return b.forEach(o,a=>i.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ui)for(const t of e)this.Ui.removeItem(this.ss(t.clientId))}}zi(){this.Li=this.Fi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ki().then(()=>this.ts()).then(()=>this.zi()))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.xi?b.resolve(!0):us(e).get($i).next(t=>{if(t!==null&&this.ns(t.leaseTimestampMs,uu)&&!this._s(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new H(N.FAILED_PRECONDITION,cu);return!1}}return!(!this.networkEnabled||!this.inForeground)||zo(e).j().next(i=>this.rs(i,uu).find(r=>{if(this.clientId!==r.clientId){const s=!this.networkEnabled&&r.networkEnabled,o=!this.inForeground&&r.inForeground,a=this.networkEnabled===r.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&B(Cn,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.ci=!1,this.us(),this.Li&&(this.Li.cancel(),this.Li=null),this.cs(),this.ls(),await this.$i.runTransaction("shutdown","readwrite",[ro,mr],e=>{const t=new Nu(e,wt.ue);return this.Yi(t).next(()=>this.es(t))}),this.$i.close(),this.hs()}rs(e,t){return e.filter(i=>this.ns(i.updateTimeMs,t)&&!this._s(i.clientId))}Ps(){return this.runTransaction("getActiveClients","readonly",e=>zo(e).j().next(t=>this.rs(t,lu).map(i=>i.clientId)))}get started(){return this.ci}getGlobalsCache(){return this.li}getMutationQueue(e,t){return ml.yt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new MS(e,this.serializer.gt.databaseId)}getDocumentOverlayCache(e){return pl.yt(this.serializer,e)}getBundleCache(){return this.Ti}runTransaction(e,t,i){B(Cn,"Starting transaction:",e);const r=t==="readonly"?"readonly":"readwrite",s=function(c){return c===18?MA:c===17?By:c===16?bA:c===15?$c:c===14?Oy:c===13?Uy:c===12?kA:c===11?Fy:void Y(60245)}(this.Oi);let o;return this.$i.runTransaction(e,r,s,a=>(o=new Nu(a,this.ui?this.ui.next():wt.ue),t==="readwrite-primary"?this.Ji(o).next(c=>!!c||this.Hi(o)).next(c=>{if(!c)throw ut(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)),new H(N.FAILED_PRECONDITION,Py);return i(o)}).next(c=>this.Zi(o).next(()=>c)):this.Ts(o).next(()=>i(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ts(e){return us(e).get($i).next(t=>{if(t!==null&&this.ns(t.leaseTimestampMs,uu)&&!this._s(t.ownerId)&&!this.Xi(t)&&!(this.xi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new H(N.FAILED_PRECONDITION,cu)})}Zi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return us(e).put($i,t)}static C(){return Ln.C()}Yi(e){const t=us(e);return t.get($i).next(i=>this.Xi(i)?(B(Cn,"Releasing primary lease."),t.delete($i)):b.resolve())}ns(e,t){const i=Date.now();return!(e<i-t)&&(!(e>i)||(ut(`Detected an update time that is in the future: ${e} > ${i}`),!1))}Wi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Bi=()=>{this.Fi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ki()))},this.document.addEventListener("visibilitychange",this.Bi),this.inForeground=this.document.visibilityState==="visible")}cs(){this.Bi&&(this.document.removeEventListener("visibilitychange",this.Bi),this.Bi=null)}Gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Ni=()=>{this.us();const t=/(?:Version|Mobile)\/1[456]/;Sg()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Fi.enterRestrictedMode(!0),this.Fi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ni))}ls(){this.Ni&&(this.window.removeEventListener("pagehide",this.Ni),this.Ni=null)}_s(e){var t;try{const i=((t=this.Ui)===null||t===void 0?void 0:t.getItem(this.ss(e)))!==null;return B(Cn,`Client '${e}' ${i?"is":"is not"} zombied in LocalStorage`),i}catch(i){return ut(Cn,"Failed to get zombied client id.",i),!1}}us(){if(this.Ui)try{this.Ui.setItem(this.ss(this.clientId),String(Date.now()))}catch(e){ut("Failed to set zombie client id.",e)}}hs(){if(this.Ui)try{this.Ui.removeItem(this.ss(this.clientId))}catch{}}ss(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function us(n){return $e(n,ro)}function zo(n){return $e(n,mr)}function QS(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sd{constructor(e,t,i,r){this.targetId=e,this.fromCache=t,this.Is=i,this.ds=r}static Es(e,t){let i=ae(),r=ae();for(const s of t.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new sd(e,t.fromCache,i,r)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZS{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K_{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=function(){return Sg()?8:ky(qe())>0?6:4}()}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,i,r){const s={result:null};return this.ps(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ys(e,t,r,i).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new ZS;return this.ws(e,t,o).next(a=>{if(s.result=a,this.Rs)return this.Ss(e,t,o,a.size)})}).next(()=>s.result)}Ss(e,t,i,r){return i.documentReadCount<this.Vs?(Yi()<=le.DEBUG&&B("QueryEngine","SDK will not create cache indexes for query:",Xi(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),b.resolve()):(Yi()<=le.DEBUG&&B("QueryEngine","Query:",Xi(t),"scans",i.documentReadCount,"local documents and returns",r,"documents as results."),i.documentReadCount>this.fs*r?(Yi()<=le.DEBUG&&B("QueryEngine","The SDK decides to create cache indexes for query:",Xi(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,At(t))):b.resolve())}ps(e,t){if(Lh(t))return b.resolve(null);let i=At(t);return this.indexManager.getIndexType(e,i).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=qu(t,null,"F"),i=At(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(s=>{const o=ae(...s);return this.gs.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,i).next(c=>{const d=this.bs(t,a);return this.Ds(t,d,o,c.readTime)?this.ps(e,qu(t,null,"F")):this.vs(e,d,t,c)}))})))}ys(e,t,i,r){return Lh(t)||r.isEqual(j.min())?b.resolve(null):this.gs.getDocuments(e,i).next(s=>{const o=this.bs(t,s);return this.Ds(t,o,i,r)?b.resolve(null):(Yi()<=le.DEBUG&&B("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Xi(t)),this.vs(e,o,t,tA(r,Ls)).next(a=>a))})}bs(e,t){let i=new ve(o_(e));return t.forEach((r,s)=>{ao(e,s)&&(i=i.add(s))}),i}Ds(e,t,i,r){if(e.limit===null)return!1;if(i.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}ws(e,t,i){return Yi()<=le.DEBUG&&B("QueryEngine","Using full collection scan to execute query:",Xi(t)),this.gs.getDocumentsMatchingQuery(e,t,vt.min(),i)}vs(e,t,i,r){return this.gs.getDocumentsMatchingQuery(e,i,r).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const od="LocalStore",jS=3e8;class e0{constructor(e,t,i,r){this.persistence=e,this.Cs=t,this.serializer=r,this.Fs=new Re(te),this.Ms=new fn(s=>Ei(s),so),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(i)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new W_(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}}function J_(n,e,t,i){return new e0(n,e,t,i)}async function Y_(n,e){const t=re(n);return await t.persistence.runTransaction("Handle user change","readonly",i=>{let r;return t.mutationQueue.getAllMutationBatches(i).next(s=>(r=s,t.Ns(e),t.mutationQueue.getAllMutationBatches(i))).next(s=>{const o=[],a=[];let c=ae();for(const d of r){o.push(d.batchId);for(const h of d.mutations)c=c.add(h.key)}for(const d of s){a.push(d.batchId);for(const h of d.mutations)c=c.add(h.key)}return t.localDocuments.getDocuments(i,c).next(d=>({Bs:d,removedBatchIds:o,addedBatchIds:a}))})})}function t0(n,e){const t=re(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const r=e.batch.keys(),s=t.Os.newChangeBuffer({trackRemovals:!0});return function(a,c,d,h){const p=d.batch,g=p.keys();let _=b.resolve();return g.forEach(C=>{_=_.next(()=>h.getEntry(c,C)).next(P=>{const x=d.docVersions.get(C);Q(x!==null,48541),P.version.compareTo(x)<0&&(p.applyToRemoteDocument(P,d),P.isValidDocument()&&(P.setReadTime(d.commitVersion),h.addEntry(P)))})}),_.next(()=>a.mutationQueue.removeMutationBatch(c,p))}(t,i,e,s).next(()=>s.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(a){let c=ae();for(let d=0;d<a.mutationResults.length;++d)a.mutationResults[d].transformResults.length>0&&(c=c.add(a.batch.mutations[d].key));return c}(e))).next(()=>t.localDocuments.getDocuments(i,r))})}function X_(n){const e=re(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.hi.getLastRemoteSnapshotVersion(t))}function n0(n,e){const t=re(n),i=e.snapshotVersion;let r=t.Fs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=t.Os.newChangeBuffer({trackRemovals:!0});r=t.Fs;const a=[];e.targetChanges.forEach((h,p)=>{const g=r.get(p);if(!g)return;a.push(t.hi.removeMatchingKeys(s,h.removedDocuments,p).next(()=>t.hi.addMatchingKeys(s,h.addedDocuments,p)));let _=g.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(p)!==null?_=_.withResumeToken(Oe.EMPTY_BYTE_STRING,j.min()).withLastLimboFreeSnapshotVersion(j.min()):h.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(h.resumeToken,i)),r=r.insert(p,_),function(P,x,F){return P.resumeToken.approximateByteSize()===0||x.snapshotVersion.toMicroseconds()-P.snapshotVersion.toMicroseconds()>=jS?!0:F.addedDocuments.size+F.modifiedDocuments.size+F.removedDocuments.size>0}(g,_,h)&&a.push(t.hi.updateTargetData(s,_))});let c=_t(),d=ae();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,h))}),a.push(i0(s,o,e.documentUpdates).next(h=>{c=h.Ls,d=h.ks})),!i.isEqual(j.min())){const h=t.hi.getLastRemoteSnapshotVersion(s).next(p=>t.hi.setTargetsMetadata(s,s.currentSequenceNumber,i));a.push(h)}return b.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,d)).next(()=>c)}).then(s=>(t.Fs=r,s))}function i0(n,e,t){let i=ae(),r=ae();return t.forEach(s=>i=i.add(s)),e.getEntries(n,i).next(s=>{let o=_t();return t.forEach((a,c)=>{const d=s.get(a);c.isFoundDocument()!==d.isFoundDocument()&&(r=r.add(a)),c.isNoDocument()&&c.version.isEqual(j.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!d.isValidDocument()||c.version.compareTo(d.version)>0||c.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):B(od,"Ignoring outdated watch update for ",a,". Current version:",d.version," Watch version:",c.version)}),{Ls:o,ks:r}})}function r0(n,e){const t=re(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=ci),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function s0(n,e){const t=re(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return t.hi.getTargetData(i,e).next(s=>s?(r=s,b.resolve(r)):t.hi.allocateTargetId(i).next(o=>(r=new tn(e,o,"TargetPurposeListen",i.currentSequenceNumber),t.hi.addTargetData(i,r).next(()=>r))))}).then(i=>{const r=t.Fs.get(i.targetId);return(r===null||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.Fs=t.Fs.insert(i.targetId,i),t.Ms.set(e,i.targetId)),i})}async function Yu(n,e,t){const i=re(n),r=i.Fs.get(e),s=t?"readwrite":"readwrite-primary";try{t||await i.persistence.runTransaction("Release target",s,o=>i.persistence.referenceDelegate.removeTarget(o,r))}catch(o){if(!Kn(o))throw o;B(od,`Failed to update sequence numbers for target ${e}: ${o}`)}i.Fs=i.Fs.remove(e),i.Ms.delete(r.target)}function hp(n,e,t){const i=re(n);let r=j.min(),s=ae();return i.persistence.runTransaction("Execute query","readwrite",o=>function(c,d,h){const p=re(c),g=p.Ms.get(h);return g!==void 0?b.resolve(p.Fs.get(g)):p.hi.getTargetData(d,h)}(i,o,At(e)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,i.hi.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>i.Cs.getDocumentsMatchingQuery(o,e,t?r:j.min(),t?s:ae())).next(a=>(o0(i,KA(e),a),{documents:a,qs:s})))}function o0(n,e,t){let i=n.xs.get(e)||j.min();t.forEach((r,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)}),n.xs.set(e,i)}class pp{constructor(){this.activeTargetIds=jA()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Q_{constructor(){this.Fo=new pp,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,i){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new pp,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a0{xo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mp="ConnectivityMonitor";class gp{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){B(mp,"Network connectivity changed: AVAILABLE");for(const e of this.ko)e(0)}Lo(){B(mp,"Network connectivity changed: UNAVAILABLE");for(const e of this.ko)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wo=null;function Xu(){return Wo===null?Wo=function(){return 268435456+Math.round(2147483648*Math.random())}():Wo++,"0x"+Wo.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const du="RestConnection",l0={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class u0{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${i}/databases/${r}`,this.Ko=this.databaseId.database===Sa?`project_id=${i}`:`project_id=${i}&database_id=${r}`}Wo(e,t,i,r,s){const o=Xu(),a=this.Go(e,t.toUriEncodedString());B(du,`Sending RPC '${e}' ${o}:`,a,i);const c={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(c,r,s);const{host:d}=new URL(a),h=br(d);return this.jo(e,a,c,i,h).then(p=>(B(du,`Received RPC '${e}' ${o}: `,p),p),p=>{throw Wt(du,`RPC '${e}' ${o} failed with error: `,p,"url: ",a,"request:",i),p})}Jo(e,t,i,r,s,o){return this.Wo(e,t,i,r,s)}zo(e,t,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Nr}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((r,s)=>e[s]=r),i&&i.headers.forEach((r,s)=>e[s]=r)}Go(e,t){const i=l0[e];return`${this.$o}/v1/${t}:${i}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c0{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const je="WebChannelConnection";class d0 extends u0{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,i,r,s){const o=Xu();return new Promise((a,c)=>{const d=new gy;d.setWithCredentials(!0),d.listenOnce(yy.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case jo.NO_ERROR:const p=d.getResponseJson();B(je,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(p)),a(p);break;case jo.TIMEOUT:B(je,`RPC '${e}' ${o} timed out`),c(new H(N.DEADLINE_EXCEEDED,"Request time out"));break;case jo.HTTP_ERROR:const g=d.getStatus();if(B(je,`RPC '${e}' ${o} failed with status:`,g,"response text:",d.getResponseText()),g>0){let _=d.getResponseJson();Array.isArray(_)&&(_=_[0]);const C=_==null?void 0:_.error;if(C&&C.status&&C.message){const P=function(F){const L=F.toLowerCase().replace(/_/g,"-");return Object.values(N).indexOf(L)>=0?L:N.UNKNOWN}(C.status);c(new H(P,C.message))}else c(new H(N.UNKNOWN,"Server responded with status "+d.getStatus()))}else c(new H(N.UNAVAILABLE,"Connection failed."));break;default:Y(9055,{c_:e,streamId:o,l_:d.getLastErrorCode(),h_:d.getLastError()})}}finally{B(je,`RPC '${e}' ${o} completed.`)}});const h=JSON.stringify(r);B(je,`RPC '${e}' ${o} sending request:`,r),d.send(t,"POST",h,i,15)})}P_(e,t,i){const r=Xu(),s=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Ty(),a=vy(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(c.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(c.useFetchStreams=!0),this.zo(c.initMessageHeaders,t,i),c.encodeInitMessageHeaders=!0;const h=s.join("");B(je,`Creating RPC '${e}' stream ${r}: ${h}`,c);const p=o.createWebChannel(h,c);this.T_(p);let g=!1,_=!1;const C=new c0({Ho:x=>{_?B(je,`Not sending because RPC '${e}' stream ${r} is closed:`,x):(g||(B(je,`Opening RPC '${e}' stream ${r} transport.`),p.open(),g=!0),B(je,`RPC '${e}' stream ${r} sending:`,x),p.send(x))},Yo:()=>p.close()}),P=(x,F,L)=>{x.listen(F,V=>{try{L(V)}catch(O){setTimeout(()=>{throw O},0)}})};return P(p,hs.EventType.OPEN,()=>{_||(B(je,`RPC '${e}' stream ${r} transport opened.`),C.s_())}),P(p,hs.EventType.CLOSE,()=>{_||(_=!0,B(je,`RPC '${e}' stream ${r} transport closed`),C.__(),this.I_(p))}),P(p,hs.EventType.ERROR,x=>{_||(_=!0,Wt(je,`RPC '${e}' stream ${r} transport errored. Name:`,x.name,"Message:",x.message),C.__(new H(N.UNAVAILABLE,"The operation could not be completed")))}),P(p,hs.EventType.MESSAGE,x=>{var F;if(!_){const L=x.data[0];Q(!!L,16349);const V=L,O=(V==null?void 0:V.error)||((F=V[0])===null||F===void 0?void 0:F.error);if(O){B(je,`RPC '${e}' stream ${r} received error:`,O);const U=O.status;let q=function(E){const R=Le[E];if(R!==void 0)return v_(R)}(U),I=O.message;q===void 0&&(q=N.INTERNAL,I="Unknown error status: "+U+" with message "+O.message),_=!0,C.__(new H(q,I)),p.close()}else B(je,`RPC '${e}' stream ${r} received:`,L),C.a_(L)}}),P(a,_y.STAT_EVENT,x=>{x.stat===Pu.PROXY?B(je,`RPC '${e}' stream ${r} detected buffering proxy`):x.stat===Pu.NOPROXY&&B(je,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{C.o_()},0),C}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f0(){return typeof window<"u"?window:null}function ua(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yl(n){return new hS(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z_{constructor(e,t,i=1e3,r=1.5,s=6e4){this.Fi=e,this.timerId=t,this.d_=i,this.E_=r,this.A_=s,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();const t=Math.floor(this.R_+this.p_()),i=Math.max(0,Date.now()-this.m_),r=Math.max(0,t-i);r>0&&B("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,r,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yp="PersistentStream";class j_{constructor(e,t,i,r,s,o,a,c){this.Fi=e,this.w_=i,this.S_=r,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new Z_(e,t)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}async stop(){this.M_()&&await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,e!==4?this.F_.reset():t&&t.code===N.RESOURCE_EXHAUSTED?(ut(t.toString()),ut("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===N.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.n_(t)}U_(){}auth(){this.state=1;const e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.b_===t&&this.W_(i,r)},i=>{e(()=>{const r=new H(N.UNKNOWN,"Fetching auth token failed: "+i.message);return this.G_(r)})})}W_(e,t){const i=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{i(()=>this.listener.Zo())}),this.stream.e_(()=>{i(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(r=>{i(()=>this.G_(r))}),this.stream.onMessage(r=>{i(()=>++this.C_==1?this.j_(r):this.onNext(r))})}O_(){this.state=5,this.F_.g_(async()=>{this.state=0,this.start()})}G_(e){return B(yp,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(B(yp,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class h0 extends j_{constructor(e,t,i,r,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,r,o),this.serializer=s}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();const t=gS(this.serializer,e),i=function(s){if(!("targetChange"in s))return j.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?j.min():o.readTime?dt(o.readTime):j.min()}(e);return this.listener.J_(t,i)}H_(e){const t={};t.database=Hu(this.serializer),t.addTarget=function(s,o){let a;const c=o.target;if(a=Pa(c)?{documents:R_(s,c)}:{query:P_(s,c).Vt},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=I_(s,o.resumeToken);const d=$u(s,o.expectedCount);d!==null&&(a.expectedCount=d)}else if(o.snapshotVersion.compareTo(j.min())>0){a.readTime=Ir(s,o.snapshotVersion.toTimestamp());const d=$u(s,o.expectedCount);d!==null&&(a.expectedCount=d)}return a}(this.serializer,e);const i=_S(this.serializer,e);i&&(t.labels=i),this.k_(t)}Y_(e){const t={};t.database=Hu(this.serializer),t.removeTarget=e,this.k_(t)}}class p0 extends j_{constructor(e,t,i,r,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,r,o),this.serializer=s}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return Q(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Q(!e.writeResults||e.writeResults.length===0,55816),this.listener.ea()}onNext(e){Q(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();const t=yS(e.writeResults,e.commitTime),i=dt(e.commitTime);return this.listener.ta(i,t)}na(){const e={};e.database=Hu(this.serializer),this.k_(e)}X_(e){const t={streamToken:this.lastStreamToken,writes:e.map(i=>ba(this.serializer,i))};this.k_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m0{}class g0 extends m0{constructor(e,t,i,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=r,this.ra=!1}ia(){if(this.ra)throw new H(N.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,i,r){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Wo(e,Gu(t,i),r,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new H(N.UNKNOWN,s.toString())})}Jo(e,t,i,r,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Jo(e,Gu(t,i),r,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new H(N.UNKNOWN,o.toString())})}terminate(){this.ra=!0,this.connection.terminate()}}class y0{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,e==="Online"&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(ut(t),this._a=!1):B("OnlineStateTracker",t)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Si="RemoteStore";class _0{constructor(e,t,i,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=s,this.Ea.xo(o=>{i.enqueueAndForget(async()=>{Vi(this)&&(B(Si,"Restarting streams for network reachability change."),await async function(c){const d=re(c);d.Ia.add(4),await co(d),d.Aa.set("Unknown"),d.Ia.delete(4),await _l(d)}(this))})}),this.Aa=new y0(i,r)}}async function _l(n){if(Vi(n))for(const e of n.da)await e(!0)}async function co(n){for(const e of n.da)await e(!1)}function ev(n,e){const t=re(n);t.Ta.has(e.targetId)||(t.Ta.set(e.targetId,e),cd(t)?ud(t):Lr(t).x_()&&ld(t,e))}function ad(n,e){const t=re(n),i=Lr(t);t.Ta.delete(e),i.x_()&&tv(t,e),t.Ta.size===0&&(i.x_()?i.B_():Vi(t)&&t.Aa.set("Unknown"))}function ld(n,e){if(n.Ra.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(j.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Lr(n).H_(e)}function tv(n,e){n.Ra.$e(e),Lr(n).Y_(e)}function ud(n){n.Ra=new uS({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>n.Ta.get(e)||null,lt:()=>n.datastore.serializer.databaseId}),Lr(n).start(),n.Aa.aa()}function cd(n){return Vi(n)&&!Lr(n).M_()&&n.Ta.size>0}function Vi(n){return re(n).Ia.size===0}function nv(n){n.Ra=void 0}async function v0(n){n.Aa.set("Online")}async function T0(n){n.Ta.forEach((e,t)=>{ld(n,e)})}async function E0(n,e){nv(n),cd(n)?(n.Aa.la(e),ud(n)):n.Aa.set("Unknown")}async function I0(n,e,t){if(n.Aa.set("Online"),e instanceof E_&&e.state===2&&e.cause)try{await async function(r,s){const o=s.cause;for(const a of s.targetIds)r.Ta.has(a)&&(await r.remoteSyncer.rejectListen(a,o),r.Ta.delete(a),r.Ra.removeTarget(a))}(n,e)}catch(i){B(Si,"Failed to remove targets %s: %s ",e.targetIds.join(","),i),await La(n,i)}else if(e instanceof aa?n.Ra.Ye(e):e instanceof T_?n.Ra.it(e):n.Ra.et(e),!t.isEqual(j.min()))try{const i=await X_(n.localStore);t.compareTo(i)>=0&&await function(s,o){const a=s.Ra.Pt(o);return a.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){const h=s.Ta.get(d);h&&s.Ta.set(d,h.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,d)=>{const h=s.Ta.get(c);if(!h)return;s.Ta.set(c,h.withResumeToken(Oe.EMPTY_BYTE_STRING,h.snapshotVersion)),tv(s,c);const p=new tn(h.target,c,d,h.sequenceNumber);ld(s,p)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(i){B(Si,"Failed to raise snapshot:",i),await La(n,i)}}async function La(n,e,t){if(!Kn(e))throw e;n.Ia.add(1),await co(n),n.Aa.set("Offline"),t||(t=()=>X_(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{B(Si,"Retrying IndexedDB access"),await t(),n.Ia.delete(1),await _l(n)})}function iv(n,e){return e().catch(t=>La(n,t,e))}async function fo(n){const e=re(n),t=$n(e);let i=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:ci;for(;C0(e);)try{const r=await r0(e.localStore,i);if(r===null){e.Pa.length===0&&t.B_();break}i=r.batchId,w0(e,r)}catch(r){await La(e,r)}rv(e)&&sv(e)}function C0(n){return Vi(n)&&n.Pa.length<10}function w0(n,e){n.Pa.push(e);const t=$n(n);t.x_()&&t.Z_&&t.X_(e.mutations)}function rv(n){return Vi(n)&&!$n(n).M_()&&n.Pa.length>0}function sv(n){$n(n).start()}async function A0(n){$n(n).na()}async function S0(n){const e=$n(n);for(const t of n.Pa)e.X_(t.mutations)}async function R0(n,e,t){const i=n.Pa.shift(),r=Xc.from(i,e,t);await iv(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),await fo(n)}async function P0(n,e){e&&$n(n).Z_&&await async function(i,r){if(function(o){return aS(o)&&o!==N.ABORTED}(r.code)){const s=i.Pa.shift();$n(i).N_(),await iv(i,()=>i.remoteSyncer.rejectFailedWrite(s.batchId,r)),await fo(i)}}(n,e),rv(n)&&sv(n)}async function _p(n,e){const t=re(n);t.asyncQueue.verifyOperationInProgress(),B(Si,"RemoteStore received new credentials");const i=Vi(t);t.Ia.add(3),await co(t),i&&t.Aa.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ia.delete(3),await _l(t)}async function x0(n,e){const t=re(n);e?(t.Ia.delete(2),await _l(t)):e||(t.Ia.add(2),await co(t),t.Aa.set("Unknown"))}function Lr(n){return n.Va||(n.Va=function(t,i,r){const s=re(t);return s.ia(),new h0(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{Zo:v0.bind(null,n),e_:T0.bind(null,n),n_:E0.bind(null,n),J_:I0.bind(null,n)}),n.da.push(async e=>{e?(n.Va.N_(),cd(n)?ud(n):n.Aa.set("Unknown")):(await n.Va.stop(),nv(n))})),n.Va}function $n(n){return n.ma||(n.ma=function(t,i,r){const s=re(t);return s.ia(),new p0(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),e_:A0.bind(null,n),n_:P0.bind(null,n),ea:S0.bind(null,n),ta:R0.bind(null,n)}),n.da.push(async e=>{e?(n.ma.N_(),await fo(n)):(await n.ma.stop(),n.Pa.length>0&&(B(Si,`Stopping write stream with ${n.Pa.length} pending writes`),n.Pa=[]))})),n.ma}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dd{constructor(e,t,i,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new rn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,r,s){const o=Date.now()+i,a=new dd(e,t,o,r,s);return a.start(i),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new H(N.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function fd(n,e){if(ut("AsyncQueue",`${e}: ${n}`),Kn(n))return new H(N.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ar{static emptySet(e){return new ar(e.comparator)}constructor(e){this.comparator=e?(t,i)=>e(t,i)||W.comparator(t.key,i.key):(t,i)=>W.comparator(t.key,i.key),this.keyedMap=ps(),this.sortedSet=new Re(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ar)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const i=new ar;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vp{constructor(){this.fa=new Re(W.comparator)}track(e){const t=e.doc.key,i=this.fa.get(t);i?e.type!==0&&i.type===3?this.fa=this.fa.insert(t,e):e.type===3&&i.type!==1?this.fa=this.fa.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.fa=this.fa.remove(t):e.type===1&&i.type===2?this.fa=this.fa.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):Y(63341,{At:e,ga:i}):this.fa=this.fa.insert(t,e)}pa(){const e=[];return this.fa.inorderTraversal((t,i)=>{e.push(i)}),e}}class Cr{constructor(e,t,i,r,s,o,a,c,d){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=d}static fromInitialDocuments(e,t,i,r,s){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Cr(e,t,ar.emptySet(t),o,i,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&cl(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==i[r].type||!t[r].doc.isEqual(i[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k0{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}}class b0{constructor(){this.queries=Tp(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(t,i){const r=re(t),s=r.queries;r.queries=Tp(),s.forEach((o,a)=>{for(const c of a.wa)c.onError(i)})})(this,new H(N.ABORTED,"Firestore shutting down"))}}function Tp(){return new fn(n=>s_(n),cl)}async function ov(n,e){const t=re(n);let i=3;const r=e.query;let s=t.queries.get(r);s?!s.Sa()&&e.ba()&&(i=2):(s=new k0,i=e.ba()?0:1);try{switch(i){case 0:s.ya=await t.onListen(r,!0);break;case 1:s.ya=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(o){const a=fd(o,`Initialization of query '${Xi(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,s),s.wa.push(e),e.va(t.onlineState),s.ya&&e.Ca(s.ya)&&hd(t)}async function av(n,e){const t=re(n),i=e.query;let r=3;const s=t.queries.get(i);if(s){const o=s.wa.indexOf(e);o>=0&&(s.wa.splice(o,1),s.wa.length===0?r=e.ba()?0:1:!s.Sa()&&e.ba()&&(r=2))}switch(r){case 0:return t.queries.delete(i),t.onUnlisten(i,!0);case 1:return t.queries.delete(i),t.onUnlisten(i,!1);case 2:return t.onLastRemoteStoreUnlisten(i);default:return}}function M0(n,e){const t=re(n);let i=!1;for(const r of e){const s=r.query,o=t.queries.get(s);if(o){for(const a of o.wa)a.Ca(r)&&(i=!0);o.ya=r}}i&&hd(t)}function D0(n,e,t){const i=re(n),r=i.queries.get(e);if(r)for(const s of r.wa)s.onError(t);i.queries.delete(e)}function hd(n){n.Da.forEach(e=>{e.next()})}var Qu,Ep;(Ep=Qu||(Qu={})).Fa="default",Ep.Cache="cache";class lv{constructor(e,t,i){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=i||{}}Ca(e){if(!this.options.includeMetadataChanges){const i=[];for(const r of e.docChanges)r.type!==3&&i.push(r);e=new Cr(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){if(!e.fromCache||!this.ba())return!0;const i=t!=="Offline";return(!this.options.ka||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Na(e){if(e.docChanges.length>0)return!0;const t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}La(e){e=Cr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==Qu.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uv{constructor(e){this.key=e}}class cv{constructor(e){this.key=e}}class N0{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=ae(),this.mutatedKeys=ae(),this.Xa=o_(e),this.eu=new ar(this.Xa)}get tu(){return this.Ha}nu(e,t){const i=t?t.ru:new vp,r=t?t.eu:this.eu;let s=t?t.mutatedKeys:this.mutatedKeys,o=r,a=!1;const c=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,d=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((h,p)=>{const g=r.get(h),_=ao(this.query,p)?p:null,C=!!g&&this.mutatedKeys.has(g.key),P=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let x=!1;g&&_?g.data.isEqual(_.data)?C!==P&&(i.track({type:3,doc:_}),x=!0):this.iu(g,_)||(i.track({type:2,doc:_}),x=!0,(c&&this.Xa(_,c)>0||d&&this.Xa(_,d)<0)&&(a=!0)):!g&&_?(i.track({type:0,doc:_}),x=!0):g&&!_&&(i.track({type:1,doc:g}),x=!0,(c||d)&&(a=!0)),x&&(_?(o=o.add(_),s=P?s.add(h):s.delete(h)):(o=o.delete(h),s=s.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),s=s.delete(h.key),i.track({type:1,doc:h})}return{eu:o,ru:i,Ds:a,mutatedKeys:s}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,r){const s=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;const o=e.ru.pa();o.sort((h,p)=>function(_,C){const P=x=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Y(20277,{At:x})}};return P(_)-P(C)}(h.type,p.type)||this.Xa(h.doc,p.doc)),this.su(i),r=r!=null&&r;const a=t&&!r?this.ou():[],c=this.Za.size===0&&this.current&&!r?1:0,d=c!==this.Ya;return this.Ya=c,o.length!==0||d?{snapshot:new Cr(this.query,e.eu,s,o,e.mutatedKeys,c===0,d,!1,!!i&&i.resumeToken.approximateByteSize()>0),_u:a}:{_u:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new vp,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=e.current)}ou(){if(!this.current)return[];const e=this.Za;this.Za=ae(),this.eu.forEach(i=>{this.au(i.key)&&(this.Za=this.Za.add(i.key))});const t=[];return e.forEach(i=>{this.Za.has(i)||t.push(new cv(i))}),this.Za.forEach(i=>{e.has(i)||t.push(new uv(i))}),t}uu(e){this.Ha=e.qs,this.Za=ae();const t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return Cr.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}}const pd="SyncEngine";class V0{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class L0{constructor(e){this.key=e,this.lu=!1}}class F0{constructor(e,t,i,r,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.hu={},this.Pu=new fn(a=>s_(a),cl),this.Tu=new Map,this.Iu=new Set,this.du=new Re(W.comparator),this.Eu=new Map,this.Au=new nd,this.Ru={},this.Vu=new Map,this.mu=Ai.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}}async function U0(n,e,t=!0){const i=gv(n);let r;const s=i.Pu.get(e);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.cu()):r=await dv(i,e,t,!0),r}async function O0(n,e){const t=gv(n);await dv(t,e,!0,!1)}async function dv(n,e,t,i){const r=await s0(n.localStore,At(e)),s=r.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t);let a;return i&&(a=await B0(n,e,s,o==="current",r.resumeToken)),n.isPrimaryClient&&t&&ev(n.remoteStore,r),a}async function B0(n,e,t,i,r){n.gu=(p,g,_)=>async function(P,x,F,L){let V=x.view.nu(F);V.Ds&&(V=await hp(P.localStore,x.query,!1).then(({documents:I})=>x.view.nu(I,V)));const O=L&&L.targetChanges.get(x.targetId),U=L&&L.targetMismatches.get(x.targetId)!=null,q=x.view.applyChanges(V,P.isPrimaryClient,O,U);return Cp(P,x.targetId,q._u),q.snapshot}(n,p,g,_);const s=await hp(n.localStore,e,!0),o=new N0(e,s.qs),a=o.nu(s.documents),c=uo.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",r),d=o.applyChanges(a,n.isPrimaryClient,c);Cp(n,t,d._u);const h=new V0(e,t,o);return n.Pu.set(e,h),n.Tu.has(t)?n.Tu.get(t).push(e):n.Tu.set(t,[e]),d.snapshot}async function q0(n,e,t){const i=re(n),r=i.Pu.get(e),s=i.Tu.get(r.targetId);if(s.length>1)return i.Tu.set(r.targetId,s.filter(o=>!cl(o,e))),void i.Pu.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(r.targetId),i.sharedClientState.isActiveQueryTarget(r.targetId)||await Yu(i.localStore,r.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(r.targetId),t&&ad(i.remoteStore,r.targetId),Zu(i,r.targetId)}).catch(Ni)):(Zu(i,r.targetId),await Yu(i.localStore,r.targetId,!0))}async function $0(n,e){const t=re(n),i=t.Pu.get(e),r=t.Tu.get(i.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(i.targetId),ad(t.remoteStore,i.targetId))}async function G0(n,e,t){const i=yv(n);try{const r=await function(o,a){const c=re(o),d=ue.now(),h=a.reduce((_,C)=>_.add(C.key),ae());let p,g;return c.persistence.runTransaction("Locally write mutations","readwrite",_=>{let C=_t(),P=ae();return c.Os.getEntries(_,h).next(x=>{C=x,C.forEach((F,L)=>{L.isValidDocument()||(P=P.add(F))})}).next(()=>c.localDocuments.getOverlayedDocuments(_,C)).next(x=>{p=x;const F=[];for(const L of a){const V=sS(L,p.get(L.key).overlayedDocument);V!=null&&F.push(new hn(L.key,V,Xy(V.value.mapValue),Be.exists(!0)))}return c.mutationQueue.addMutationBatch(_,d,F,a)}).next(x=>{g=x;const F=x.applyToLocalDocumentSet(p,P);return c.documentOverlayCache.saveOverlays(_,x.batchId,F)})}).then(()=>({batchId:g.batchId,changes:l_(p)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(r.batchId),function(o,a,c){let d=o.Ru[o.currentUser.toKey()];d||(d=new Re(te)),d=d.insert(a,c),o.Ru[o.currentUser.toKey()]=d}(i,r.batchId,t),await ho(i,r.changes),await fo(i.remoteStore)}catch(r){const s=fd(r,"Failed to persist write");t.reject(s)}}async function fv(n,e){const t=re(n);try{const i=await n0(t.localStore,e);e.targetChanges.forEach((r,s)=>{const o=t.Eu.get(s);o&&(Q(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?o.lu=!0:r.modifiedDocuments.size>0?Q(o.lu,14607):r.removedDocuments.size>0&&(Q(o.lu,42227),o.lu=!1))}),await ho(t,i,e)}catch(i){await Ni(i)}}function Ip(n,e,t){const i=re(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){const r=[];i.Pu.forEach((s,o)=>{const a=o.view.va(e);a.snapshot&&r.push(a.snapshot)}),function(o,a){const c=re(o);c.onlineState=a;let d=!1;c.queries.forEach((h,p)=>{for(const g of p.wa)g.va(a)&&(d=!0)}),d&&hd(c)}(i.eventManager,e),r.length&&i.hu.J_(r),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function H0(n,e,t){const i=re(n);i.sharedClientState.updateQueryState(e,"rejected",t);const r=i.Eu.get(e),s=r&&r.key;if(s){let o=new Re(W.comparator);o=o.insert(s,ke.newNoDocument(s,j.min()));const a=ae().add(s),c=new hl(j.min(),new Map,new Re(te),o,a);await fv(i,c),i.du=i.du.remove(s),i.Eu.delete(e),md(i)}else await Yu(i.localStore,e,!1).then(()=>Zu(i,e,t)).catch(Ni)}async function z0(n,e){const t=re(n),i=e.batch.batchId;try{const r=await t0(t.localStore,e);pv(t,i,null),hv(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),await ho(t,r)}catch(r){await Ni(r)}}async function W0(n,e,t){const i=re(n);try{const r=await function(o,a){const c=re(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let h;return c.mutationQueue.lookupMutationBatch(d,a).next(p=>(Q(p!==null,37113),h=p.keys(),c.mutationQueue.removeMutationBatch(d,p))).next(()=>c.mutationQueue.performConsistencyCheck(d)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(d,h,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,h)).next(()=>c.localDocuments.getDocuments(d,h))})}(i.localStore,e);pv(i,e,t),hv(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),await ho(i,r)}catch(r){await Ni(r)}}function hv(n,e){(n.Vu.get(e)||[]).forEach(t=>{t.resolve()}),n.Vu.delete(e)}function pv(n,e,t){const i=re(n);let r=i.Ru[i.currentUser.toKey()];if(r){const s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),i.Ru[i.currentUser.toKey()]=r}}function Zu(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const i of n.Tu.get(e))n.Pu.delete(i),t&&n.hu.pu(i,t);n.Tu.delete(e),n.isPrimaryClient&&n.Au.zr(e).forEach(i=>{n.Au.containsKey(i)||mv(n,i)})}function mv(n,e){n.Iu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(ad(n.remoteStore,t),n.du=n.du.remove(e),n.Eu.delete(t),md(n))}function Cp(n,e,t){for(const i of t)i instanceof uv?(n.Au.addReference(i.key,e),K0(n,i)):i instanceof cv?(B(pd,"Document no longer in limbo: "+i.key),n.Au.removeReference(i.key,e),n.Au.containsKey(i.key)||mv(n,i.key)):Y(19791,{yu:i})}function K0(n,e){const t=e.key,i=t.path.canonicalString();n.du.get(t)||n.Iu.has(i)||(B(pd,"New document in limbo: "+t),n.Iu.add(i),md(n))}function md(n){for(;n.Iu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Iu.values().next().value;n.Iu.delete(e);const t=new W(ye.fromString(e)),i=n.mu.next();n.Eu.set(i,new L0(t)),n.du=n.du.insert(t,i),ev(n.remoteStore,new tn(At(ul(t.path)),i,"TargetPurposeLimboResolution",wt.ue))}}async function ho(n,e,t){const i=re(n),r=[],s=[],o=[];i.Pu.isEmpty()||(i.Pu.forEach((a,c)=>{o.push(i.gu(c,e,t).then(d=>{var h;if((d||t)&&i.isPrimaryClient){const p=d?!d.fromCache:(h=t==null?void 0:t.targetChanges.get(c.targetId))===null||h===void 0?void 0:h.current;i.sharedClientState.updateQueryState(c.targetId,p?"current":"not-current")}if(d){r.push(d);const p=sd.Es(c.targetId,d);s.push(p)}}))}),await Promise.all(o),i.hu.J_(r),await async function(c,d){const h=re(c);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>b.forEach(d,g=>b.forEach(g.Is,_=>h.persistence.referenceDelegate.addReference(p,g.targetId,_)).next(()=>b.forEach(g.ds,_=>h.persistence.referenceDelegate.removeReference(p,g.targetId,_)))))}catch(p){if(!Kn(p))throw p;B(od,"Failed to update sequence numbers: "+p)}for(const p of d){const g=p.targetId;if(!p.fromCache){const _=h.Fs.get(g),C=_.snapshotVersion,P=_.withLastLimboFreeSnapshotVersion(C);h.Fs=h.Fs.insert(g,P)}}}(i.localStore,s))}async function J0(n,e){const t=re(n);if(!t.currentUser.isEqual(e)){B(pd,"User change. New user:",e.toKey());const i=await Y_(t.localStore,e);t.currentUser=e,function(s,o){s.Vu.forEach(a=>{a.forEach(c=>{c.reject(new H(N.CANCELLED,o))})}),s.Vu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await ho(t,i.Bs)}}function Y0(n,e){const t=re(n),i=t.Eu.get(e);if(i&&i.lu)return ae().add(i.key);{let r=ae();const s=t.Tu.get(e);if(!s)return r;for(const o of s){const a=t.Pu.get(o);r=r.unionWith(a.view.tu)}return r}}function gv(n){const e=re(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=fv.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Y0.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=H0.bind(null,e),e.hu.J_=M0.bind(null,e.eventManager),e.hu.pu=D0.bind(null,e.eventManager),e}function yv(n){const e=re(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=z0.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=W0.bind(null,e),e}class Ks{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=yl(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)}Cu(e,t){return null}Fu(e,t){return null}vu(e){return J_(this.persistence,new K_,e.initialUser,this.serializer)}Du(e){return new id(gl.Vi,this.serializer)}bu(e){return new Q_}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ks.provider={build:()=>new Ks};class X0 extends Ks{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){Q(this.persistence.referenceDelegate instanceof Va,46915);const i=this.persistence.referenceDelegate.garbageCollector;return new $_(i,e.asyncQueue,t)}Du(e){const t=this.cacheSizeBytes!==void 0?et.withCacheSize(this.cacheSizeBytes):et.DEFAULT;return new id(i=>Va.Vi(i,t),this.serializer)}}class Q0 extends Ks{constructor(e,t,i){super(),this.Mu=e,this.cacheSizeBytes=t,this.forceOwnership=i,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Mu.initialize(this,e),await yv(this.Mu.syncEngine),await fo(this.Mu.remoteStore),await this.persistence.ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return J_(this.persistence,new K_,e.initialUser,this.serializer)}Cu(e,t){const i=this.persistence.referenceDelegate.garbageCollector;return new $_(i,e.asyncQueue,t)}Fu(e,t){const i=new sA(t,this.persistence);return new rA(e.asyncQueue,i)}Du(e){const t=QS(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),i=this.cacheSizeBytes!==void 0?et.withCacheSize(this.cacheSizeBytes):et.DEFAULT;return new rd(this.synchronizeTabs,t,e.clientId,i,e.asyncQueue,f0(),ua(),this.serializer,this.sharedClientState,!!this.forceOwnership)}bu(e){return new Q_}}class Fa{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Ip(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=J0.bind(null,this.syncEngine),await x0(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new b0}()}createDatastore(e){const t=yl(e.databaseInfo.databaseId),i=function(s){return new d0(s)}(e.databaseInfo);return function(s,o,a,c){return new g0(s,o,a,c)}(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return function(i,r,s,o,a){return new _0(i,r,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>Ip(this.syncEngine,t,0),function(){return gp.C()?new gp:new a0}())}createSyncEngine(e,t){return function(r,s,o,a,c,d,h){const p=new F0(r,s,o,a,c,d);return h&&(p.fu=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(r){const s=re(r);B(Si,"RemoteStore shutting down."),s.Ia.add(5),await co(s),s.Ea.shutdown(),s.Aa.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}Fa.provider={build:()=>new Fa};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _v{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):ut("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gn="FirestoreClient";class Z0{constructor(e,t,i,r,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=r,this.user=We.UNAUTHENTICATED,this.clientId=Lc.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(i,async o=>{B(Gn,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(i,o=>(B(Gn,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new rn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=fd(t,"Failed to shutdown persistence");e.reject(i)}}),e.promise}}async function fu(n,e){n.asyncQueue.verifyOperationInProgress(),B(Gn,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(async r=>{i.isEqual(r)||(await Y_(e.localStore,r),i=r)}),e.persistence.setDatabaseDeletedListener(()=>{Wt("Terminating Firestore due to IndexedDb database deletion"),n.terminate().then(()=>{B("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(r=>{Wt("Terminating Firestore due to IndexedDb database deletion failed",r)})}),n._offlineComponents=e}async function wp(n,e){n.asyncQueue.verifyOperationInProgress();const t=await j0(n);B(Gn,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(i=>_p(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,r)=>_p(e.remoteStore,r)),n._onlineComponents=e}async function j0(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){B(Gn,"Using user provided OfflineComponentProvider");try{await fu(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(r){return r.name==="FirebaseError"?r.code===N.FAILED_PRECONDITION||r.code===N.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(t))throw t;Wt("Error using user provided cache. Falling back to memory cache: "+t),await fu(n,new Ks)}}else B(Gn,"Using default OfflineComponentProvider"),await fu(n,new X0(void 0));return n._offlineComponents}async function vv(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(B(Gn,"Using user provided OnlineComponentProvider"),await wp(n,n._uninitializedComponentsProvider._online)):(B(Gn,"Using default OnlineComponentProvider"),await wp(n,new Fa))),n._onlineComponents}function eR(n){return vv(n).then(e=>e.syncEngine)}async function ju(n){const e=await vv(n),t=e.eventManager;return t.onListen=U0.bind(null,e.syncEngine),t.onUnlisten=q0.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=O0.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=$0.bind(null,e.syncEngine),t}function tR(n,e,t={}){const i=new rn;return n.asyncQueue.enqueueAndForget(async()=>function(s,o,a,c,d){const h=new _v({next:g=>{h.Ou(),o.enqueueAndForget(()=>av(s,p)),g.fromCache&&c.source==="server"?d.reject(new H(N.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(g)},error:g=>d.reject(g)}),p=new lv(a,h,{includeMetadataChanges:!0,ka:!0});return ov(s,p)}(await ju(n),n.asyncQueue,e,t,i)),i.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tv(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ap=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ev="firestore.googleapis.com",Sp=!0;class Rp{constructor(e){var t,i;if(e.host===void 0){if(e.ssl!==void 0)throw new H(N.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Ev,this.ssl=Sp}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:Sp;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=U_;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<NS)throw new H(N.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}eA("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Tv((i=e.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new H(N.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new H(N.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new H(N.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(i,r){return i.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class vl{constructor(e,t,i,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Rp({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new H(N.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new H(N.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Rp(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new zw;switch(i.type){case"firstParty":return new Yw(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new H(N.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const i=Ap.get(t);i&&(B("ComponentProvider","Removing Datastore"),Ap.delete(t),i.terminate())}(this),Promise.resolve()}}function nR(n,e,t,i={}){var r;n=pt(n,vl);const s=br(e),o=n._getSettings(),a=Object.assign(Object.assign({},o),{emulatorOptions:n._getEmulatorOptions()}),c=`${e}:${t}`;s&&(Cg(`https://${c}`),wg("Firestore",!0)),o.host!==Ev&&o.host!==c&&Wt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const d=Object.assign(Object.assign({},o),{host:c,ssl:s,emulatorOptions:i});if(!On(d,a)&&(n._setSettings(d),i.mockUserToken)){let h,p;if(typeof i.mockUserToken=="string")h=i.mockUserToken,p=We.MOCK_USER;else{h=oE(i.mockUserToken,(r=n._app)===null||r===void 0?void 0:r.options.projectId);const g=i.mockUserToken.sub||i.mockUserToken.user_id;if(!g)throw new H(N.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new We(g)}n._authCredentials=new Ww(new Iy(h,p))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Li{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new Li(this.firestore,e,this._query)}}class Me{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Fn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Me(this.firestore,e,this._key)}toJSON(){return{type:Me._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,i){if(io(t,Me._jsonSchema))return new Me(e,i||null,new W(ye.fromString(t.referencePath)))}}Me._jsonSchemaVersion="firestore/documentReference/1.0",Me._jsonSchema={type:Ue("string",Me._jsonSchemaVersion),referencePath:Ue("string")};class Fn extends Li{constructor(e,t,i){super(e,t,ul(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Me(this.firestore,null,new W(e))}withConverter(e){return new Fn(this.firestore,e,this._path)}}function ct(n,e,...t){if(n=Ve(n),Ay("collection","path",e),n instanceof vl){const i=ye.fromString(e,...t);return yh(i),new Fn(n,null,i)}{if(!(n instanceof Me||n instanceof Fn))throw new H(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(ye.fromString(e,...t));return yh(i),new Fn(n.firestore,null,i)}}function he(n,e,...t){if(n=Ve(n),arguments.length===1&&(e=Lc.newId()),Ay("doc","path",e),n instanceof vl){const i=ye.fromString(e,...t);return gh(i),new Me(n,null,new W(i))}{if(!(n instanceof Me||n instanceof Fn))throw new H(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(ye.fromString(e,...t));return gh(i),new Me(n.firestore,n instanceof Fn?n.converter:null,new W(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pp="AsyncQueue";class xp{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new Z_(this,"async_queue_retry"),this.oc=()=>{const i=ua();i&&B(Pp,"Visibility state changed to "+i.visibilityState),this.F_.y_()},this._c=e;const t=ua();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;const t=ua();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});const t=new rn;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}async cc(){if(this.Zu.length!==0){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!Kn(e))throw e;B(Pp,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}}uc(e){const t=this._c.then(()=>(this.nc=!0,e().catch(i=>{throw this.tc=i,this.nc=!1,ut("INTERNAL UNHANDLED ERROR: ",kp(i)),i}).then(i=>(this.nc=!1,i))));return this._c=t,t}enqueueAfterDelay(e,t,i){this.ac(),this.sc.indexOf(e)>-1&&(t=0);const r=dd.createAndSchedule(this,e,t,i,s=>this.lc(s));return this.ec.push(r),r}ac(){this.tc&&Y(47125,{hc:kp(this.tc)})}verifyOperationInProgress(){}async Pc(){let e;do e=this._c,await e;while(e!==this._c)}Tc(e){for(const t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{this.ec.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(const t of this.ec)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){const t=this.ec.indexOf(e);this.ec.splice(t,1)}}function kp(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bp(n){return function(t,i){if(typeof t!="object"||t===null)return!1;const r=t;for(const s of i)if(s in r&&typeof r[s]=="function")return!0;return!1}(n,["next","error","complete"])}class Jt extends vl{constructor(e,t,i,r){super(e,t,i,r),this.type="firestore",this._queue=new xp,this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new xp(e),this._firestoreClient=void 0,await e}}}function iR(n,e){const t=typeof n=="object"?n:Mg(),i=typeof n=="string"?n:Sa,r=Ac(t,"firestore").getImmediate({identifier:i});if(!r._initialized){const s=rE("firestore");s&&nR(r,...s)}return r}function Tl(n){if(n._terminated)throw new H(N.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Iv(n),n._firestoreClient}function Iv(n){var e,t,i;const r=n._freezeSettings(),s=function(a,c,d,h){return new NA(a,c,d,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,Tv(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,r);n._componentsProvider||!((t=r.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((i=r.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider}),n._firestoreClient=new Z0(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&function(a){const c=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(c),_online:c}}(n._componentsProvider))}function rR(n,e){Wt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return sR(n,Fa.provider,{build:i=>new Q0(i,t.cacheSizeBytes,void 0)}),Promise.resolve()}function sR(n,e,t){if((n=pt(n,Jt))._firestoreClient||n._terminated)throw new H(N.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new H(N.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},Iv(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class It{constructor(e){this._byteString=e}static fromBase64String(e){try{return new It(Oe.fromBase64String(e))}catch(t){throw new H(N.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new It(Oe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:It._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(io(e,It._jsonSchema))return It.fromBase64String(e.bytes)}}It._jsonSchemaVersion="firestore/bytes/1.0",It._jsonSchema={type:Ue("string",It._jsonSchemaVersion),bytes:Ue("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class po{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new H(N.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Pe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mo{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new H(N.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new H(N.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return te(this._lat,e._lat)||te(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:qt._jsonSchemaVersion}}static fromJSON(e){if(io(e,qt._jsonSchema))return new qt(e.latitude,e.longitude)}}qt._jsonSchemaVersion="firestore/geoPoint/1.0",qt._jsonSchema={type:Ue("string",qt._jsonSchemaVersion),latitude:Ue("number"),longitude:Ue("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $t{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(i,r){if(i.length!==r.length)return!1;for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:$t._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(io(e,$t._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new $t(e.vectorValues);throw new H(N.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}$t._jsonSchemaVersion="firestore/vectorValue/1.0",$t._jsonSchema={type:Ue("string",$t._jsonSchemaVersion),vectorValues:Ue("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oR=/^__.*__$/;class aR{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new hn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Vr(e,this.data,t,this.fieldTransforms)}}class Cv{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new hn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function wv(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Y(40011,{Ec:n})}}class El{constructor(e,t,i,r,s,o){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=r,s===void 0&&this.Ac(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new El(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.Rc({path:i,mc:!1});return r.fc(e),r}gc(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.Rc({path:i,mc:!1});return r.Ac(),r}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return Ua(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(e.length===0)throw this.wc("Document fields must not be empty");if(wv(this.Ec)&&oR.test(e))throw this.wc('Document fields cannot begin and end with "__"')}}class lR{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||yl(e)}Dc(e,t,i,r=!1){return new El({Ec:e,methodName:t,bc:i,path:Pe.emptyPath(),mc:!1,Sc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function go(n){const e=n._freezeSettings(),t=yl(n._databaseId);return new lR(n._databaseId,!!e.ignoreUndefinedProperties,t)}function gd(n,e,t,i,r,s={}){const o=n.Dc(s.merge||s.mergeFields?2:0,e,t,r);vd("Data must be an object, but it was:",o,i);const a=Rv(i,o);let c,d;if(s.merge)c=new ht(o.fieldMask),d=o.fieldTransforms;else if(s.mergeFields){const h=[];for(const p of s.mergeFields){const g=ec(e,p,t);if(!o.contains(g))throw new H(N.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);xv(h,g)||h.push(g)}c=new ht(h),d=o.fieldTransforms.filter(p=>c.covers(p.field))}else c=null,d=o.fieldTransforms;return new aR(new tt(a),c,d)}class Il extends mo{_toFieldTransform(e){if(e.Ec!==2)throw e.Ec===1?e.wc(`${this._methodName}() can only appear at the top level of your update data`):e.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Il}}function uR(n,e,t){return new El({Ec:3,bc:e.settings.bc,methodName:n._methodName,mc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class yd extends mo{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=uR(this,e,!0),i=this.vc.map(s=>Fr(s,t)),r=new Ii(i);return new Jc(e.path,r)}isEqual(e){return e instanceof yd&&On(this.vc,e.vc)}}class _d extends mo{constructor(e,t){super(e),this.Cc=t}_toFieldTransform(e){const t=new Er(e.serializer,d_(e.serializer,this.Cc));return new Jc(e.path,t)}isEqual(e){return e instanceof _d&&this.Cc===e.Cc}}function Av(n,e,t,i){const r=n.Dc(1,e,t);vd("Data must be an object, but it was:",r,i);const s=[],o=tt.empty();Jn(i,(c,d)=>{const h=Td(e,c,t);d=Ve(d);const p=r.gc(h);if(d instanceof Il)s.push(h);else{const g=Fr(d,p);g!=null&&(s.push(h),o.set(h,g))}});const a=new ht(s);return new Cv(o,a,r.fieldTransforms)}function Sv(n,e,t,i,r,s){const o=n.Dc(1,e,t),a=[ec(e,i,t)],c=[r];if(s.length%2!=0)throw new H(N.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<s.length;g+=2)a.push(ec(e,s[g])),c.push(s[g+1]);const d=[],h=tt.empty();for(let g=a.length-1;g>=0;--g)if(!xv(d,a[g])){const _=a[g];let C=c[g];C=Ve(C);const P=o.gc(_);if(C instanceof Il)d.push(_);else{const x=Fr(C,P);x!=null&&(d.push(_),h.set(_,x))}}const p=new ht(d);return new Cv(h,p,o.fieldTransforms)}function cR(n,e,t,i=!1){return Fr(t,n.Dc(i?4:3,e))}function Fr(n,e){if(Pv(n=Ve(n)))return vd("Unsupported field value:",e,n),Rv(n,e);if(n instanceof mo)return function(i,r){if(!wv(r.Ec))throw r.wc(`${i._methodName}() can only be used with update() and set()`);if(!r.path)throw r.wc(`${i._methodName}() is not currently supported inside arrays`);const s=i._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.mc&&e.Ec!==4)throw e.wc("Nested arrays are not supported");return function(i,r){const s=[];let o=0;for(const a of i){let c=Fr(a,r.yc(o));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(n,e)}return function(i,r){if((i=Ve(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return d_(r.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const s=ue.fromDate(i);return{timestampValue:Ir(r.serializer,s)}}if(i instanceof ue){const s=new ue(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:Ir(r.serializer,s)}}if(i instanceof qt)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof It)return{bytesValue:I_(r.serializer,i._byteString)};if(i instanceof Me){const s=r.databaseId,o=i.firestore._databaseId;if(!o.isEqual(s))throw r.wc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:jc(i.firestore._databaseId||r.databaseId,i._key.path)}}if(i instanceof $t)return function(o,a){return{mapValue:{fields:{[Hc]:{stringValue:zc},[gr]:{arrayValue:{values:o.toArray().map(d=>{if(typeof d!="number")throw a.wc("VectorValues must only contain numeric values.");return Kc(a.serializer,d)})}}}}}}(i,r);throw r.wc(`Unsupported field value: ${tl(i)}`)}(n,e)}function Rv(n,e){const t={};return qy(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Jn(n,(i,r)=>{const s=Fr(r,e.Vc(i));s!=null&&(t[i]=s)}),{mapValue:{fields:t}}}function Pv(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ue||n instanceof qt||n instanceof It||n instanceof Me||n instanceof mo||n instanceof $t)}function vd(n,e,t){if(!Pv(t)||!Sy(t)){const i=tl(t);throw i==="an object"?e.wc(n+" a custom object"):e.wc(n+" "+i)}}function ec(n,e,t){if((e=Ve(e))instanceof po)return e._internalPath;if(typeof e=="string")return Td(n,e);throw Ua("Field path arguments must be of type string or ",n,!1,void 0,t)}const dR=new RegExp("[~\\*/\\[\\]]");function Td(n,e,t){if(e.search(dR)>=0)throw Ua(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new po(...e.split("."))._internalPath}catch{throw Ua(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Ua(n,e,t,i,r){const s=i&&!i.isEmpty(),o=r!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${i}`),o&&(c+=` in document ${r}`),c+=")"),new H(N.INVALID_ARGUMENT,a+n+c)}function xv(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kv{constructor(e,t,i,r,s){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Me(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new fR(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ed("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class fR extends kv{data(){return super.data()}}function Ed(n,e){return typeof e=="string"?Td(n,e):e instanceof po?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bv(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new H(N.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Id{}class hR extends Id{}function Je(n,e,...t){let i=[];e instanceof Id&&i.push(e),i=i.concat(t),function(s){const o=s.filter(c=>c instanceof Cd).length,a=s.filter(c=>c instanceof Cl).length;if(o>1||o>0&&a>0)throw new H(N.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(const r of i)n=r._apply(n);return n}class Cl extends hR{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new Cl(e,t,i)}_apply(e){const t=this._parse(e);return Mv(e._query,t),new Li(e.firestore,e.converter,Bu(e._query,t))}_parse(e){const t=go(e.firestore);return function(s,o,a,c,d,h,p){let g;if(d.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new H(N.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){Dp(p,h);const C=[];for(const P of p)C.push(Mp(c,s,P));g={arrayValue:{values:C}}}else g=Mp(c,s,p)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||Dp(p,h),g=cR(a,o,p,h==="in"||h==="not-in");return ce.create(d,h,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function lt(n,e,t){const i=e,r=Ed("where",n);return Cl._create(r,i,t)}class Cd extends Id{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Cd(e,t)}_parse(e){const t=this._queryConstraints.map(i=>i._parse(e)).filter(i=>i.getFilters().length>0);return t.length===1?t[0]:_e.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(r,s){let o=r;const a=s.getFlattenedFilters();for(const c of a)Mv(o,c),o=Bu(o,c)}(e._query,t),new Li(e.firestore,e.converter,Bu(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function Mp(n,e,t){if(typeof(t=Ve(t))=="string"){if(t==="")throw new H(N.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!r_(e)&&t.indexOf("/")!==-1)throw new H(N.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const i=e.path.child(ye.fromString(t));if(!W.isDocumentKey(i))throw new H(N.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return Hs(n,new W(i))}if(t instanceof Me)return Hs(n,t._key);throw new H(N.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${tl(t)}.`)}function Dp(n,e){if(!Array.isArray(n)||n.length===0)throw new H(N.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Mv(n,e){const t=function(r,s){for(const o of r)for(const a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new H(N.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new H(N.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class pR{convertValue(e,t="none"){switch(Bn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ae(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(un(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Y(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const i={};return Jn(e,(r,s)=>{i[r]=this.convertValue(s,t)}),i}convertVectorValue(e){var t,i,r;const s=(r=(i=(t=e.fields)===null||t===void 0?void 0:t[gr].arrayValue)===null||i===void 0?void 0:i.values)===null||r===void 0?void 0:r.map(o=>Ae(o.doubleValue));return new $t(s)}convertGeoPoint(e){return new qt(Ae(e.latitude),Ae(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":const i=al(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp($s(e));default:return null}}convertTimestamp(e){const t=ln(e);return new ue(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=ye.fromString(e);Q(M_(i),9688,{name:e});const r=new Ti(i.get(1),i.get(3)),s=new W(i.popFirst(5));return r.isEqual(t)||ut(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wd(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}class ys{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class hi extends kv{constructor(e,t,i,r,s,o){super(e,t,i,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ca(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(Ed("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new H(N.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=hi._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}hi._jsonSchemaVersion="firestore/documentSnapshot/1.0",hi._jsonSchema={type:Ue("string",hi._jsonSchemaVersion),bundleSource:Ue("string","DocumentSnapshot"),bundleName:Ue("string"),bundle:Ue("string")};class ca extends hi{data(e={}){return super.data(e)}}class pi{constructor(e,t,i,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new ys(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new ca(this._firestore,this._userDataWriter,i.key,i,new ys(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new H(N.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(a=>{const c=new ca(r._firestore,r._userDataWriter,a.doc.key,a.doc,new ys(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{const c=new ca(r._firestore,r._userDataWriter,a.doc.key,a.doc,new ys(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);let d=-1,h=-1;return a.type!==0&&(d=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:mR(a.type),doc:c,oldIndex:d,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new H(N.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=pi._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Lc.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],i=[],r=[];return this.docs.forEach(s=>{s._document!==null&&(t.push(s._document),i.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),r.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function mR(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Y(61501,{type:n})}}pi._jsonSchemaVersion="firestore/querySnapshot/1.0",pi._jsonSchema={type:Ue("string",pi._jsonSchemaVersion),bundleSource:Ue("string","QuerySnapshot"),bundleName:Ue("string"),bundle:Ue("string")};class Ad extends pR{constructor(e){super(),this.firestore=e}convertBytes(e){return new It(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Me(this.firestore,null,t)}}function Mt(n){n=pt(n,Li);const e=pt(n.firestore,Jt),t=Tl(e),i=new Ad(e);return bv(n._query),tR(t,n._query).then(r=>new pi(e,i,n,r))}function gR(n,e,t){n=pt(n,Me);const i=pt(n.firestore,Jt),r=wd(n.converter,e,t);return _o(i,[gd(go(i),"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,Be.none())])}function Se(n,e,t,...i){n=pt(n,Me);const r=pt(n.firestore,Jt),s=go(r);let o;return o=typeof(e=Ve(e))=="string"||e instanceof po?Sv(s,"updateDoc",n._key,e,t,i):Av(s,"updateDoc",n._key,e),_o(r,[o.toMutation(n._key,Be.exists(!0))])}function Ur(n){return _o(pt(n.firestore,Jt),[new lo(n._key,Be.none())])}function yo(n,e){const t=pt(n.firestore,Jt),i=he(n),r=wd(n.converter,e);return _o(t,[gd(go(n.firestore),"addDoc",i._key,r,n.converter!==null,{}).toMutation(i._key,Be.exists(!1))]).then(()=>i)}function Ri(n,...e){var t,i,r;n=Ve(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||bp(e[o])||(s=e[o++]);const a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(bp(e[o])){const p=e[o];e[o]=(t=p.next)===null||t===void 0?void 0:t.bind(p),e[o+1]=(i=p.error)===null||i===void 0?void 0:i.bind(p),e[o+2]=(r=p.complete)===null||r===void 0?void 0:r.bind(p)}let c,d,h;if(n instanceof Me)d=pt(n.firestore,Jt),h=ul(n._key.path),c={next:p=>{e[o]&&e[o](yR(d,n,p))},error:e[o+1],complete:e[o+2]};else{const p=pt(n,Li);d=pt(p.firestore,Jt),h=p._query;const g=new Ad(d);c={next:_=>{e[o]&&e[o](new pi(d,g,p,_))},error:e[o+1],complete:e[o+2]},bv(n._query)}return function(g,_,C,P){const x=new _v(P),F=new lv(_,x,C);return g.asyncQueue.enqueueAndForget(async()=>ov(await ju(g),F)),()=>{x.Ou(),g.asyncQueue.enqueueAndForget(async()=>av(await ju(g),F))}}(Tl(d),h,a,c)}function _o(n,e){return function(i,r){const s=new rn;return i.asyncQueue.enqueueAndForget(async()=>G0(await eR(i),r,s)),s.promise}(Tl(n),e)}function yR(n,e,t){const i=t.docs.get(e._key),r=new Ad(n);return new hi(n,r,e._key,i,new ys(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _R{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=go(e)}set(e,t,i){this._verifyNotCommitted();const r=hu(e,this._firestore),s=wd(r.converter,t,i),o=gd(this._dataReader,"WriteBatch.set",r._key,s,r.converter!==null,i);return this._mutations.push(o.toMutation(r._key,Be.none())),this}update(e,t,i,...r){this._verifyNotCommitted();const s=hu(e,this._firestore);let o;return o=typeof(t=Ve(t))=="string"||t instanceof po?Sv(this._dataReader,"WriteBatch.update",s._key,t,i,r):Av(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Be.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=hu(e,this._firestore);return this._mutations=this._mutations.concat(new lo(t._key,Be.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new H(N.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function hu(n,e){if((n=Ve(n)).firestore!==e)throw new H(N.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}function Np(...n){return new yd("arrayUnion",n)}function ui(n){return new _d("increment",n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vp(n){return Tl(n=pt(n,Jt)),new _R(n,e=>_o(n,e))}(function(e,t=!0){(function(r){Nr=r})(Mr),cr(new gi("firestore",(i,{instanceIdentifier:r,options:s})=>{const o=i.getProvider("app").getImmediate(),a=new Jt(new Kw(i.getProvider("auth-internal")),new Xw(o,i.getProvider("app-check-internal")),function(d,h){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new H(N.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ti(d.options.projectId,h)}(o,r),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Nn(dh,fh,e),Nn(dh,fh,"esm2017")})();var vR="firebase",TR="11.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Nn(vR,TR,"app");/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ER={apiKey:"AIzaSyA-9arO3bMG1IK9PoJP93LEiMCAPwyT6pg",authDomain:"agenda-9bc62.firebaseapp.com",projectId:"agenda-9bc62",storageBucket:"agenda-9bc62.appspot.com",messagingSenderId:"340413052561",appId:"1:340413052561:web:69c04c0a640050f3f7f130",measurementId:"G-X0VPQGJVGG"},Gt="default-task-manager",Dv=bg(ER),wl=Gw(Dv),He=iR(Dv),IR=async n=>{try{await rR(He)}catch(e){e.code=="failed-precondition"?(console.warn("Firestore persistence failed: multiple tabs open."),n("Os dados não serão salvos offline. Mantenha apenas uma aba do app aberta.",5e3)):e.code=="unimplemented"&&(console.error("Firestore persistence not supported in this browser."),n("Seu navegador não suporta modo offline.",5e3))}};var ge;(function(n){n.assertEqual=r=>{};function e(r){}n.assertIs=e;function t(r){throw new Error}n.assertNever=t,n.arrayToEnum=r=>{const s={};for(const o of r)s[o]=o;return s},n.getValidEnumValues=r=>{const s=n.objectKeys(r).filter(a=>typeof r[r[a]]!="number"),o={};for(const a of s)o[a]=r[a];return n.objectValues(o)},n.objectValues=r=>n.objectKeys(r).map(function(s){return r[s]}),n.objectKeys=typeof Object.keys=="function"?r=>Object.keys(r):r=>{const s=[];for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&s.push(o);return s},n.find=(r,s)=>{for(const o of r)if(s(o))return o},n.isInteger=typeof Number.isInteger=="function"?r=>Number.isInteger(r):r=>typeof r=="number"&&Number.isFinite(r)&&Math.floor(r)===r;function i(r,s=" | "){return r.map(o=>typeof o=="string"?`'${o}'`:o).join(s)}n.joinValues=i,n.jsonStringifyReplacer=(r,s)=>typeof s=="bigint"?s.toString():s})(ge||(ge={}));var Lp;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(Lp||(Lp={}));const J=ge.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),An=n=>{switch(typeof n){case"undefined":return J.undefined;case"string":return J.string;case"number":return Number.isNaN(n)?J.nan:J.number;case"boolean":return J.boolean;case"function":return J.function;case"bigint":return J.bigint;case"symbol":return J.symbol;case"object":return Array.isArray(n)?J.array:n===null?J.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?J.promise:typeof Map<"u"&&n instanceof Map?J.map:typeof Set<"u"&&n instanceof Set?J.set:typeof Date<"u"&&n instanceof Date?J.date:J.object;default:return J.unknown}},G=ge.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class cn extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=i=>{this.issues=[...this.issues,i]},this.addIssues=(i=[])=>{this.issues=[...this.issues,...i]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(s){return s.message},i={_errors:[]},r=s=>{for(const o of s.issues)if(o.code==="invalid_union")o.unionErrors.map(r);else if(o.code==="invalid_return_type")r(o.returnTypeError);else if(o.code==="invalid_arguments")r(o.argumentsError);else if(o.path.length===0)i._errors.push(t(o));else{let a=i,c=0;for(;c<o.path.length;){const d=o.path[c];c===o.path.length-1?(a[d]=a[d]||{_errors:[]},a[d]._errors.push(t(o))):a[d]=a[d]||{_errors:[]},a=a[d],c++}}};return r(this),i}static assert(e){if(!(e instanceof cn))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ge.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},i=[];for(const r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):i.push(e(r));return{formErrors:i,fieldErrors:t}}get formErrors(){return this.flatten()}}cn.create=n=>new cn(n);const tc=(n,e)=>{let t;switch(n.code){case G.invalid_type:n.received===J.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case G.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,ge.jsonStringifyReplacer)}`;break;case G.unrecognized_keys:t=`Unrecognized key(s) in object: ${ge.joinValues(n.keys,", ")}`;break;case G.invalid_union:t="Invalid input";break;case G.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${ge.joinValues(n.options)}`;break;case G.invalid_enum_value:t=`Invalid enum value. Expected ${ge.joinValues(n.options)}, received '${n.received}'`;break;case G.invalid_arguments:t="Invalid function arguments";break;case G.invalid_return_type:t="Invalid function return type";break;case G.invalid_date:t="Invalid date";break;case G.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:ge.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case G.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case G.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case G.custom:t="Invalid input";break;case G.invalid_intersection_types:t="Intersection results could not be merged";break;case G.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case G.not_finite:t="Number must be finite";break;default:t=e.defaultError,ge.assertNever(n)}return{message:t}};let CR=tc;function wR(){return CR}const AR=n=>{const{data:e,path:t,errorMaps:i,issueData:r}=n,s=[...t,...r.path||[]],o={...r,path:s};if(r.message!==void 0)return{...r,path:s,message:r.message};let a="";const c=i.filter(d=>!!d).slice().reverse();for(const d of c)a=d(o,{data:e,defaultError:a}).message;return{...r,path:s,message:a}};function K(n,e){const t=wR(),i=AR({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===tc?void 0:tc].filter(r=>!!r)});n.common.issues.push(i)}class ft{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const i=[];for(const r of t){if(r.status==="aborted")return ie;r.status==="dirty"&&e.dirty(),i.push(r.value)}return{status:e.value,value:i}}static async mergeObjectAsync(e,t){const i=[];for(const r of t){const s=await r.key,o=await r.value;i.push({key:s,value:o})}return ft.mergeObjectSync(e,i)}static mergeObjectSync(e,t){const i={};for(const r of t){const{key:s,value:o}=r;if(s.status==="aborted"||o.status==="aborted")return ie;s.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof o.value<"u"||r.alwaysSet)&&(i[s.value]=o.value)}return{status:e.value,value:i}}}const ie=Object.freeze({status:"aborted"}),_s=n=>({status:"dirty",value:n}),Rt=n=>({status:"valid",value:n}),Fp=n=>n.status==="aborted",Up=n=>n.status==="dirty",wr=n=>n.status==="valid",Oa=n=>typeof Promise<"u"&&n instanceof Promise;var X;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(X||(X={}));class Yt{constructor(e,t,i,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=i,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Op=(n,e)=>{if(wr(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new cn(n.common.issues);return this._error=t,this._error}}};function oe(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:i,description:r}=n;if(e&&(t||i))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:r}:{errorMap:(o,a)=>{const{message:c}=n;return o.code==="invalid_enum_value"?{message:c??a.defaultError}:typeof a.data>"u"?{message:c??i??a.defaultError}:o.code!=="invalid_type"?{message:a.defaultError}:{message:c??t??a.defaultError}},description:r}}class de{get description(){return this._def.description}_getType(e){return An(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:An(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ft,ctx:{common:e.parent.common,data:e.data,parsedType:An(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Oa(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const i=this.safeParse(e,t);if(i.success)return i.data;throw i.error}safeParse(e,t){const i={common:{issues:[],async:(t==null?void 0:t.async)??!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:An(e)},r=this._parseSync({data:e,path:i.path,parent:i});return Op(i,r)}"~validate"(e){var i,r;const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:An(e)};if(!this["~standard"].async)try{const s=this._parseSync({data:e,path:[],parent:t});return wr(s)?{value:s.value}:{issues:t.common.issues}}catch(s){(r=(i=s==null?void 0:s.message)==null?void 0:i.toLowerCase())!=null&&r.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(s=>wr(s)?{value:s.value}:{issues:t.common.issues})}async parseAsync(e,t){const i=await this.safeParseAsync(e,t);if(i.success)return i.data;throw i.error}async safeParseAsync(e,t){const i={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:An(e)},r=this._parse({data:e,path:i.path,parent:i}),s=await(Oa(r)?r:Promise.resolve(r));return Op(i,s)}refine(e,t){const i=r=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(r):t;return this._refinement((r,s)=>{const o=e(r),a=()=>s.addIssue({code:G.custom,...i(r)});return typeof Promise<"u"&&o instanceof Promise?o.then(c=>c?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(e,t){return this._refinement((i,r)=>e(i)?!0:(r.addIssue(typeof t=="function"?t(i,r):t),!1))}_refinement(e){return new Rr({schema:this,typeName:ne.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return Un.create(this,this._def)}nullable(){return Pr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ht.create(this)}promise(){return Ha.create(this,this._def)}or(e){return qa.create([this,e],this._def)}and(e){return $a.create(this,e,this._def)}transform(e){return new Rr({...oe(this._def),schema:this,typeName:ne.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new sc({...oe(this._def),innerType:this,defaultValue:t,typeName:ne.ZodDefault})}brand(){return new JR({typeName:ne.ZodBranded,type:this,...oe(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new oc({...oe(this._def),innerType:this,catchValue:t,typeName:ne.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Sd.create(this,e)}readonly(){return ac.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const SR=/^c[^\s-]{8,}$/i,RR=/^[0-9a-z]+$/,PR=/^[0-9A-HJKMNP-TV-Z]{26}$/i,xR=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,kR=/^[a-z0-9_-]{21}$/i,bR=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,MR=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,DR=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,NR="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let pu;const VR=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,LR=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,FR=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,UR=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,OR=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,BR=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Nv="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",qR=new RegExp(`^${Nv}$`);function Vv(n){let e="[0-5]\\d";n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`);const t=n.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function $R(n){return new RegExp(`^${Vv(n)}$`)}function GR(n){let e=`${Nv}T${Vv(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function HR(n,e){return!!((e==="v4"||!e)&&VR.test(n)||(e==="v6"||!e)&&FR.test(n))}function zR(n,e){if(!bR.test(n))return!1;try{const[t]=n.split("."),i=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),r=JSON.parse(atob(i));return!(typeof r!="object"||r===null||"typ"in r&&(r==null?void 0:r.typ)!=="JWT"||!r.alg||e&&r.alg!==e)}catch{return!1}}function WR(n,e){return!!((e==="v4"||!e)&&LR.test(n)||(e==="v6"||!e)&&UR.test(n))}class Ft extends de{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==J.string){const s=this._getOrReturnCtx(e);return K(s,{code:G.invalid_type,expected:J.string,received:s.parsedType}),ie}const i=new ft;let r;for(const s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(r=this._getOrReturnCtx(e,r),K(r,{code:G.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),i.dirty());else if(s.kind==="max")e.data.length>s.value&&(r=this._getOrReturnCtx(e,r),K(r,{code:G.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),i.dirty());else if(s.kind==="length"){const o=e.data.length>s.value,a=e.data.length<s.value;(o||a)&&(r=this._getOrReturnCtx(e,r),o?K(r,{code:G.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):a&&K(r,{code:G.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),i.dirty())}else if(s.kind==="email")DR.test(e.data)||(r=this._getOrReturnCtx(e,r),K(r,{validation:"email",code:G.invalid_string,message:s.message}),i.dirty());else if(s.kind==="emoji")pu||(pu=new RegExp(NR,"u")),pu.test(e.data)||(r=this._getOrReturnCtx(e,r),K(r,{validation:"emoji",code:G.invalid_string,message:s.message}),i.dirty());else if(s.kind==="uuid")xR.test(e.data)||(r=this._getOrReturnCtx(e,r),K(r,{validation:"uuid",code:G.invalid_string,message:s.message}),i.dirty());else if(s.kind==="nanoid")kR.test(e.data)||(r=this._getOrReturnCtx(e,r),K(r,{validation:"nanoid",code:G.invalid_string,message:s.message}),i.dirty());else if(s.kind==="cuid")SR.test(e.data)||(r=this._getOrReturnCtx(e,r),K(r,{validation:"cuid",code:G.invalid_string,message:s.message}),i.dirty());else if(s.kind==="cuid2")RR.test(e.data)||(r=this._getOrReturnCtx(e,r),K(r,{validation:"cuid2",code:G.invalid_string,message:s.message}),i.dirty());else if(s.kind==="ulid")PR.test(e.data)||(r=this._getOrReturnCtx(e,r),K(r,{validation:"ulid",code:G.invalid_string,message:s.message}),i.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),K(r,{validation:"url",code:G.invalid_string,message:s.message}),i.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),K(r,{validation:"regex",code:G.invalid_string,message:s.message}),i.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(r=this._getOrReturnCtx(e,r),K(r,{code:G.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),i.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(r=this._getOrReturnCtx(e,r),K(r,{code:G.invalid_string,validation:{startsWith:s.value},message:s.message}),i.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(r=this._getOrReturnCtx(e,r),K(r,{code:G.invalid_string,validation:{endsWith:s.value},message:s.message}),i.dirty()):s.kind==="datetime"?GR(s).test(e.data)||(r=this._getOrReturnCtx(e,r),K(r,{code:G.invalid_string,validation:"datetime",message:s.message}),i.dirty()):s.kind==="date"?qR.test(e.data)||(r=this._getOrReturnCtx(e,r),K(r,{code:G.invalid_string,validation:"date",message:s.message}),i.dirty()):s.kind==="time"?$R(s).test(e.data)||(r=this._getOrReturnCtx(e,r),K(r,{code:G.invalid_string,validation:"time",message:s.message}),i.dirty()):s.kind==="duration"?MR.test(e.data)||(r=this._getOrReturnCtx(e,r),K(r,{validation:"duration",code:G.invalid_string,message:s.message}),i.dirty()):s.kind==="ip"?HR(e.data,s.version)||(r=this._getOrReturnCtx(e,r),K(r,{validation:"ip",code:G.invalid_string,message:s.message}),i.dirty()):s.kind==="jwt"?zR(e.data,s.alg)||(r=this._getOrReturnCtx(e,r),K(r,{validation:"jwt",code:G.invalid_string,message:s.message}),i.dirty()):s.kind==="cidr"?WR(e.data,s.version)||(r=this._getOrReturnCtx(e,r),K(r,{validation:"cidr",code:G.invalid_string,message:s.message}),i.dirty()):s.kind==="base64"?OR.test(e.data)||(r=this._getOrReturnCtx(e,r),K(r,{validation:"base64",code:G.invalid_string,message:s.message}),i.dirty()):s.kind==="base64url"?BR.test(e.data)||(r=this._getOrReturnCtx(e,r),K(r,{validation:"base64url",code:G.invalid_string,message:s.message}),i.dirty()):ge.assertNever(s);return{status:i.value,value:e.data}}_regex(e,t,i){return this.refinement(r=>e.test(r),{validation:t,code:G.invalid_string,...X.errToObj(i)})}_addCheck(e){return new Ft({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...X.errToObj(e)})}url(e){return this._addCheck({kind:"url",...X.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...X.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...X.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...X.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...X.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...X.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...X.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...X.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...X.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...X.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...X.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...X.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...X.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...X.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...X.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...X.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...X.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...X.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...X.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...X.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...X.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...X.errToObj(t)})}nonempty(e){return this.min(1,X.errToObj(e))}trim(){return new Ft({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ft({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ft({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Ft.create=n=>new Ft({checks:[],typeName:ne.ZodString,coerce:(n==null?void 0:n.coerce)??!1,...oe(n)});function KR(n,e){const t=(n.toString().split(".")[1]||"").length,i=(e.toString().split(".")[1]||"").length,r=t>i?t:i,s=Number.parseInt(n.toFixed(r).replace(".","")),o=Number.parseInt(e.toFixed(r).replace(".",""));return s%o/10**r}class Pi extends de{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==J.number){const s=this._getOrReturnCtx(e);return K(s,{code:G.invalid_type,expected:J.number,received:s.parsedType}),ie}let i;const r=new ft;for(const s of this._def.checks)s.kind==="int"?ge.isInteger(e.data)||(i=this._getOrReturnCtx(e,i),K(i,{code:G.invalid_type,expected:"integer",received:"float",message:s.message}),r.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(i=this._getOrReturnCtx(e,i),K(i,{code:G.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(i=this._getOrReturnCtx(e,i),K(i,{code:G.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="multipleOf"?KR(e.data,s.value)!==0&&(i=this._getOrReturnCtx(e,i),K(i,{code:G.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(i=this._getOrReturnCtx(e,i),K(i,{code:G.not_finite,message:s.message}),r.dirty()):ge.assertNever(s);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,X.toString(t))}gt(e,t){return this.setLimit("min",e,!1,X.toString(t))}lte(e,t){return this.setLimit("max",e,!0,X.toString(t))}lt(e,t){return this.setLimit("max",e,!1,X.toString(t))}setLimit(e,t,i,r){return new Pi({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:i,message:X.toString(r)}]})}_addCheck(e){return new Pi({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:X.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:X.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:X.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:X.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:X.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:X.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:X.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:X.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:X.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ge.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const i of this._def.checks){if(i.kind==="finite"||i.kind==="int"||i.kind==="multipleOf")return!0;i.kind==="min"?(t===null||i.value>t)&&(t=i.value):i.kind==="max"&&(e===null||i.value<e)&&(e=i.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Pi.create=n=>new Pi({checks:[],typeName:ne.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...oe(n)});class xi extends de{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==J.bigint)return this._getInvalidInput(e);let i;const r=new ft;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(i=this._getOrReturnCtx(e,i),K(i,{code:G.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(i=this._getOrReturnCtx(e,i),K(i,{code:G.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(i=this._getOrReturnCtx(e,i),K(i,{code:G.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):ge.assertNever(s);return{status:r.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return K(t,{code:G.invalid_type,expected:J.bigint,received:t.parsedType}),ie}gte(e,t){return this.setLimit("min",e,!0,X.toString(t))}gt(e,t){return this.setLimit("min",e,!1,X.toString(t))}lte(e,t){return this.setLimit("max",e,!0,X.toString(t))}lt(e,t){return this.setLimit("max",e,!1,X.toString(t))}setLimit(e,t,i,r){return new xi({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:i,message:X.toString(r)}]})}_addCheck(e){return new xi({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:X.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:X.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:X.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:X.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:X.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}xi.create=n=>new xi({checks:[],typeName:ne.ZodBigInt,coerce:(n==null?void 0:n.coerce)??!1,...oe(n)});class Ba extends de{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==J.boolean){const i=this._getOrReturnCtx(e);return K(i,{code:G.invalid_type,expected:J.boolean,received:i.parsedType}),ie}return Rt(e.data)}}Ba.create=n=>new Ba({typeName:ne.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...oe(n)});class Ar extends de{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==J.date){const s=this._getOrReturnCtx(e);return K(s,{code:G.invalid_type,expected:J.date,received:s.parsedType}),ie}if(Number.isNaN(e.data.getTime())){const s=this._getOrReturnCtx(e);return K(s,{code:G.invalid_date}),ie}const i=new ft;let r;for(const s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(r=this._getOrReturnCtx(e,r),K(r,{code:G.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),i.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(r=this._getOrReturnCtx(e,r),K(r,{code:G.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),i.dirty()):ge.assertNever(s);return{status:i.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Ar({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:X.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:X.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Ar.create=n=>new Ar({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:ne.ZodDate,...oe(n)});class Bp extends de{_parse(e){if(this._getType(e)!==J.symbol){const i=this._getOrReturnCtx(e);return K(i,{code:G.invalid_type,expected:J.symbol,received:i.parsedType}),ie}return Rt(e.data)}}Bp.create=n=>new Bp({typeName:ne.ZodSymbol,...oe(n)});class qp extends de{_parse(e){if(this._getType(e)!==J.undefined){const i=this._getOrReturnCtx(e);return K(i,{code:G.invalid_type,expected:J.undefined,received:i.parsedType}),ie}return Rt(e.data)}}qp.create=n=>new qp({typeName:ne.ZodUndefined,...oe(n)});class $p extends de{_parse(e){if(this._getType(e)!==J.null){const i=this._getOrReturnCtx(e);return K(i,{code:G.invalid_type,expected:J.null,received:i.parsedType}),ie}return Rt(e.data)}}$p.create=n=>new $p({typeName:ne.ZodNull,...oe(n)});class Gp extends de{constructor(){super(...arguments),this._any=!0}_parse(e){return Rt(e.data)}}Gp.create=n=>new Gp({typeName:ne.ZodAny,...oe(n)});class nc extends de{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Rt(e.data)}}nc.create=n=>new nc({typeName:ne.ZodUnknown,...oe(n)});class Hn extends de{_parse(e){const t=this._getOrReturnCtx(e);return K(t,{code:G.invalid_type,expected:J.never,received:t.parsedType}),ie}}Hn.create=n=>new Hn({typeName:ne.ZodNever,...oe(n)});class Hp extends de{_parse(e){if(this._getType(e)!==J.undefined){const i=this._getOrReturnCtx(e);return K(i,{code:G.invalid_type,expected:J.void,received:i.parsedType}),ie}return Rt(e.data)}}Hp.create=n=>new Hp({typeName:ne.ZodVoid,...oe(n)});class Ht extends de{_parse(e){const{ctx:t,status:i}=this._processInputParams(e),r=this._def;if(t.parsedType!==J.array)return K(t,{code:G.invalid_type,expected:J.array,received:t.parsedType}),ie;if(r.exactLength!==null){const o=t.data.length>r.exactLength.value,a=t.data.length<r.exactLength.value;(o||a)&&(K(t,{code:o?G.too_big:G.too_small,minimum:a?r.exactLength.value:void 0,maximum:o?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),i.dirty())}if(r.minLength!==null&&t.data.length<r.minLength.value&&(K(t,{code:G.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),i.dirty()),r.maxLength!==null&&t.data.length>r.maxLength.value&&(K(t,{code:G.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),i.dirty()),t.common.async)return Promise.all([...t.data].map((o,a)=>r.type._parseAsync(new Yt(t,o,t.path,a)))).then(o=>ft.mergeArray(i,o));const s=[...t.data].map((o,a)=>r.type._parseSync(new Yt(t,o,t.path,a)));return ft.mergeArray(i,s)}get element(){return this._def.type}min(e,t){return new Ht({...this._def,minLength:{value:e,message:X.toString(t)}})}max(e,t){return new Ht({...this._def,maxLength:{value:e,message:X.toString(t)}})}length(e,t){return new Ht({...this._def,exactLength:{value:e,message:X.toString(t)}})}nonempty(e){return this.min(1,e)}}Ht.create=(n,e)=>new Ht({type:n,minLength:null,maxLength:null,exactLength:null,typeName:ne.ZodArray,...oe(e)});function er(n){if(n instanceof Fe){const e={};for(const t in n.shape){const i=n.shape[t];e[t]=Un.create(er(i))}return new Fe({...n._def,shape:()=>e})}else return n instanceof Ht?new Ht({...n._def,type:er(n.element)}):n instanceof Un?Un.create(er(n.unwrap())):n instanceof Pr?Pr.create(er(n.unwrap())):n instanceof ki?ki.create(n.items.map(e=>er(e))):n}class Fe extends de{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=ge.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==J.object){const d=this._getOrReturnCtx(e);return K(d,{code:G.invalid_type,expected:J.object,received:d.parsedType}),ie}const{status:i,ctx:r}=this._processInputParams(e),{shape:s,keys:o}=this._getCached(),a=[];if(!(this._def.catchall instanceof Hn&&this._def.unknownKeys==="strip"))for(const d in r.data)o.includes(d)||a.push(d);const c=[];for(const d of o){const h=s[d],p=r.data[d];c.push({key:{status:"valid",value:d},value:h._parse(new Yt(r,p,r.path,d)),alwaysSet:d in r.data})}if(this._def.catchall instanceof Hn){const d=this._def.unknownKeys;if(d==="passthrough")for(const h of a)c.push({key:{status:"valid",value:h},value:{status:"valid",value:r.data[h]}});else if(d==="strict")a.length>0&&(K(r,{code:G.unrecognized_keys,keys:a}),i.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const d=this._def.catchall;for(const h of a){const p=r.data[h];c.push({key:{status:"valid",value:h},value:d._parse(new Yt(r,p,r.path,h)),alwaysSet:h in r.data})}}return r.common.async?Promise.resolve().then(async()=>{const d=[];for(const h of c){const p=await h.key,g=await h.value;d.push({key:p,value:g,alwaysSet:h.alwaysSet})}return d}).then(d=>ft.mergeObjectSync(i,d)):ft.mergeObjectSync(i,c)}get shape(){return this._def.shape()}strict(e){return X.errToObj,new Fe({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,i)=>{var s,o;const r=((o=(s=this._def).errorMap)==null?void 0:o.call(s,t,i).message)??i.defaultError;return t.code==="unrecognized_keys"?{message:X.errToObj(e).message??r}:{message:r}}}:{}})}strip(){return new Fe({...this._def,unknownKeys:"strip"})}passthrough(){return new Fe({...this._def,unknownKeys:"passthrough"})}extend(e){return new Fe({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Fe({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:ne.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Fe({...this._def,catchall:e})}pick(e){const t={};for(const i of ge.objectKeys(e))e[i]&&this.shape[i]&&(t[i]=this.shape[i]);return new Fe({...this._def,shape:()=>t})}omit(e){const t={};for(const i of ge.objectKeys(this.shape))e[i]||(t[i]=this.shape[i]);return new Fe({...this._def,shape:()=>t})}deepPartial(){return er(this)}partial(e){const t={};for(const i of ge.objectKeys(this.shape)){const r=this.shape[i];e&&!e[i]?t[i]=r:t[i]=r.optional()}return new Fe({...this._def,shape:()=>t})}required(e){const t={};for(const i of ge.objectKeys(this.shape))if(e&&!e[i])t[i]=this.shape[i];else{let s=this.shape[i];for(;s instanceof Un;)s=s._def.innerType;t[i]=s}return new Fe({...this._def,shape:()=>t})}keyof(){return Lv(ge.objectKeys(this.shape))}}Fe.create=(n,e)=>new Fe({shape:()=>n,unknownKeys:"strip",catchall:Hn.create(),typeName:ne.ZodObject,...oe(e)});Fe.strictCreate=(n,e)=>new Fe({shape:()=>n,unknownKeys:"strict",catchall:Hn.create(),typeName:ne.ZodObject,...oe(e)});Fe.lazycreate=(n,e)=>new Fe({shape:n,unknownKeys:"strip",catchall:Hn.create(),typeName:ne.ZodObject,...oe(e)});class qa extends de{_parse(e){const{ctx:t}=this._processInputParams(e),i=this._def.options;function r(s){for(const a of s)if(a.result.status==="valid")return a.result;for(const a of s)if(a.result.status==="dirty")return t.common.issues.push(...a.ctx.common.issues),a.result;const o=s.map(a=>new cn(a.ctx.common.issues));return K(t,{code:G.invalid_union,unionErrors:o}),ie}if(t.common.async)return Promise.all(i.map(async s=>{const o={...t,common:{...t.common,issues:[]},parent:null};return{result:await s._parseAsync({data:t.data,path:t.path,parent:o}),ctx:o}})).then(r);{let s;const o=[];for(const c of i){const d={...t,common:{...t.common,issues:[]},parent:null},h=c._parseSync({data:t.data,path:t.path,parent:d});if(h.status==="valid")return h;h.status==="dirty"&&!s&&(s={result:h,ctx:d}),d.common.issues.length&&o.push(d.common.issues)}if(s)return t.common.issues.push(...s.ctx.common.issues),s.result;const a=o.map(c=>new cn(c));return K(t,{code:G.invalid_union,unionErrors:a}),ie}}get options(){return this._def.options}}qa.create=(n,e)=>new qa({options:n,typeName:ne.ZodUnion,...oe(e)});function ic(n,e){const t=An(n),i=An(e);if(n===e)return{valid:!0,data:n};if(t===J.object&&i===J.object){const r=ge.objectKeys(e),s=ge.objectKeys(n).filter(a=>r.indexOf(a)!==-1),o={...n,...e};for(const a of s){const c=ic(n[a],e[a]);if(!c.valid)return{valid:!1};o[a]=c.data}return{valid:!0,data:o}}else if(t===J.array&&i===J.array){if(n.length!==e.length)return{valid:!1};const r=[];for(let s=0;s<n.length;s++){const o=n[s],a=e[s],c=ic(o,a);if(!c.valid)return{valid:!1};r.push(c.data)}return{valid:!0,data:r}}else return t===J.date&&i===J.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class $a extends de{_parse(e){const{status:t,ctx:i}=this._processInputParams(e),r=(s,o)=>{if(Fp(s)||Fp(o))return ie;const a=ic(s.value,o.value);return a.valid?((Up(s)||Up(o))&&t.dirty(),{status:t.value,value:a.data}):(K(i,{code:G.invalid_intersection_types}),ie)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([s,o])=>r(s,o)):r(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}}$a.create=(n,e,t)=>new $a({left:n,right:e,typeName:ne.ZodIntersection,...oe(t)});class ki extends de{_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==J.array)return K(i,{code:G.invalid_type,expected:J.array,received:i.parsedType}),ie;if(i.data.length<this._def.items.length)return K(i,{code:G.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ie;!this._def.rest&&i.data.length>this._def.items.length&&(K(i,{code:G.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const s=[...i.data].map((o,a)=>{const c=this._def.items[a]||this._def.rest;return c?c._parse(new Yt(i,o,i.path,a)):null}).filter(o=>!!o);return i.common.async?Promise.all(s).then(o=>ft.mergeArray(t,o)):ft.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new ki({...this._def,rest:e})}}ki.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ki({items:n,typeName:ne.ZodTuple,rest:null,...oe(e)})};class Ga extends de{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==J.object)return K(i,{code:G.invalid_type,expected:J.object,received:i.parsedType}),ie;const r=[],s=this._def.keyType,o=this._def.valueType;for(const a in i.data)r.push({key:s._parse(new Yt(i,a,i.path,a)),value:o._parse(new Yt(i,i.data[a],i.path,a)),alwaysSet:a in i.data});return i.common.async?ft.mergeObjectAsync(t,r):ft.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(e,t,i){return t instanceof de?new Ga({keyType:e,valueType:t,typeName:ne.ZodRecord,...oe(i)}):new Ga({keyType:Ft.create(),valueType:e,typeName:ne.ZodRecord,...oe(t)})}}class zp extends de{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==J.map)return K(i,{code:G.invalid_type,expected:J.map,received:i.parsedType}),ie;const r=this._def.keyType,s=this._def.valueType,o=[...i.data.entries()].map(([a,c],d)=>({key:r._parse(new Yt(i,a,i.path,[d,"key"])),value:s._parse(new Yt(i,c,i.path,[d,"value"]))}));if(i.common.async){const a=new Map;return Promise.resolve().then(async()=>{for(const c of o){const d=await c.key,h=await c.value;if(d.status==="aborted"||h.status==="aborted")return ie;(d.status==="dirty"||h.status==="dirty")&&t.dirty(),a.set(d.value,h.value)}return{status:t.value,value:a}})}else{const a=new Map;for(const c of o){const d=c.key,h=c.value;if(d.status==="aborted"||h.status==="aborted")return ie;(d.status==="dirty"||h.status==="dirty")&&t.dirty(),a.set(d.value,h.value)}return{status:t.value,value:a}}}}zp.create=(n,e,t)=>new zp({valueType:e,keyType:n,typeName:ne.ZodMap,...oe(t)});class Js extends de{_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==J.set)return K(i,{code:G.invalid_type,expected:J.set,received:i.parsedType}),ie;const r=this._def;r.minSize!==null&&i.data.size<r.minSize.value&&(K(i,{code:G.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),r.maxSize!==null&&i.data.size>r.maxSize.value&&(K(i,{code:G.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const s=this._def.valueType;function o(c){const d=new Set;for(const h of c){if(h.status==="aborted")return ie;h.status==="dirty"&&t.dirty(),d.add(h.value)}return{status:t.value,value:d}}const a=[...i.data.values()].map((c,d)=>s._parse(new Yt(i,c,i.path,d)));return i.common.async?Promise.all(a).then(c=>o(c)):o(a)}min(e,t){return new Js({...this._def,minSize:{value:e,message:X.toString(t)}})}max(e,t){return new Js({...this._def,maxSize:{value:e,message:X.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Js.create=(n,e)=>new Js({valueType:n,minSize:null,maxSize:null,typeName:ne.ZodSet,...oe(e)});class rc extends de{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}rc.create=(n,e)=>new rc({getter:n,typeName:ne.ZodLazy,...oe(e)});class Wp extends de{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return K(t,{received:t.data,code:G.invalid_literal,expected:this._def.value}),ie}return{status:"valid",value:e.data}}get value(){return this._def.value}}Wp.create=(n,e)=>new Wp({value:n,typeName:ne.ZodLiteral,...oe(e)});function Lv(n,e){return new Sr({values:n,typeName:ne.ZodEnum,...oe(e)})}class Sr extends de{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),i=this._def.values;return K(t,{expected:ge.joinValues(i),received:t.parsedType,code:G.invalid_type}),ie}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),i=this._def.values;return K(t,{received:t.data,code:G.invalid_enum_value,options:i}),ie}return Rt(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Sr.create(e,{...this._def,...t})}exclude(e,t=this._def){return Sr.create(this.options.filter(i=>!e.includes(i)),{...this._def,...t})}}Sr.create=Lv;class Kp extends de{_parse(e){const t=ge.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(e);if(i.parsedType!==J.string&&i.parsedType!==J.number){const r=ge.objectValues(t);return K(i,{expected:ge.joinValues(r),received:i.parsedType,code:G.invalid_type}),ie}if(this._cache||(this._cache=new Set(ge.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const r=ge.objectValues(t);return K(i,{received:i.data,code:G.invalid_enum_value,options:r}),ie}return Rt(e.data)}get enum(){return this._def.values}}Kp.create=(n,e)=>new Kp({values:n,typeName:ne.ZodNativeEnum,...oe(e)});class Ha extends de{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==J.promise&&t.common.async===!1)return K(t,{code:G.invalid_type,expected:J.promise,received:t.parsedType}),ie;const i=t.parsedType===J.promise?t.data:Promise.resolve(t.data);return Rt(i.then(r=>this._def.type.parseAsync(r,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Ha.create=(n,e)=>new Ha({type:n,typeName:ne.ZodPromise,...oe(e)});class Rr extends de{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ne.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:i}=this._processInputParams(e),r=this._def.effect||null,s={addIssue:o=>{K(i,o),o.fatal?t.abort():t.dirty()},get path(){return i.path}};if(s.addIssue=s.addIssue.bind(s),r.type==="preprocess"){const o=r.transform(i.data,s);if(i.common.async)return Promise.resolve(o).then(async a=>{if(t.value==="aborted")return ie;const c=await this._def.schema._parseAsync({data:a,path:i.path,parent:i});return c.status==="aborted"?ie:c.status==="dirty"||t.value==="dirty"?_s(c.value):c});{if(t.value==="aborted")return ie;const a=this._def.schema._parseSync({data:o,path:i.path,parent:i});return a.status==="aborted"?ie:a.status==="dirty"||t.value==="dirty"?_s(a.value):a}}if(r.type==="refinement"){const o=a=>{const c=r.refinement(a,s);if(i.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(i.common.async===!1){const a=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return a.status==="aborted"?ie:(a.status==="dirty"&&t.dirty(),o(a.value),{status:t.value,value:a.value})}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(a=>a.status==="aborted"?ie:(a.status==="dirty"&&t.dirty(),o(a.value).then(()=>({status:t.value,value:a.value}))))}if(r.type==="transform")if(i.common.async===!1){const o=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!wr(o))return ie;const a=r.transform(o.value,s);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(o=>wr(o)?Promise.resolve(r.transform(o.value,s)).then(a=>({status:t.value,value:a})):ie);ge.assertNever(r)}}Rr.create=(n,e,t)=>new Rr({schema:n,typeName:ne.ZodEffects,effect:e,...oe(t)});Rr.createWithPreprocess=(n,e,t)=>new Rr({schema:e,effect:{type:"preprocess",transform:n},typeName:ne.ZodEffects,...oe(t)});class Un extends de{_parse(e){return this._getType(e)===J.undefined?Rt(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Un.create=(n,e)=>new Un({innerType:n,typeName:ne.ZodOptional,...oe(e)});class Pr extends de{_parse(e){return this._getType(e)===J.null?Rt(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Pr.create=(n,e)=>new Pr({innerType:n,typeName:ne.ZodNullable,...oe(e)});class sc extends de{_parse(e){const{ctx:t}=this._processInputParams(e);let i=t.data;return t.parsedType===J.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}sc.create=(n,e)=>new sc({innerType:n,typeName:ne.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...oe(e)});class oc extends de{_parse(e){const{ctx:t}=this._processInputParams(e),i={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:i.data,path:i.path,parent:{...i}});return Oa(r)?r.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new cn(i.common.issues)},input:i.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new cn(i.common.issues)},input:i.data})}}removeCatch(){return this._def.innerType}}oc.create=(n,e)=>new oc({innerType:n,typeName:ne.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...oe(e)});class Jp extends de{_parse(e){if(this._getType(e)!==J.nan){const i=this._getOrReturnCtx(e);return K(i,{code:G.invalid_type,expected:J.nan,received:i.parsedType}),ie}return{status:"valid",value:e.data}}}Jp.create=n=>new Jp({typeName:ne.ZodNaN,...oe(n)});class JR extends de{_parse(e){const{ctx:t}=this._processInputParams(e),i=t.data;return this._def.type._parse({data:i,path:t.path,parent:t})}unwrap(){return this._def.type}}class Sd extends de{_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:i.data,path:i.path,parent:i});return s.status==="aborted"?ie:s.status==="dirty"?(t.dirty(),_s(s.value)):this._def.out._parseAsync({data:s.value,path:i.path,parent:i})})();{const r=this._def.in._parseSync({data:i.data,path:i.path,parent:i});return r.status==="aborted"?ie:r.status==="dirty"?(t.dirty(),{status:"dirty",value:r.value}):this._def.out._parseSync({data:r.value,path:i.path,parent:i})}}static create(e,t){return new Sd({in:e,out:t,typeName:ne.ZodPipeline})}}class ac extends de{_parse(e){const t=this._def.innerType._parse(e),i=r=>(wr(r)&&(r.value=Object.freeze(r.value)),r);return Oa(t)?t.then(r=>i(r)):i(t)}unwrap(){return this._def.innerType}}ac.create=(n,e)=>new ac({innerType:n,typeName:ne.ZodReadonly,...oe(e)});var ne;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(ne||(ne={}));const ei=Ft.create,Yp=Pi.create;xi.create;const YR=Ba.create;Ar.create;const Xp=nc.create;Hn.create;const vs=Ht.create,XR=Fe.create,QR=qa.create;$a.create;ki.create;const ZR=Ga.create,jR=rc.create,eP=Sr.create;Ha.create;Un.create;Pr.create;const Ji={string:n=>Ft.create({...n,coerce:!0}),number:n=>Pi.create({...n,coerce:!0}),boolean:n=>Ba.create({...n,coerce:!0}),bigint:n=>xi.create({...n,coerce:!0}),date:n=>Ar.create({...n,coerce:!0})};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let tP,nP;function iP(){return{geminiUrl:tP,vertexUrl:nP}}function rP(n,e,t){var i,r,s;if(!(!((i=n.httpOptions)===null||i===void 0)&&i.baseUrl)){const o=iP();return n.vertexai?(r=o.vertexUrl)!==null&&r!==void 0?r:e:(s=o.geminiUrl)!==null&&s!==void 0?s:t}return n.httpOptions.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Fi{}function Z(n,e){const t=/\{([^}]+)\}/g;return n.replace(t,(i,r)=>{if(Object.prototype.hasOwnProperty.call(e,r)){const s=e[r];return s!=null?String(s):""}else throw new Error(`Key '${r}' not found in valueMap.`)})}function u(n,e,t){for(let s=0;s<e.length-1;s++){const o=e[s];if(o.endsWith("[]")){const a=o.slice(0,-2);if(!(a in n))if(Array.isArray(t))n[a]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${o}`);if(Array.isArray(n[a])){const c=n[a];if(Array.isArray(t))for(let d=0;d<c.length;d++){const h=c[d];u(h,e.slice(s+1),t[d])}else for(const d of c)u(d,e.slice(s+1),t)}return}else if(o.endsWith("[0]")){const a=o.slice(0,-3);a in n||(n[a]=[{}]);const c=n[a];u(c[0],e.slice(s+1),t);return}(!n[o]||typeof n[o]!="object")&&(n[o]={}),n=n[o]}const i=e[e.length-1],r=n[i];if(r!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===r)return;if(typeof r=="object"&&typeof t=="object"&&r!==null&&t!==null)Object.assign(r,t);else throw new Error(`Cannot set value for an existing key. Key: ${i}`)}else n[i]=t}function l(n,e){try{if(e.length===1&&e[0]==="_self")return n;for(let t=0;t<e.length;t++){if(typeof n!="object"||n===null)return;const i=e[t];if(i.endsWith("[]")){const r=i.slice(0,-2);if(r in n){const s=n[r];return Array.isArray(s)?s.map(o=>l(o,e.slice(t+1))):void 0}else return}else n=n[i]}return n}catch(t){if(t instanceof TypeError)return;throw t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Qp;(function(n){n.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",n.OUTCOME_OK="OUTCOME_OK",n.OUTCOME_FAILED="OUTCOME_FAILED",n.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Qp||(Qp={}));var Zp;(function(n){n.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",n.PYTHON="PYTHON"})(Zp||(Zp={}));var Ut;(function(n){n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT",n.NULL="NULL"})(Ut||(Ut={}));var jp;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(jp||(jp={}));var em;(function(n){n.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",n.SEVERITY="SEVERITY",n.PROBABILITY="PROBABILITY"})(em||(em={}));var tm;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE",n.OFF="OFF"})(tm||(tm={}));var nm;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(nm||(nm={}));var im;(function(n){n.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",n.NO_AUTH="NO_AUTH",n.API_KEY_AUTH="API_KEY_AUTH",n.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",n.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",n.OAUTH="OAUTH",n.OIDC_AUTH="OIDC_AUTH"})(im||(im={}));var rm;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.IMAGE_SAFETY="IMAGE_SAFETY",n.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL"})(rm||(rm={}));var sm;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(sm||(sm={}));var om;(function(n){n.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",n.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",n.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",n.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",n.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(om||(om={}));var am;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT"})(am||(am={}));var lm;(function(n){n.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",n.ON_DEMAND="ON_DEMAND",n.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(lm||(lm={}));var za;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO"})(za||(za={}));var um;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(um||(um={}));var lc;(function(n){n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(lc||(lc={}));var cm;(function(n){n.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",n.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",n.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",n.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",n.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",n.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",n.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(cm||(cm={}));var dm;(function(n){n.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",n.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",n.BALANCED="BALANCED",n.PRIORITIZE_COST="PRIORITIZE_COST"})(dm||(dm={}));var fm;(function(n){n.UNSPECIFIED="UNSPECIFIED",n.BLOCKING="BLOCKING",n.NON_BLOCKING="NON_BLOCKING"})(fm||(fm={}));var hm;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(hm||(hm={}));var pm;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE"})(pm||(pm={}));var mm;(function(n){n.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",n.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",n.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR"})(mm||(mm={}));var gm;(function(n){n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(gm||(gm={}));var ym;(function(n){n.DONT_ALLOW="DONT_ALLOW",n.ALLOW_ADULT="ALLOW_ADULT",n.ALLOW_ALL="ALLOW_ALL"})(ym||(ym={}));var _m;(function(n){n.auto="auto",n.en="en",n.ja="ja",n.ko="ko",n.hi="hi"})(_m||(_m={}));var vm;(function(n){n.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",n.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",n.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",n.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",n.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(vm||(vm={}));var Tm;(function(n){n.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",n.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",n.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",n.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Tm||(Tm={}));var Em;(function(n){n.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",n.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",n.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",n.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Em||(Em={}));var Im;(function(n){n.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",n.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",n.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",n.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",n.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",n.EDIT_MODE_STYLE="EDIT_MODE_STYLE",n.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",n.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Im||(Im={}));var Cm;(function(n){n.OPTIMIZED="OPTIMIZED",n.LOSSLESS="LOSSLESS"})(Cm||(Cm={}));var wm;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.PROCESSING="PROCESSING",n.ACTIVE="ACTIVE",n.FAILED="FAILED"})(wm||(wm={}));var Am;(function(n){n.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",n.UPLOADED="UPLOADED",n.GENERATED="GENERATED"})(Am||(Am={}));var Sm;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.VIDEO="VIDEO",n.AUDIO="AUDIO",n.DOCUMENT="DOCUMENT"})(Sm||(Sm={}));var Rm;(function(n){n.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",n.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",n.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Rm||(Rm={}));var Pm;(function(n){n.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",n.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",n.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Pm||(Pm={}));var xm;(function(n){n.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",n.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",n.NO_INTERRUPTION="NO_INTERRUPTION"})(xm||(xm={}));var km;(function(n){n.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",n.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",n.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(km||(km={}));var bm;(function(n){n.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",n.SILENT="SILENT",n.WHEN_IDLE="WHEN_IDLE",n.INTERRUPT="INTERRUPT"})(bm||(bm={}));var Mm;(function(n){n.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",n.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",n.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",n.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",n.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",n.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",n.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",n.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",n.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",n.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",n.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",n.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",n.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Mm||(Mm={}));var nr;(function(n){n.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.RESET_CONTEXT="RESET_CONTEXT"})(nr||(nr={}));class uc{constructor(e){const t={};for(const i of e.headers.entries())t[i[0]]=i[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class cs{get text(){var e,t,i,r,s,o,a,c;if(((r=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",h=!1;const p=[];for(const g of(c=(a=(o=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)!==null&&c!==void 0?c:[]){for(const[_,C]of Object.entries(g))_!=="text"&&_!=="thought"&&(C!==null||C!==void 0)&&p.push(_);if(typeof g.text=="string"){if(typeof g.thought=="boolean"&&g.thought)continue;h=!0,d+=g.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),h?d:void 0}get data(){var e,t,i,r,s,o,a,c;if(((r=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let d="";const h=[];for(const p of(c=(a=(o=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)!==null&&c!==void 0?c:[]){for(const[g,_]of Object.entries(p))g!=="inlineData"&&(_!==null||_!==void 0)&&h.push(g);p.inlineData&&typeof p.inlineData.data=="string"&&(d+=atob(p.inlineData.data))}return h.length>0&&console.warn(`there are non-data parts ${h} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),d.length>0?btoa(d):void 0}get functionCalls(){var e,t,i,r,s,o,a,c;if(((r=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const d=(c=(a=(o=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||c===void 0?void 0:c.filter(h=>h.functionCall).map(h=>h.functionCall).filter(h=>h!==void 0);if((d==null?void 0:d.length)!==0)return d}get executableCode(){var e,t,i,r,s,o,a,c,d;if(((r=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const h=(c=(a=(o=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||c===void 0?void 0:c.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((h==null?void 0:h.length)!==0)return(d=h==null?void 0:h[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var e,t,i,r,s,o,a,c,d;if(((r=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const h=(c=(a=(o=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||c===void 0?void 0:c.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((h==null?void 0:h.length)!==0)return(d=h==null?void 0:h[0])===null||d===void 0?void 0:d.output}}class Dm{}class Nm{}class sP{}class oP{}class Vm{}class Lm{}class Fm{}class aP{}class Um{}class Om{}class Bm{}class lP{}class uP{}class cP{}class qm{}class dP{get text(){var e,t,i;let r="",s=!1;const o=[];for(const a of(i=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&i!==void 0?i:[]){for(const[c,d]of Object.entries(a))c!=="text"&&c!=="thought"&&d!==null&&o.push(c);if(typeof a.text=="string"){if(typeof a.thought=="boolean"&&a.thought)continue;s=!0,r+=a.text}}return o.length>0&&console.warn(`there are non-text parts ${o} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),s?r:void 0}get data(){var e,t,i;let r="";const s=[];for(const o of(i=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&i!==void 0?i:[]){for(const[a,c]of Object.entries(o))a!=="inlineData"&&c!==null&&s.push(a);o.inlineData&&typeof o.inlineData.data=="string"&&(r+=atob(o.inlineData.data))}return s.length>0&&console.warn(`there are non-data parts ${s} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),r.length>0?btoa(r):void 0}}class fP{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Te(n,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(n.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function Fv(n,e){const t=Te(n,e);return t?t.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:t.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${t}`:t:""}function Uv(n){return Array.isArray(n)?n.map(e=>Wa(e)):[Wa(n)]}function Wa(n){if(typeof n=="object"&&n!==null)return n;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof n}`)}function hP(n){const e=Wa(n);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function pP(n){const e=Wa(n);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function $m(n){if(n==null)throw new Error("PartUnion is required");if(typeof n=="object")return n;if(typeof n=="string")return{text:n};throw new Error(`Unsupported part type: ${typeof n}`)}function Ov(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map(e=>$m(e)):[$m(n)]}function cc(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function Gm(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function Hm(n){return n!=null&&typeof n=="object"&&"functionResponse"in n}function nt(n){if(n==null)throw new Error("ContentUnion is required");return cc(n)?n:{role:"user",parts:Ov(n)}}function Bv(n,e){if(!e)return[];if(n.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const i=nt(t);return i.parts&&i.parts.length>0&&i.parts[0].text!==void 0?[i.parts[0].text]:[]});if(n.isVertexAI()){const t=nt(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>nt(t)):[nt(e)]}function St(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("contents are required");if(!Array.isArray(n)){if(Gm(n)||Hm(n))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[nt(n)]}const e=[],t=[],i=cc(n[0]);for(const r of n){const s=cc(r);if(s!=i)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(s)e.push(r);else{if(Gm(r)||Hm(r))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(r)}}return i||e.push({role:"user",parts:Ov(t)}),e}const mP=new Set(["type","format","title","description","default","items","minItems","maxItems","enum","properties","required","minProperties","maxProperties","minimum","maximum","minLength","maxLength","pattern","anyOf","propertyOrdering"]),zm=eP(["string","number","integer","object","array","boolean","null"]),gP=QR([zm,vs(zm)]);function yP(n=!0){const e=jR(()=>{const t=XR({type:gP.optional(),format:ei().optional(),title:ei().optional(),description:ei().optional(),default:Xp().optional(),items:e.optional(),minItems:Ji.string().optional(),maxItems:Ji.string().optional(),enum:vs(Xp()).optional(),properties:ZR(ei(),e).optional(),required:vs(ei()).optional(),minProperties:Ji.string().optional(),maxProperties:Ji.string().optional(),propertyOrdering:vs(ei()).optional(),minimum:Yp().optional(),maximum:Yp().optional(),minLength:Ji.string().optional(),maxLength:Ji.string().optional(),pattern:ei().optional(),anyOf:vs(e).optional(),additionalProperties:YR().optional()});return n?t.strict():t});return e}function _P(n,e){n.includes("null")&&(e.nullable=!0);const t=n.filter(i=>i!=="null");if(t.length===1)e.type=Object.values(Ut).includes(t[0].toUpperCase())?t[0].toUpperCase():Ut.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const i of t)e.anyOf.push({type:Object.values(Ut).includes(i.toUpperCase())?i.toUpperCase():Ut.TYPE_UNSPECIFIED})}}function lr(n){const e={},t=["items"],i=["anyOf"],r=["properties"];if(n.type&&n.anyOf)throw new Error("type and anyOf cannot be both populated.");const s=n.anyOf;s!=null&&s.length==2&&(s[0].type==="null"?(e.nullable=!0,n=s[1]):s[1].type==="null"&&(e.nullable=!0,n=s[0])),n.type instanceof Array&&_P(n.type,e);for(const[o,a]of Object.entries(n))if(a!=null)if(o=="type"){if(a==="null")throw new Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;e.type=Object.values(Ut).includes(a.toUpperCase())?a.toUpperCase():Ut.TYPE_UNSPECIFIED}else if(t.includes(o))e[o]=lr(a);else if(i.includes(o)){const c=[];for(const d of a){if(d.type=="null"){e.nullable=!0;continue}c.push(lr(d))}e[o]=c}else if(r.includes(o)){const c={};for(const[d,h]of Object.entries(a))c[d]=lr(h);e[o]=c}else{if(o==="additionalProperties")continue;e[o]=a}return e}function Ys(n){if(Object.keys(n).includes("$schema")){delete n.$schema;const e=yP().parse(n);return lr(e)}else return lr(n)}function Rd(n){if(typeof n=="object")return n;if(typeof n=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error(`Unsupported speechConfig type: ${typeof n}`)}function Pd(n){if("multiSpeakerVoiceConfig"in n)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return n}function Or(n){if(n.functionDeclarations)for(const e of n.functionDeclarations)e.parameters&&(e.parameters=Ys(e.parameters)),e.response&&(e.response=Ys(e.response));return n}function Br(n){if(n==null)throw new Error("tools is required");if(!Array.isArray(n))throw new Error("tools is required and must be an array of Tools");const e=[];for(const t of n)e.push(t);return e}function vP(n,e,t,i=1){const r=!e.startsWith(`${t}/`)&&e.split("/").length===i;return n.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${n.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:r?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}/${e}`:e:r?`${t}/${e}`:e}function pn(n,e){if(typeof e!="string")throw new Error("name must be a string");return vP(n,e,"cachedContents")}function qv(n){switch(n){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return n}}function mn(n){if(typeof n!="string")throw new Error("fromImageBytes must be a string");return n}function TP(n){return n!=null&&typeof n=="object"&&"name"in n}function EP(n){return n!=null&&typeof n=="object"&&"video"in n}function IP(n){return n!=null&&typeof n=="object"&&"uri"in n}function $v(n){var e;let t;if(TP(n)&&(t=n.name),!(IP(n)&&(t=n.uri,t===void 0))&&!(EP(n)&&(t=(e=n.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof n=="string"&&(t=n),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){const r=t.split("files/")[1].match(/[a-z0-9]+/);if(r===null)throw new Error(`Could not extract file name from URI ${t}`);t=r[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function Gv(n,e){let t;return n.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function Hv(n){for(const e of["models","tunedModels","publisherModels"])if(CP(n,e))return n[e];return[]}function CP(n,e){return n!==null&&typeof n=="object"&&e in n}function wP(n,e={}){const t=n,i={name:t.name,description:t.description,parameters:lr(Al(t.inputSchema))};return e.behavior&&(i.behavior=e.behavior),{functionDeclarations:[i]}}function AP(n,e={}){const t=[],i=new Set;for(const r of n){const s=r.name;if(i.has(s))throw new Error(`Duplicate function name ${s} found in MCP tools. Please ensure function names are unique.`);i.add(s);const o=wP(r,e);o.functionDeclarations&&t.push(...o.functionDeclarations)}return{functionDeclarations:t}}function SP(n){const e=[];for(const t of n)e.push(Al(t));return e}function RP(n){const e={};for(const[t,i]of Object.entries(n)){const r=i;e[t]=Al(r)}return e}function Al(n){const e=new Set(["items"]),t=new Set(["anyOf"]),i=new Set(["properties"]),r={};for(const[s,o]of Object.entries(n))if(e.has(s))r[s]=Al(o);else if(t.has(s))r[s]=SP(o);else if(i.has(s))r[s]=RP(o);else if(s==="type"){const a=o.toUpperCase();r[s]=Object.values(Ut).includes(a)?a:Ut.TYPE_UNSPECIFIED}else mP.has(s)&&(r[s]=o);return r}function zv(n,e){if(typeof e!="string"&&!Array.isArray(e)){if(n&&n.isVertexAI()){if(e.gcsUri&&e.bigqueryUri)throw new Error("Only one of `gcsUri` or `bigqueryUri` can be set.");if(!e.gcsUri&&!e.bigqueryUri)throw new Error("One of `gcsUri` or `bigqueryUri` must be set.")}else{if(e.inlinedRequests&&e.fileName)throw new Error("Only one of `inlinedRequests` or `fileName` can be set.");if(!e.inlinedRequests&&!e.fileName)throw new Error("One of `inlinedRequests` or `fileName` must be set.")}return e}else{if(Array.isArray(e))return{inlinedRequests:e};if(typeof e=="string"){if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:[e]};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};if(e.startsWith("files/"))return{fileName:e}}}throw new Error(`Unsupported source: ${e}`)}function PP(n){const e=n;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function Sl(n,e){const t=e;if(!n.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function Wv(n){const e=n;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function xP(n){const e={},t=l(n,["fps"]);t!=null&&u(e,["fps"],t);const i=l(n,["endOffset"]);i!=null&&u(e,["endOffset"],i);const r=l(n,["startOffset"]);return r!=null&&u(e,["startOffset"],r),e}function kP(n){const e={};if(l(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=l(n,["data"]);t!=null&&u(e,["data"],t);const i=l(n,["mimeType"]);return i!=null&&u(e,["mimeType"],i),e}function bP(n){const e={};if(l(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=l(n,["fileUri"]);t!=null&&u(e,["fileUri"],t);const i=l(n,["mimeType"]);return i!=null&&u(e,["mimeType"],i),e}function MP(n){const e={},t=l(n,["videoMetadata"]);t!=null&&u(e,["videoMetadata"],xP(t));const i=l(n,["thought"]);i!=null&&u(e,["thought"],i);const r=l(n,["inlineData"]);r!=null&&u(e,["inlineData"],kP(r));const s=l(n,["fileData"]);s!=null&&u(e,["fileData"],bP(s));const o=l(n,["thoughtSignature"]);o!=null&&u(e,["thoughtSignature"],o);const a=l(n,["codeExecutionResult"]);a!=null&&u(e,["codeExecutionResult"],a);const c=l(n,["executableCode"]);c!=null&&u(e,["executableCode"],c);const d=l(n,["functionCall"]);d!=null&&u(e,["functionCall"],d);const h=l(n,["functionResponse"]);h!=null&&u(e,["functionResponse"],h);const p=l(n,["text"]);return p!=null&&u(e,["text"],p),e}function Kv(n){const e={},t=l(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(s=>MP(s))),u(e,["parts"],r)}const i=l(n,["role"]);return i!=null&&u(e,["role"],i),e}function DP(n){const e={},t=l(n,["anyOf"]);t!=null&&u(e,["anyOf"],t);const i=l(n,["default"]);i!=null&&u(e,["default"],i);const r=l(n,["description"]);r!=null&&u(e,["description"],r);const s=l(n,["enum"]);s!=null&&u(e,["enum"],s);const o=l(n,["example"]);o!=null&&u(e,["example"],o);const a=l(n,["format"]);a!=null&&u(e,["format"],a);const c=l(n,["items"]);c!=null&&u(e,["items"],c);const d=l(n,["maxItems"]);d!=null&&u(e,["maxItems"],d);const h=l(n,["maxLength"]);h!=null&&u(e,["maxLength"],h);const p=l(n,["maxProperties"]);p!=null&&u(e,["maxProperties"],p);const g=l(n,["maximum"]);g!=null&&u(e,["maximum"],g);const _=l(n,["minItems"]);_!=null&&u(e,["minItems"],_);const C=l(n,["minLength"]);C!=null&&u(e,["minLength"],C);const P=l(n,["minProperties"]);P!=null&&u(e,["minProperties"],P);const x=l(n,["minimum"]);x!=null&&u(e,["minimum"],x);const F=l(n,["nullable"]);F!=null&&u(e,["nullable"],F);const L=l(n,["pattern"]);L!=null&&u(e,["pattern"],L);const V=l(n,["properties"]);V!=null&&u(e,["properties"],V);const O=l(n,["propertyOrdering"]);O!=null&&u(e,["propertyOrdering"],O);const U=l(n,["required"]);U!=null&&u(e,["required"],U);const q=l(n,["title"]);q!=null&&u(e,["title"],q);const I=l(n,["type"]);return I!=null&&u(e,["type"],I),e}function NP(n){const e={};if(l(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const t=l(n,["category"]);t!=null&&u(e,["category"],t);const i=l(n,["threshold"]);return i!=null&&u(e,["threshold"],i),e}function VP(n){const e={},t=l(n,["behavior"]);t!=null&&u(e,["behavior"],t);const i=l(n,["description"]);i!=null&&u(e,["description"],i);const r=l(n,["name"]);r!=null&&u(e,["name"],r);const s=l(n,["parameters"]);s!=null&&u(e,["parameters"],s);const o=l(n,["parametersJsonSchema"]);o!=null&&u(e,["parametersJsonSchema"],o);const a=l(n,["response"]);a!=null&&u(e,["response"],a);const c=l(n,["responseJsonSchema"]);return c!=null&&u(e,["responseJsonSchema"],c),e}function LP(n){const e={},t=l(n,["startTime"]);t!=null&&u(e,["startTime"],t);const i=l(n,["endTime"]);return i!=null&&u(e,["endTime"],i),e}function FP(n){const e={},t=l(n,["timeRangeFilter"]);return t!=null&&u(e,["timeRangeFilter"],LP(t)),e}function UP(n){const e={},t=l(n,["mode"]);t!=null&&u(e,["mode"],t);const i=l(n,["dynamicThreshold"]);return i!=null&&u(e,["dynamicThreshold"],i),e}function OP(n){const e={},t=l(n,["dynamicRetrievalConfig"]);return t!=null&&u(e,["dynamicRetrievalConfig"],UP(t)),e}function BP(){return{}}function qP(n){const e={},t=l(n,["functionDeclarations"]);if(t!=null){let a=t;Array.isArray(a)&&(a=a.map(c=>VP(c))),u(e,["functionDeclarations"],a)}if(l(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=l(n,["googleSearch"]);i!=null&&u(e,["googleSearch"],FP(i));const r=l(n,["googleSearchRetrieval"]);if(r!=null&&u(e,["googleSearchRetrieval"],OP(r)),l(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(l(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");l(n,["urlContext"])!=null&&u(e,["urlContext"],BP());const o=l(n,["codeExecution"]);return o!=null&&u(e,["codeExecution"],o),e}function $P(n){const e={},t=l(n,["mode"]);t!=null&&u(e,["mode"],t);const i=l(n,["allowedFunctionNames"]);return i!=null&&u(e,["allowedFunctionNames"],i),e}function GP(n){const e={},t=l(n,["latitude"]);t!=null&&u(e,["latitude"],t);const i=l(n,["longitude"]);return i!=null&&u(e,["longitude"],i),e}function HP(n){const e={},t=l(n,["latLng"]);t!=null&&u(e,["latLng"],GP(t));const i=l(n,["languageCode"]);return i!=null&&u(e,["languageCode"],i),e}function zP(n){const e={},t=l(n,["functionCallingConfig"]);t!=null&&u(e,["functionCallingConfig"],$P(t));const i=l(n,["retrievalConfig"]);return i!=null&&u(e,["retrievalConfig"],HP(i)),e}function WP(n){const e={},t=l(n,["voiceName"]);return t!=null&&u(e,["voiceName"],t),e}function Jv(n){const e={},t=l(n,["prebuiltVoiceConfig"]);return t!=null&&u(e,["prebuiltVoiceConfig"],WP(t)),e}function KP(n){const e={},t=l(n,["speaker"]);t!=null&&u(e,["speaker"],t);const i=l(n,["voiceConfig"]);return i!=null&&u(e,["voiceConfig"],Jv(i)),e}function JP(n){const e={},t=l(n,["speakerVoiceConfigs"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>KP(r))),u(e,["speakerVoiceConfigs"],i)}return e}function YP(n){const e={},t=l(n,["voiceConfig"]);t!=null&&u(e,["voiceConfig"],Jv(t));const i=l(n,["multiSpeakerVoiceConfig"]);i!=null&&u(e,["multiSpeakerVoiceConfig"],JP(i));const r=l(n,["languageCode"]);return r!=null&&u(e,["languageCode"],r),e}function XP(n){const e={},t=l(n,["includeThoughts"]);t!=null&&u(e,["includeThoughts"],t);const i=l(n,["thinkingBudget"]);return i!=null&&u(e,["thinkingBudget"],i),e}function QP(n,e,t){const i={},r=l(e,["systemInstruction"]);t!==void 0&&r!=null&&u(t,["systemInstruction"],Kv(nt(r)));const s=l(e,["temperature"]);s!=null&&u(i,["temperature"],s);const o=l(e,["topP"]);o!=null&&u(i,["topP"],o);const a=l(e,["topK"]);a!=null&&u(i,["topK"],a);const c=l(e,["candidateCount"]);c!=null&&u(i,["candidateCount"],c);const d=l(e,["maxOutputTokens"]);d!=null&&u(i,["maxOutputTokens"],d);const h=l(e,["stopSequences"]);h!=null&&u(i,["stopSequences"],h);const p=l(e,["responseLogprobs"]);p!=null&&u(i,["responseLogprobs"],p);const g=l(e,["logprobs"]);g!=null&&u(i,["logprobs"],g);const _=l(e,["presencePenalty"]);_!=null&&u(i,["presencePenalty"],_);const C=l(e,["frequencyPenalty"]);C!=null&&u(i,["frequencyPenalty"],C);const P=l(e,["seed"]);P!=null&&u(i,["seed"],P);const x=l(e,["responseMimeType"]);x!=null&&u(i,["responseMimeType"],x);const F=l(e,["responseSchema"]);F!=null&&u(i,["responseSchema"],DP(Ys(F)));const L=l(e,["responseJsonSchema"]);if(L!=null&&u(i,["responseJsonSchema"],L),l(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(l(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const V=l(e,["safetySettings"]);if(t!==void 0&&V!=null){let w=V;Array.isArray(w)&&(w=w.map(k=>NP(k))),u(t,["safetySettings"],w)}const O=l(e,["tools"]);if(t!==void 0&&O!=null){let w=Br(O);Array.isArray(w)&&(w=w.map(k=>qP(Or(k)))),u(t,["tools"],w)}const U=l(e,["toolConfig"]);if(t!==void 0&&U!=null&&u(t,["toolConfig"],zP(U)),l(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const q=l(e,["cachedContent"]);t!==void 0&&q!=null&&u(t,["cachedContent"],pn(n,q));const I=l(e,["responseModalities"]);I!=null&&u(i,["responseModalities"],I);const T=l(e,["mediaResolution"]);T!=null&&u(i,["mediaResolution"],T);const E=l(e,["speechConfig"]);if(E!=null&&u(i,["speechConfig"],YP(Rd(E))),l(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const R=l(e,["thinkingConfig"]);return R!=null&&u(i,["thinkingConfig"],XP(R)),i}function ZP(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["request","model"],Te(n,i));const r=l(e,["contents"]);if(r!=null){let o=St(r);Array.isArray(o)&&(o=o.map(a=>Kv(a))),u(t,["request","contents"],o)}const s=l(e,["config"]);return s!=null&&u(t,["request","generationConfig"],QP(n,s,t)),t}function jP(n,e){const t={};if(l(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(l(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(l(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const i=l(e,["fileName"]);i!=null&&u(t,["fileName"],i);const r=l(e,["inlinedRequests"]);if(r!=null){let s=r;Array.isArray(s)&&(s=s.map(o=>ZP(n,o))),u(t,["requests","requests"],s)}return t}function ex(n,e){const t={},i=l(n,["displayName"]);if(e!==void 0&&i!=null&&u(e,["batch","displayName"],i),l(n,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function tx(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["_url","model"],Te(n,i));const r=l(e,["src"]);r!=null&&u(t,["batch","inputConfig"],jP(n,zv(n,r)));const s=l(e,["config"]);return s!=null&&u(t,["config"],ex(s,t)),t}function nx(n,e){const t={},i=l(e,["name"]);i!=null&&u(t,["_url","name"],Sl(n,i));const r=l(e,["config"]);return r!=null&&u(t,["config"],r),t}function ix(n,e){const t={},i=l(e,["name"]);i!=null&&u(t,["_url","name"],Sl(n,i));const r=l(e,["config"]);return r!=null&&u(t,["config"],r),t}function rx(n,e){const t={},i=l(n,["pageSize"]);e!==void 0&&i!=null&&u(e,["_query","pageSize"],i);const r=l(n,["pageToken"]);if(e!==void 0&&r!=null&&u(e,["_query","pageToken"],r),l(n,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function sx(n){const e={},t=l(n,["config"]);return t!=null&&u(e,["config"],rx(t,e)),e}function ox(n){const e={},t=l(n,["format"]);t!=null&&u(e,["instancesFormat"],t);const i=l(n,["gcsUri"]);i!=null&&u(e,["gcsSource","uris"],i);const r=l(n,["bigqueryUri"]);if(r!=null&&u(e,["bigquerySource","inputUri"],r),l(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(l(n,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function ax(n){const e={},t=l(n,["format"]);t!=null&&u(e,["predictionsFormat"],t);const i=l(n,["gcsUri"]);i!=null&&u(e,["gcsDestination","outputUriPrefix"],i);const r=l(n,["bigqueryUri"]);if(r!=null&&u(e,["bigqueryDestination","outputUri"],r),l(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(l(n,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");return e}function lx(n,e){const t={},i=l(n,["displayName"]);e!==void 0&&i!=null&&u(e,["displayName"],i);const r=l(n,["dest"]);return e!==void 0&&r!=null&&u(e,["outputConfig"],ax(PP(r))),t}function ux(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["model"],Te(n,i));const r=l(e,["src"]);r!=null&&u(t,["inputConfig"],ox(zv(n,r)));const s=l(e,["config"]);return s!=null&&u(t,["config"],lx(s,t)),t}function cx(n,e){const t={},i=l(e,["name"]);i!=null&&u(t,["_url","name"],Sl(n,i));const r=l(e,["config"]);return r!=null&&u(t,["config"],r),t}function dx(n,e){const t={},i=l(e,["name"]);i!=null&&u(t,["_url","name"],Sl(n,i));const r=l(e,["config"]);return r!=null&&u(t,["config"],r),t}function fx(n,e){const t={},i=l(n,["pageSize"]);e!==void 0&&i!=null&&u(e,["_query","pageSize"],i);const r=l(n,["pageToken"]);e!==void 0&&r!=null&&u(e,["_query","pageToken"],r);const s=l(n,["filter"]);return e!==void 0&&s!=null&&u(e,["_query","filter"],s),t}function hx(n){const e={},t=l(n,["config"]);return t!=null&&u(e,["config"],fx(t,e)),e}function px(){return{}}function mx(n){const e={},t=l(n,["fps"]);t!=null&&u(e,["fps"],t);const i=l(n,["endOffset"]);i!=null&&u(e,["endOffset"],i);const r=l(n,["startOffset"]);return r!=null&&u(e,["startOffset"],r),e}function gx(n){const e={},t=l(n,["data"]);t!=null&&u(e,["data"],t);const i=l(n,["mimeType"]);return i!=null&&u(e,["mimeType"],i),e}function yx(n){const e={},t=l(n,["fileUri"]);t!=null&&u(e,["fileUri"],t);const i=l(n,["mimeType"]);return i!=null&&u(e,["mimeType"],i),e}function _x(n){const e={},t=l(n,["videoMetadata"]);t!=null&&u(e,["videoMetadata"],mx(t));const i=l(n,["thought"]);i!=null&&u(e,["thought"],i);const r=l(n,["inlineData"]);r!=null&&u(e,["inlineData"],gx(r));const s=l(n,["fileData"]);s!=null&&u(e,["fileData"],yx(s));const o=l(n,["thoughtSignature"]);o!=null&&u(e,["thoughtSignature"],o);const a=l(n,["codeExecutionResult"]);a!=null&&u(e,["codeExecutionResult"],a);const c=l(n,["executableCode"]);c!=null&&u(e,["executableCode"],c);const d=l(n,["functionCall"]);d!=null&&u(e,["functionCall"],d);const h=l(n,["functionResponse"]);h!=null&&u(e,["functionResponse"],h);const p=l(n,["text"]);return p!=null&&u(e,["text"],p),e}function vx(n){const e={},t=l(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(s=>_x(s))),u(e,["parts"],r)}const i=l(n,["role"]);return i!=null&&u(e,["role"],i),e}function Tx(n){const e={},t=l(n,["citationSources"]);return t!=null&&u(e,["citations"],t),e}function Ex(n){const e={},t=l(n,["retrievedUrl"]);t!=null&&u(e,["retrievedUrl"],t);const i=l(n,["urlRetrievalStatus"]);return i!=null&&u(e,["urlRetrievalStatus"],i),e}function Ix(n){const e={},t=l(n,["urlMetadata"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>Ex(r))),u(e,["urlMetadata"],i)}return e}function Cx(n){const e={},t=l(n,["content"]);t!=null&&u(e,["content"],vx(t));const i=l(n,["citationMetadata"]);i!=null&&u(e,["citationMetadata"],Tx(i));const r=l(n,["tokenCount"]);r!=null&&u(e,["tokenCount"],r);const s=l(n,["finishReason"]);s!=null&&u(e,["finishReason"],s);const o=l(n,["urlContextMetadata"]);o!=null&&u(e,["urlContextMetadata"],Ix(o));const a=l(n,["avgLogprobs"]);a!=null&&u(e,["avgLogprobs"],a);const c=l(n,["groundingMetadata"]);c!=null&&u(e,["groundingMetadata"],c);const d=l(n,["index"]);d!=null&&u(e,["index"],d);const h=l(n,["logprobsResult"]);h!=null&&u(e,["logprobsResult"],h);const p=l(n,["safetyRatings"]);return p!=null&&u(e,["safetyRatings"],p),e}function wx(n){const e={},t=l(n,["candidates"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(a=>Cx(a))),u(e,["candidates"],o)}const i=l(n,["modelVersion"]);i!=null&&u(e,["modelVersion"],i);const r=l(n,["promptFeedback"]);r!=null&&u(e,["promptFeedback"],r);const s=l(n,["usageMetadata"]);return s!=null&&u(e,["usageMetadata"],s),e}function Ax(n){const e={},t=l(n,["response"]);return t!=null&&u(e,["response"],wx(t)),l(n,["error"])!=null&&u(e,["error"],px()),e}function Sx(n){const e={},t=l(n,["responsesFile"]);t!=null&&u(e,["fileName"],t);const i=l(n,["inlinedResponses","inlinedResponses"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(s=>Ax(s))),u(e,["inlinedResponses"],r)}return e}function dc(n){const e={},t=l(n,["name"]);t!=null&&u(e,["name"],t);const i=l(n,["metadata","displayName"]);i!=null&&u(e,["displayName"],i);const r=l(n,["metadata","state"]);r!=null&&u(e,["state"],Wv(r));const s=l(n,["metadata","createTime"]);s!=null&&u(e,["createTime"],s);const o=l(n,["metadata","endTime"]);o!=null&&u(e,["endTime"],o);const a=l(n,["metadata","updateTime"]);a!=null&&u(e,["updateTime"],a);const c=l(n,["metadata","model"]);c!=null&&u(e,["model"],c);const d=l(n,["metadata","output"]);return d!=null&&u(e,["dest"],Sx(d)),e}function Rx(n){const e={},t=l(n,["nextPageToken"]);t!=null&&u(e,["nextPageToken"],t);const i=l(n,["operations"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(s=>dc(s))),u(e,["batchJobs"],r)}return e}function Px(n){const e={},t=l(n,["details"]);t!=null&&u(e,["details"],t);const i=l(n,["code"]);i!=null&&u(e,["code"],i);const r=l(n,["message"]);return r!=null&&u(e,["message"],r),e}function xx(n){const e={},t=l(n,["instancesFormat"]);t!=null&&u(e,["format"],t);const i=l(n,["gcsSource","uris"]);i!=null&&u(e,["gcsUri"],i);const r=l(n,["bigquerySource","inputUri"]);return r!=null&&u(e,["bigqueryUri"],r),e}function kx(n){const e={},t=l(n,["predictionsFormat"]);t!=null&&u(e,["format"],t);const i=l(n,["gcsDestination","outputUriPrefix"]);i!=null&&u(e,["gcsUri"],i);const r=l(n,["bigqueryDestination","outputUri"]);return r!=null&&u(e,["bigqueryUri"],r),e}function fc(n){const e={},t=l(n,["name"]);t!=null&&u(e,["name"],t);const i=l(n,["displayName"]);i!=null&&u(e,["displayName"],i);const r=l(n,["state"]);r!=null&&u(e,["state"],Wv(r));const s=l(n,["error"]);s!=null&&u(e,["error"],Px(s));const o=l(n,["createTime"]);o!=null&&u(e,["createTime"],o);const a=l(n,["startTime"]);a!=null&&u(e,["startTime"],a);const c=l(n,["endTime"]);c!=null&&u(e,["endTime"],c);const d=l(n,["updateTime"]);d!=null&&u(e,["updateTime"],d);const h=l(n,["model"]);h!=null&&u(e,["model"],h);const p=l(n,["inputConfig"]);p!=null&&u(e,["src"],xx(p));const g=l(n,["outputConfig"]);return g!=null&&u(e,["dest"],kx(g)),e}function bx(n){const e={},t=l(n,["nextPageToken"]);t!=null&&u(e,["nextPageToken"],t);const i=l(n,["batchPredictionJobs"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(s=>fc(s))),u(e,["batchJobs"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var bi;(function(n){n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(bi||(bi={}));class vo{constructor(e,t,i,r){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,i,r)}init(e,t,i){var r,s;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.idxInternal=0;let o={config:{}};i?typeof i=="object"?o=Object.assign({},i):o=i:o={config:{}},o.config&&(o.config.pageToken=t.nextPageToken),this.paramsInternal=o,this.pageInternalSize=(s=(r=o.config)===null||r===void 0?void 0:r.pageSize)!==null&&s!==void 0?s:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Mx extends Fi{constructor(e){super(),this.apiClient=e,this.create=async t=>{if(this.apiClient.isVertexAI()){if(Array.isArray(t.src))throw new Error("InlinedRequest[] is not supported in Vertex AI. Please use Google Cloud Storage URI or BigQuery URI instead.");if(t.config=t.config||{},t.config.displayName===void 0&&(t.config.displayName="genaiBatchJob_"),t.config.dest===void 0&&typeof t.src=="string")if(t.src.startsWith("gs://")&&t.src.endsWith(".jsonl"))t.config.dest=`${t.src.slice(0,-6)}/dest`;else if(t.src.startsWith("bq://"))t.config.dest=`${t.src}_dest_`;else throw new Error("Unsupported source:"+t.src)}return await this.createInternal(t)},this.list=async(t={})=>new vo(bi.PAGED_ITEM_BATCH_JOBS,i=>this.listInternal(i),await this.listInternal(t),t)}async createInternal(e){var t,i,r,s;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=ux(this.apiClient,e);return a=Z("batchPredictionJobs",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>fc(h))}else{const d=tx(this.apiClient,e);return a=Z("{model}:batchGenerateContent",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>dc(h))}}async get(e){var t,i,r,s;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=cx(this.apiClient,e);return a=Z("batchPredictionJobs/{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>fc(h))}else{const d=nx(this.apiClient,e);return a=Z("batches/{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>dc(h))}}async cancel(e){var t,i,r,s;let o="",a={};if(this.apiClient.isVertexAI()){const c=dx(this.apiClient,e);o=Z("batchPredictionJobs/{name}:cancel",c._url),a=c._query,delete c.config,delete c._url,delete c._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}else{const c=ix(this.apiClient,e);o=Z("batches/{name}:cancel",c._url),a=c._query,delete c.config,delete c._url,delete c._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var t,i,r,s;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=hx(e);return a=Z("batchPredictionJobs",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>{const p=bx(h),g=new qm;return Object.assign(g,p),g})}else{const d=sx(e);return a=Z("batches",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>{const p=Rx(h),g=new qm;return Object.assign(g,p),g})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Dx(n){const e={},t=l(n,["fps"]);t!=null&&u(e,["fps"],t);const i=l(n,["endOffset"]);i!=null&&u(e,["endOffset"],i);const r=l(n,["startOffset"]);return r!=null&&u(e,["startOffset"],r),e}function Nx(n){const e={};if(l(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=l(n,["data"]);t!=null&&u(e,["data"],t);const i=l(n,["mimeType"]);return i!=null&&u(e,["mimeType"],i),e}function Vx(n){const e={};if(l(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=l(n,["fileUri"]);t!=null&&u(e,["fileUri"],t);const i=l(n,["mimeType"]);return i!=null&&u(e,["mimeType"],i),e}function Lx(n){const e={},t=l(n,["videoMetadata"]);t!=null&&u(e,["videoMetadata"],Dx(t));const i=l(n,["thought"]);i!=null&&u(e,["thought"],i);const r=l(n,["inlineData"]);r!=null&&u(e,["inlineData"],Nx(r));const s=l(n,["fileData"]);s!=null&&u(e,["fileData"],Vx(s));const o=l(n,["thoughtSignature"]);o!=null&&u(e,["thoughtSignature"],o);const a=l(n,["codeExecutionResult"]);a!=null&&u(e,["codeExecutionResult"],a);const c=l(n,["executableCode"]);c!=null&&u(e,["executableCode"],c);const d=l(n,["functionCall"]);d!=null&&u(e,["functionCall"],d);const h=l(n,["functionResponse"]);h!=null&&u(e,["functionResponse"],h);const p=l(n,["text"]);return p!=null&&u(e,["text"],p),e}function Wm(n){const e={},t=l(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(s=>Lx(s))),u(e,["parts"],r)}const i=l(n,["role"]);return i!=null&&u(e,["role"],i),e}function Fx(n){const e={},t=l(n,["behavior"]);t!=null&&u(e,["behavior"],t);const i=l(n,["description"]);i!=null&&u(e,["description"],i);const r=l(n,["name"]);r!=null&&u(e,["name"],r);const s=l(n,["parameters"]);s!=null&&u(e,["parameters"],s);const o=l(n,["parametersJsonSchema"]);o!=null&&u(e,["parametersJsonSchema"],o);const a=l(n,["response"]);a!=null&&u(e,["response"],a);const c=l(n,["responseJsonSchema"]);return c!=null&&u(e,["responseJsonSchema"],c),e}function Ux(n){const e={},t=l(n,["startTime"]);t!=null&&u(e,["startTime"],t);const i=l(n,["endTime"]);return i!=null&&u(e,["endTime"],i),e}function Ox(n){const e={},t=l(n,["timeRangeFilter"]);return t!=null&&u(e,["timeRangeFilter"],Ux(t)),e}function Bx(n){const e={},t=l(n,["mode"]);t!=null&&u(e,["mode"],t);const i=l(n,["dynamicThreshold"]);return i!=null&&u(e,["dynamicThreshold"],i),e}function qx(n){const e={},t=l(n,["dynamicRetrievalConfig"]);return t!=null&&u(e,["dynamicRetrievalConfig"],Bx(t)),e}function $x(){return{}}function Gx(n){const e={},t=l(n,["functionDeclarations"]);if(t!=null){let a=t;Array.isArray(a)&&(a=a.map(c=>Fx(c))),u(e,["functionDeclarations"],a)}if(l(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=l(n,["googleSearch"]);i!=null&&u(e,["googleSearch"],Ox(i));const r=l(n,["googleSearchRetrieval"]);if(r!=null&&u(e,["googleSearchRetrieval"],qx(r)),l(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(l(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");l(n,["urlContext"])!=null&&u(e,["urlContext"],$x());const o=l(n,["codeExecution"]);return o!=null&&u(e,["codeExecution"],o),e}function Hx(n){const e={},t=l(n,["mode"]);t!=null&&u(e,["mode"],t);const i=l(n,["allowedFunctionNames"]);return i!=null&&u(e,["allowedFunctionNames"],i),e}function zx(n){const e={},t=l(n,["latitude"]);t!=null&&u(e,["latitude"],t);const i=l(n,["longitude"]);return i!=null&&u(e,["longitude"],i),e}function Wx(n){const e={},t=l(n,["latLng"]);t!=null&&u(e,["latLng"],zx(t));const i=l(n,["languageCode"]);return i!=null&&u(e,["languageCode"],i),e}function Kx(n){const e={},t=l(n,["functionCallingConfig"]);t!=null&&u(e,["functionCallingConfig"],Hx(t));const i=l(n,["retrievalConfig"]);return i!=null&&u(e,["retrievalConfig"],Wx(i)),e}function Jx(n,e){const t={},i=l(n,["ttl"]);e!==void 0&&i!=null&&u(e,["ttl"],i);const r=l(n,["expireTime"]);e!==void 0&&r!=null&&u(e,["expireTime"],r);const s=l(n,["displayName"]);e!==void 0&&s!=null&&u(e,["displayName"],s);const o=l(n,["contents"]);if(e!==void 0&&o!=null){let h=St(o);Array.isArray(h)&&(h=h.map(p=>Wm(p))),u(e,["contents"],h)}const a=l(n,["systemInstruction"]);e!==void 0&&a!=null&&u(e,["systemInstruction"],Wm(nt(a)));const c=l(n,["tools"]);if(e!==void 0&&c!=null){let h=c;Array.isArray(h)&&(h=h.map(p=>Gx(p))),u(e,["tools"],h)}const d=l(n,["toolConfig"]);if(e!==void 0&&d!=null&&u(e,["toolConfig"],Kx(d)),l(n,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function Yx(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["model"],Fv(n,i));const r=l(e,["config"]);return r!=null&&u(t,["config"],Jx(r,t)),t}function Xx(n,e){const t={},i=l(e,["name"]);i!=null&&u(t,["_url","name"],pn(n,i));const r=l(e,["config"]);return r!=null&&u(t,["config"],r),t}function Qx(n,e){const t={},i=l(e,["name"]);i!=null&&u(t,["_url","name"],pn(n,i));const r=l(e,["config"]);return r!=null&&u(t,["config"],r),t}function Zx(n,e){const t={},i=l(n,["ttl"]);e!==void 0&&i!=null&&u(e,["ttl"],i);const r=l(n,["expireTime"]);return e!==void 0&&r!=null&&u(e,["expireTime"],r),t}function jx(n,e){const t={},i=l(e,["name"]);i!=null&&u(t,["_url","name"],pn(n,i));const r=l(e,["config"]);return r!=null&&u(t,["config"],Zx(r,t)),t}function ek(n,e){const t={},i=l(n,["pageSize"]);e!==void 0&&i!=null&&u(e,["_query","pageSize"],i);const r=l(n,["pageToken"]);return e!==void 0&&r!=null&&u(e,["_query","pageToken"],r),t}function tk(n){const e={},t=l(n,["config"]);return t!=null&&u(e,["config"],ek(t,e)),e}function nk(n){const e={},t=l(n,["fps"]);t!=null&&u(e,["fps"],t);const i=l(n,["endOffset"]);i!=null&&u(e,["endOffset"],i);const r=l(n,["startOffset"]);return r!=null&&u(e,["startOffset"],r),e}function ik(n){const e={},t=l(n,["displayName"]);t!=null&&u(e,["displayName"],t);const i=l(n,["data"]);i!=null&&u(e,["data"],i);const r=l(n,["mimeType"]);return r!=null&&u(e,["mimeType"],r),e}function rk(n){const e={},t=l(n,["displayName"]);t!=null&&u(e,["displayName"],t);const i=l(n,["fileUri"]);i!=null&&u(e,["fileUri"],i);const r=l(n,["mimeType"]);return r!=null&&u(e,["mimeType"],r),e}function sk(n){const e={},t=l(n,["videoMetadata"]);t!=null&&u(e,["videoMetadata"],nk(t));const i=l(n,["thought"]);i!=null&&u(e,["thought"],i);const r=l(n,["inlineData"]);r!=null&&u(e,["inlineData"],ik(r));const s=l(n,["fileData"]);s!=null&&u(e,["fileData"],rk(s));const o=l(n,["thoughtSignature"]);o!=null&&u(e,["thoughtSignature"],o);const a=l(n,["codeExecutionResult"]);a!=null&&u(e,["codeExecutionResult"],a);const c=l(n,["executableCode"]);c!=null&&u(e,["executableCode"],c);const d=l(n,["functionCall"]);d!=null&&u(e,["functionCall"],d);const h=l(n,["functionResponse"]);h!=null&&u(e,["functionResponse"],h);const p=l(n,["text"]);return p!=null&&u(e,["text"],p),e}function Km(n){const e={},t=l(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(s=>sk(s))),u(e,["parts"],r)}const i=l(n,["role"]);return i!=null&&u(e,["role"],i),e}function ok(n){const e={};if(l(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=l(n,["description"]);t!=null&&u(e,["description"],t);const i=l(n,["name"]);i!=null&&u(e,["name"],i);const r=l(n,["parameters"]);r!=null&&u(e,["parameters"],r);const s=l(n,["parametersJsonSchema"]);s!=null&&u(e,["parametersJsonSchema"],s);const o=l(n,["response"]);o!=null&&u(e,["response"],o);const a=l(n,["responseJsonSchema"]);return a!=null&&u(e,["responseJsonSchema"],a),e}function ak(n){const e={},t=l(n,["startTime"]);t!=null&&u(e,["startTime"],t);const i=l(n,["endTime"]);return i!=null&&u(e,["endTime"],i),e}function lk(n){const e={},t=l(n,["timeRangeFilter"]);return t!=null&&u(e,["timeRangeFilter"],ak(t)),e}function uk(n){const e={},t=l(n,["mode"]);t!=null&&u(e,["mode"],t);const i=l(n,["dynamicThreshold"]);return i!=null&&u(e,["dynamicThreshold"],i),e}function ck(n){const e={},t=l(n,["dynamicRetrievalConfig"]);return t!=null&&u(e,["dynamicRetrievalConfig"],uk(t)),e}function dk(){return{}}function fk(n){const e={},t=l(n,["apiKeyString"]);return t!=null&&u(e,["apiKeyString"],t),e}function hk(n){const e={},t=l(n,["apiKeyConfig"]);t!=null&&u(e,["apiKeyConfig"],fk(t));const i=l(n,["authType"]);i!=null&&u(e,["authType"],i);const r=l(n,["googleServiceAccountConfig"]);r!=null&&u(e,["googleServiceAccountConfig"],r);const s=l(n,["httpBasicAuthConfig"]);s!=null&&u(e,["httpBasicAuthConfig"],s);const o=l(n,["oauthConfig"]);o!=null&&u(e,["oauthConfig"],o);const a=l(n,["oidcConfig"]);return a!=null&&u(e,["oidcConfig"],a),e}function pk(n){const e={},t=l(n,["authConfig"]);return t!=null&&u(e,["authConfig"],hk(t)),e}function mk(){return{}}function gk(n){const e={},t=l(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(p=>ok(p))),u(e,["functionDeclarations"],h)}const i=l(n,["retrieval"]);i!=null&&u(e,["retrieval"],i);const r=l(n,["googleSearch"]);r!=null&&u(e,["googleSearch"],lk(r));const s=l(n,["googleSearchRetrieval"]);s!=null&&u(e,["googleSearchRetrieval"],ck(s)),l(n,["enterpriseWebSearch"])!=null&&u(e,["enterpriseWebSearch"],dk());const a=l(n,["googleMaps"]);a!=null&&u(e,["googleMaps"],pk(a)),l(n,["urlContext"])!=null&&u(e,["urlContext"],mk());const d=l(n,["codeExecution"]);return d!=null&&u(e,["codeExecution"],d),e}function yk(n){const e={},t=l(n,["mode"]);t!=null&&u(e,["mode"],t);const i=l(n,["allowedFunctionNames"]);return i!=null&&u(e,["allowedFunctionNames"],i),e}function _k(n){const e={},t=l(n,["latitude"]);t!=null&&u(e,["latitude"],t);const i=l(n,["longitude"]);return i!=null&&u(e,["longitude"],i),e}function vk(n){const e={},t=l(n,["latLng"]);t!=null&&u(e,["latLng"],_k(t));const i=l(n,["languageCode"]);return i!=null&&u(e,["languageCode"],i),e}function Tk(n){const e={},t=l(n,["functionCallingConfig"]);t!=null&&u(e,["functionCallingConfig"],yk(t));const i=l(n,["retrievalConfig"]);return i!=null&&u(e,["retrievalConfig"],vk(i)),e}function Ek(n,e){const t={},i=l(n,["ttl"]);e!==void 0&&i!=null&&u(e,["ttl"],i);const r=l(n,["expireTime"]);e!==void 0&&r!=null&&u(e,["expireTime"],r);const s=l(n,["displayName"]);e!==void 0&&s!=null&&u(e,["displayName"],s);const o=l(n,["contents"]);if(e!==void 0&&o!=null){let p=St(o);Array.isArray(p)&&(p=p.map(g=>Km(g))),u(e,["contents"],p)}const a=l(n,["systemInstruction"]);e!==void 0&&a!=null&&u(e,["systemInstruction"],Km(nt(a)));const c=l(n,["tools"]);if(e!==void 0&&c!=null){let p=c;Array.isArray(p)&&(p=p.map(g=>gk(g))),u(e,["tools"],p)}const d=l(n,["toolConfig"]);e!==void 0&&d!=null&&u(e,["toolConfig"],Tk(d));const h=l(n,["kmsKeyName"]);return e!==void 0&&h!=null&&u(e,["encryption_spec","kmsKeyName"],h),t}function Ik(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["model"],Fv(n,i));const r=l(e,["config"]);return r!=null&&u(t,["config"],Ek(r,t)),t}function Ck(n,e){const t={},i=l(e,["name"]);i!=null&&u(t,["_url","name"],pn(n,i));const r=l(e,["config"]);return r!=null&&u(t,["config"],r),t}function wk(n,e){const t={},i=l(e,["name"]);i!=null&&u(t,["_url","name"],pn(n,i));const r=l(e,["config"]);return r!=null&&u(t,["config"],r),t}function Ak(n,e){const t={},i=l(n,["ttl"]);e!==void 0&&i!=null&&u(e,["ttl"],i);const r=l(n,["expireTime"]);return e!==void 0&&r!=null&&u(e,["expireTime"],r),t}function Sk(n,e){const t={},i=l(e,["name"]);i!=null&&u(t,["_url","name"],pn(n,i));const r=l(e,["config"]);return r!=null&&u(t,["config"],Ak(r,t)),t}function Rk(n,e){const t={},i=l(n,["pageSize"]);e!==void 0&&i!=null&&u(e,["_query","pageSize"],i);const r=l(n,["pageToken"]);return e!==void 0&&r!=null&&u(e,["_query","pageToken"],r),t}function Pk(n){const e={},t=l(n,["config"]);return t!=null&&u(e,["config"],Rk(t,e)),e}function da(n){const e={},t=l(n,["name"]);t!=null&&u(e,["name"],t);const i=l(n,["displayName"]);i!=null&&u(e,["displayName"],i);const r=l(n,["model"]);r!=null&&u(e,["model"],r);const s=l(n,["createTime"]);s!=null&&u(e,["createTime"],s);const o=l(n,["updateTime"]);o!=null&&u(e,["updateTime"],o);const a=l(n,["expireTime"]);a!=null&&u(e,["expireTime"],a);const c=l(n,["usageMetadata"]);return c!=null&&u(e,["usageMetadata"],c),e}function xk(){return{}}function kk(n){const e={},t=l(n,["nextPageToken"]);t!=null&&u(e,["nextPageToken"],t);const i=l(n,["cachedContents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(s=>da(s))),u(e,["cachedContents"],r)}return e}function fa(n){const e={},t=l(n,["name"]);t!=null&&u(e,["name"],t);const i=l(n,["displayName"]);i!=null&&u(e,["displayName"],i);const r=l(n,["model"]);r!=null&&u(e,["model"],r);const s=l(n,["createTime"]);s!=null&&u(e,["createTime"],s);const o=l(n,["updateTime"]);o!=null&&u(e,["updateTime"],o);const a=l(n,["expireTime"]);a!=null&&u(e,["expireTime"],a);const c=l(n,["usageMetadata"]);return c!=null&&u(e,["usageMetadata"],c),e}function bk(){return{}}function Mk(n){const e={},t=l(n,["nextPageToken"]);t!=null&&u(e,["nextPageToken"],t);const i=l(n,["cachedContents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(s=>fa(s))),u(e,["cachedContents"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Dk extends Fi{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new vo(bi.PAGED_ITEM_CACHED_CONTENTS,i=>this.listInternal(i),await this.listInternal(t),t)}async create(e){var t,i,r,s;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=Ik(this.apiClient,e);return a=Z("cachedContents",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>fa(h))}else{const d=Yx(this.apiClient,e);return a=Z("cachedContents",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>da(h))}}async get(e){var t,i,r,s;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=Ck(this.apiClient,e);return a=Z("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>fa(h))}else{const d=Xx(this.apiClient,e);return a=Z("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>da(h))}}async delete(e){var t,i,r,s;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=wk(this.apiClient,e);return a=Z("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(()=>{const h=bk(),p=new Om;return Object.assign(p,h),p})}else{const d=Qx(this.apiClient,e);return a=Z("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(()=>{const h=xk(),p=new Om;return Object.assign(p,h),p})}}async update(e){var t,i,r,s;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=Sk(this.apiClient,e);return a=Z("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>fa(h))}else{const d=jx(this.apiClient,e);return a=Z("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>da(h))}}async listInternal(e){var t,i,r,s;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=Pk(e);return a=Z("cachedContents",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>{const p=Mk(h),g=new Bm;return Object.assign(g,p),g})}else{const d=tk(e);return a=Z("cachedContents",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>{const p=kk(h),g=new Bm;return Object.assign(g,p),g})}}}function Jm(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function we(n){return this instanceof we?(this.v=n,this):new we(n)}function ur(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),r,s=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),r[Symbol.asyncIterator]=function(){return this},r;function o(_){return function(C){return Promise.resolve(C).then(_,p)}}function a(_,C){i[_]&&(r[_]=function(P){return new Promise(function(x,F){s.push([_,P,x,F])>1||c(_,P)})},C&&(r[_]=C(r[_])))}function c(_,C){try{d(i[_](C))}catch(P){g(s[0][3],P)}}function d(_){_.value instanceof we?Promise.resolve(_.value.v).then(h,p):g(s[0][2],_)}function h(_){c("next",_)}function p(_){c("throw",_)}function g(_,C){_(C),s.shift(),s.length&&c(s[0][0],s[0][1])}}function ks(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof Jm=="function"?Jm(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=n[s]&&function(o){return new Promise(function(a,c){o=n[s](o),r(a,c,o.done,o.value)})}}function r(s,o,a,c){Promise.resolve(c).then(function(d){s({value:d,done:a})},o)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Nk(n){var e;if(n.candidates==null||n.candidates.length===0)return!1;const t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:Yv(t)}function Yv(n){if(n.parts===void 0||n.parts.length===0)return!1;for(const e of n.parts)if(e===void 0||Object.keys(e).length===0||!e.thought&&e.text!==void 0&&e.text==="")return!1;return!0}function Vk(n){if(n.length!==0){for(const e of n)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function Ym(n){if(n===void 0||n.length===0)return[];const e=[],t=n.length;let i=0;for(;i<t;)if(n[i].role==="user")e.push(n[i]),i++;else{const r=[];let s=!0;for(;i<t&&n[i].role==="model";)r.push(n[i]),s&&!Yv(n[i])&&(s=!1),i++;s?e.push(...r):e.pop()}return e}class Lk{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new Fk(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class Fk{constructor(e,t,i,r={},s=[]){this.apiClient=e,this.modelsModule=t,this.model=i,this.config=r,this.history=s,this.sendPromise=Promise.resolve(),Vk(s)}async sendMessage(e){var t;await this.sendPromise;const i=nt(e.message),r=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(i),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var s,o,a;const c=await r,d=(o=(s=c.candidates)===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.content,h=c.automaticFunctionCallingHistory,p=this.getHistory(!0).length;let g=[];h!=null&&(g=(a=h.slice(p))!==null&&a!==void 0?a:[]);const _=d?[d]:[];this.recordHistory(i,_,g)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),r}async sendMessageStream(e){var t;await this.sendPromise;const i=nt(e.message),r=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(i),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=r.then(()=>{}).catch(()=>{});const s=await r;return this.processStreamResponse(s,i)}getHistory(e=!1){const t=e?Ym(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){var i,r;return ur(this,arguments,function*(){var o,a,c,d;const h=[];try{for(var p=!0,g=ks(e),_;_=yield we(g.next()),o=_.done,!o;p=!0){d=_.value,p=!1;const C=d;if(Nk(C)){const P=(r=(i=C.candidates)===null||i===void 0?void 0:i[0])===null||r===void 0?void 0:r.content;P!==void 0&&h.push(P)}yield yield we(C)}}catch(C){a={error:C}}finally{try{!p&&!o&&(c=g.return)&&(yield we(c.call(g)))}finally{if(a)throw a.error}}this.recordHistory(t,h)})}recordHistory(e,t,i){let r=[];t.length>0&&t.every(s=>s.role!==void 0)?r=t:r.push({role:"model",parts:[]}),i&&i.length>0?this.history.push(...Ym(i)):this.history.push(e),this.history.push(...r)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Rl extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Rl.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Uk(n,e){const t={},i=l(n,["pageSize"]);e!==void 0&&i!=null&&u(e,["_query","pageSize"],i);const r=l(n,["pageToken"]);return e!==void 0&&r!=null&&u(e,["_query","pageToken"],r),t}function Ok(n){const e={},t=l(n,["config"]);return t!=null&&u(e,["config"],Uk(t,e)),e}function Bk(n){const e={},t=l(n,["details"]);t!=null&&u(e,["details"],t);const i=l(n,["message"]);i!=null&&u(e,["message"],i);const r=l(n,["code"]);return r!=null&&u(e,["code"],r),e}function qk(n){const e={},t=l(n,["name"]);t!=null&&u(e,["name"],t);const i=l(n,["displayName"]);i!=null&&u(e,["displayName"],i);const r=l(n,["mimeType"]);r!=null&&u(e,["mimeType"],r);const s=l(n,["sizeBytes"]);s!=null&&u(e,["sizeBytes"],s);const o=l(n,["createTime"]);o!=null&&u(e,["createTime"],o);const a=l(n,["expirationTime"]);a!=null&&u(e,["expirationTime"],a);const c=l(n,["updateTime"]);c!=null&&u(e,["updateTime"],c);const d=l(n,["sha256Hash"]);d!=null&&u(e,["sha256Hash"],d);const h=l(n,["uri"]);h!=null&&u(e,["uri"],h);const p=l(n,["downloadUri"]);p!=null&&u(e,["downloadUri"],p);const g=l(n,["state"]);g!=null&&u(e,["state"],g);const _=l(n,["source"]);_!=null&&u(e,["source"],_);const C=l(n,["videoMetadata"]);C!=null&&u(e,["videoMetadata"],C);const P=l(n,["error"]);return P!=null&&u(e,["error"],Bk(P)),e}function $k(n){const e={},t=l(n,["file"]);t!=null&&u(e,["file"],qk(t));const i=l(n,["config"]);return i!=null&&u(e,["config"],i),e}function Gk(n){const e={},t=l(n,["name"]);t!=null&&u(e,["_url","file"],$v(t));const i=l(n,["config"]);return i!=null&&u(e,["config"],i),e}function Hk(n){const e={},t=l(n,["name"]);t!=null&&u(e,["_url","file"],$v(t));const i=l(n,["config"]);return i!=null&&u(e,["config"],i),e}function zk(n){const e={},t=l(n,["details"]);t!=null&&u(e,["details"],t);const i=l(n,["message"]);i!=null&&u(e,["message"],i);const r=l(n,["code"]);return r!=null&&u(e,["code"],r),e}function hc(n){const e={},t=l(n,["name"]);t!=null&&u(e,["name"],t);const i=l(n,["displayName"]);i!=null&&u(e,["displayName"],i);const r=l(n,["mimeType"]);r!=null&&u(e,["mimeType"],r);const s=l(n,["sizeBytes"]);s!=null&&u(e,["sizeBytes"],s);const o=l(n,["createTime"]);o!=null&&u(e,["createTime"],o);const a=l(n,["expirationTime"]);a!=null&&u(e,["expirationTime"],a);const c=l(n,["updateTime"]);c!=null&&u(e,["updateTime"],c);const d=l(n,["sha256Hash"]);d!=null&&u(e,["sha256Hash"],d);const h=l(n,["uri"]);h!=null&&u(e,["uri"],h);const p=l(n,["downloadUri"]);p!=null&&u(e,["downloadUri"],p);const g=l(n,["state"]);g!=null&&u(e,["state"],g);const _=l(n,["source"]);_!=null&&u(e,["source"],_);const C=l(n,["videoMetadata"]);C!=null&&u(e,["videoMetadata"],C);const P=l(n,["error"]);return P!=null&&u(e,["error"],zk(P)),e}function Wk(n){const e={},t=l(n,["nextPageToken"]);t!=null&&u(e,["nextPageToken"],t);const i=l(n,["files"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(s=>hc(s))),u(e,["files"],r)}return e}function Kk(){return{}}function Jk(){return{}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Yk extends Fi{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new vo(bi.PAGED_ITEM_FILES,i=>this.listInternal(i),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>hc(t))}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,i;let r,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=Ok(e);return s=Z("files",a._url),o=a._query,delete a.config,delete a._url,delete a._query,r=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>{const d=Wk(c),h=new lP;return Object.assign(h,d),h})}}async createInternal(e){var t,i;let r,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=$k(e);return s=Z("upload/v1beta/files",a._url),o=a._query,delete a.config,delete a._url,delete a._query,r=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(()=>{const c=Kk(),d=new uP;return Object.assign(d,c),d})}}async get(e){var t,i;let r,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=Gk(e);return s=Z("files/{file}",a._url),o=a._query,delete a.config,delete a._url,delete a._query,r=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>hc(c))}}async delete(e){var t,i;let r,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=Hk(e);return s=Z("files/{file}",a._url),o=a._query,delete a.config,delete a._url,delete a._query,r=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(()=>{const c=Jk(),d=new cP;return Object.assign(d,c),d})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Xk(n){const e={},t=l(n,["voiceName"]);return t!=null&&u(e,["voiceName"],t),e}function Qk(n){const e={},t=l(n,["voiceName"]);return t!=null&&u(e,["voiceName"],t),e}function Xv(n){const e={},t=l(n,["prebuiltVoiceConfig"]);return t!=null&&u(e,["prebuiltVoiceConfig"],Xk(t)),e}function Zk(n){const e={},t=l(n,["prebuiltVoiceConfig"]);return t!=null&&u(e,["prebuiltVoiceConfig"],Qk(t)),e}function jk(n){const e={},t=l(n,["speaker"]);t!=null&&u(e,["speaker"],t);const i=l(n,["voiceConfig"]);return i!=null&&u(e,["voiceConfig"],Xv(i)),e}function eb(n){const e={},t=l(n,["speakerVoiceConfigs"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>jk(r))),u(e,["speakerVoiceConfigs"],i)}return e}function tb(n){const e={},t=l(n,["voiceConfig"]);t!=null&&u(e,["voiceConfig"],Xv(t));const i=l(n,["multiSpeakerVoiceConfig"]);i!=null&&u(e,["multiSpeakerVoiceConfig"],eb(i));const r=l(n,["languageCode"]);return r!=null&&u(e,["languageCode"],r),e}function nb(n){const e={},t=l(n,["voiceConfig"]);if(t!=null&&u(e,["voiceConfig"],Zk(t)),l(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const i=l(n,["languageCode"]);return i!=null&&u(e,["languageCode"],i),e}function ib(n){const e={},t=l(n,["fps"]);t!=null&&u(e,["fps"],t);const i=l(n,["endOffset"]);i!=null&&u(e,["endOffset"],i);const r=l(n,["startOffset"]);return r!=null&&u(e,["startOffset"],r),e}function rb(n){const e={},t=l(n,["fps"]);t!=null&&u(e,["fps"],t);const i=l(n,["endOffset"]);i!=null&&u(e,["endOffset"],i);const r=l(n,["startOffset"]);return r!=null&&u(e,["startOffset"],r),e}function sb(n){const e={};if(l(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=l(n,["data"]);t!=null&&u(e,["data"],t);const i=l(n,["mimeType"]);return i!=null&&u(e,["mimeType"],i),e}function ob(n){const e={},t=l(n,["displayName"]);t!=null&&u(e,["displayName"],t);const i=l(n,["data"]);i!=null&&u(e,["data"],i);const r=l(n,["mimeType"]);return r!=null&&u(e,["mimeType"],r),e}function ab(n){const e={};if(l(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=l(n,["fileUri"]);t!=null&&u(e,["fileUri"],t);const i=l(n,["mimeType"]);return i!=null&&u(e,["mimeType"],i),e}function lb(n){const e={},t=l(n,["displayName"]);t!=null&&u(e,["displayName"],t);const i=l(n,["fileUri"]);i!=null&&u(e,["fileUri"],i);const r=l(n,["mimeType"]);return r!=null&&u(e,["mimeType"],r),e}function ub(n){const e={},t=l(n,["videoMetadata"]);t!=null&&u(e,["videoMetadata"],ib(t));const i=l(n,["thought"]);i!=null&&u(e,["thought"],i);const r=l(n,["inlineData"]);r!=null&&u(e,["inlineData"],sb(r));const s=l(n,["fileData"]);s!=null&&u(e,["fileData"],ab(s));const o=l(n,["thoughtSignature"]);o!=null&&u(e,["thoughtSignature"],o);const a=l(n,["codeExecutionResult"]);a!=null&&u(e,["codeExecutionResult"],a);const c=l(n,["executableCode"]);c!=null&&u(e,["executableCode"],c);const d=l(n,["functionCall"]);d!=null&&u(e,["functionCall"],d);const h=l(n,["functionResponse"]);h!=null&&u(e,["functionResponse"],h);const p=l(n,["text"]);return p!=null&&u(e,["text"],p),e}function cb(n){const e={},t=l(n,["videoMetadata"]);t!=null&&u(e,["videoMetadata"],rb(t));const i=l(n,["thought"]);i!=null&&u(e,["thought"],i);const r=l(n,["inlineData"]);r!=null&&u(e,["inlineData"],ob(r));const s=l(n,["fileData"]);s!=null&&u(e,["fileData"],lb(s));const o=l(n,["thoughtSignature"]);o!=null&&u(e,["thoughtSignature"],o);const a=l(n,["codeExecutionResult"]);a!=null&&u(e,["codeExecutionResult"],a);const c=l(n,["executableCode"]);c!=null&&u(e,["executableCode"],c);const d=l(n,["functionCall"]);d!=null&&u(e,["functionCall"],d);const h=l(n,["functionResponse"]);h!=null&&u(e,["functionResponse"],h);const p=l(n,["text"]);return p!=null&&u(e,["text"],p),e}function db(n){const e={},t=l(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(s=>ub(s))),u(e,["parts"],r)}const i=l(n,["role"]);return i!=null&&u(e,["role"],i),e}function fb(n){const e={},t=l(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(s=>cb(s))),u(e,["parts"],r)}const i=l(n,["role"]);return i!=null&&u(e,["role"],i),e}function hb(n){const e={},t=l(n,["behavior"]);t!=null&&u(e,["behavior"],t);const i=l(n,["description"]);i!=null&&u(e,["description"],i);const r=l(n,["name"]);r!=null&&u(e,["name"],r);const s=l(n,["parameters"]);s!=null&&u(e,["parameters"],s);const o=l(n,["parametersJsonSchema"]);o!=null&&u(e,["parametersJsonSchema"],o);const a=l(n,["response"]);a!=null&&u(e,["response"],a);const c=l(n,["responseJsonSchema"]);return c!=null&&u(e,["responseJsonSchema"],c),e}function pb(n){const e={};if(l(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=l(n,["description"]);t!=null&&u(e,["description"],t);const i=l(n,["name"]);i!=null&&u(e,["name"],i);const r=l(n,["parameters"]);r!=null&&u(e,["parameters"],r);const s=l(n,["parametersJsonSchema"]);s!=null&&u(e,["parametersJsonSchema"],s);const o=l(n,["response"]);o!=null&&u(e,["response"],o);const a=l(n,["responseJsonSchema"]);return a!=null&&u(e,["responseJsonSchema"],a),e}function mb(n){const e={},t=l(n,["startTime"]);t!=null&&u(e,["startTime"],t);const i=l(n,["endTime"]);return i!=null&&u(e,["endTime"],i),e}function gb(n){const e={},t=l(n,["startTime"]);t!=null&&u(e,["startTime"],t);const i=l(n,["endTime"]);return i!=null&&u(e,["endTime"],i),e}function yb(n){const e={},t=l(n,["timeRangeFilter"]);return t!=null&&u(e,["timeRangeFilter"],mb(t)),e}function _b(n){const e={},t=l(n,["timeRangeFilter"]);return t!=null&&u(e,["timeRangeFilter"],gb(t)),e}function vb(n){const e={},t=l(n,["mode"]);t!=null&&u(e,["mode"],t);const i=l(n,["dynamicThreshold"]);return i!=null&&u(e,["dynamicThreshold"],i),e}function Tb(n){const e={},t=l(n,["mode"]);t!=null&&u(e,["mode"],t);const i=l(n,["dynamicThreshold"]);return i!=null&&u(e,["dynamicThreshold"],i),e}function Eb(n){const e={},t=l(n,["dynamicRetrievalConfig"]);return t!=null&&u(e,["dynamicRetrievalConfig"],vb(t)),e}function Ib(n){const e={},t=l(n,["dynamicRetrievalConfig"]);return t!=null&&u(e,["dynamicRetrievalConfig"],Tb(t)),e}function Cb(){return{}}function wb(n){const e={},t=l(n,["apiKeyString"]);return t!=null&&u(e,["apiKeyString"],t),e}function Ab(n){const e={},t=l(n,["apiKeyConfig"]);t!=null&&u(e,["apiKeyConfig"],wb(t));const i=l(n,["authType"]);i!=null&&u(e,["authType"],i);const r=l(n,["googleServiceAccountConfig"]);r!=null&&u(e,["googleServiceAccountConfig"],r);const s=l(n,["httpBasicAuthConfig"]);s!=null&&u(e,["httpBasicAuthConfig"],s);const o=l(n,["oauthConfig"]);o!=null&&u(e,["oauthConfig"],o);const a=l(n,["oidcConfig"]);return a!=null&&u(e,["oidcConfig"],a),e}function Sb(n){const e={},t=l(n,["authConfig"]);return t!=null&&u(e,["authConfig"],Ab(t)),e}function Rb(){return{}}function Pb(){return{}}function xb(n){const e={},t=l(n,["functionDeclarations"]);if(t!=null){let a=t;Array.isArray(a)&&(a=a.map(c=>hb(c))),u(e,["functionDeclarations"],a)}if(l(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=l(n,["googleSearch"]);i!=null&&u(e,["googleSearch"],yb(i));const r=l(n,["googleSearchRetrieval"]);if(r!=null&&u(e,["googleSearchRetrieval"],Eb(r)),l(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(l(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");l(n,["urlContext"])!=null&&u(e,["urlContext"],Rb());const o=l(n,["codeExecution"]);return o!=null&&u(e,["codeExecution"],o),e}function kb(n){const e={},t=l(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(p=>pb(p))),u(e,["functionDeclarations"],h)}const i=l(n,["retrieval"]);i!=null&&u(e,["retrieval"],i);const r=l(n,["googleSearch"]);r!=null&&u(e,["googleSearch"],_b(r));const s=l(n,["googleSearchRetrieval"]);s!=null&&u(e,["googleSearchRetrieval"],Ib(s)),l(n,["enterpriseWebSearch"])!=null&&u(e,["enterpriseWebSearch"],Cb());const a=l(n,["googleMaps"]);a!=null&&u(e,["googleMaps"],Sb(a)),l(n,["urlContext"])!=null&&u(e,["urlContext"],Pb());const d=l(n,["codeExecution"]);return d!=null&&u(e,["codeExecution"],d),e}function bb(n){const e={},t=l(n,["handle"]);if(t!=null&&u(e,["handle"],t),l(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Mb(n){const e={},t=l(n,["handle"]);t!=null&&u(e,["handle"],t);const i=l(n,["transparent"]);return i!=null&&u(e,["transparent"],i),e}function Xm(){return{}}function Qm(){return{}}function Db(n){const e={},t=l(n,["disabled"]);t!=null&&u(e,["disabled"],t);const i=l(n,["startOfSpeechSensitivity"]);i!=null&&u(e,["startOfSpeechSensitivity"],i);const r=l(n,["endOfSpeechSensitivity"]);r!=null&&u(e,["endOfSpeechSensitivity"],r);const s=l(n,["prefixPaddingMs"]);s!=null&&u(e,["prefixPaddingMs"],s);const o=l(n,["silenceDurationMs"]);return o!=null&&u(e,["silenceDurationMs"],o),e}function Nb(n){const e={},t=l(n,["disabled"]);t!=null&&u(e,["disabled"],t);const i=l(n,["startOfSpeechSensitivity"]);i!=null&&u(e,["startOfSpeechSensitivity"],i);const r=l(n,["endOfSpeechSensitivity"]);r!=null&&u(e,["endOfSpeechSensitivity"],r);const s=l(n,["prefixPaddingMs"]);s!=null&&u(e,["prefixPaddingMs"],s);const o=l(n,["silenceDurationMs"]);return o!=null&&u(e,["silenceDurationMs"],o),e}function Vb(n){const e={},t=l(n,["automaticActivityDetection"]);t!=null&&u(e,["automaticActivityDetection"],Db(t));const i=l(n,["activityHandling"]);i!=null&&u(e,["activityHandling"],i);const r=l(n,["turnCoverage"]);return r!=null&&u(e,["turnCoverage"],r),e}function Lb(n){const e={},t=l(n,["automaticActivityDetection"]);t!=null&&u(e,["automaticActivityDetection"],Nb(t));const i=l(n,["activityHandling"]);i!=null&&u(e,["activityHandling"],i);const r=l(n,["turnCoverage"]);return r!=null&&u(e,["turnCoverage"],r),e}function Fb(n){const e={},t=l(n,["targetTokens"]);return t!=null&&u(e,["targetTokens"],t),e}function Ub(n){const e={},t=l(n,["targetTokens"]);return t!=null&&u(e,["targetTokens"],t),e}function Ob(n){const e={},t=l(n,["triggerTokens"]);t!=null&&u(e,["triggerTokens"],t);const i=l(n,["slidingWindow"]);return i!=null&&u(e,["slidingWindow"],Fb(i)),e}function Bb(n){const e={},t=l(n,["triggerTokens"]);t!=null&&u(e,["triggerTokens"],t);const i=l(n,["slidingWindow"]);return i!=null&&u(e,["slidingWindow"],Ub(i)),e}function qb(n){const e={},t=l(n,["proactiveAudio"]);return t!=null&&u(e,["proactiveAudio"],t),e}function $b(n){const e={},t=l(n,["proactiveAudio"]);return t!=null&&u(e,["proactiveAudio"],t),e}function Gb(n,e){const t={},i=l(n,["generationConfig"]);e!==void 0&&i!=null&&u(e,["setup","generationConfig"],i);const r=l(n,["responseModalities"]);e!==void 0&&r!=null&&u(e,["setup","generationConfig","responseModalities"],r);const s=l(n,["temperature"]);e!==void 0&&s!=null&&u(e,["setup","generationConfig","temperature"],s);const o=l(n,["topP"]);e!==void 0&&o!=null&&u(e,["setup","generationConfig","topP"],o);const a=l(n,["topK"]);e!==void 0&&a!=null&&u(e,["setup","generationConfig","topK"],a);const c=l(n,["maxOutputTokens"]);e!==void 0&&c!=null&&u(e,["setup","generationConfig","maxOutputTokens"],c);const d=l(n,["mediaResolution"]);e!==void 0&&d!=null&&u(e,["setup","generationConfig","mediaResolution"],d);const h=l(n,["seed"]);e!==void 0&&h!=null&&u(e,["setup","generationConfig","seed"],h);const p=l(n,["speechConfig"]);e!==void 0&&p!=null&&u(e,["setup","generationConfig","speechConfig"],tb(Pd(p)));const g=l(n,["enableAffectiveDialog"]);e!==void 0&&g!=null&&u(e,["setup","generationConfig","enableAffectiveDialog"],g);const _=l(n,["systemInstruction"]);e!==void 0&&_!=null&&u(e,["setup","systemInstruction"],db(nt(_)));const C=l(n,["tools"]);if(e!==void 0&&C!=null){let U=Br(C);Array.isArray(U)&&(U=U.map(q=>xb(Or(q)))),u(e,["setup","tools"],U)}const P=l(n,["sessionResumption"]);e!==void 0&&P!=null&&u(e,["setup","sessionResumption"],bb(P));const x=l(n,["inputAudioTranscription"]);e!==void 0&&x!=null&&u(e,["setup","inputAudioTranscription"],Xm());const F=l(n,["outputAudioTranscription"]);e!==void 0&&F!=null&&u(e,["setup","outputAudioTranscription"],Xm());const L=l(n,["realtimeInputConfig"]);e!==void 0&&L!=null&&u(e,["setup","realtimeInputConfig"],Vb(L));const V=l(n,["contextWindowCompression"]);e!==void 0&&V!=null&&u(e,["setup","contextWindowCompression"],Ob(V));const O=l(n,["proactivity"]);return e!==void 0&&O!=null&&u(e,["setup","proactivity"],qb(O)),t}function Hb(n,e){const t={},i=l(n,["generationConfig"]);e!==void 0&&i!=null&&u(e,["setup","generationConfig"],i);const r=l(n,["responseModalities"]);e!==void 0&&r!=null&&u(e,["setup","generationConfig","responseModalities"],r);const s=l(n,["temperature"]);e!==void 0&&s!=null&&u(e,["setup","generationConfig","temperature"],s);const o=l(n,["topP"]);e!==void 0&&o!=null&&u(e,["setup","generationConfig","topP"],o);const a=l(n,["topK"]);e!==void 0&&a!=null&&u(e,["setup","generationConfig","topK"],a);const c=l(n,["maxOutputTokens"]);e!==void 0&&c!=null&&u(e,["setup","generationConfig","maxOutputTokens"],c);const d=l(n,["mediaResolution"]);e!==void 0&&d!=null&&u(e,["setup","generationConfig","mediaResolution"],d);const h=l(n,["seed"]);e!==void 0&&h!=null&&u(e,["setup","generationConfig","seed"],h);const p=l(n,["speechConfig"]);e!==void 0&&p!=null&&u(e,["setup","generationConfig","speechConfig"],nb(Pd(p)));const g=l(n,["enableAffectiveDialog"]);e!==void 0&&g!=null&&u(e,["setup","generationConfig","enableAffectiveDialog"],g);const _=l(n,["systemInstruction"]);e!==void 0&&_!=null&&u(e,["setup","systemInstruction"],fb(nt(_)));const C=l(n,["tools"]);if(e!==void 0&&C!=null){let U=Br(C);Array.isArray(U)&&(U=U.map(q=>kb(Or(q)))),u(e,["setup","tools"],U)}const P=l(n,["sessionResumption"]);e!==void 0&&P!=null&&u(e,["setup","sessionResumption"],Mb(P));const x=l(n,["inputAudioTranscription"]);e!==void 0&&x!=null&&u(e,["setup","inputAudioTranscription"],Qm());const F=l(n,["outputAudioTranscription"]);e!==void 0&&F!=null&&u(e,["setup","outputAudioTranscription"],Qm());const L=l(n,["realtimeInputConfig"]);e!==void 0&&L!=null&&u(e,["setup","realtimeInputConfig"],Lb(L));const V=l(n,["contextWindowCompression"]);e!==void 0&&V!=null&&u(e,["setup","contextWindowCompression"],Bb(V));const O=l(n,["proactivity"]);return e!==void 0&&O!=null&&u(e,["setup","proactivity"],$b(O)),t}function zb(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["setup","model"],Te(n,i));const r=l(e,["config"]);return r!=null&&u(t,["config"],Gb(r,t)),t}function Wb(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["setup","model"],Te(n,i));const r=l(e,["config"]);return r!=null&&u(t,["config"],Hb(r,t)),t}function Kb(){return{}}function Jb(){return{}}function Yb(){return{}}function Xb(){return{}}function Qb(n){const e={},t=l(n,["media"]);t!=null&&u(e,["mediaChunks"],Uv(t));const i=l(n,["audio"]);i!=null&&u(e,["audio"],pP(i));const r=l(n,["audioStreamEnd"]);r!=null&&u(e,["audioStreamEnd"],r);const s=l(n,["video"]);s!=null&&u(e,["video"],hP(s));const o=l(n,["text"]);return o!=null&&u(e,["text"],o),l(n,["activityStart"])!=null&&u(e,["activityStart"],Kb()),l(n,["activityEnd"])!=null&&u(e,["activityEnd"],Yb()),e}function Zb(n){const e={},t=l(n,["media"]);if(t!=null&&u(e,["mediaChunks"],Uv(t)),l(n,["audio"])!==void 0)throw new Error("audio parameter is not supported in Vertex AI.");const i=l(n,["audioStreamEnd"]);if(i!=null&&u(e,["audioStreamEnd"],i),l(n,["video"])!==void 0)throw new Error("video parameter is not supported in Vertex AI.");if(l(n,["text"])!==void 0)throw new Error("text parameter is not supported in Vertex AI.");return l(n,["activityStart"])!=null&&u(e,["activityStart"],Jb()),l(n,["activityEnd"])!=null&&u(e,["activityEnd"],Xb()),e}function Qv(n){const e={},t=l(n,["text"]);t!=null&&u(e,["text"],t);const i=l(n,["weight"]);return i!=null&&u(e,["weight"],i),e}function jb(n){const e={},t=l(n,["weightedPrompts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>Qv(r))),u(e,["weightedPrompts"],i)}return e}function Zv(n){const e={},t=l(n,["temperature"]);t!=null&&u(e,["temperature"],t);const i=l(n,["topK"]);i!=null&&u(e,["topK"],i);const r=l(n,["seed"]);r!=null&&u(e,["seed"],r);const s=l(n,["guidance"]);s!=null&&u(e,["guidance"],s);const o=l(n,["bpm"]);o!=null&&u(e,["bpm"],o);const a=l(n,["density"]);a!=null&&u(e,["density"],a);const c=l(n,["brightness"]);c!=null&&u(e,["brightness"],c);const d=l(n,["scale"]);d!=null&&u(e,["scale"],d);const h=l(n,["muteBass"]);h!=null&&u(e,["muteBass"],h);const p=l(n,["muteDrums"]);p!=null&&u(e,["muteDrums"],p);const g=l(n,["onlyBassAndDrums"]);return g!=null&&u(e,["onlyBassAndDrums"],g),e}function eM(n){const e={},t=l(n,["musicGenerationConfig"]);return t!=null&&u(e,["musicGenerationConfig"],Zv(t)),e}function jv(n){const e={},t=l(n,["model"]);return t!=null&&u(e,["model"],t),e}function eT(n){const e={},t=l(n,["weightedPrompts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>Qv(r))),u(e,["weightedPrompts"],i)}return e}function pc(n){const e={},t=l(n,["setup"]);t!=null&&u(e,["setup"],jv(t));const i=l(n,["clientContent"]);i!=null&&u(e,["clientContent"],eT(i));const r=l(n,["musicGenerationConfig"]);r!=null&&u(e,["musicGenerationConfig"],Zv(r));const s=l(n,["playbackControl"]);return s!=null&&u(e,["playbackControl"],s),e}function tM(){return{}}function nM(){return{}}function iM(n){const e={},t=l(n,["fps"]);t!=null&&u(e,["fps"],t);const i=l(n,["endOffset"]);i!=null&&u(e,["endOffset"],i);const r=l(n,["startOffset"]);return r!=null&&u(e,["startOffset"],r),e}function rM(n){const e={},t=l(n,["fps"]);t!=null&&u(e,["fps"],t);const i=l(n,["endOffset"]);i!=null&&u(e,["endOffset"],i);const r=l(n,["startOffset"]);return r!=null&&u(e,["startOffset"],r),e}function sM(n){const e={},t=l(n,["data"]);t!=null&&u(e,["data"],t);const i=l(n,["mimeType"]);return i!=null&&u(e,["mimeType"],i),e}function oM(n){const e={},t=l(n,["displayName"]);t!=null&&u(e,["displayName"],t);const i=l(n,["data"]);i!=null&&u(e,["data"],i);const r=l(n,["mimeType"]);return r!=null&&u(e,["mimeType"],r),e}function aM(n){const e={},t=l(n,["fileUri"]);t!=null&&u(e,["fileUri"],t);const i=l(n,["mimeType"]);return i!=null&&u(e,["mimeType"],i),e}function lM(n){const e={},t=l(n,["displayName"]);t!=null&&u(e,["displayName"],t);const i=l(n,["fileUri"]);i!=null&&u(e,["fileUri"],i);const r=l(n,["mimeType"]);return r!=null&&u(e,["mimeType"],r),e}function uM(n){const e={},t=l(n,["videoMetadata"]);t!=null&&u(e,["videoMetadata"],iM(t));const i=l(n,["thought"]);i!=null&&u(e,["thought"],i);const r=l(n,["inlineData"]);r!=null&&u(e,["inlineData"],sM(r));const s=l(n,["fileData"]);s!=null&&u(e,["fileData"],aM(s));const o=l(n,["thoughtSignature"]);o!=null&&u(e,["thoughtSignature"],o);const a=l(n,["codeExecutionResult"]);a!=null&&u(e,["codeExecutionResult"],a);const c=l(n,["executableCode"]);c!=null&&u(e,["executableCode"],c);const d=l(n,["functionCall"]);d!=null&&u(e,["functionCall"],d);const h=l(n,["functionResponse"]);h!=null&&u(e,["functionResponse"],h);const p=l(n,["text"]);return p!=null&&u(e,["text"],p),e}function cM(n){const e={},t=l(n,["videoMetadata"]);t!=null&&u(e,["videoMetadata"],rM(t));const i=l(n,["thought"]);i!=null&&u(e,["thought"],i);const r=l(n,["inlineData"]);r!=null&&u(e,["inlineData"],oM(r));const s=l(n,["fileData"]);s!=null&&u(e,["fileData"],lM(s));const o=l(n,["thoughtSignature"]);o!=null&&u(e,["thoughtSignature"],o);const a=l(n,["codeExecutionResult"]);a!=null&&u(e,["codeExecutionResult"],a);const c=l(n,["executableCode"]);c!=null&&u(e,["executableCode"],c);const d=l(n,["functionCall"]);d!=null&&u(e,["functionCall"],d);const h=l(n,["functionResponse"]);h!=null&&u(e,["functionResponse"],h);const p=l(n,["text"]);return p!=null&&u(e,["text"],p),e}function dM(n){const e={},t=l(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(s=>uM(s))),u(e,["parts"],r)}const i=l(n,["role"]);return i!=null&&u(e,["role"],i),e}function fM(n){const e={},t=l(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(s=>cM(s))),u(e,["parts"],r)}const i=l(n,["role"]);return i!=null&&u(e,["role"],i),e}function Zm(n){const e={},t=l(n,["text"]);t!=null&&u(e,["text"],t);const i=l(n,["finished"]);return i!=null&&u(e,["finished"],i),e}function jm(n){const e={},t=l(n,["text"]);t!=null&&u(e,["text"],t);const i=l(n,["finished"]);return i!=null&&u(e,["finished"],i),e}function hM(n){const e={},t=l(n,["retrievedUrl"]);t!=null&&u(e,["retrievedUrl"],t);const i=l(n,["urlRetrievalStatus"]);return i!=null&&u(e,["urlRetrievalStatus"],i),e}function pM(n){const e={},t=l(n,["urlMetadata"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>hM(r))),u(e,["urlMetadata"],i)}return e}function mM(n){const e={},t=l(n,["modelTurn"]);t!=null&&u(e,["modelTurn"],dM(t));const i=l(n,["turnComplete"]);i!=null&&u(e,["turnComplete"],i);const r=l(n,["interrupted"]);r!=null&&u(e,["interrupted"],r);const s=l(n,["groundingMetadata"]);s!=null&&u(e,["groundingMetadata"],s);const o=l(n,["generationComplete"]);o!=null&&u(e,["generationComplete"],o);const a=l(n,["inputTranscription"]);a!=null&&u(e,["inputTranscription"],Zm(a));const c=l(n,["outputTranscription"]);c!=null&&u(e,["outputTranscription"],Zm(c));const d=l(n,["urlContextMetadata"]);return d!=null&&u(e,["urlContextMetadata"],pM(d)),e}function gM(n){const e={},t=l(n,["modelTurn"]);t!=null&&u(e,["modelTurn"],fM(t));const i=l(n,["turnComplete"]);i!=null&&u(e,["turnComplete"],i);const r=l(n,["interrupted"]);r!=null&&u(e,["interrupted"],r);const s=l(n,["groundingMetadata"]);s!=null&&u(e,["groundingMetadata"],s);const o=l(n,["generationComplete"]);o!=null&&u(e,["generationComplete"],o);const a=l(n,["inputTranscription"]);a!=null&&u(e,["inputTranscription"],jm(a));const c=l(n,["outputTranscription"]);return c!=null&&u(e,["outputTranscription"],jm(c)),e}function yM(n){const e={},t=l(n,["id"]);t!=null&&u(e,["id"],t);const i=l(n,["args"]);i!=null&&u(e,["args"],i);const r=l(n,["name"]);return r!=null&&u(e,["name"],r),e}function _M(n){const e={},t=l(n,["args"]);t!=null&&u(e,["args"],t);const i=l(n,["name"]);return i!=null&&u(e,["name"],i),e}function vM(n){const e={},t=l(n,["functionCalls"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>yM(r))),u(e,["functionCalls"],i)}return e}function TM(n){const e={},t=l(n,["functionCalls"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>_M(r))),u(e,["functionCalls"],i)}return e}function EM(n){const e={},t=l(n,["ids"]);return t!=null&&u(e,["ids"],t),e}function IM(n){const e={},t=l(n,["ids"]);return t!=null&&u(e,["ids"],t),e}function Ko(n){const e={},t=l(n,["modality"]);t!=null&&u(e,["modality"],t);const i=l(n,["tokenCount"]);return i!=null&&u(e,["tokenCount"],i),e}function Jo(n){const e={},t=l(n,["modality"]);t!=null&&u(e,["modality"],t);const i=l(n,["tokenCount"]);return i!=null&&u(e,["tokenCount"],i),e}function CM(n){const e={},t=l(n,["promptTokenCount"]);t!=null&&u(e,["promptTokenCount"],t);const i=l(n,["cachedContentTokenCount"]);i!=null&&u(e,["cachedContentTokenCount"],i);const r=l(n,["responseTokenCount"]);r!=null&&u(e,["responseTokenCount"],r);const s=l(n,["toolUsePromptTokenCount"]);s!=null&&u(e,["toolUsePromptTokenCount"],s);const o=l(n,["thoughtsTokenCount"]);o!=null&&u(e,["thoughtsTokenCount"],o);const a=l(n,["totalTokenCount"]);a!=null&&u(e,["totalTokenCount"],a);const c=l(n,["promptTokensDetails"]);if(c!=null){let g=c;Array.isArray(g)&&(g=g.map(_=>Ko(_))),u(e,["promptTokensDetails"],g)}const d=l(n,["cacheTokensDetails"]);if(d!=null){let g=d;Array.isArray(g)&&(g=g.map(_=>Ko(_))),u(e,["cacheTokensDetails"],g)}const h=l(n,["responseTokensDetails"]);if(h!=null){let g=h;Array.isArray(g)&&(g=g.map(_=>Ko(_))),u(e,["responseTokensDetails"],g)}const p=l(n,["toolUsePromptTokensDetails"]);if(p!=null){let g=p;Array.isArray(g)&&(g=g.map(_=>Ko(_))),u(e,["toolUsePromptTokensDetails"],g)}return e}function wM(n){const e={},t=l(n,["promptTokenCount"]);t!=null&&u(e,["promptTokenCount"],t);const i=l(n,["cachedContentTokenCount"]);i!=null&&u(e,["cachedContentTokenCount"],i);const r=l(n,["candidatesTokenCount"]);r!=null&&u(e,["responseTokenCount"],r);const s=l(n,["toolUsePromptTokenCount"]);s!=null&&u(e,["toolUsePromptTokenCount"],s);const o=l(n,["thoughtsTokenCount"]);o!=null&&u(e,["thoughtsTokenCount"],o);const a=l(n,["totalTokenCount"]);a!=null&&u(e,["totalTokenCount"],a);const c=l(n,["promptTokensDetails"]);if(c!=null){let _=c;Array.isArray(_)&&(_=_.map(C=>Jo(C))),u(e,["promptTokensDetails"],_)}const d=l(n,["cacheTokensDetails"]);if(d!=null){let _=d;Array.isArray(_)&&(_=_.map(C=>Jo(C))),u(e,["cacheTokensDetails"],_)}const h=l(n,["candidatesTokensDetails"]);if(h!=null){let _=h;Array.isArray(_)&&(_=_.map(C=>Jo(C))),u(e,["responseTokensDetails"],_)}const p=l(n,["toolUsePromptTokensDetails"]);if(p!=null){let _=p;Array.isArray(_)&&(_=_.map(C=>Jo(C))),u(e,["toolUsePromptTokensDetails"],_)}const g=l(n,["trafficType"]);return g!=null&&u(e,["trafficType"],g),e}function AM(n){const e={},t=l(n,["timeLeft"]);return t!=null&&u(e,["timeLeft"],t),e}function SM(n){const e={},t=l(n,["timeLeft"]);return t!=null&&u(e,["timeLeft"],t),e}function RM(n){const e={},t=l(n,["newHandle"]);t!=null&&u(e,["newHandle"],t);const i=l(n,["resumable"]);i!=null&&u(e,["resumable"],i);const r=l(n,["lastConsumedClientMessageIndex"]);return r!=null&&u(e,["lastConsumedClientMessageIndex"],r),e}function PM(n){const e={},t=l(n,["newHandle"]);t!=null&&u(e,["newHandle"],t);const i=l(n,["resumable"]);i!=null&&u(e,["resumable"],i);const r=l(n,["lastConsumedClientMessageIndex"]);return r!=null&&u(e,["lastConsumedClientMessageIndex"],r),e}function xM(n){const e={};l(n,["setupComplete"])!=null&&u(e,["setupComplete"],tM());const i=l(n,["serverContent"]);i!=null&&u(e,["serverContent"],mM(i));const r=l(n,["toolCall"]);r!=null&&u(e,["toolCall"],vM(r));const s=l(n,["toolCallCancellation"]);s!=null&&u(e,["toolCallCancellation"],EM(s));const o=l(n,["usageMetadata"]);o!=null&&u(e,["usageMetadata"],CM(o));const a=l(n,["goAway"]);a!=null&&u(e,["goAway"],AM(a));const c=l(n,["sessionResumptionUpdate"]);return c!=null&&u(e,["sessionResumptionUpdate"],RM(c)),e}function kM(n){const e={};l(n,["setupComplete"])!=null&&u(e,["setupComplete"],nM());const i=l(n,["serverContent"]);i!=null&&u(e,["serverContent"],gM(i));const r=l(n,["toolCall"]);r!=null&&u(e,["toolCall"],TM(r));const s=l(n,["toolCallCancellation"]);s!=null&&u(e,["toolCallCancellation"],IM(s));const o=l(n,["usageMetadata"]);o!=null&&u(e,["usageMetadata"],wM(o));const a=l(n,["goAway"]);a!=null&&u(e,["goAway"],SM(a));const c=l(n,["sessionResumptionUpdate"]);return c!=null&&u(e,["sessionResumptionUpdate"],PM(c)),e}function bM(){return{}}function MM(n){const e={},t=l(n,["text"]);t!=null&&u(e,["text"],t);const i=l(n,["weight"]);return i!=null&&u(e,["weight"],i),e}function DM(n){const e={},t=l(n,["weightedPrompts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>MM(r))),u(e,["weightedPrompts"],i)}return e}function NM(n){const e={},t=l(n,["temperature"]);t!=null&&u(e,["temperature"],t);const i=l(n,["topK"]);i!=null&&u(e,["topK"],i);const r=l(n,["seed"]);r!=null&&u(e,["seed"],r);const s=l(n,["guidance"]);s!=null&&u(e,["guidance"],s);const o=l(n,["bpm"]);o!=null&&u(e,["bpm"],o);const a=l(n,["density"]);a!=null&&u(e,["density"],a);const c=l(n,["brightness"]);c!=null&&u(e,["brightness"],c);const d=l(n,["scale"]);d!=null&&u(e,["scale"],d);const h=l(n,["muteBass"]);h!=null&&u(e,["muteBass"],h);const p=l(n,["muteDrums"]);p!=null&&u(e,["muteDrums"],p);const g=l(n,["onlyBassAndDrums"]);return g!=null&&u(e,["onlyBassAndDrums"],g),e}function VM(n){const e={},t=l(n,["clientContent"]);t!=null&&u(e,["clientContent"],DM(t));const i=l(n,["musicGenerationConfig"]);return i!=null&&u(e,["musicGenerationConfig"],NM(i)),e}function LM(n){const e={},t=l(n,["data"]);t!=null&&u(e,["data"],t);const i=l(n,["mimeType"]);i!=null&&u(e,["mimeType"],i);const r=l(n,["sourceMetadata"]);return r!=null&&u(e,["sourceMetadata"],VM(r)),e}function FM(n){const e={},t=l(n,["audioChunks"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>LM(r))),u(e,["audioChunks"],i)}return e}function UM(n){const e={},t=l(n,["text"]);t!=null&&u(e,["text"],t);const i=l(n,["filteredReason"]);return i!=null&&u(e,["filteredReason"],i),e}function OM(n){const e={};l(n,["setupComplete"])!=null&&u(e,["setupComplete"],bM());const i=l(n,["serverContent"]);i!=null&&u(e,["serverContent"],FM(i));const r=l(n,["filteredPrompt"]);return r!=null&&u(e,["filteredPrompt"],UM(r)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function BM(n){const e={},t=l(n,["fps"]);t!=null&&u(e,["fps"],t);const i=l(n,["endOffset"]);i!=null&&u(e,["endOffset"],i);const r=l(n,["startOffset"]);return r!=null&&u(e,["startOffset"],r),e}function qM(n){const e={};if(l(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=l(n,["data"]);t!=null&&u(e,["data"],t);const i=l(n,["mimeType"]);return i!=null&&u(e,["mimeType"],i),e}function $M(n){const e={};if(l(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=l(n,["fileUri"]);t!=null&&u(e,["fileUri"],t);const i=l(n,["mimeType"]);return i!=null&&u(e,["mimeType"],i),e}function GM(n){const e={},t=l(n,["videoMetadata"]);t!=null&&u(e,["videoMetadata"],BM(t));const i=l(n,["thought"]);i!=null&&u(e,["thought"],i);const r=l(n,["inlineData"]);r!=null&&u(e,["inlineData"],qM(r));const s=l(n,["fileData"]);s!=null&&u(e,["fileData"],$M(s));const o=l(n,["thoughtSignature"]);o!=null&&u(e,["thoughtSignature"],o);const a=l(n,["codeExecutionResult"]);a!=null&&u(e,["codeExecutionResult"],a);const c=l(n,["executableCode"]);c!=null&&u(e,["executableCode"],c);const d=l(n,["functionCall"]);d!=null&&u(e,["functionCall"],d);const h=l(n,["functionResponse"]);h!=null&&u(e,["functionResponse"],h);const p=l(n,["text"]);return p!=null&&u(e,["text"],p),e}function Pl(n){const e={},t=l(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(s=>GM(s))),u(e,["parts"],r)}const i=l(n,["role"]);return i!=null&&u(e,["role"],i),e}function HM(n){const e={},t=l(n,["anyOf"]);t!=null&&u(e,["anyOf"],t);const i=l(n,["default"]);i!=null&&u(e,["default"],i);const r=l(n,["description"]);r!=null&&u(e,["description"],r);const s=l(n,["enum"]);s!=null&&u(e,["enum"],s);const o=l(n,["example"]);o!=null&&u(e,["example"],o);const a=l(n,["format"]);a!=null&&u(e,["format"],a);const c=l(n,["items"]);c!=null&&u(e,["items"],c);const d=l(n,["maxItems"]);d!=null&&u(e,["maxItems"],d);const h=l(n,["maxLength"]);h!=null&&u(e,["maxLength"],h);const p=l(n,["maxProperties"]);p!=null&&u(e,["maxProperties"],p);const g=l(n,["maximum"]);g!=null&&u(e,["maximum"],g);const _=l(n,["minItems"]);_!=null&&u(e,["minItems"],_);const C=l(n,["minLength"]);C!=null&&u(e,["minLength"],C);const P=l(n,["minProperties"]);P!=null&&u(e,["minProperties"],P);const x=l(n,["minimum"]);x!=null&&u(e,["minimum"],x);const F=l(n,["nullable"]);F!=null&&u(e,["nullable"],F);const L=l(n,["pattern"]);L!=null&&u(e,["pattern"],L);const V=l(n,["properties"]);V!=null&&u(e,["properties"],V);const O=l(n,["propertyOrdering"]);O!=null&&u(e,["propertyOrdering"],O);const U=l(n,["required"]);U!=null&&u(e,["required"],U);const q=l(n,["title"]);q!=null&&u(e,["title"],q);const I=l(n,["type"]);return I!=null&&u(e,["type"],I),e}function zM(n){const e={};if(l(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const t=l(n,["category"]);t!=null&&u(e,["category"],t);const i=l(n,["threshold"]);return i!=null&&u(e,["threshold"],i),e}function WM(n){const e={},t=l(n,["behavior"]);t!=null&&u(e,["behavior"],t);const i=l(n,["description"]);i!=null&&u(e,["description"],i);const r=l(n,["name"]);r!=null&&u(e,["name"],r);const s=l(n,["parameters"]);s!=null&&u(e,["parameters"],s);const o=l(n,["parametersJsonSchema"]);o!=null&&u(e,["parametersJsonSchema"],o);const a=l(n,["response"]);a!=null&&u(e,["response"],a);const c=l(n,["responseJsonSchema"]);return c!=null&&u(e,["responseJsonSchema"],c),e}function KM(n){const e={},t=l(n,["startTime"]);t!=null&&u(e,["startTime"],t);const i=l(n,["endTime"]);return i!=null&&u(e,["endTime"],i),e}function JM(n){const e={},t=l(n,["timeRangeFilter"]);return t!=null&&u(e,["timeRangeFilter"],KM(t)),e}function YM(n){const e={},t=l(n,["mode"]);t!=null&&u(e,["mode"],t);const i=l(n,["dynamicThreshold"]);return i!=null&&u(e,["dynamicThreshold"],i),e}function XM(n){const e={},t=l(n,["dynamicRetrievalConfig"]);return t!=null&&u(e,["dynamicRetrievalConfig"],YM(t)),e}function QM(){return{}}function ZM(n){const e={},t=l(n,["functionDeclarations"]);if(t!=null){let a=t;Array.isArray(a)&&(a=a.map(c=>WM(c))),u(e,["functionDeclarations"],a)}if(l(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=l(n,["googleSearch"]);i!=null&&u(e,["googleSearch"],JM(i));const r=l(n,["googleSearchRetrieval"]);if(r!=null&&u(e,["googleSearchRetrieval"],XM(r)),l(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(l(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");l(n,["urlContext"])!=null&&u(e,["urlContext"],QM());const o=l(n,["codeExecution"]);return o!=null&&u(e,["codeExecution"],o),e}function jM(n){const e={},t=l(n,["mode"]);t!=null&&u(e,["mode"],t);const i=l(n,["allowedFunctionNames"]);return i!=null&&u(e,["allowedFunctionNames"],i),e}function eD(n){const e={},t=l(n,["latitude"]);t!=null&&u(e,["latitude"],t);const i=l(n,["longitude"]);return i!=null&&u(e,["longitude"],i),e}function tD(n){const e={},t=l(n,["latLng"]);t!=null&&u(e,["latLng"],eD(t));const i=l(n,["languageCode"]);return i!=null&&u(e,["languageCode"],i),e}function nD(n){const e={},t=l(n,["functionCallingConfig"]);t!=null&&u(e,["functionCallingConfig"],jM(t));const i=l(n,["retrievalConfig"]);return i!=null&&u(e,["retrievalConfig"],tD(i)),e}function iD(n){const e={},t=l(n,["voiceName"]);return t!=null&&u(e,["voiceName"],t),e}function tT(n){const e={},t=l(n,["prebuiltVoiceConfig"]);return t!=null&&u(e,["prebuiltVoiceConfig"],iD(t)),e}function rD(n){const e={},t=l(n,["speaker"]);t!=null&&u(e,["speaker"],t);const i=l(n,["voiceConfig"]);return i!=null&&u(e,["voiceConfig"],tT(i)),e}function sD(n){const e={},t=l(n,["speakerVoiceConfigs"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>rD(r))),u(e,["speakerVoiceConfigs"],i)}return e}function oD(n){const e={},t=l(n,["voiceConfig"]);t!=null&&u(e,["voiceConfig"],tT(t));const i=l(n,["multiSpeakerVoiceConfig"]);i!=null&&u(e,["multiSpeakerVoiceConfig"],sD(i));const r=l(n,["languageCode"]);return r!=null&&u(e,["languageCode"],r),e}function aD(n){const e={},t=l(n,["includeThoughts"]);t!=null&&u(e,["includeThoughts"],t);const i=l(n,["thinkingBudget"]);return i!=null&&u(e,["thinkingBudget"],i),e}function lD(n,e,t){const i={},r=l(e,["systemInstruction"]);t!==void 0&&r!=null&&u(t,["systemInstruction"],Pl(nt(r)));const s=l(e,["temperature"]);s!=null&&u(i,["temperature"],s);const o=l(e,["topP"]);o!=null&&u(i,["topP"],o);const a=l(e,["topK"]);a!=null&&u(i,["topK"],a);const c=l(e,["candidateCount"]);c!=null&&u(i,["candidateCount"],c);const d=l(e,["maxOutputTokens"]);d!=null&&u(i,["maxOutputTokens"],d);const h=l(e,["stopSequences"]);h!=null&&u(i,["stopSequences"],h);const p=l(e,["responseLogprobs"]);p!=null&&u(i,["responseLogprobs"],p);const g=l(e,["logprobs"]);g!=null&&u(i,["logprobs"],g);const _=l(e,["presencePenalty"]);_!=null&&u(i,["presencePenalty"],_);const C=l(e,["frequencyPenalty"]);C!=null&&u(i,["frequencyPenalty"],C);const P=l(e,["seed"]);P!=null&&u(i,["seed"],P);const x=l(e,["responseMimeType"]);x!=null&&u(i,["responseMimeType"],x);const F=l(e,["responseSchema"]);F!=null&&u(i,["responseSchema"],HM(Ys(F)));const L=l(e,["responseJsonSchema"]);if(L!=null&&u(i,["responseJsonSchema"],L),l(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(l(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const V=l(e,["safetySettings"]);if(t!==void 0&&V!=null){let w=V;Array.isArray(w)&&(w=w.map(k=>zM(k))),u(t,["safetySettings"],w)}const O=l(e,["tools"]);if(t!==void 0&&O!=null){let w=Br(O);Array.isArray(w)&&(w=w.map(k=>ZM(Or(k)))),u(t,["tools"],w)}const U=l(e,["toolConfig"]);if(t!==void 0&&U!=null&&u(t,["toolConfig"],nD(U)),l(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const q=l(e,["cachedContent"]);t!==void 0&&q!=null&&u(t,["cachedContent"],pn(n,q));const I=l(e,["responseModalities"]);I!=null&&u(i,["responseModalities"],I);const T=l(e,["mediaResolution"]);T!=null&&u(i,["mediaResolution"],T);const E=l(e,["speechConfig"]);if(E!=null&&u(i,["speechConfig"],oD(Rd(E))),l(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const R=l(e,["thinkingConfig"]);return R!=null&&u(i,["thinkingConfig"],aD(R)),i}function eg(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["_url","model"],Te(n,i));const r=l(e,["contents"]);if(r!=null){let o=St(r);Array.isArray(o)&&(o=o.map(a=>Pl(a))),u(t,["contents"],o)}const s=l(e,["config"]);return s!=null&&u(t,["generationConfig"],lD(n,s,t)),t}function uD(n,e){const t={},i=l(n,["taskType"]);e!==void 0&&i!=null&&u(e,["requests[]","taskType"],i);const r=l(n,["title"]);e!==void 0&&r!=null&&u(e,["requests[]","title"],r);const s=l(n,["outputDimensionality"]);if(e!==void 0&&s!=null&&u(e,["requests[]","outputDimensionality"],s),l(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(l(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function cD(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["_url","model"],Te(n,i));const r=l(e,["contents"]);r!=null&&u(t,["requests[]","content"],Bv(n,r));const s=l(e,["config"]);s!=null&&u(t,["config"],uD(s,t));const o=l(e,["model"]);return o!==void 0&&u(t,["requests[]","model"],Te(n,o)),t}function dD(n,e){const t={};if(l(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(l(n,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const i=l(n,["numberOfImages"]);e!==void 0&&i!=null&&u(e,["parameters","sampleCount"],i);const r=l(n,["aspectRatio"]);e!==void 0&&r!=null&&u(e,["parameters","aspectRatio"],r);const s=l(n,["guidanceScale"]);if(e!==void 0&&s!=null&&u(e,["parameters","guidanceScale"],s),l(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const o=l(n,["safetyFilterLevel"]);e!==void 0&&o!=null&&u(e,["parameters","safetySetting"],o);const a=l(n,["personGeneration"]);e!==void 0&&a!=null&&u(e,["parameters","personGeneration"],a);const c=l(n,["includeSafetyAttributes"]);e!==void 0&&c!=null&&u(e,["parameters","includeSafetyAttributes"],c);const d=l(n,["includeRaiReason"]);e!==void 0&&d!=null&&u(e,["parameters","includeRaiReason"],d);const h=l(n,["language"]);e!==void 0&&h!=null&&u(e,["parameters","language"],h);const p=l(n,["outputMimeType"]);e!==void 0&&p!=null&&u(e,["parameters","outputOptions","mimeType"],p);const g=l(n,["outputCompressionQuality"]);if(e!==void 0&&g!=null&&u(e,["parameters","outputOptions","compressionQuality"],g),l(n,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(l(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function fD(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["_url","model"],Te(n,i));const r=l(e,["prompt"]);r!=null&&u(t,["instances[0]","prompt"],r);const s=l(e,["config"]);return s!=null&&u(t,["config"],dD(s,t)),t}function hD(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["_url","name"],Te(n,i));const r=l(e,["config"]);return r!=null&&u(t,["config"],r),t}function pD(n,e,t){const i={},r=l(e,["pageSize"]);t!==void 0&&r!=null&&u(t,["_query","pageSize"],r);const s=l(e,["pageToken"]);t!==void 0&&s!=null&&u(t,["_query","pageToken"],s);const o=l(e,["filter"]);t!==void 0&&o!=null&&u(t,["_query","filter"],o);const a=l(e,["queryBase"]);return t!==void 0&&a!=null&&u(t,["_url","models_url"],Gv(n,a)),i}function mD(n,e){const t={},i=l(e,["config"]);return i!=null&&u(t,["config"],pD(n,i,t)),t}function gD(n,e){const t={},i=l(n,["displayName"]);e!==void 0&&i!=null&&u(e,["displayName"],i);const r=l(n,["description"]);e!==void 0&&r!=null&&u(e,["description"],r);const s=l(n,["defaultCheckpointId"]);return e!==void 0&&s!=null&&u(e,["defaultCheckpointId"],s),t}function yD(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["_url","name"],Te(n,i));const r=l(e,["config"]);return r!=null&&u(t,["config"],gD(r,t)),t}function _D(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["_url","name"],Te(n,i));const r=l(e,["config"]);return r!=null&&u(t,["config"],r),t}function vD(n){const e={};if(l(n,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(l(n,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(l(n,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function TD(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["_url","model"],Te(n,i));const r=l(e,["contents"]);if(r!=null){let o=St(r);Array.isArray(o)&&(o=o.map(a=>Pl(a))),u(t,["contents"],o)}const s=l(e,["config"]);return s!=null&&u(t,["config"],vD(s)),t}function ED(n){const e={};if(l(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const t=l(n,["imageBytes"]);t!=null&&u(e,["bytesBase64Encoded"],mn(t));const i=l(n,["mimeType"]);return i!=null&&u(e,["mimeType"],i),e}function ID(n,e){const t={},i=l(n,["numberOfVideos"]);if(e!==void 0&&i!=null&&u(e,["parameters","sampleCount"],i),l(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(l(n,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const r=l(n,["durationSeconds"]);if(e!==void 0&&r!=null&&u(e,["parameters","durationSeconds"],r),l(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const s=l(n,["aspectRatio"]);if(e!==void 0&&s!=null&&u(e,["parameters","aspectRatio"],s),l(n,["resolution"])!==void 0)throw new Error("resolution parameter is not supported in Gemini API.");const o=l(n,["personGeneration"]);if(e!==void 0&&o!=null&&u(e,["parameters","personGeneration"],o),l(n,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const a=l(n,["negativePrompt"]);e!==void 0&&a!=null&&u(e,["parameters","negativePrompt"],a);const c=l(n,["enhancePrompt"]);if(e!==void 0&&c!=null&&u(e,["parameters","enhancePrompt"],c),l(n,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");if(l(n,["lastFrame"])!==void 0)throw new Error("lastFrame parameter is not supported in Gemini API.");if(l(n,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function CD(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["_url","model"],Te(n,i));const r=l(e,["prompt"]);r!=null&&u(t,["instances[0]","prompt"],r);const s=l(e,["image"]);if(s!=null&&u(t,["instances[0]","image"],ED(s)),l(e,["video"])!==void 0)throw new Error("video parameter is not supported in Gemini API.");const o=l(e,["config"]);return o!=null&&u(t,["config"],ID(o,t)),t}function wD(n){const e={},t=l(n,["fps"]);t!=null&&u(e,["fps"],t);const i=l(n,["endOffset"]);i!=null&&u(e,["endOffset"],i);const r=l(n,["startOffset"]);return r!=null&&u(e,["startOffset"],r),e}function AD(n){const e={},t=l(n,["displayName"]);t!=null&&u(e,["displayName"],t);const i=l(n,["data"]);i!=null&&u(e,["data"],i);const r=l(n,["mimeType"]);return r!=null&&u(e,["mimeType"],r),e}function SD(n){const e={},t=l(n,["displayName"]);t!=null&&u(e,["displayName"],t);const i=l(n,["fileUri"]);i!=null&&u(e,["fileUri"],i);const r=l(n,["mimeType"]);return r!=null&&u(e,["mimeType"],r),e}function RD(n){const e={},t=l(n,["videoMetadata"]);t!=null&&u(e,["videoMetadata"],wD(t));const i=l(n,["thought"]);i!=null&&u(e,["thought"],i);const r=l(n,["inlineData"]);r!=null&&u(e,["inlineData"],AD(r));const s=l(n,["fileData"]);s!=null&&u(e,["fileData"],SD(s));const o=l(n,["thoughtSignature"]);o!=null&&u(e,["thoughtSignature"],o);const a=l(n,["codeExecutionResult"]);a!=null&&u(e,["codeExecutionResult"],a);const c=l(n,["executableCode"]);c!=null&&u(e,["executableCode"],c);const d=l(n,["functionCall"]);d!=null&&u(e,["functionCall"],d);const h=l(n,["functionResponse"]);h!=null&&u(e,["functionResponse"],h);const p=l(n,["text"]);return p!=null&&u(e,["text"],p),e}function qr(n){const e={},t=l(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(s=>RD(s))),u(e,["parts"],r)}const i=l(n,["role"]);return i!=null&&u(e,["role"],i),e}function PD(n){const e={},t=l(n,["anyOf"]);t!=null&&u(e,["anyOf"],t);const i=l(n,["default"]);i!=null&&u(e,["default"],i);const r=l(n,["description"]);r!=null&&u(e,["description"],r);const s=l(n,["enum"]);s!=null&&u(e,["enum"],s);const o=l(n,["example"]);o!=null&&u(e,["example"],o);const a=l(n,["format"]);a!=null&&u(e,["format"],a);const c=l(n,["items"]);c!=null&&u(e,["items"],c);const d=l(n,["maxItems"]);d!=null&&u(e,["maxItems"],d);const h=l(n,["maxLength"]);h!=null&&u(e,["maxLength"],h);const p=l(n,["maxProperties"]);p!=null&&u(e,["maxProperties"],p);const g=l(n,["maximum"]);g!=null&&u(e,["maximum"],g);const _=l(n,["minItems"]);_!=null&&u(e,["minItems"],_);const C=l(n,["minLength"]);C!=null&&u(e,["minLength"],C);const P=l(n,["minProperties"]);P!=null&&u(e,["minProperties"],P);const x=l(n,["minimum"]);x!=null&&u(e,["minimum"],x);const F=l(n,["nullable"]);F!=null&&u(e,["nullable"],F);const L=l(n,["pattern"]);L!=null&&u(e,["pattern"],L);const V=l(n,["properties"]);V!=null&&u(e,["properties"],V);const O=l(n,["propertyOrdering"]);O!=null&&u(e,["propertyOrdering"],O);const U=l(n,["required"]);U!=null&&u(e,["required"],U);const q=l(n,["title"]);q!=null&&u(e,["title"],q);const I=l(n,["type"]);return I!=null&&u(e,["type"],I),e}function xD(n){const e={},t=l(n,["featureSelectionPreference"]);return t!=null&&u(e,["featureSelectionPreference"],t),e}function kD(n){const e={},t=l(n,["method"]);t!=null&&u(e,["method"],t);const i=l(n,["category"]);i!=null&&u(e,["category"],i);const r=l(n,["threshold"]);return r!=null&&u(e,["threshold"],r),e}function bD(n){const e={};if(l(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=l(n,["description"]);t!=null&&u(e,["description"],t);const i=l(n,["name"]);i!=null&&u(e,["name"],i);const r=l(n,["parameters"]);r!=null&&u(e,["parameters"],r);const s=l(n,["parametersJsonSchema"]);s!=null&&u(e,["parametersJsonSchema"],s);const o=l(n,["response"]);o!=null&&u(e,["response"],o);const a=l(n,["responseJsonSchema"]);return a!=null&&u(e,["responseJsonSchema"],a),e}function MD(n){const e={},t=l(n,["startTime"]);t!=null&&u(e,["startTime"],t);const i=l(n,["endTime"]);return i!=null&&u(e,["endTime"],i),e}function DD(n){const e={},t=l(n,["timeRangeFilter"]);return t!=null&&u(e,["timeRangeFilter"],MD(t)),e}function ND(n){const e={},t=l(n,["mode"]);t!=null&&u(e,["mode"],t);const i=l(n,["dynamicThreshold"]);return i!=null&&u(e,["dynamicThreshold"],i),e}function VD(n){const e={},t=l(n,["dynamicRetrievalConfig"]);return t!=null&&u(e,["dynamicRetrievalConfig"],ND(t)),e}function LD(){return{}}function FD(n){const e={},t=l(n,["apiKeyString"]);return t!=null&&u(e,["apiKeyString"],t),e}function UD(n){const e={},t=l(n,["apiKeyConfig"]);t!=null&&u(e,["apiKeyConfig"],FD(t));const i=l(n,["authType"]);i!=null&&u(e,["authType"],i);const r=l(n,["googleServiceAccountConfig"]);r!=null&&u(e,["googleServiceAccountConfig"],r);const s=l(n,["httpBasicAuthConfig"]);s!=null&&u(e,["httpBasicAuthConfig"],s);const o=l(n,["oauthConfig"]);o!=null&&u(e,["oauthConfig"],o);const a=l(n,["oidcConfig"]);return a!=null&&u(e,["oidcConfig"],a),e}function OD(n){const e={},t=l(n,["authConfig"]);return t!=null&&u(e,["authConfig"],UD(t)),e}function BD(){return{}}function nT(n){const e={},t=l(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(p=>bD(p))),u(e,["functionDeclarations"],h)}const i=l(n,["retrieval"]);i!=null&&u(e,["retrieval"],i);const r=l(n,["googleSearch"]);r!=null&&u(e,["googleSearch"],DD(r));const s=l(n,["googleSearchRetrieval"]);s!=null&&u(e,["googleSearchRetrieval"],VD(s)),l(n,["enterpriseWebSearch"])!=null&&u(e,["enterpriseWebSearch"],LD());const a=l(n,["googleMaps"]);a!=null&&u(e,["googleMaps"],OD(a)),l(n,["urlContext"])!=null&&u(e,["urlContext"],BD());const d=l(n,["codeExecution"]);return d!=null&&u(e,["codeExecution"],d),e}function qD(n){const e={},t=l(n,["mode"]);t!=null&&u(e,["mode"],t);const i=l(n,["allowedFunctionNames"]);return i!=null&&u(e,["allowedFunctionNames"],i),e}function $D(n){const e={},t=l(n,["latitude"]);t!=null&&u(e,["latitude"],t);const i=l(n,["longitude"]);return i!=null&&u(e,["longitude"],i),e}function GD(n){const e={},t=l(n,["latLng"]);t!=null&&u(e,["latLng"],$D(t));const i=l(n,["languageCode"]);return i!=null&&u(e,["languageCode"],i),e}function HD(n){const e={},t=l(n,["functionCallingConfig"]);t!=null&&u(e,["functionCallingConfig"],qD(t));const i=l(n,["retrievalConfig"]);return i!=null&&u(e,["retrievalConfig"],GD(i)),e}function zD(n){const e={},t=l(n,["voiceName"]);return t!=null&&u(e,["voiceName"],t),e}function WD(n){const e={},t=l(n,["prebuiltVoiceConfig"]);return t!=null&&u(e,["prebuiltVoiceConfig"],zD(t)),e}function KD(n){const e={},t=l(n,["voiceConfig"]);if(t!=null&&u(e,["voiceConfig"],WD(t)),l(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const i=l(n,["languageCode"]);return i!=null&&u(e,["languageCode"],i),e}function JD(n){const e={},t=l(n,["includeThoughts"]);t!=null&&u(e,["includeThoughts"],t);const i=l(n,["thinkingBudget"]);return i!=null&&u(e,["thinkingBudget"],i),e}function YD(n,e,t){const i={},r=l(e,["systemInstruction"]);t!==void 0&&r!=null&&u(t,["systemInstruction"],qr(nt(r)));const s=l(e,["temperature"]);s!=null&&u(i,["temperature"],s);const o=l(e,["topP"]);o!=null&&u(i,["topP"],o);const a=l(e,["topK"]);a!=null&&u(i,["topK"],a);const c=l(e,["candidateCount"]);c!=null&&u(i,["candidateCount"],c);const d=l(e,["maxOutputTokens"]);d!=null&&u(i,["maxOutputTokens"],d);const h=l(e,["stopSequences"]);h!=null&&u(i,["stopSequences"],h);const p=l(e,["responseLogprobs"]);p!=null&&u(i,["responseLogprobs"],p);const g=l(e,["logprobs"]);g!=null&&u(i,["logprobs"],g);const _=l(e,["presencePenalty"]);_!=null&&u(i,["presencePenalty"],_);const C=l(e,["frequencyPenalty"]);C!=null&&u(i,["frequencyPenalty"],C);const P=l(e,["seed"]);P!=null&&u(i,["seed"],P);const x=l(e,["responseMimeType"]);x!=null&&u(i,["responseMimeType"],x);const F=l(e,["responseSchema"]);F!=null&&u(i,["responseSchema"],PD(Ys(F)));const L=l(e,["responseJsonSchema"]);L!=null&&u(i,["responseJsonSchema"],L);const V=l(e,["routingConfig"]);V!=null&&u(i,["routingConfig"],V);const O=l(e,["modelSelectionConfig"]);O!=null&&u(i,["modelConfig"],xD(O));const U=l(e,["safetySettings"]);if(t!==void 0&&U!=null){let st=U;Array.isArray(st)&&(st=st.map($r=>kD($r))),u(t,["safetySettings"],st)}const q=l(e,["tools"]);if(t!==void 0&&q!=null){let st=Br(q);Array.isArray(st)&&(st=st.map($r=>nT(Or($r)))),u(t,["tools"],st)}const I=l(e,["toolConfig"]);t!==void 0&&I!=null&&u(t,["toolConfig"],HD(I));const T=l(e,["labels"]);t!==void 0&&T!=null&&u(t,["labels"],T);const E=l(e,["cachedContent"]);t!==void 0&&E!=null&&u(t,["cachedContent"],pn(n,E));const R=l(e,["responseModalities"]);R!=null&&u(i,["responseModalities"],R);const w=l(e,["mediaResolution"]);w!=null&&u(i,["mediaResolution"],w);const k=l(e,["speechConfig"]);k!=null&&u(i,["speechConfig"],KD(Rd(k)));const S=l(e,["audioTimestamp"]);S!=null&&u(i,["audioTimestamp"],S);const Tt=l(e,["thinkingConfig"]);return Tt!=null&&u(i,["thinkingConfig"],JD(Tt)),i}function tg(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["_url","model"],Te(n,i));const r=l(e,["contents"]);if(r!=null){let o=St(r);Array.isArray(o)&&(o=o.map(a=>qr(a))),u(t,["contents"],o)}const s=l(e,["config"]);return s!=null&&u(t,["generationConfig"],YD(n,s,t)),t}function XD(n,e){const t={},i=l(n,["taskType"]);e!==void 0&&i!=null&&u(e,["instances[]","task_type"],i);const r=l(n,["title"]);e!==void 0&&r!=null&&u(e,["instances[]","title"],r);const s=l(n,["outputDimensionality"]);e!==void 0&&s!=null&&u(e,["parameters","outputDimensionality"],s);const o=l(n,["mimeType"]);e!==void 0&&o!=null&&u(e,["instances[]","mimeType"],o);const a=l(n,["autoTruncate"]);return e!==void 0&&a!=null&&u(e,["parameters","autoTruncate"],a),t}function QD(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["_url","model"],Te(n,i));const r=l(e,["contents"]);r!=null&&u(t,["instances[]","content"],Bv(n,r));const s=l(e,["config"]);return s!=null&&u(t,["config"],XD(s,t)),t}function ZD(n,e){const t={},i=l(n,["outputGcsUri"]);e!==void 0&&i!=null&&u(e,["parameters","storageUri"],i);const r=l(n,["negativePrompt"]);e!==void 0&&r!=null&&u(e,["parameters","negativePrompt"],r);const s=l(n,["numberOfImages"]);e!==void 0&&s!=null&&u(e,["parameters","sampleCount"],s);const o=l(n,["aspectRatio"]);e!==void 0&&o!=null&&u(e,["parameters","aspectRatio"],o);const a=l(n,["guidanceScale"]);e!==void 0&&a!=null&&u(e,["parameters","guidanceScale"],a);const c=l(n,["seed"]);e!==void 0&&c!=null&&u(e,["parameters","seed"],c);const d=l(n,["safetyFilterLevel"]);e!==void 0&&d!=null&&u(e,["parameters","safetySetting"],d);const h=l(n,["personGeneration"]);e!==void 0&&h!=null&&u(e,["parameters","personGeneration"],h);const p=l(n,["includeSafetyAttributes"]);e!==void 0&&p!=null&&u(e,["parameters","includeSafetyAttributes"],p);const g=l(n,["includeRaiReason"]);e!==void 0&&g!=null&&u(e,["parameters","includeRaiReason"],g);const _=l(n,["language"]);e!==void 0&&_!=null&&u(e,["parameters","language"],_);const C=l(n,["outputMimeType"]);e!==void 0&&C!=null&&u(e,["parameters","outputOptions","mimeType"],C);const P=l(n,["outputCompressionQuality"]);e!==void 0&&P!=null&&u(e,["parameters","outputOptions","compressionQuality"],P);const x=l(n,["addWatermark"]);e!==void 0&&x!=null&&u(e,["parameters","addWatermark"],x);const F=l(n,["enhancePrompt"]);return e!==void 0&&F!=null&&u(e,["parameters","enhancePrompt"],F),t}function jD(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["_url","model"],Te(n,i));const r=l(e,["prompt"]);r!=null&&u(t,["instances[0]","prompt"],r);const s=l(e,["config"]);return s!=null&&u(t,["config"],ZD(s,t)),t}function xl(n){const e={},t=l(n,["gcsUri"]);t!=null&&u(e,["gcsUri"],t);const i=l(n,["imageBytes"]);i!=null&&u(e,["bytesBase64Encoded"],mn(i));const r=l(n,["mimeType"]);return r!=null&&u(e,["mimeType"],r),e}function eN(n){const e={},t=l(n,["maskMode"]);t!=null&&u(e,["maskMode"],t);const i=l(n,["segmentationClasses"]);i!=null&&u(e,["maskClasses"],i);const r=l(n,["maskDilation"]);return r!=null&&u(e,["dilation"],r),e}function tN(n){const e={},t=l(n,["controlType"]);t!=null&&u(e,["controlType"],t);const i=l(n,["enableControlImageComputation"]);return i!=null&&u(e,["computeControl"],i),e}function nN(n){const e={},t=l(n,["styleDescription"]);return t!=null&&u(e,["styleDescription"],t),e}function iN(n){const e={},t=l(n,["subjectType"]);t!=null&&u(e,["subjectType"],t);const i=l(n,["subjectDescription"]);return i!=null&&u(e,["subjectDescription"],i),e}function rN(n){const e={},t=l(n,["referenceImage"]);t!=null&&u(e,["referenceImage"],xl(t));const i=l(n,["referenceId"]);i!=null&&u(e,["referenceId"],i);const r=l(n,["referenceType"]);r!=null&&u(e,["referenceType"],r);const s=l(n,["maskImageConfig"]);s!=null&&u(e,["maskImageConfig"],eN(s));const o=l(n,["controlImageConfig"]);o!=null&&u(e,["controlImageConfig"],tN(o));const a=l(n,["styleImageConfig"]);a!=null&&u(e,["styleImageConfig"],nN(a));const c=l(n,["subjectImageConfig"]);return c!=null&&u(e,["subjectImageConfig"],iN(c)),e}function sN(n,e){const t={},i=l(n,["outputGcsUri"]);e!==void 0&&i!=null&&u(e,["parameters","storageUri"],i);const r=l(n,["negativePrompt"]);e!==void 0&&r!=null&&u(e,["parameters","negativePrompt"],r);const s=l(n,["numberOfImages"]);e!==void 0&&s!=null&&u(e,["parameters","sampleCount"],s);const o=l(n,["aspectRatio"]);e!==void 0&&o!=null&&u(e,["parameters","aspectRatio"],o);const a=l(n,["guidanceScale"]);e!==void 0&&a!=null&&u(e,["parameters","guidanceScale"],a);const c=l(n,["seed"]);e!==void 0&&c!=null&&u(e,["parameters","seed"],c);const d=l(n,["safetyFilterLevel"]);e!==void 0&&d!=null&&u(e,["parameters","safetySetting"],d);const h=l(n,["personGeneration"]);e!==void 0&&h!=null&&u(e,["parameters","personGeneration"],h);const p=l(n,["includeSafetyAttributes"]);e!==void 0&&p!=null&&u(e,["parameters","includeSafetyAttributes"],p);const g=l(n,["includeRaiReason"]);e!==void 0&&g!=null&&u(e,["parameters","includeRaiReason"],g);const _=l(n,["language"]);e!==void 0&&_!=null&&u(e,["parameters","language"],_);const C=l(n,["outputMimeType"]);e!==void 0&&C!=null&&u(e,["parameters","outputOptions","mimeType"],C);const P=l(n,["outputCompressionQuality"]);e!==void 0&&P!=null&&u(e,["parameters","outputOptions","compressionQuality"],P);const x=l(n,["editMode"]);e!==void 0&&x!=null&&u(e,["parameters","editMode"],x);const F=l(n,["baseSteps"]);return e!==void 0&&F!=null&&u(e,["parameters","editConfig","baseSteps"],F),t}function oN(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["_url","model"],Te(n,i));const r=l(e,["prompt"]);r!=null&&u(t,["instances[0]","prompt"],r);const s=l(e,["referenceImages"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(c=>rN(c))),u(t,["instances[0]","referenceImages"],a)}const o=l(e,["config"]);return o!=null&&u(t,["config"],sN(o,t)),t}function aN(n,e){const t={},i=l(n,["includeRaiReason"]);e!==void 0&&i!=null&&u(e,["parameters","includeRaiReason"],i);const r=l(n,["outputMimeType"]);e!==void 0&&r!=null&&u(e,["parameters","outputOptions","mimeType"],r);const s=l(n,["outputCompressionQuality"]);e!==void 0&&s!=null&&u(e,["parameters","outputOptions","compressionQuality"],s);const o=l(n,["enhanceInputImage"]);e!==void 0&&o!=null&&u(e,["parameters","upscaleConfig","enhanceInputImage"],o);const a=l(n,["imagePreservationFactor"]);e!==void 0&&a!=null&&u(e,["parameters","upscaleConfig","imagePreservationFactor"],a);const c=l(n,["numberOfImages"]);e!==void 0&&c!=null&&u(e,["parameters","sampleCount"],c);const d=l(n,["mode"]);return e!==void 0&&d!=null&&u(e,["parameters","mode"],d),t}function lN(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["_url","model"],Te(n,i));const r=l(e,["image"]);r!=null&&u(t,["instances[0]","image"],xl(r));const s=l(e,["upscaleFactor"]);s!=null&&u(t,["parameters","upscaleConfig","upscaleFactor"],s);const o=l(e,["config"]);return o!=null&&u(t,["config"],aN(o,t)),t}function uN(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["_url","name"],Te(n,i));const r=l(e,["config"]);return r!=null&&u(t,["config"],r),t}function cN(n,e,t){const i={},r=l(e,["pageSize"]);t!==void 0&&r!=null&&u(t,["_query","pageSize"],r);const s=l(e,["pageToken"]);t!==void 0&&s!=null&&u(t,["_query","pageToken"],s);const o=l(e,["filter"]);t!==void 0&&o!=null&&u(t,["_query","filter"],o);const a=l(e,["queryBase"]);return t!==void 0&&a!=null&&u(t,["_url","models_url"],Gv(n,a)),i}function dN(n,e){const t={},i=l(e,["config"]);return i!=null&&u(t,["config"],cN(n,i,t)),t}function fN(n,e){const t={},i=l(n,["displayName"]);e!==void 0&&i!=null&&u(e,["displayName"],i);const r=l(n,["description"]);e!==void 0&&r!=null&&u(e,["description"],r);const s=l(n,["defaultCheckpointId"]);return e!==void 0&&s!=null&&u(e,["defaultCheckpointId"],s),t}function hN(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["_url","model"],Te(n,i));const r=l(e,["config"]);return r!=null&&u(t,["config"],fN(r,t)),t}function pN(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["_url","name"],Te(n,i));const r=l(e,["config"]);return r!=null&&u(t,["config"],r),t}function mN(n,e){const t={},i=l(n,["systemInstruction"]);e!==void 0&&i!=null&&u(e,["systemInstruction"],qr(nt(i)));const r=l(n,["tools"]);if(e!==void 0&&r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>nT(a))),u(e,["tools"],o)}const s=l(n,["generationConfig"]);return e!==void 0&&s!=null&&u(e,["generationConfig"],s),t}function gN(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["_url","model"],Te(n,i));const r=l(e,["contents"]);if(r!=null){let o=St(r);Array.isArray(o)&&(o=o.map(a=>qr(a))),u(t,["contents"],o)}const s=l(e,["config"]);return s!=null&&u(t,["config"],mN(s,t)),t}function yN(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["_url","model"],Te(n,i));const r=l(e,["contents"]);if(r!=null){let o=St(r);Array.isArray(o)&&(o=o.map(a=>qr(a))),u(t,["contents"],o)}const s=l(e,["config"]);return s!=null&&u(t,["config"],s),t}function _N(n){const e={},t=l(n,["uri"]);t!=null&&u(e,["gcsUri"],t);const i=l(n,["videoBytes"]);i!=null&&u(e,["bytesBase64Encoded"],mn(i));const r=l(n,["mimeType"]);return r!=null&&u(e,["mimeType"],r),e}function vN(n,e){const t={},i=l(n,["numberOfVideos"]);e!==void 0&&i!=null&&u(e,["parameters","sampleCount"],i);const r=l(n,["outputGcsUri"]);e!==void 0&&r!=null&&u(e,["parameters","storageUri"],r);const s=l(n,["fps"]);e!==void 0&&s!=null&&u(e,["parameters","fps"],s);const o=l(n,["durationSeconds"]);e!==void 0&&o!=null&&u(e,["parameters","durationSeconds"],o);const a=l(n,["seed"]);e!==void 0&&a!=null&&u(e,["parameters","seed"],a);const c=l(n,["aspectRatio"]);e!==void 0&&c!=null&&u(e,["parameters","aspectRatio"],c);const d=l(n,["resolution"]);e!==void 0&&d!=null&&u(e,["parameters","resolution"],d);const h=l(n,["personGeneration"]);e!==void 0&&h!=null&&u(e,["parameters","personGeneration"],h);const p=l(n,["pubsubTopic"]);e!==void 0&&p!=null&&u(e,["parameters","pubsubTopic"],p);const g=l(n,["negativePrompt"]);e!==void 0&&g!=null&&u(e,["parameters","negativePrompt"],g);const _=l(n,["enhancePrompt"]);e!==void 0&&_!=null&&u(e,["parameters","enhancePrompt"],_);const C=l(n,["generateAudio"]);e!==void 0&&C!=null&&u(e,["parameters","generateAudio"],C);const P=l(n,["lastFrame"]);e!==void 0&&P!=null&&u(e,["instances[0]","lastFrame"],xl(P));const x=l(n,["compressionQuality"]);return e!==void 0&&x!=null&&u(e,["parameters","compressionQuality"],x),t}function TN(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["_url","model"],Te(n,i));const r=l(e,["prompt"]);r!=null&&u(t,["instances[0]","prompt"],r);const s=l(e,["image"]);s!=null&&u(t,["instances[0]","image"],xl(s));const o=l(e,["video"]);o!=null&&u(t,["instances[0]","video"],_N(o));const a=l(e,["config"]);return a!=null&&u(t,["config"],vN(a,t)),t}function EN(n){const e={},t=l(n,["fps"]);t!=null&&u(e,["fps"],t);const i=l(n,["endOffset"]);i!=null&&u(e,["endOffset"],i);const r=l(n,["startOffset"]);return r!=null&&u(e,["startOffset"],r),e}function IN(n){const e={},t=l(n,["data"]);t!=null&&u(e,["data"],t);const i=l(n,["mimeType"]);return i!=null&&u(e,["mimeType"],i),e}function CN(n){const e={},t=l(n,["fileUri"]);t!=null&&u(e,["fileUri"],t);const i=l(n,["mimeType"]);return i!=null&&u(e,["mimeType"],i),e}function wN(n){const e={},t=l(n,["videoMetadata"]);t!=null&&u(e,["videoMetadata"],EN(t));const i=l(n,["thought"]);i!=null&&u(e,["thought"],i);const r=l(n,["inlineData"]);r!=null&&u(e,["inlineData"],IN(r));const s=l(n,["fileData"]);s!=null&&u(e,["fileData"],CN(s));const o=l(n,["thoughtSignature"]);o!=null&&u(e,["thoughtSignature"],o);const a=l(n,["codeExecutionResult"]);a!=null&&u(e,["codeExecutionResult"],a);const c=l(n,["executableCode"]);c!=null&&u(e,["executableCode"],c);const d=l(n,["functionCall"]);d!=null&&u(e,["functionCall"],d);const h=l(n,["functionResponse"]);h!=null&&u(e,["functionResponse"],h);const p=l(n,["text"]);return p!=null&&u(e,["text"],p),e}function AN(n){const e={},t=l(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(s=>wN(s))),u(e,["parts"],r)}const i=l(n,["role"]);return i!=null&&u(e,["role"],i),e}function SN(n){const e={},t=l(n,["citationSources"]);return t!=null&&u(e,["citations"],t),e}function RN(n){const e={},t=l(n,["retrievedUrl"]);t!=null&&u(e,["retrievedUrl"],t);const i=l(n,["urlRetrievalStatus"]);return i!=null&&u(e,["urlRetrievalStatus"],i),e}function PN(n){const e={},t=l(n,["urlMetadata"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>RN(r))),u(e,["urlMetadata"],i)}return e}function xN(n){const e={},t=l(n,["content"]);t!=null&&u(e,["content"],AN(t));const i=l(n,["citationMetadata"]);i!=null&&u(e,["citationMetadata"],SN(i));const r=l(n,["tokenCount"]);r!=null&&u(e,["tokenCount"],r);const s=l(n,["finishReason"]);s!=null&&u(e,["finishReason"],s);const o=l(n,["urlContextMetadata"]);o!=null&&u(e,["urlContextMetadata"],PN(o));const a=l(n,["avgLogprobs"]);a!=null&&u(e,["avgLogprobs"],a);const c=l(n,["groundingMetadata"]);c!=null&&u(e,["groundingMetadata"],c);const d=l(n,["index"]);d!=null&&u(e,["index"],d);const h=l(n,["logprobsResult"]);h!=null&&u(e,["logprobsResult"],h);const p=l(n,["safetyRatings"]);return p!=null&&u(e,["safetyRatings"],p),e}function ng(n){const e={},t=l(n,["candidates"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(a=>xN(a))),u(e,["candidates"],o)}const i=l(n,["modelVersion"]);i!=null&&u(e,["modelVersion"],i);const r=l(n,["promptFeedback"]);r!=null&&u(e,["promptFeedback"],r);const s=l(n,["usageMetadata"]);return s!=null&&u(e,["usageMetadata"],s),e}function kN(n){const e={},t=l(n,["values"]);return t!=null&&u(e,["values"],t),e}function bN(){return{}}function MN(n){const e={},t=l(n,["embeddings"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(s=>kN(s))),u(e,["embeddings"],r)}return l(n,["metadata"])!=null&&u(e,["metadata"],bN()),e}function DN(n){const e={},t=l(n,["bytesBase64Encoded"]);t!=null&&u(e,["imageBytes"],mn(t));const i=l(n,["mimeType"]);return i!=null&&u(e,["mimeType"],i),e}function iT(n){const e={},t=l(n,["safetyAttributes","categories"]);t!=null&&u(e,["categories"],t);const i=l(n,["safetyAttributes","scores"]);i!=null&&u(e,["scores"],i);const r=l(n,["contentType"]);return r!=null&&u(e,["contentType"],r),e}function NN(n){const e={},t=l(n,["_self"]);t!=null&&u(e,["image"],DN(t));const i=l(n,["raiFilteredReason"]);i!=null&&u(e,["raiFilteredReason"],i);const r=l(n,["_self"]);return r!=null&&u(e,["safetyAttributes"],iT(r)),e}function VN(n){const e={},t=l(n,["predictions"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(s=>NN(s))),u(e,["generatedImages"],r)}const i=l(n,["positivePromptSafetyAttributes"]);return i!=null&&u(e,["positivePromptSafetyAttributes"],iT(i)),e}function LN(n){const e={},t=l(n,["baseModel"]);t!=null&&u(e,["baseModel"],t);const i=l(n,["createTime"]);i!=null&&u(e,["createTime"],i);const r=l(n,["updateTime"]);return r!=null&&u(e,["updateTime"],r),e}function mc(n){const e={},t=l(n,["name"]);t!=null&&u(e,["name"],t);const i=l(n,["displayName"]);i!=null&&u(e,["displayName"],i);const r=l(n,["description"]);r!=null&&u(e,["description"],r);const s=l(n,["version"]);s!=null&&u(e,["version"],s);const o=l(n,["_self"]);o!=null&&u(e,["tunedModelInfo"],LN(o));const a=l(n,["inputTokenLimit"]);a!=null&&u(e,["inputTokenLimit"],a);const c=l(n,["outputTokenLimit"]);c!=null&&u(e,["outputTokenLimit"],c);const d=l(n,["supportedGenerationMethods"]);return d!=null&&u(e,["supportedActions"],d),e}function FN(n,e){const t={},i=l(e,["nextPageToken"]);i!=null&&u(t,["nextPageToken"],i);const r=l(e,["_self"]);if(r!=null){let s=Hv(r);Array.isArray(s)&&(s=s.map(o=>mc(o))),u(t,["models"],s)}return t}function UN(){return{}}function ON(n){const e={},t=l(n,["totalTokens"]);t!=null&&u(e,["totalTokens"],t);const i=l(n,["cachedContentTokenCount"]);return i!=null&&u(e,["cachedContentTokenCount"],i),e}function BN(n){const e={},t=l(n,["video","uri"]);t!=null&&u(e,["uri"],t);const i=l(n,["video","encodedVideo"]);i!=null&&u(e,["videoBytes"],mn(i));const r=l(n,["encoding"]);return r!=null&&u(e,["mimeType"],r),e}function qN(n){const e={},t=l(n,["_self"]);return t!=null&&u(e,["video"],BN(t)),e}function $N(n){const e={},t=l(n,["generatedSamples"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>qN(o))),u(e,["generatedVideos"],s)}const i=l(n,["raiMediaFilteredCount"]);i!=null&&u(e,["raiMediaFilteredCount"],i);const r=l(n,["raiMediaFilteredReasons"]);return r!=null&&u(e,["raiMediaFilteredReasons"],r),e}function GN(n){const e={},t=l(n,["name"]);t!=null&&u(e,["name"],t);const i=l(n,["metadata"]);i!=null&&u(e,["metadata"],i);const r=l(n,["done"]);r!=null&&u(e,["done"],r);const s=l(n,["error"]);s!=null&&u(e,["error"],s);const o=l(n,["response","generateVideoResponse"]);return o!=null&&u(e,["response"],$N(o)),e}function HN(n){const e={},t=l(n,["fps"]);t!=null&&u(e,["fps"],t);const i=l(n,["endOffset"]);i!=null&&u(e,["endOffset"],i);const r=l(n,["startOffset"]);return r!=null&&u(e,["startOffset"],r),e}function zN(n){const e={},t=l(n,["displayName"]);t!=null&&u(e,["displayName"],t);const i=l(n,["data"]);i!=null&&u(e,["data"],i);const r=l(n,["mimeType"]);return r!=null&&u(e,["mimeType"],r),e}function WN(n){const e={},t=l(n,["displayName"]);t!=null&&u(e,["displayName"],t);const i=l(n,["fileUri"]);i!=null&&u(e,["fileUri"],i);const r=l(n,["mimeType"]);return r!=null&&u(e,["mimeType"],r),e}function KN(n){const e={},t=l(n,["videoMetadata"]);t!=null&&u(e,["videoMetadata"],HN(t));const i=l(n,["thought"]);i!=null&&u(e,["thought"],i);const r=l(n,["inlineData"]);r!=null&&u(e,["inlineData"],zN(r));const s=l(n,["fileData"]);s!=null&&u(e,["fileData"],WN(s));const o=l(n,["thoughtSignature"]);o!=null&&u(e,["thoughtSignature"],o);const a=l(n,["codeExecutionResult"]);a!=null&&u(e,["codeExecutionResult"],a);const c=l(n,["executableCode"]);c!=null&&u(e,["executableCode"],c);const d=l(n,["functionCall"]);d!=null&&u(e,["functionCall"],d);const h=l(n,["functionResponse"]);h!=null&&u(e,["functionResponse"],h);const p=l(n,["text"]);return p!=null&&u(e,["text"],p),e}function JN(n){const e={},t=l(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(s=>KN(s))),u(e,["parts"],r)}const i=l(n,["role"]);return i!=null&&u(e,["role"],i),e}function YN(n){const e={},t=l(n,["citations"]);return t!=null&&u(e,["citations"],t),e}function XN(n){const e={},t=l(n,["retrievedUrl"]);t!=null&&u(e,["retrievedUrl"],t);const i=l(n,["urlRetrievalStatus"]);return i!=null&&u(e,["urlRetrievalStatus"],i),e}function QN(n){const e={},t=l(n,["urlMetadata"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>XN(r))),u(e,["urlMetadata"],i)}return e}function ZN(n){const e={},t=l(n,["content"]);t!=null&&u(e,["content"],JN(t));const i=l(n,["citationMetadata"]);i!=null&&u(e,["citationMetadata"],YN(i));const r=l(n,["finishMessage"]);r!=null&&u(e,["finishMessage"],r);const s=l(n,["finishReason"]);s!=null&&u(e,["finishReason"],s);const o=l(n,["urlContextMetadata"]);o!=null&&u(e,["urlContextMetadata"],QN(o));const a=l(n,["avgLogprobs"]);a!=null&&u(e,["avgLogprobs"],a);const c=l(n,["groundingMetadata"]);c!=null&&u(e,["groundingMetadata"],c);const d=l(n,["index"]);d!=null&&u(e,["index"],d);const h=l(n,["logprobsResult"]);h!=null&&u(e,["logprobsResult"],h);const p=l(n,["safetyRatings"]);return p!=null&&u(e,["safetyRatings"],p),e}function ig(n){const e={},t=l(n,["candidates"]);if(t!=null){let c=t;Array.isArray(c)&&(c=c.map(d=>ZN(d))),u(e,["candidates"],c)}const i=l(n,["createTime"]);i!=null&&u(e,["createTime"],i);const r=l(n,["responseId"]);r!=null&&u(e,["responseId"],r);const s=l(n,["modelVersion"]);s!=null&&u(e,["modelVersion"],s);const o=l(n,["promptFeedback"]);o!=null&&u(e,["promptFeedback"],o);const a=l(n,["usageMetadata"]);return a!=null&&u(e,["usageMetadata"],a),e}function jN(n){const e={},t=l(n,["truncated"]);t!=null&&u(e,["truncated"],t);const i=l(n,["token_count"]);return i!=null&&u(e,["tokenCount"],i),e}function eV(n){const e={},t=l(n,["values"]);t!=null&&u(e,["values"],t);const i=l(n,["statistics"]);return i!=null&&u(e,["statistics"],jN(i)),e}function tV(n){const e={},t=l(n,["billableCharacterCount"]);return t!=null&&u(e,["billableCharacterCount"],t),e}function nV(n){const e={},t=l(n,["predictions[]","embeddings"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(s=>eV(s))),u(e,["embeddings"],r)}const i=l(n,["metadata"]);return i!=null&&u(e,["metadata"],tV(i)),e}function iV(n){const e={},t=l(n,["gcsUri"]);t!=null&&u(e,["gcsUri"],t);const i=l(n,["bytesBase64Encoded"]);i!=null&&u(e,["imageBytes"],mn(i));const r=l(n,["mimeType"]);return r!=null&&u(e,["mimeType"],r),e}function rT(n){const e={},t=l(n,["safetyAttributes","categories"]);t!=null&&u(e,["categories"],t);const i=l(n,["safetyAttributes","scores"]);i!=null&&u(e,["scores"],i);const r=l(n,["contentType"]);return r!=null&&u(e,["contentType"],r),e}function xd(n){const e={},t=l(n,["_self"]);t!=null&&u(e,["image"],iV(t));const i=l(n,["raiFilteredReason"]);i!=null&&u(e,["raiFilteredReason"],i);const r=l(n,["_self"]);r!=null&&u(e,["safetyAttributes"],rT(r));const s=l(n,["prompt"]);return s!=null&&u(e,["enhancedPrompt"],s),e}function rV(n){const e={},t=l(n,["predictions"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(s=>xd(s))),u(e,["generatedImages"],r)}const i=l(n,["positivePromptSafetyAttributes"]);return i!=null&&u(e,["positivePromptSafetyAttributes"],rT(i)),e}function sV(n){const e={},t=l(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>xd(r))),u(e,["generatedImages"],i)}return e}function oV(n){const e={},t=l(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>xd(r))),u(e,["generatedImages"],i)}return e}function aV(n){const e={},t=l(n,["endpoint"]);t!=null&&u(e,["name"],t);const i=l(n,["deployedModelId"]);return i!=null&&u(e,["deployedModelId"],i),e}function lV(n){const e={},t=l(n,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&u(e,["baseModel"],t);const i=l(n,["createTime"]);i!=null&&u(e,["createTime"],i);const r=l(n,["updateTime"]);return r!=null&&u(e,["updateTime"],r),e}function uV(n){const e={},t=l(n,["checkpointId"]);t!=null&&u(e,["checkpointId"],t);const i=l(n,["epoch"]);i!=null&&u(e,["epoch"],i);const r=l(n,["step"]);return r!=null&&u(e,["step"],r),e}function gc(n){const e={},t=l(n,["name"]);t!=null&&u(e,["name"],t);const i=l(n,["displayName"]);i!=null&&u(e,["displayName"],i);const r=l(n,["description"]);r!=null&&u(e,["description"],r);const s=l(n,["versionId"]);s!=null&&u(e,["version"],s);const o=l(n,["deployedModels"]);if(o!=null){let p=o;Array.isArray(p)&&(p=p.map(g=>aV(g))),u(e,["endpoints"],p)}const a=l(n,["labels"]);a!=null&&u(e,["labels"],a);const c=l(n,["_self"]);c!=null&&u(e,["tunedModelInfo"],lV(c));const d=l(n,["defaultCheckpointId"]);d!=null&&u(e,["defaultCheckpointId"],d);const h=l(n,["checkpoints"]);if(h!=null){let p=h;Array.isArray(p)&&(p=p.map(g=>uV(g))),u(e,["checkpoints"],p)}return e}function cV(n,e){const t={},i=l(e,["nextPageToken"]);i!=null&&u(t,["nextPageToken"],i);const r=l(e,["_self"]);if(r!=null){let s=Hv(r);Array.isArray(s)&&(s=s.map(o=>gc(o))),u(t,["models"],s)}return t}function dV(){return{}}function fV(n){const e={},t=l(n,["totalTokens"]);return t!=null&&u(e,["totalTokens"],t),e}function hV(n){const e={},t=l(n,["tokensInfo"]);return t!=null&&u(e,["tokensInfo"],t),e}function pV(n){const e={},t=l(n,["gcsUri"]);t!=null&&u(e,["uri"],t);const i=l(n,["bytesBase64Encoded"]);i!=null&&u(e,["videoBytes"],mn(i));const r=l(n,["mimeType"]);return r!=null&&u(e,["mimeType"],r),e}function mV(n){const e={},t=l(n,["_self"]);return t!=null&&u(e,["video"],pV(t)),e}function gV(n){const e={},t=l(n,["videos"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>mV(o))),u(e,["generatedVideos"],s)}const i=l(n,["raiMediaFilteredCount"]);i!=null&&u(e,["raiMediaFilteredCount"],i);const r=l(n,["raiMediaFilteredReasons"]);return r!=null&&u(e,["raiMediaFilteredReasons"],r),e}function yV(n){const e={},t=l(n,["name"]);t!=null&&u(e,["name"],t);const i=l(n,["metadata"]);i!=null&&u(e,["metadata"],i);const r=l(n,["done"]);r!=null&&u(e,["done"],r);const s=l(n,["error"]);s!=null&&u(e,["error"],s);const o=l(n,["response"]);return o!=null&&u(e,["response"],gV(o)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const _V="Content-Type",vV="X-Server-Timeout",TV="User-Agent",yc="x-goog-api-client",EV="1.7.0",IV=`google-genai-sdk/${EV}`,CV="v1beta1",wV="v1beta",rg=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class AV{constructor(e){var t,i;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const r={};this.clientOptions.vertexai?(r.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:CV,r.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(r.apiVersion=(i=this.clientOptions.apiVersion)!==null&&i!==void 0?i:wV,r.baseUrl="https://generativelanguage.googleapis.com/"),r.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=r,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(r,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const i=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&i.push(e.apiVersion),i.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,i){const r=[this.getRequestUrlInternal(t)];return i&&r.push(this.getBaseResourcePath()),e!==""&&r.push(e),new URL(`${r.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const i=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,t,i);if(e.queryParams)for(const[o,a]of Object.entries(e.queryParams))r.searchParams.append(o,String(a));let s={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else s.body=e.body;return s=await this.includeExtraHttpOptionsToRequestInit(s,t,e.abortSignal),this.unaryApiCall(r,s,e.httpMethod)}patchHttpOptions(e,t){const i=JSON.parse(JSON.stringify(e));for(const[r,s]of Object.entries(t))typeof s=="object"?i[r]=Object.assign(Object.assign({},i[r]),s):s!==void 0&&(i[r]=s);return i}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const i=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,t,i);(!r.searchParams.has("alt")||r.searchParams.get("alt")!=="sse")&&r.searchParams.set("alt","sse");let s={};return s.body=e.body,s=await this.includeExtraHttpOptionsToRequestInit(s,t,e.abortSignal),this.streamApiCall(r,s,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,i){if(t&&t.timeout||i){const r=new AbortController,s=r.signal;t.timeout&&(t==null?void 0:t.timeout)>0&&setTimeout(()=>r.abort(),t.timeout),i&&i.addEventListener("abort",()=>{r.abort()}),e.signal=s}return t&&t.extraBody!==null&&SV(e,t.extraBody),e.headers=await this.getHeadersInternal(t),e}async unaryApiCall(e,t,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:i})).then(async r=>(await sg(r),new uc(r))).catch(r=>{throw r instanceof Error?r:new Error(JSON.stringify(r))})}async streamApiCall(e,t,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:i})).then(async r=>(await sg(r),this.processStreamResponse(r))).catch(r=>{throw r instanceof Error?r:new Error(JSON.stringify(r))})}processStreamResponse(e){var t;return ur(this,arguments,function*(){const r=(t=e==null?void 0:e.body)===null||t===void 0?void 0:t.getReader(),s=new TextDecoder("utf-8");if(!r)throw new Error("Response body is empty");try{let o="";for(;;){const{done:a,value:c}=yield we(r.read());if(a){if(o.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const d=s.decode(c);try{const p=JSON.parse(d);if("error"in p){const g=JSON.parse(JSON.stringify(p.error)),_=g.status,C=g.code,P=`got status: ${_}. ${JSON.stringify(p)}`;if(C>=400&&C<600)throw new Rl({message:P,status:C})}}catch(p){if(p.name==="ApiError")throw p}o+=d;let h=o.match(rg);for(;h;){const p=h[1];try{const g=new Response(p,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield we(new uc(g)),o=o.slice(h[0].length),h=o.match(rg)}catch(g){throw new Error(`exception parsing stream chunk ${p}. ${g}`)}}}}finally{r.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(i=>{throw new Error(`exception ${i} sending request`)})}getDefaultHeaders(){const e={},t=IV+" "+this.clientOptions.userAgentExtra;return e[TV]=t,e[yc]=t,e[_V]="application/json",e}async getHeadersInternal(e){const t=new Headers;if(e&&e.headers){for(const[i,r]of Object.entries(e.headers))t.append(i,r);e.timeout&&e.timeout>0&&t.append(vV,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(t),t}async uploadFile(e,t){var i;const r={};t!=null&&(r.mimeType=t.mimeType,r.name=t.name,r.displayName=t.displayName),r.name&&!r.name.startsWith("files/")&&(r.name=`files/${r.name}`);const s=this.clientOptions.uploader,o=await s.stat(e);r.sizeBytes=String(o.size);const a=(i=t==null?void 0:t.mimeType)!==null&&i!==void 0?i:o.type;if(a===void 0||a==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");r.mimeType=a;const c=await this.fetchUploadUrl(r,t);return s.upload(e,c,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t){var i;let r={};t!=null&&t.httpOptions?r=t.httpOptions:r={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};const s={file:e},o=await this.request({path:Z("upload/v1beta/files",s._url),body:JSON.stringify(s),httpMethod:"POST",httpOptions:r});if(!o||!(o!=null&&o.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const a=(i=o==null?void 0:o.headers)===null||i===void 0?void 0:i["x-goog-upload-url"];if(a===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return a}}async function sg(n){var e;if(n===void 0)throw new Error("response is undefined");if(!n.ok){const t=n.status;let i;!((e=n.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?i=await n.json():i={error:{message:await n.text(),code:n.status,status:n.statusText}};const r=JSON.stringify(i);throw t>=400&&t<600?new Rl({message:r,status:t}):new Error(r)}}function SV(n,e){if(!e||Object.keys(e).length===0)return;if(n.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof n.body=="string"&&n.body.length>0)try{const s=JSON.parse(n.body);if(typeof s=="object"&&s!==null&&!Array.isArray(s))t=s;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function i(s,o){const a=Object.assign({},s);for(const c in o)if(Object.prototype.hasOwnProperty.call(o,c)){const d=o[c],h=a[c];d&&typeof d=="object"&&!Array.isArray(d)&&h&&typeof h=="object"&&!Array.isArray(h)?a[c]=i(h,d):(h&&d&&typeof h!=typeof d&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${c}". Original type: ${typeof h}, New type: ${typeof d}. Overwriting.`),a[c]=d)}return a}const r=i(t,e);n.body=JSON.stringify(r)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const RV="mcp_used/unknown";function sT(n){for(const e of n)if(kd(e)||typeof e=="object"&&"inputSchema"in e)return!0;return!1}function oT(n){var e;const t=(e=n[yc])!==null&&e!==void 0?e:"";n[yc]=(t+` ${RV}`).trimStart()}function PV(n){var e,t,i;return(i=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(r=>kd(r)))!==null&&i!==void 0?i:!1}function xV(n){var e,t,i;return(i=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(r=>!kd(r)))!==null&&i!==void 0?i:!1}function kd(n){return n!==null&&typeof n=="object"&&n instanceof bd}function kV(n,e=100){return ur(this,arguments,function*(){let i,r=0;for(;r<e;){const s=yield we(n.listTools({cursor:i}));for(const o of s.tools)yield yield we(o),r++;if(!s.nextCursor)break;i=s.nextCursor}})}class bd{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new bd(e,t)}async initialize(){var e,t,i,r;if(this.mcpTools.length>0)return;const s={},o=[];for(const h of this.mcpClients)try{for(var a=!0,c=(t=void 0,ks(kV(h))),d;d=await c.next(),e=d.done,!e;a=!0){r=d.value,a=!1;const p=r;o.push(p);const g=p.name;if(s[g])throw new Error(`Duplicate function name ${g} found in MCP tools. Please ensure function names are unique.`);s[g]=h}}catch(p){t={error:p}}finally{try{!a&&!e&&(i=c.return)&&await i.call(c)}finally{if(t)throw t.error}}this.mcpTools=o,this.functionNameToMcpClient=s}async tool(){return await this.initialize(),AP(this.mcpTools,this.config)}async callTool(e){await this.initialize();const t=[];for(const i of e)if(i.name in this.functionNameToMcpClient){const r=this.functionNameToMcpClient[i.name];let s;this.config.timeout&&(s={timeout:this.config.timeout});const o=await r.callTool({name:i.name,arguments:i.args},void 0,s);t.push({functionResponse:{name:i.name,response:o.isError?{error:o}:o}})}return t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function bV(n,e,t){const i=new fP;let r;t.data instanceof Blob?r=JSON.parse(await t.data.text()):r=JSON.parse(t.data);const s=OM(r);Object.assign(i,s),e(i)}class MV{constructor(e,t,i){this.apiClient=e,this.auth=t,this.webSocketFactory=i}async connect(e){var t,i;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const r=this.apiClient.getWebsocketBaseUrl(),s=this.apiClient.getApiVersion(),o=VV(this.apiClient.getDefaultHeaders()),a=this.apiClient.getApiKey(),c=`${r}/ws/google.ai.generativelanguage.${s}.GenerativeService.BidiGenerateMusic?key=${a}`;let d=()=>{};const h=new Promise(V=>{d=V}),p=e.callbacks,g=function(){d({})},_=this.apiClient,C={onopen:g,onmessage:V=>{bV(_,p.onmessage,V)},onerror:(t=p==null?void 0:p.onerror)!==null&&t!==void 0?t:function(V){},onclose:(i=p==null?void 0:p.onclose)!==null&&i!==void 0?i:function(V){}},P=this.webSocketFactory.create(c,NV(o),C);P.connect(),await h;const x=Te(this.apiClient,e.model),F=jv({model:x}),L=pc({setup:F});return P.send(JSON.stringify(L)),new DV(P,this.apiClient)}}class DV{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=jb(e),i=eT(t);this.conn.send(JSON.stringify({clientContent:i}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=eM(e),i=pc(t);this.conn.send(JSON.stringify(i))}sendPlaybackControl(e){const t=pc({playbackControl:e});this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(nr.PLAY)}pause(){this.sendPlaybackControl(nr.PAUSE)}stop(){this.sendPlaybackControl(nr.STOP)}resetContext(){this.sendPlaybackControl(nr.RESET_CONTEXT)}close(){this.conn.close()}}function NV(n){const e={};return n.forEach((t,i)=>{e[i]=t}),e}function VV(n){const e=new Headers;for(const[t,i]of Object.entries(n))e.append(t,i);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const LV="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function FV(n,e,t){const i=new dP;let r;t.data instanceof Blob?r=await t.data.text():t.data instanceof ArrayBuffer?r=new TextDecoder().decode(t.data):r=t.data;const s=JSON.parse(r);if(n.isVertexAI()){const o=kM(s);Object.assign(i,o)}else{const o=xM(s);Object.assign(i,o)}e(i)}class UV{constructor(e,t,i){this.apiClient=e,this.auth=t,this.webSocketFactory=i,this.music=new MV(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,i,r,s,o,a;const c=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion();let h;const p=this.apiClient.getDefaultHeaders();e.config&&e.config.tools&&sT(e.config.tools)&&oT(p);const g=$V(p);if(this.apiClient.isVertexAI())h=`${c}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(g);else{const E=this.apiClient.getApiKey();let R="BidiGenerateContent",w="key";E!=null&&E.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),R="BidiGenerateContentConstrained",w="access_token"),h=`${c}/ws/google.ai.generativelanguage.${d}.GenerativeService.${R}?${w}=${E}`}let _=()=>{};const C=new Promise(E=>{_=E}),P=e.callbacks,x=function(){var E;(E=P==null?void 0:P.onopen)===null||E===void 0||E.call(P),_({})},F=this.apiClient,L={onopen:x,onmessage:E=>{FV(F,P.onmessage,E)},onerror:(t=P==null?void 0:P.onerror)!==null&&t!==void 0?t:function(E){},onclose:(i=P==null?void 0:P.onclose)!==null&&i!==void 0?i:function(E){}},V=this.webSocketFactory.create(h,qV(g),L);V.connect(),await C;let O=Te(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&O.startsWith("publishers/")){const E=this.apiClient.getProject(),R=this.apiClient.getLocation();O=`projects/${E}/locations/${R}/`+O}let U={};this.apiClient.isVertexAI()&&((r=e.config)===null||r===void 0?void 0:r.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[za.AUDIO]}:e.config.responseModalities=[za.AUDIO]),!((s=e.config)===null||s===void 0)&&s.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const q=(a=(o=e.config)===null||o===void 0?void 0:o.tools)!==null&&a!==void 0?a:[],I=[];for(const E of q)if(this.isCallableTool(E)){const R=E;I.push(await R.tool())}else I.push(E);I.length>0&&(e.config.tools=I);const T={model:O,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?U=Wb(this.apiClient,T):U=zb(this.apiClient,T),delete U.config,V.send(JSON.stringify(U)),new BV(V,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const OV={turnComplete:!0};class BV{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let i=[];try{i=St(t.turns),e.isVertexAI()?i=i.map(r=>qr(r)):i=i.map(r=>Pl(r))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:i,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let i=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?i=t.functionResponses:i=[t.functionResponses],i.length===0)throw new Error("functionResponses is required.");for(const s of i){if(typeof s!="object"||s===null||!("name"in s)||!("response"in s))throw new Error(`Could not parse function response, type '${typeof s}'.`);if(!e.isVertexAI()&&!("id"in s))throw new Error(LV)}return{toolResponse:{functionResponses:i}}}sendClientContent(e){e=Object.assign(Object.assign({},OV),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:Zb(e)}:t={realtimeInput:Qb(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function qV(n){const e={};return n.forEach((t,i)=>{e[i]=t}),e}function $V(n){const e=new Headers;for(const[t,i]of Object.entries(n))e.append(t,i);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const og=10;function ag(n){var e,t,i;if(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let r=!1;for(const o of(t=n==null?void 0:n.tools)!==null&&t!==void 0?t:[])if(ha(o)){r=!0;break}if(!r)return!0;const s=(i=n==null?void 0:n.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls;return s&&(s<0||!Number.isInteger(s))||s==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",s),!0):!1}function ha(n){return"callTool"in n&&typeof n.callTool=="function"}function lg(n){var e;return!(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class GV extends Fi{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var i,r,s,o,a;const c=await this.processParamsForMcpUsage(t);if(!PV(t)||ag(t.config))return await this.generateContentInternal(c);if(xV(t))throw new Error("Automatic function calling with CallableTools and Tools is not yet supported.");let d,h;const p=St(c.contents),g=(s=(r=(i=c.config)===null||i===void 0?void 0:i.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&s!==void 0?s:og;let _=0;for(;_<g&&(d=await this.generateContentInternal(c),!(!d.functionCalls||d.functionCalls.length===0));){const C=d.candidates[0].content,P=[];for(const x of(a=(o=t.config)===null||o===void 0?void 0:o.tools)!==null&&a!==void 0?a:[])if(ha(x)){const L=await x.callTool(d.functionCalls);P.push(...L)}_++,h={role:"user",parts:P},c.contents=St(c.contents),c.contents.push(C),c.contents.push(h),lg(c.config)&&(p.push(C),p.push(h))}return lg(c.config)&&(d.automaticFunctionCallingHistory=p),d},this.generateContentStream=async t=>{if(ag(t.config)){const i=await this.processParamsForMcpUsage(t);return await this.generateContentStreamInternal(i)}else return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(i=>{var r;let s;const o=[];if(i!=null&&i.generatedImages)for(const c of i.generatedImages)c&&(c!=null&&c.safetyAttributes)&&((r=c==null?void 0:c.safetyAttributes)===null||r===void 0?void 0:r.contentType)==="Positive Prompt"?s=c==null?void 0:c.safetyAttributes:o.push(c);let a;return s?a={generatedImages:o,positivePromptSafetyAttributes:s}:a={generatedImages:o},a}),this.list=async t=>{var i;const o={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!o.config.queryBase){if(!((i=o.config)===null||i===void 0)&&i.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");o.config.filter="labels.tune-type:*"}return new vo(bi.PAGED_ITEM_MODELS,a=>this.listInternal(a),await this.listInternal(o),o)},this.editImage=async t=>{const i={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(i.referenceImages=t.referenceImages.map(r=>r.toReferenceImageAPI())),await this.editImageInternal(i)},this.upscaleImage=async t=>{let i={numberOfImages:1,mode:"upscale"};t.config&&(i=Object.assign(Object.assign({},i),t.config));const r={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:i};return await this.upscaleImageInternal(r)}}async processParamsForMcpUsage(e){var t,i,r;const s=(t=e.config)===null||t===void 0?void 0:t.tools;if(!s)return e;const o=await Promise.all(s.map(async c=>ha(c)?await c.tool():c)),a={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:o})};if(a.config.tools=o,e.config&&e.config.tools&&sT(e.config.tools)){const c=(r=(i=e.config.httpOptions)===null||i===void 0?void 0:i.headers)!==null&&r!==void 0?r:{};let d=Object.assign({},c);Object.keys(d).length===0&&(d=this.apiClient.getDefaultHeaders()),oT(d),a.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:d})}return a}async initAfcToolsMap(e){var t,i,r;const s=new Map;for(const o of(i=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&i!==void 0?i:[])if(ha(o)){const a=o,c=await a.tool();for(const d of(r=c.functionDeclarations)!==null&&r!==void 0?r:[]){if(!d.name)throw new Error("Function declaration name is required.");if(s.has(d.name))throw new Error(`Duplicate tool declaration name: ${d.name}`);s.set(d.name,a)}}return s}async processAfcStream(e){var t,i,r;const s=(r=(i=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&r!==void 0?r:og;let o=!1,a=0;const c=await this.initAfcToolsMap(e);return function(d,h,p){var g,_;return ur(this,arguments,function*(){for(var C,P,x,F;a<s;){o&&(a++,o=!1);const U=yield we(d.processParamsForMcpUsage(p)),q=yield we(d.generateContentStreamInternal(U)),I=[],T=[];try{for(var L=!0,V=(P=void 0,ks(q)),O;O=yield we(V.next()),C=O.done,!C;L=!0){F=O.value,L=!1;const E=F;if(yield yield we(E),E.candidates&&(!((g=E.candidates[0])===null||g===void 0)&&g.content)){T.push(E.candidates[0].content);for(const R of(_=E.candidates[0].content.parts)!==null&&_!==void 0?_:[])if(a<s&&R.functionCall){if(!R.functionCall.name)throw new Error("Function call name was not returned by the model.");if(h.has(R.functionCall.name)){const w=yield we(h.get(R.functionCall.name).callTool([R.functionCall]));I.push(...w)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${h.keys()}, mising tool: ${R.functionCall.name}`)}}}}catch(E){P={error:E}}finally{try{!L&&!C&&(x=V.return)&&(yield we(x.call(V)))}finally{if(P)throw P.error}}if(I.length>0){o=!0;const E=new cs;E.candidates=[{content:{role:"user",parts:I}}],yield yield we(E);const R=[];R.push(...T),R.push({role:"user",parts:I});const w=St(p.contents).concat(R);p.contents=w}else break}})}(this,c,e)}async generateContentInternal(e){var t,i,r,s;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=tg(this.apiClient,e);return a=Z("{model}:generateContent",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>{const p=ig(h),g=new cs;return Object.assign(g,p),g})}else{const d=eg(this.apiClient,e);return a=Z("{model}:generateContent",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>{const p=ng(h),g=new cs;return Object.assign(g,p),g})}}async generateContentStreamInternal(e){var t,i,r,s;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=tg(this.apiClient,e);return a=Z("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.requestStream({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}),o.then(function(p){return ur(this,arguments,function*(){var g,_,C,P;try{for(var x=!0,F=ks(p),L;L=yield we(F.next()),g=L.done,!g;x=!0){P=L.value,x=!1;const O=ig(yield we(P.json())),U=new cs;Object.assign(U,O),yield yield we(U)}}catch(V){_={error:V}}finally{try{!x&&!g&&(C=F.return)&&(yield we(C.call(F)))}finally{if(_)throw _.error}}})})}else{const d=eg(this.apiClient,e);return a=Z("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.requestStream({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}),o.then(function(p){return ur(this,arguments,function*(){var g,_,C,P;try{for(var x=!0,F=ks(p),L;L=yield we(F.next()),g=L.done,!g;x=!0){P=L.value,x=!1;const O=ng(yield we(P.json())),U=new cs;Object.assign(U,O),yield yield we(U)}}catch(V){_={error:V}}finally{try{!x&&!g&&(C=F.return)&&(yield we(C.call(F)))}finally{if(_)throw _.error}}})})}}async embedContent(e){var t,i,r,s;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=QD(this.apiClient,e);return a=Z("{model}:predict",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>{const p=nV(h),g=new Dm;return Object.assign(g,p),g})}else{const d=cD(this.apiClient,e);return a=Z("{model}:batchEmbedContents",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>{const p=MN(h),g=new Dm;return Object.assign(g,p),g})}}async generateImagesInternal(e){var t,i,r,s;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=jD(this.apiClient,e);return a=Z("{model}:predict",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>{const p=rV(h),g=new Nm;return Object.assign(g,p),g})}else{const d=fD(this.apiClient,e);return a=Z("{model}:predict",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>{const p=VN(h),g=new Nm;return Object.assign(g,p),g})}}async editImageInternal(e){var t,i;let r,s="",o={};if(this.apiClient.isVertexAI()){const a=oN(this.apiClient,e);return s=Z("{model}:predict",a._url),o=a._query,delete a.config,delete a._url,delete a._query,r=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>{const d=sV(c),h=new sP;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,i;let r,s="",o={};if(this.apiClient.isVertexAI()){const a=lN(this.apiClient,e);return s=Z("{model}:predict",a._url),o=a._query,delete a.config,delete a._url,delete a._query,r=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>{const d=oV(c),h=new oP;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,i,r,s;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=uN(this.apiClient,e);return a=Z("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>gc(h))}else{const d=hD(this.apiClient,e);return a=Z("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>mc(h))}}async listInternal(e){var t,i,r,s;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=dN(this.apiClient,e);return a=Z("{models_url}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>{const p=cV(this.apiClient,h),g=new Vm;return Object.assign(g,p),g})}else{const d=mD(this.apiClient,e);return a=Z("{models_url}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>{const p=FN(this.apiClient,h),g=new Vm;return Object.assign(g,p),g})}}async update(e){var t,i,r,s;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=hN(this.apiClient,e);return a=Z("{model}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>gc(h))}else{const d=yD(this.apiClient,e);return a=Z("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>mc(h))}}async delete(e){var t,i,r,s;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=pN(this.apiClient,e);return a=Z("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(()=>{const h=dV(),p=new Lm;return Object.assign(p,h),p})}else{const d=_D(this.apiClient,e);return a=Z("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(()=>{const h=UN(),p=new Lm;return Object.assign(p,h),p})}}async countTokens(e){var t,i,r,s;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=gN(this.apiClient,e);return a=Z("{model}:countTokens",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>{const p=fV(h),g=new Fm;return Object.assign(g,p),g})}else{const d=TD(this.apiClient,e);return a=Z("{model}:countTokens",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>{const p=ON(h),g=new Fm;return Object.assign(g,p),g})}}async computeTokens(e){var t,i;let r,s="",o={};if(this.apiClient.isVertexAI()){const a=yN(this.apiClient,e);return s=Z("{model}:computeTokens",a._url),o=a._query,delete a.config,delete a._url,delete a._query,r=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>{const d=hV(c),h=new aP;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideos(e){var t,i,r,s;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=TN(this.apiClient,e);return a=Z("{model}:predictLongRunning",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>yV(h))}else{const d=CD(this.apiClient,e);return a=Z("{model}:predictLongRunning",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>GN(h))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function HV(n){const e={},t=l(n,["operationName"]);t!=null&&u(e,["_url","operationName"],t);const i=l(n,["config"]);return i!=null&&u(e,["config"],i),e}function zV(n){const e={},t=l(n,["operationName"]);t!=null&&u(e,["_url","operationName"],t);const i=l(n,["config"]);return i!=null&&u(e,["config"],i),e}function WV(n){const e={},t=l(n,["operationName"]);t!=null&&u(e,["operationName"],t);const i=l(n,["resourceName"]);i!=null&&u(e,["_url","resourceName"],i);const r=l(n,["config"]);return r!=null&&u(e,["config"],r),e}function KV(n){const e={},t=l(n,["video","uri"]);t!=null&&u(e,["uri"],t);const i=l(n,["video","encodedVideo"]);i!=null&&u(e,["videoBytes"],mn(i));const r=l(n,["encoding"]);return r!=null&&u(e,["mimeType"],r),e}function JV(n){const e={},t=l(n,["_self"]);return t!=null&&u(e,["video"],KV(t)),e}function YV(n){const e={},t=l(n,["generatedSamples"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>JV(o))),u(e,["generatedVideos"],s)}const i=l(n,["raiMediaFilteredCount"]);i!=null&&u(e,["raiMediaFilteredCount"],i);const r=l(n,["raiMediaFilteredReasons"]);return r!=null&&u(e,["raiMediaFilteredReasons"],r),e}function XV(n){const e={},t=l(n,["name"]);t!=null&&u(e,["name"],t);const i=l(n,["metadata"]);i!=null&&u(e,["metadata"],i);const r=l(n,["done"]);r!=null&&u(e,["done"],r);const s=l(n,["error"]);s!=null&&u(e,["error"],s);const o=l(n,["response","generateVideoResponse"]);return o!=null&&u(e,["response"],YV(o)),e}function QV(n){const e={},t=l(n,["gcsUri"]);t!=null&&u(e,["uri"],t);const i=l(n,["bytesBase64Encoded"]);i!=null&&u(e,["videoBytes"],mn(i));const r=l(n,["mimeType"]);return r!=null&&u(e,["mimeType"],r),e}function ZV(n){const e={},t=l(n,["_self"]);return t!=null&&u(e,["video"],QV(t)),e}function jV(n){const e={},t=l(n,["videos"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>ZV(o))),u(e,["generatedVideos"],s)}const i=l(n,["raiMediaFilteredCount"]);i!=null&&u(e,["raiMediaFilteredCount"],i);const r=l(n,["raiMediaFilteredReasons"]);return r!=null&&u(e,["raiMediaFilteredReasons"],r),e}function ug(n){const e={},t=l(n,["name"]);t!=null&&u(e,["name"],t);const i=l(n,["metadata"]);i!=null&&u(e,["metadata"],i);const r=l(n,["done"]);r!=null&&u(e,["done"],r);const s=l(n,["error"]);s!=null&&u(e,["error"],s);const o=l(n,["response"]);return o!=null&&u(e,["response"],jV(o)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class eL extends Fi{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,i=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const r=t.name.split("/operations/")[0];let s;return i&&"httpOptions"in i&&(s=i.httpOptions),this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:r,config:{httpOptions:s}})}else return this.getVideosOperationInternal({operationName:t.name,config:i})}async getVideosOperationInternal(e){var t,i,r,s;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=zV(e);return a=Z("{operationName}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>ug(h))}else{const d=HV(e);return a=Z("{operationName}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>XV(h))}}async fetchPredictVideosOperationInternal(e){var t,i;let r,s="",o={};if(this.apiClient.isVertexAI()){const a=WV(e);return s=Z("{resourceName}:fetchPredictOperation",a._url),o=a._query,delete a.config,delete a._url,delete a._query,r=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>ug(c))}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function tL(n){const e={},t=l(n,["voiceName"]);return t!=null&&u(e,["voiceName"],t),e}function aT(n){const e={},t=l(n,["prebuiltVoiceConfig"]);return t!=null&&u(e,["prebuiltVoiceConfig"],tL(t)),e}function nL(n){const e={},t=l(n,["speaker"]);t!=null&&u(e,["speaker"],t);const i=l(n,["voiceConfig"]);return i!=null&&u(e,["voiceConfig"],aT(i)),e}function iL(n){const e={},t=l(n,["speakerVoiceConfigs"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>nL(r))),u(e,["speakerVoiceConfigs"],i)}return e}function rL(n){const e={},t=l(n,["voiceConfig"]);t!=null&&u(e,["voiceConfig"],aT(t));const i=l(n,["multiSpeakerVoiceConfig"]);i!=null&&u(e,["multiSpeakerVoiceConfig"],iL(i));const r=l(n,["languageCode"]);return r!=null&&u(e,["languageCode"],r),e}function sL(n){const e={},t=l(n,["fps"]);t!=null&&u(e,["fps"],t);const i=l(n,["endOffset"]);i!=null&&u(e,["endOffset"],i);const r=l(n,["startOffset"]);return r!=null&&u(e,["startOffset"],r),e}function oL(n){const e={};if(l(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=l(n,["data"]);t!=null&&u(e,["data"],t);const i=l(n,["mimeType"]);return i!=null&&u(e,["mimeType"],i),e}function aL(n){const e={};if(l(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=l(n,["fileUri"]);t!=null&&u(e,["fileUri"],t);const i=l(n,["mimeType"]);return i!=null&&u(e,["mimeType"],i),e}function lL(n){const e={},t=l(n,["videoMetadata"]);t!=null&&u(e,["videoMetadata"],sL(t));const i=l(n,["thought"]);i!=null&&u(e,["thought"],i);const r=l(n,["inlineData"]);r!=null&&u(e,["inlineData"],oL(r));const s=l(n,["fileData"]);s!=null&&u(e,["fileData"],aL(s));const o=l(n,["thoughtSignature"]);o!=null&&u(e,["thoughtSignature"],o);const a=l(n,["codeExecutionResult"]);a!=null&&u(e,["codeExecutionResult"],a);const c=l(n,["executableCode"]);c!=null&&u(e,["executableCode"],c);const d=l(n,["functionCall"]);d!=null&&u(e,["functionCall"],d);const h=l(n,["functionResponse"]);h!=null&&u(e,["functionResponse"],h);const p=l(n,["text"]);return p!=null&&u(e,["text"],p),e}function uL(n){const e={},t=l(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(s=>lL(s))),u(e,["parts"],r)}const i=l(n,["role"]);return i!=null&&u(e,["role"],i),e}function cL(n){const e={},t=l(n,["behavior"]);t!=null&&u(e,["behavior"],t);const i=l(n,["description"]);i!=null&&u(e,["description"],i);const r=l(n,["name"]);r!=null&&u(e,["name"],r);const s=l(n,["parameters"]);s!=null&&u(e,["parameters"],s);const o=l(n,["parametersJsonSchema"]);o!=null&&u(e,["parametersJsonSchema"],o);const a=l(n,["response"]);a!=null&&u(e,["response"],a);const c=l(n,["responseJsonSchema"]);return c!=null&&u(e,["responseJsonSchema"],c),e}function dL(n){const e={},t=l(n,["startTime"]);t!=null&&u(e,["startTime"],t);const i=l(n,["endTime"]);return i!=null&&u(e,["endTime"],i),e}function fL(n){const e={},t=l(n,["timeRangeFilter"]);return t!=null&&u(e,["timeRangeFilter"],dL(t)),e}function hL(n){const e={},t=l(n,["mode"]);t!=null&&u(e,["mode"],t);const i=l(n,["dynamicThreshold"]);return i!=null&&u(e,["dynamicThreshold"],i),e}function pL(n){const e={},t=l(n,["dynamicRetrievalConfig"]);return t!=null&&u(e,["dynamicRetrievalConfig"],hL(t)),e}function mL(){return{}}function gL(n){const e={},t=l(n,["functionDeclarations"]);if(t!=null){let a=t;Array.isArray(a)&&(a=a.map(c=>cL(c))),u(e,["functionDeclarations"],a)}if(l(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=l(n,["googleSearch"]);i!=null&&u(e,["googleSearch"],fL(i));const r=l(n,["googleSearchRetrieval"]);if(r!=null&&u(e,["googleSearchRetrieval"],pL(r)),l(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(l(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");l(n,["urlContext"])!=null&&u(e,["urlContext"],mL());const o=l(n,["codeExecution"]);return o!=null&&u(e,["codeExecution"],o),e}function yL(n){const e={},t=l(n,["handle"]);if(t!=null&&u(e,["handle"],t),l(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function cg(){return{}}function _L(n){const e={},t=l(n,["disabled"]);t!=null&&u(e,["disabled"],t);const i=l(n,["startOfSpeechSensitivity"]);i!=null&&u(e,["startOfSpeechSensitivity"],i);const r=l(n,["endOfSpeechSensitivity"]);r!=null&&u(e,["endOfSpeechSensitivity"],r);const s=l(n,["prefixPaddingMs"]);s!=null&&u(e,["prefixPaddingMs"],s);const o=l(n,["silenceDurationMs"]);return o!=null&&u(e,["silenceDurationMs"],o),e}function vL(n){const e={},t=l(n,["automaticActivityDetection"]);t!=null&&u(e,["automaticActivityDetection"],_L(t));const i=l(n,["activityHandling"]);i!=null&&u(e,["activityHandling"],i);const r=l(n,["turnCoverage"]);return r!=null&&u(e,["turnCoverage"],r),e}function TL(n){const e={},t=l(n,["targetTokens"]);return t!=null&&u(e,["targetTokens"],t),e}function EL(n){const e={},t=l(n,["triggerTokens"]);t!=null&&u(e,["triggerTokens"],t);const i=l(n,["slidingWindow"]);return i!=null&&u(e,["slidingWindow"],TL(i)),e}function IL(n){const e={},t=l(n,["proactiveAudio"]);return t!=null&&u(e,["proactiveAudio"],t),e}function CL(n,e){const t={},i=l(n,["generationConfig"]);e!==void 0&&i!=null&&u(e,["setup","generationConfig"],i);const r=l(n,["responseModalities"]);e!==void 0&&r!=null&&u(e,["setup","generationConfig","responseModalities"],r);const s=l(n,["temperature"]);e!==void 0&&s!=null&&u(e,["setup","generationConfig","temperature"],s);const o=l(n,["topP"]);e!==void 0&&o!=null&&u(e,["setup","generationConfig","topP"],o);const a=l(n,["topK"]);e!==void 0&&a!=null&&u(e,["setup","generationConfig","topK"],a);const c=l(n,["maxOutputTokens"]);e!==void 0&&c!=null&&u(e,["setup","generationConfig","maxOutputTokens"],c);const d=l(n,["mediaResolution"]);e!==void 0&&d!=null&&u(e,["setup","generationConfig","mediaResolution"],d);const h=l(n,["seed"]);e!==void 0&&h!=null&&u(e,["setup","generationConfig","seed"],h);const p=l(n,["speechConfig"]);e!==void 0&&p!=null&&u(e,["setup","generationConfig","speechConfig"],rL(Pd(p)));const g=l(n,["enableAffectiveDialog"]);e!==void 0&&g!=null&&u(e,["setup","generationConfig","enableAffectiveDialog"],g);const _=l(n,["systemInstruction"]);e!==void 0&&_!=null&&u(e,["setup","systemInstruction"],uL(nt(_)));const C=l(n,["tools"]);if(e!==void 0&&C!=null){let U=Br(C);Array.isArray(U)&&(U=U.map(q=>gL(Or(q)))),u(e,["setup","tools"],U)}const P=l(n,["sessionResumption"]);e!==void 0&&P!=null&&u(e,["setup","sessionResumption"],yL(P));const x=l(n,["inputAudioTranscription"]);e!==void 0&&x!=null&&u(e,["setup","inputAudioTranscription"],cg());const F=l(n,["outputAudioTranscription"]);e!==void 0&&F!=null&&u(e,["setup","outputAudioTranscription"],cg());const L=l(n,["realtimeInputConfig"]);e!==void 0&&L!=null&&u(e,["setup","realtimeInputConfig"],vL(L));const V=l(n,["contextWindowCompression"]);e!==void 0&&V!=null&&u(e,["setup","contextWindowCompression"],EL(V));const O=l(n,["proactivity"]);return e!==void 0&&O!=null&&u(e,["setup","proactivity"],IL(O)),t}function wL(n,e){const t={},i=l(e,["model"]);i!=null&&u(t,["setup","model"],Te(n,i));const r=l(e,["config"]);return r!=null&&u(t,["config"],CL(r,t)),t}function AL(n,e,t){const i={},r=l(e,["expireTime"]);t!==void 0&&r!=null&&u(t,["expireTime"],r);const s=l(e,["newSessionExpireTime"]);t!==void 0&&s!=null&&u(t,["newSessionExpireTime"],s);const o=l(e,["uses"]);t!==void 0&&o!=null&&u(t,["uses"],o);const a=l(e,["liveConnectConstraints"]);t!==void 0&&a!=null&&u(t,["bidiGenerateContentSetup"],wL(n,a));const c=l(e,["lockAdditionalFields"]);return t!==void 0&&c!=null&&u(t,["fieldMask"],c),i}function SL(n,e){const t={},i=l(e,["config"]);return i!=null&&u(t,["config"],AL(n,i,t)),t}function RL(n){const e={},t=l(n,["name"]);return t!=null&&u(e,["name"],t),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function PL(n){const e=[];for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const i=n[t];if(typeof i=="object"&&i!=null&&Object.keys(i).length>0){const r=Object.keys(i).map(s=>`${t}.${s}`);e.push(...r)}else e.push(t)}return e.join(",")}function xL(n,e){let t=null;const i=n.bidiGenerateContentSetup;if(typeof i=="object"&&i!==null&&"setup"in i){const s=i.setup;typeof s=="object"&&s!==null?(n.bidiGenerateContentSetup=s,t=s):delete n.bidiGenerateContentSetup}else i!==void 0&&delete n.bidiGenerateContentSetup;const r=n.fieldMask;if(t){const s=PL(t);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)s?n.fieldMask=s:delete n.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&r!==null&&Array.isArray(r)&&r.length>0){const o=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let a=[];r.length>0&&(a=r.map(d=>o.includes(d)?`generationConfig.${d}`:d));const c=[];s&&c.push(s),a.length>0&&c.push(...a),c.length>0?n.fieldMask=c.join(","):delete n.fieldMask}else delete n.fieldMask}else r!==null&&Array.isArray(r)&&r.length>0?n.fieldMask=r.join(","):delete n.fieldMask;return n}class kL extends Fi{constructor(e){super(),this.apiClient=e}async create(e){var t,i;let r,s="",o={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const a=SL(this.apiClient,e);s=Z("auth_tokens",a._url),o=a._query,delete a.config,delete a._url,delete a._query;const c=xL(a,e.config);return r=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),r.then(d=>RL(d))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function bL(n){const e={},t=l(n,["name"]);t!=null&&u(e,["_url","name"],t);const i=l(n,["config"]);return i!=null&&u(e,["config"],i),e}function ML(n,e){const t={},i=l(n,["pageSize"]);e!==void 0&&i!=null&&u(e,["_query","pageSize"],i);const r=l(n,["pageToken"]);e!==void 0&&r!=null&&u(e,["_query","pageToken"],r);const s=l(n,["filter"]);return e!==void 0&&s!=null&&u(e,["_query","filter"],s),t}function DL(n){const e={},t=l(n,["config"]);return t!=null&&u(e,["config"],ML(t,e)),e}function NL(n){const e={},t=l(n,["textInput"]);t!=null&&u(e,["textInput"],t);const i=l(n,["output"]);return i!=null&&u(e,["output"],i),e}function VL(n){const e={};if(l(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const t=l(n,["examples"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>NL(r))),u(e,["examples","examples"],i)}return e}function LL(n,e){const t={};if(l(n,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=l(n,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&u(e,["displayName"],i),l(n,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const r=l(n,["epochCount"]);e!==void 0&&r!=null&&u(e,["tuningTask","hyperparameters","epochCount"],r);const s=l(n,["learningRateMultiplier"]);if(s!=null&&u(t,["tuningTask","hyperparameters","learningRateMultiplier"],s),l(n,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(l(n,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const o=l(n,["batchSize"]);e!==void 0&&o!=null&&u(e,["tuningTask","hyperparameters","batchSize"],o);const a=l(n,["learningRate"]);return e!==void 0&&a!=null&&u(e,["tuningTask","hyperparameters","learningRate"],a),t}function FL(n){const e={},t=l(n,["baseModel"]);t!=null&&u(e,["baseModel"],t);const i=l(n,["trainingDataset"]);i!=null&&u(e,["tuningTask","trainingData"],VL(i));const r=l(n,["config"]);return r!=null&&u(e,["config"],LL(r,e)),e}function UL(n){const e={},t=l(n,["name"]);t!=null&&u(e,["_url","name"],t);const i=l(n,["config"]);return i!=null&&u(e,["config"],i),e}function OL(n,e){const t={},i=l(n,["pageSize"]);e!==void 0&&i!=null&&u(e,["_query","pageSize"],i);const r=l(n,["pageToken"]);e!==void 0&&r!=null&&u(e,["_query","pageToken"],r);const s=l(n,["filter"]);return e!==void 0&&s!=null&&u(e,["_query","filter"],s),t}function BL(n){const e={},t=l(n,["config"]);return t!=null&&u(e,["config"],OL(t,e)),e}function qL(n,e){const t={},i=l(n,["gcsUri"]);if(e!==void 0&&i!=null&&u(e,["supervisedTuningSpec","trainingDatasetUri"],i),l(n,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return t}function $L(n){const e={},t=l(n,["gcsUri"]);return t!=null&&u(e,["validationDatasetUri"],t),e}function GL(n,e){const t={},i=l(n,["validationDataset"]);e!==void 0&&i!=null&&u(e,["supervisedTuningSpec"],$L(i));const r=l(n,["tunedModelDisplayName"]);e!==void 0&&r!=null&&u(e,["tunedModelDisplayName"],r);const s=l(n,["description"]);e!==void 0&&s!=null&&u(e,["description"],s);const o=l(n,["epochCount"]);e!==void 0&&o!=null&&u(e,["supervisedTuningSpec","hyperParameters","epochCount"],o);const a=l(n,["learningRateMultiplier"]);e!==void 0&&a!=null&&u(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],a);const c=l(n,["exportLastCheckpointOnly"]);e!==void 0&&c!=null&&u(e,["supervisedTuningSpec","exportLastCheckpointOnly"],c);const d=l(n,["adapterSize"]);if(e!==void 0&&d!=null&&u(e,["supervisedTuningSpec","hyperParameters","adapterSize"],d),l(n,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(l(n,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");return t}function HL(n){const e={},t=l(n,["baseModel"]);t!=null&&u(e,["baseModel"],t);const i=l(n,["trainingDataset"]);i!=null&&u(e,["supervisedTuningSpec","trainingDatasetUri"],qL(i,e));const r=l(n,["config"]);return r!=null&&u(e,["config"],GL(r,e)),e}function zL(n){const e={},t=l(n,["name"]);t!=null&&u(e,["model"],t);const i=l(n,["name"]);return i!=null&&u(e,["endpoint"],i),e}function lT(n){const e={},t=l(n,["name"]);t!=null&&u(e,["name"],t);const i=l(n,["state"]);i!=null&&u(e,["state"],qv(i));const r=l(n,["createTime"]);r!=null&&u(e,["createTime"],r);const s=l(n,["tuningTask","startTime"]);s!=null&&u(e,["startTime"],s);const o=l(n,["tuningTask","completeTime"]);o!=null&&u(e,["endTime"],o);const a=l(n,["updateTime"]);a!=null&&u(e,["updateTime"],a);const c=l(n,["description"]);c!=null&&u(e,["description"],c);const d=l(n,["baseModel"]);d!=null&&u(e,["baseModel"],d);const h=l(n,["_self"]);h!=null&&u(e,["tunedModel"],zL(h));const p=l(n,["distillationSpec"]);p!=null&&u(e,["distillationSpec"],p);const g=l(n,["experiment"]);g!=null&&u(e,["experiment"],g);const _=l(n,["labels"]);_!=null&&u(e,["labels"],_);const C=l(n,["pipelineJob"]);C!=null&&u(e,["pipelineJob"],C);const P=l(n,["serviceAccount"]);P!=null&&u(e,["serviceAccount"],P);const x=l(n,["tunedModelDisplayName"]);return x!=null&&u(e,["tunedModelDisplayName"],x),e}function WL(n){const e={},t=l(n,["nextPageToken"]);t!=null&&u(e,["nextPageToken"],t);const i=l(n,["tunedModels"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(s=>lT(s))),u(e,["tuningJobs"],r)}return e}function KL(n){const e={},t=l(n,["name"]);t!=null&&u(e,["name"],t);const i=l(n,["metadata"]);i!=null&&u(e,["metadata"],i);const r=l(n,["done"]);r!=null&&u(e,["done"],r);const s=l(n,["error"]);return s!=null&&u(e,["error"],s),e}function JL(n){const e={},t=l(n,["checkpointId"]);t!=null&&u(e,["checkpointId"],t);const i=l(n,["epoch"]);i!=null&&u(e,["epoch"],i);const r=l(n,["step"]);r!=null&&u(e,["step"],r);const s=l(n,["endpoint"]);return s!=null&&u(e,["endpoint"],s),e}function YL(n){const e={},t=l(n,["model"]);t!=null&&u(e,["model"],t);const i=l(n,["endpoint"]);i!=null&&u(e,["endpoint"],i);const r=l(n,["checkpoints"]);if(r!=null){let s=r;Array.isArray(s)&&(s=s.map(o=>JL(o))),u(e,["checkpoints"],s)}return e}function _c(n){const e={},t=l(n,["name"]);t!=null&&u(e,["name"],t);const i=l(n,["state"]);i!=null&&u(e,["state"],qv(i));const r=l(n,["createTime"]);r!=null&&u(e,["createTime"],r);const s=l(n,["startTime"]);s!=null&&u(e,["startTime"],s);const o=l(n,["endTime"]);o!=null&&u(e,["endTime"],o);const a=l(n,["updateTime"]);a!=null&&u(e,["updateTime"],a);const c=l(n,["error"]);c!=null&&u(e,["error"],c);const d=l(n,["description"]);d!=null&&u(e,["description"],d);const h=l(n,["baseModel"]);h!=null&&u(e,["baseModel"],h);const p=l(n,["tunedModel"]);p!=null&&u(e,["tunedModel"],YL(p));const g=l(n,["supervisedTuningSpec"]);g!=null&&u(e,["supervisedTuningSpec"],g);const _=l(n,["tuningDataStats"]);_!=null&&u(e,["tuningDataStats"],_);const C=l(n,["encryptionSpec"]);C!=null&&u(e,["encryptionSpec"],C);const P=l(n,["partnerModelTuningSpec"]);P!=null&&u(e,["partnerModelTuningSpec"],P);const x=l(n,["distillationSpec"]);x!=null&&u(e,["distillationSpec"],x);const F=l(n,["experiment"]);F!=null&&u(e,["experiment"],F);const L=l(n,["labels"]);L!=null&&u(e,["labels"],L);const V=l(n,["pipelineJob"]);V!=null&&u(e,["pipelineJob"],V);const O=l(n,["serviceAccount"]);O!=null&&u(e,["serviceAccount"],O);const U=l(n,["tunedModelDisplayName"]);return U!=null&&u(e,["tunedModelDisplayName"],U),e}function XL(n){const e={},t=l(n,["nextPageToken"]);t!=null&&u(e,["nextPageToken"],t);const i=l(n,["tuningJobs"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(s=>_c(s))),u(e,["tuningJobs"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class QL extends Fi{constructor(e){super(),this.apiClient=e,this.get=async t=>await this.getInternal(t),this.list=async(t={})=>new vo(bi.PAGED_ITEM_TUNING_JOBS,i=>this.listInternal(i),await this.listInternal(t),t),this.tune=async t=>{if(this.apiClient.isVertexAI())return await this.tuneInternal(t);{const i=await this.tuneMldevInternal(t);let r="";return i.metadata!==void 0&&i.metadata.tunedModel!==void 0?r=i.metadata.tunedModel:i.name!==void 0&&i.name.includes("/operations/")&&(r=i.name.split("/operations/")[0]),{name:r,state:lc.JOB_STATE_QUEUED}}}}async getInternal(e){var t,i,r,s;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=UL(e);return a=Z("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>_c(h))}else{const d=bL(e);return a=Z("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>lT(h))}}async listInternal(e){var t,i,r,s;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=BL(e);return a=Z("tuningJobs",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),o.then(h=>{const p=XL(h),g=new Um;return Object.assign(g,p),g})}else{const d=DL(e);return a=Z("tunedModels",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>{const p=WL(h),g=new Um;return Object.assign(g,p),g})}}async tuneInternal(e){var t,i;let r,s="",o={};if(this.apiClient.isVertexAI()){const a=HL(e);return s=Z("tuningJobs",a._url),o=a._query,delete a.config,delete a._url,delete a._query,r=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>_c(c))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,i;let r,s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=FL(e);return s=Z("tunedModels",a._url),o=a._query,delete a.config,delete a._url,delete a._query,r=this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>KL(c))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ZL{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const jL=1024*1024*8,e1=3,t1=1e3,n1=2,mu="x-goog-upload-status";async function i1(n,e,t){var i,r,s;let o=0,a=0,c=new uc(new Response),d="upload";for(o=n.size;a<o;){const p=Math.min(jL,o-a),g=n.slice(a,a+p);a+p>=o&&(d+=", finalize");let _=0,C=t1;for(;_<e1&&(c=await t.request({path:"",body:g,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":d,"X-Goog-Upload-Offset":String(a),"Content-Length":String(p)}}}),!(!((i=c==null?void 0:c.headers)===null||i===void 0)&&i[mu]));)_++,await s1(C),C=C*n1;if(a+=p,((r=c==null?void 0:c.headers)===null||r===void 0?void 0:r[mu])!=="active")break;if(o<=a)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const h=await(c==null?void 0:c.json());if(((s=c==null?void 0:c.headers)===null||s===void 0?void 0:s[mu])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return h.file}async function r1(n){return{size:n.size,type:n.type}}function s1(n){return new Promise(e=>setTimeout(e,n))}class o1{async upload(e,t,i){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await i1(e,t,i)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await r1(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class a1{create(e,t,i){return new l1(e,t,i)}}class l1{constructor(e,t,i){this.url=e,this.headers=t,this.callbacks=i}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const dg="x-goog-api-key";class u1{constructor(e){this.apiKey=e}async addAuthHeaders(e){if(e.get(dg)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(dg,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const c1="gl-node/";class d1{constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const i=rP(e,void 0,void 0);i&&(e.httpOptions?e.httpOptions.baseUrl=i:e.httpOptions={baseUrl:i}),this.apiVersion=e.apiVersion;const r=new u1(this.apiKey);this.apiClient=new AV({auth:r,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:c1+"web",uploader:new o1,downloader:new ZL}),this.models=new GV(this.apiClient),this.live=new UV(this.apiClient,r,new a1),this.batches=new Mx(this.apiClient),this.chats=new Lk(this.models,this.apiClient),this.caches=new Dk(this.apiClient),this.files=new Yk(this.apiClient),this.operations=new eL(this.apiClient),this.authTokens=new kL(this.apiClient),this.tunings=new QL(this.apiClient)}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const f1="";new d1({apiKey:f1});const h1=async(n,e,t)=>`### Erro de Configuração
Chave de API do Gemini não configurada. A análise por IA está desativada.`;/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/const rt="Você está offline. A alteração foi salva e será sincronizada em breve.",A={appContainer:document.getElementById("app-container"),noteInput:document.getElementById("note-input"),noteIdInput:document.getElementById("note-id"),saveNoteBtn:document.getElementById("save-note-btn"),notesList:document.getElementById("notes-list"),currentDate:document.getElementById("current-date"),taskInput:document.getElementById("task-input"),addTaskBtn:document.getElementById("add-task-btn"),categorySelect:document.getElementById("category-select"),addCategoryBtn:document.getElementById("add-category-btn"),dueDateInput:document.getElementById("due-date-input"),filterContainer:document.getElementById("filter-container"),taskList:document.getElementById("task-list"),toggleCompletedBtn:document.getElementById("toggle-completed-btn"),taskDetailModal:document.getElementById("task-detail-modal"),closeDetailModalBtn:document.getElementById("close-detail-modal-btn"),detailTitleContainer:document.getElementById("detail-title-container"),detailTaskTitle:document.getElementById("detail-task-title"),detailEditContainer:document.getElementById("detail-edit-container"),detailEditInput:document.getElementById("detail-edit-input"),detailSaveBtn:document.getElementById("detail-save-btn"),detailCancelBtn:document.getElementById("detail-cancel-btn"),subtaskList:document.getElementById("subtask-list"),subtaskInput:document.getElementById("subtask-input"),addSubtaskBtn:document.getElementById("add-subtask-btn"),taskNotesList:document.getElementById("task-notes-list"),taskNoteInput:document.getElementById("task-note-input"),addTaskNoteBtn:document.getElementById("add-task-note-btn"),calendarBtn:document.getElementById("calendar-btn"),calendarModal:document.getElementById("calendar-modal"),closeCalendarBtn:document.getElementById("close-calendar-btn"),prevMonthBtn:document.getElementById("prev-month-btn"),nextMonthBtn:document.getElementById("next-month-btn"),calendarMonthYear:document.getElementById("calendar-month-year"),calendarGrid:document.getElementById("calendar-grid"),detailsDayHeader:document.getElementById("details-day-header"),detailsContent:document.getElementById("details-content"),themeToggleBtn:document.getElementById("theme-toggle-btn"),loginContainer:document.getElementById("login-container"),registerContainer:document.getElementById("register-container"),loginForm:document.getElementById("login-form"),registerForm:document.getElementById("register-form"),loginError:document.getElementById("login-error"),registerError:document.getElementById("register-error"),showRegisterBtn:document.getElementById("show-register-btn"),showLoginBtn:document.getElementById("show-login-btn"),userMenuContainer:document.getElementById("user-menu-container"),userMenuTrigger:document.getElementById("user-menu-trigger"),userMenuDropdown:document.getElementById("user-menu-dropdown"),userEmail:document.getElementById("user-email"),logoutBtn:document.getElementById("logout-btn"),categoryPopup:document.getElementById("category-popup"),categoryPopupInput:document.getElementById("category-popup-input"),categoryPopupAdd:document.getElementById("category-popup-add"),categoryPopupCancel:document.getElementById("category-popup-cancel"),aiAnalyzeBtn:document.getElementById("ai-analyze-btn"),aiAnalyzeModal:document.getElementById("ai-analyze-modal"),aiAnalyzeContent:document.getElementById("ai-analyze-content"),closeAiAnalyzeModal:document.getElementById("close-ai-analyze-modal"),connectionStatus:document.getElementById("connection-status"),connectionDot:document.getElementById("connection-dot"),connectionText:document.getElementById("connection-text"),offlineBanner:document.getElementById("offline-banner"),toastContainer:document.getElementById("toast-container"),viewToggleBtn:document.getElementById("view-toggle-btn"),viewToggleIcon:document.getElementById("view-toggle-icon"),mainContentApp:document.getElementById("main-content-app"),canvasView:document.getElementById("canvas-view"),taskCanvasContainer:document.getElementById("task-canvas-container"),taskCanvas:document.getElementById("task-canvas"),canvasLinesSvg:document.getElementById("canvas-lines-svg"),canvasTaskPopup:document.getElementById("canvas-task-popup"),canvasPopupTitle:document.getElementById("canvas-popup-title"),canvasPopupCloseBtn:document.getElementById("canvas-popup-close-btn"),canvasPopupSubtasks:document.getElementById("canvas-popup-subtasks"),canvasPopupNotes:document.getElementById("canvas-popup-notes")};let Ne=null,mt,se,sn,De,xr="Todos",Ka=!1,be=null,ir=new Date,mi="list",gu=!navigator.onLine,$={isPanning:!1,isDragging:!1,isLinking:!1,draggedNode:null,linkStartNodeId:null,startX:0,startY:0,panOffsetX:0,panOffsetY:0,zoom:1,nodeInitialX:0,nodeInitialY:0,linkStartSide:null,linkTargetSide:null},Mi=[],Xs=[],kt={},Ct={},wn="todas",zt={tasks:null,notes:null,categories:null,canvas_tasks:null,canvas_free_cards:null,task_details:null};function Xt(n){zt[n]&&(zt[n](),zt[n]=null)}function p1(){Object.keys(zt).forEach(n=>Xt(n))}const Ee={listeners:[],add:function(n,e,t){n&&(n.addEventListener(e,t),this.listeners.push({element:n,event:e,handler:t}))},removeAll:function(){this.listeners.forEach(({element:n,event:e,handler:t})=>{n&&n.removeEventListener(e,t)}),this.listeners=[]}};function pe(n,e=4e3){if(!A.toastContainer)return;const t=document.createElement("div");t.className="toast",t.textContent=n,A.toastContainer.appendChild(t),setTimeout(()=>{t.classList.add("show")},10),setTimeout(()=>{t.classList.remove("show"),t.addEventListener("transitionend",()=>t.remove())},e)}function Ja(n){A.addTaskBtn.disabled=n,A.saveNoteBtn.disabled=n,A.addCategoryBtn.disabled=n}function fg(n){return!n||!n.toDate?"Indefinido":n.toDate().toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})}function m1(){A.currentDate&&(A.currentDate.textContent=new Date().toLocaleDateString("pt-BR",{dateStyle:"full"}))}function uT(){A.toggleCompletedBtn&&(A.toggleCompletedBtn.innerHTML=Ka?'<i class="fas fa-eye-slash"></i>':'<i class="fas fa-eye"></i>')}function vc(){if(!A.connectionStatus||!A.connectionText||!A.offlineBanner)return;const n=!navigator.onLine;n?(A.connectionStatus.classList.remove("online"),A.connectionStatus.classList.add("offline"),A.connectionText.textContent="Offline",A.connectionStatus.title="Você está offline. As alterações serão salvas e sincronizadas quando reconectar.",A.aiAnalyzeBtn.disabled=!0,A.aiAnalyzeBtn.title="Análise com IA (Indisponível offline)",A.offlineBanner.classList.remove("hidden")):(A.connectionStatus.classList.remove("offline"),A.connectionStatus.classList.add("online"),A.connectionText.textContent="Online",A.connectionStatus.title="Conectado ao servidor.",A.aiAnalyzeBtn.disabled=!1,A.aiAnalyzeBtn.title="Análise com IA",A.offlineBanner.classList.add("hidden")),n&&!gu?pe("Você perdeu a conexão. O aplicativo está em modo offline.",5e3):!n&&gu&&pe("Conexão restaurada. Sincronizando seus dados...",4e3),gu=n}async function g1(){const n=A.taskInput.value.trim();if(!n||!se)return;let e=A.categorySelect.value;e==="Nenhuma"&&(e=null);const t=A.dueDateInput.value,i=t?ue.fromDate(new Date(t+"T00:00:00")):null;await yo(se,{text:n,completed:!1,category:e,createdAt:ue.now(),dueDate:i,subtaskCount:0,noteCount:0,completedSubtaskCount:0}),navigator.onLine||pe(rt),A.taskInput.value="",A.dueDateInput.value=""}async function cT(){console.log("[Free Card] handleAddFreeCard chamada");const n=document.getElementById("free-card-input");if(!n){console.error("[Free Card] Input não encontrado");return}const e=n.value.trim();if(console.log("[Free Card] Texto:",e),!e){console.warn("[Free Card] Texto vazio"),pe("Digite um texto para o card livre");return}if(!De){console.error("[Free Card] Collection ref não encontrada"),pe("Erro: Collection não configurada");return}try{console.log("[Free Card] Salvando no Firestore...");const t=await yo(De,{text:e,createdAt:ue.now(),connections:[]});console.log("[Free Card] Documento criado com ID:",t.id),navigator.onLine?pe("Card livre criado com sucesso!"):pe(rt),n.value="",Xa()}catch(t){console.error("[Free Card] Erro ao criar:",t),pe("Erro ao criar card livre. Tente novamente.")}}async function y1(){const n=A.noteInput.value.trim(),e=A.noteIdInput.value;!n||!mt||(e?await Se(he(mt,e),{text:n}):await yo(mt,{text:n,createdAt:ue.now()}),navigator.onLine||pe(rt),A.noteInput.value="",A.noteIdInput.value="")}function kr(){if(!se)return;Xt("tasks");let n=xr==="Todos"?Je(se):Je(se,lt("category","==",xr));zt.tasks=Ri(n,e=>{let t=e.docs.map(i=>({id:i.id,...i.data()}));if(wn==="antigas")t.sort((i,r)=>{var s,o;return(((s=i.createdAt)==null?void 0:s.toMillis())||0)-(((o=r.createdAt)==null?void 0:o.toMillis())||0)});else if(wn==="novas")t.sort((i,r)=>{var s,o;return(((s=r.createdAt)==null?void 0:s.toMillis())||0)-(((o=i.createdAt)==null?void 0:o.toMillis())||0)});else if(wn==="incompletas")t=t.filter(i=>(i.subtaskCount||0)>(i.completedSubtaskCount||0));else if(wn==="atrasadas"){const i=new Date;i.setHours(0,0,0,0),t=t.filter(r=>r.dueDate&&r.dueDate.toDate()<i&&!r.completed)}else wn==="concluidas"?t=t.filter(i=>i.completed):wn==="sem-categoria"&&(t=t.filter(i=>!i.category||i.category==="Nenhuma"));!Ka&&wn!=="concluidas"&&(t=t.filter(i=>!i.completed)),A.taskList.innerHTML="",t.forEach(i=>_1(i.id,i))},console.error)}function _1(n,e){const t=document.createElement("div");t.className=`task-item group p-3 rounded-lg border-b ${e.completed?"bg-green-50 text-gray-500":"bg-white"}`;let i="text-gray-400";e.subtaskCount>0&&((e.completedSubtaskCount||0)===0?i="text-red-500":e.completedSubtaskCount===e.subtaskCount?i="text-green-500":i="text-yellow-500");let r="";e.subtaskCount>0&&(r+=`<span class="ml-2 ${i}" title="${e.completedSubtaskCount||0}/${e.subtaskCount} sub-tarefas concluídas"><i class="fa-solid fa-list-check"></i></span>`),e.noteCount>0&&(r+=`<span class="ml-2 text-gray-400" title="${e.noteCount} anotações"><i class="fa-solid fa-note-sticky"></i></span>`);const s=e.dueDate?`<strong>Previsão:</strong> ${fg(e.dueDate)}`:"";t.innerHTML=`
        <div class="flex items-center">
            <input type="checkbox" data-id="${n}" ${e.completed?"checked":""} class="task-checkbox h-5 w-5 rounded border-gray-300">
            <div class="task-main-content ml-4 flex-grow" data-id="${n}" data-title="${e.text}">
                <div class="flex items-center">
                    <span class="${e.completed?"line-through":""}">${e.text}</span>
                    ${r}
                </div>
                 <div class="mt-1 text-xs text-gray-500 flex items-center gap-4">
                    <span><strong>Criada:</strong> ${fg(e.createdAt)}</span>
                    <span>${s}</span>
                </div>
            </div>
            <button class="delete-task text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100" data-id="${n}"><i class="fas fa-times"></i></button>
        </div>`,t.querySelector(".task-checkbox").addEventListener("change",o=>{const a=o.target;Se(he(se,n),{completed:a.checked,completedAt:a.checked?ue.now():null}),navigator.onLine||pe(rt)}),t.querySelector(".delete-task").addEventListener("click",o=>{o.stopPropagation(),Ur(he(se,n)),navigator.onLine||pe(rt)}),t.querySelector(".task-main-content").addEventListener("click",()=>dT(n,e.text)),A.taskList.appendChild(t)}function v1(){if(!mt)return;Xt("notes");const n=Je(mt);zt.notes=Ri(n,e=>{A.notesList.innerHTML="",e.docs.sort((t,i)=>i.data().createdAt.toMillis()-t.data().createdAt.toMillis()).forEach(t=>T1(t.id,t.data()))},console.error)}function T1(n,e){const t=document.createElement("div");t.className="note-item bg-gray-100 p-2 rounded relative group",t.innerHTML=`<p class="note-text cursor-pointer">${e.text}</p>
        <div class="actions absolute top-1 right-1 flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity">
             <button class="edit-note text-gray-500 hover:text-blue-600"><i class="fas fa-pencil-alt fa-xs"></i></button>
             <button data-id="${n}" class="delete-note text-red-400 hover:text-red-600"><i class="fas fa-times fa-xs"></i></button>
        </div>`,t.querySelectorAll(".note-text, .edit-note").forEach(r=>{r.addEventListener("click",()=>{A.noteInput.value=e.text,A.noteIdInput.value=n,A.noteInput.focus()})}),t.querySelector(".delete-note").addEventListener("click",r=>{r.stopPropagation(),Ur(he(mt,n)),navigator.onLine||pe(rt)}),A.notesList.appendChild(t)}function E1(){sn&&(Xt("categories"),zt.categories=Ri(sn,n=>{A.categorySelect.innerHTML='<option value="Nenhuma">Sem Categoria</option>',A.filterContainer.innerHTML="";const e=document.createElement("button");e.className="filter-btn px-3 py-1 text-sm rounded-full",e.textContent="Todos",e.addEventListener("click",()=>{xr="Todos",kr(),yu()}),A.filterContainer.appendChild(e),n.docs.forEach(t=>{const i=t.data().name,r=document.createElement("option");r.value=i,r.textContent=i,A.categorySelect.appendChild(r);const s=document.createElement("button");s.className="filter-btn px-3 py-1 text-sm rounded-full flex items-center gap-2 group",s.textContent=i,s.dataset.category=i,s.addEventListener("click",()=>{xr=i,kr(),yu()});const o=document.createElement("button");o.className="delete-category-btn text-red-500 hover:text-red-700 ml-1 opacity-0 group-hover:opacity-100 transition-opacity",o.title="Excluir categoria",o.innerHTML='<i class="fas fa-trash-alt fa-xs"></i>',o.addEventListener("click",async a=>{a.stopPropagation(),confirm(`Tem certeza que deseja excluir a categoria "${i}"? Todas as tarefas associadas ficarão sem categoria.`)&&(await Ur(he(sn,t.id)),navigator.onLine||pe(rt))}),s.appendChild(o),A.filterContainer.appendChild(s)}),yu()},console.error))}function yu(){document.querySelectorAll(".filter-btn").forEach(n=>{n.classList.remove("active"),((n.textContent||"").replace(/<button.*<\/button>/,"").trim()==="Todos"&&xr==="Todos"||n.dataset.category===xr)&&n.classList.add("active")})}async function I1(n){n&&sn&&(await gR(he(sn,n),{name:n}),navigator.onLine||pe(rt))}function dT(n,e){be=n,A.detailTaskTitle.textContent=e;const t=`artifacts/${Gt}/users/${Ne}/tasks/${n}`,i=ct(He,`${t}/subtasks`),r=ct(He,`${t}/taskNotes`);Xt("task_details");const s=Ri(Je(i),c=>{A.subtaskList.innerHTML="",c.docs.sort((d,h)=>d.data().createdAt.toMillis()-h.data().createdAt.toMillis()).forEach(d=>A1(d.id,d.data()))}),o=Ri(Je(r),c=>{A.taskNotesList.innerHTML="",c.docs.sort((d,h)=>d.data().createdAt.toMillis()-h.data().createdAt.toMillis()).forEach(d=>R1(d.id,d.data()))});zt.task_details=()=>{s(),o()},A.taskDetailModal.classList.remove("hidden");const a=Mi.find(c=>c.id===n);Y1((a==null?void 0:a.category)||null)}function C1(){Xt("task_details"),A.taskDetailModal.classList.add("hidden"),be=null,A.detailTitleContainer.classList.remove("hidden"),A.detailEditContainer.classList.add("hidden")}function Tc(){A.detailTitleContainer.classList.toggle("hidden"),A.detailEditContainer.classList.toggle("hidden"),A.detailEditInput.value=A.detailTaskTitle.textContent||"",A.detailEditInput.focus(),A.detailSaveBtn.onclick=async()=>{const n=A.detailEditInput.value.trim();n&&be&&se&&(await Se(he(se,be),{text:n}),navigator.onLine||pe(rt)),Tc()},A.detailCancelBtn.onclick=()=>Tc()}async function w1(){const n=A.subtaskInput.value.trim();if(!n||!be||!Ne||!se)return;const e=ct(He,`artifacts/${Gt}/users/${Ne}/tasks/${be}/subtasks`);await yo(e,{text:n,completed:!1,createdAt:ue.now()}),await Se(he(se,be),{subtaskCount:ui(1)}),navigator.onLine||pe(rt),A.subtaskInput.value=""}function A1(n,e){const t=document.createElement("div");t.className="flex items-center bg-gray-100 p-2 rounded-lg group",t.innerHTML=`
        <div class="flex-grow flex items-center">
            <input type="checkbox" data-id="${n}" ${e.completed?"checked":""} class="subtask-checkbox h-4 w-4 rounded border-gray-300">
            <span class="subtask-text ml-3 ${e.completed?"line-through text-gray-500":""}">${e.text}</span>
        </div>
        <div class="subtask-actions flex items-center gap-2 opacity-0 group-hover:opacity-100">
            <button class="edit-subtask text-gray-400 hover:text-blue-500 text-sm"><i class="fas fa-pencil-alt"></i></button>
            <button class="delete-subtask text-gray-400 hover:text-red-500 text-sm" data-id="${n}"><i class="fas fa-trash-alt"></i></button>
        </div>`,t.querySelector(".subtask-checkbox").addEventListener("change",async i=>{const r=i.target,s=r.checked?1:-1;await Se(he(ct(He,`artifacts/${Gt}/users/${Ne}/tasks/${be}/subtasks`),n),{completed:r.checked}),await Se(he(se,be),{completedSubtaskCount:ui(s)}),navigator.onLine||pe(rt)}),t.querySelector(".delete-subtask").addEventListener("click",async()=>{e.completed?await Se(he(se,be),{subtaskCount:ui(-1),completedSubtaskCount:ui(-1)}):await Se(he(se,be),{subtaskCount:ui(-1)}),await Ur(he(ct(He,`artifacts/${Gt}/users/${Ne}/tasks/${be}/subtasks`),n)),navigator.onLine||pe(rt)}),t.querySelector(".edit-subtask").addEventListener("click",()=>{const i=t.querySelector(".subtask-text").textContent||"";t.innerHTML=`<input type="text" class="edit-subtask-input flex-grow p-1 border rounded" value="${i}">
                        <button class="save-subtask-edit bg-green-500 text-white px-2 py-1 rounded text-sm">Salvar</button>`;const r=t.querySelector(".edit-subtask-input");r.focus(),t.querySelector(".save-subtask-edit").addEventListener("click",async()=>{const s=r.value.trim();s&&(await Se(he(ct(He,`artifacts/${Gt}/users/${Ne}/tasks/${be}/subtasks`),n),{text:s}),navigator.onLine||pe(rt))})}),A.subtaskList.appendChild(t)}async function S1(){const n=A.taskNoteInput.value.trim();if(!n||!be||!Ne||!se)return;const e=ct(He,`artifacts/${Gt}/users/${Ne}/tasks/${be}/taskNotes`);await yo(e,{text:n,createdAt:ue.now()}),await Se(he(se,be),{noteCount:ui(1)}),navigator.onLine||pe(rt),A.taskNoteInput.value=""}function R1(n,e){const t=document.createElement("div");t.className="bg-yellow-100 p-2 rounded-lg text-sm text-yellow-800 relative group",t.innerHTML=`
        <p class="task-note-text">${e.text}</p>
        <div class="task-note-actions absolute top-1 right-1 flex items-center gap-2 opacity-0 group-hover:opacity-100">
             <button class="edit-task-note text-yellow-600 hover:text-blue-600"><i class="fas fa-pencil-alt fa-xs"></i></button>
             <button class="delete-task-note text-yellow-600 hover:text-red-600" data-id="${n}"><i class="fas fa-times fa-xs"></i></button>
        </div>`,t.querySelector(".delete-task-note").addEventListener("click",async()=>{await Ur(he(ct(He,`artifacts/${Gt}/users/${Ne}/tasks/${be}/taskNotes`),n)),await Se(he(se,be),{noteCount:ui(-1)}),navigator.onLine||pe(rt)}),t.querySelector(".edit-task-note").addEventListener("click",()=>{const i=t.querySelector(".task-note-text").textContent||"";t.innerHTML=`<textarea class="edit-task-note-input w-full p-1 border rounded">${i}</textarea>
                        <button class="save-task-note-edit w-full mt-1 bg-green-500 text-white px-2 py-1 rounded text-sm">Salvar</button>`;const r=t.querySelector(".edit-task-note-input");r.focus(),t.querySelector(".save-task-note-edit").addEventListener("click",async()=>{const s=r.value.trim();s&&(await Se(he(ct(He,`artifacts/${Gt}/users/${Ne}/tasks/${be}/taskNotes`),n),{text:s}),navigator.onLine||pe(rt))})}),A.taskNotesList.appendChild(t)}function P1(){A.calendarModal.classList.remove("hidden"),Ec()}function x1(){A.calendarModal.classList.add("hidden")}async function Ec(){const n=ir.getFullYear(),e=ir.getMonth();A.calendarMonthYear.textContent=new Date(n,e).toLocaleDateString("pt-BR",{month:"long",year:"numeric"}),A.calendarGrid.innerHTML="";const t=await k1(n,e),i=await b1(n,e),r=new Date(n,e,1).getDay(),s=new Date(n,e+1,0).getDate();for(let o=0;o<r;o++)A.calendarGrid.appendChild(document.createElement("div"));for(let o=1;o<=s;o++){const a=document.createElement("div");if(a.className="calendar-day relative p-2 border border-gray-200 rounded-md cursor-pointer hover:bg-gray-100 flex items-center justify-center",a.textContent=o.toString(),t.has(o)){const c=document.createElement("div");c.className="calendar-day-dot",a.appendChild(c)}if(i.has(o)){const c=document.createElement("div");c.className="absolute top-1 right-1 w-2.5 h-2.5 rounded-full bg-orange-500",c.title="Tarefa pendente para este dia",a.appendChild(c)}a.addEventListener("click",()=>{document.querySelectorAll(".calendar-day.selected").forEach(c=>c.classList.remove("selected")),a.classList.add("selected"),M1(new Date(n,e,o))}),A.calendarGrid.appendChild(a)}}async function k1(n,e){if(!Ne||!se||!mt)return new Set;const t=new Date(n,e,1),i=new Date(n,e+1,0,23,59,59),r=new Set,s=Je(se,lt("createdAt",">=",t),lt("createdAt","<=",i)),o=Je(mt,lt("createdAt",">=",t),lt("createdAt","<=",i)),[a,c]=await Promise.all([Mt(s),Mt(o)]);return a.forEach(d=>r.add(d.data().createdAt.toDate().getDate())),c.forEach(d=>r.add(d.data().createdAt.toDate().getDate())),r}async function b1(n,e){if(!Ne||!se)return new Set;const t=new Date(n,e,1),i=new Date(n,e+1,0,23,59,59),r=Je(se,lt("dueDate",">=",t),lt("dueDate","<=",i),lt("completed","==",!1)),s=await Mt(r),o=new Set;return s.forEach(a=>{const c=a.data().dueDate;c&&c.toDate&&o.add(c.toDate().getDate())}),o}async function M1(n){if(!se||!mt)return;A.detailsDayHeader.textContent=`Atividade de ${n.toLocaleDateString("pt-BR",{dateStyle:"full"})}`,A.detailsContent.innerHTML="Carregando...";const e=new Date(n.setHours(0,0,0,0)),t=new Date(n.setHours(23,59,59,999)),i=Je(se,lt("createdAt",">=",e),lt("createdAt","<=",t)),r=Je(mt,lt("createdAt",">=",e),lt("createdAt","<=",t)),s=Je(se,lt("dueDate",">=",e),lt("dueDate","<=",t)),[o,a,c]=await Promise.all([Mt(i),Mt(r),Mt(s)]);let d="";c.empty||(d+='<div class="mb-4"><h4 class="font-bold text-orange-500">Tarefas agendadas para esse dia</h4>',c.forEach(h=>{const p=h.data();d+=`<span class='calendar-task-link text-orange-900 hover:underline cursor-pointer' data-taskid='${h.id}'>${p.text}</span><br>`}),d+="</div>"),d+='<div class="mb-4"><h4 class="font-bold">Tarefas criadas neste dia</h4>',o.empty?d+='<p class="text-sm">Nenhuma tarefa.</p>':o.forEach(h=>d+=`<p class="text-sm bg-gray-100 p-1 rounded mt-1">${h.data().text}</p>`),d+='</div><div><h4 class="font-bold">Anotações</h4>',a.empty?d+='<p class="text-sm">Nenhuma anotação.</p>':a.forEach(h=>d+=`<p class="text-sm bg-yellow-100 p-1 rounded mt-1">${h.data().text}</p>`),d+="</div>",A.detailsContent.innerHTML=d,A.detailsContent.querySelectorAll(".calendar-task-link").forEach(h=>{h.addEventListener("click",function(){const p=this.getAttribute("data-taskid"),g=c.docs.find(_=>_.id===p);p&&g&&dT(p,g.data().text)})})}function D1(){mi=mi==="list"?"canvas":"list";const n=mi==="list";A.mainContentApp.classList.toggle("hidden",!n),A.canvasView.classList.toggle("hidden",n),A.viewToggleIcon.className=n?"fas fa-project-diagram fa-lg":"fas fa-list-ul fa-lg",A.viewToggleBtn.title=n?"Visualização em Canvas":"Visualização em Lista";const e=document.getElementById("add-free-card-btn");e?(e.classList.toggle("hidden",n),console.log("[Free Card] Toggle view - Botão:",n?"oculto":"visível")):console.warn("[Free Card] Toggle view - Botão não encontrado"),n?(Xt("canvas_tasks"),kr()):(Xt("tasks"),requestAnimationFrame(()=>{fT()}))}async function fT(){!se||!De||(Xt("canvas_tasks"),Xt("canvas_free_cards"),A.taskCanvas.innerHTML="",A.canvasLinesSvg.innerHTML="",kt={},Ct={},Mi=[],Xs=[],Ic(),zt.canvas_tasks=Ri(Je(se),n=>{console.log("[Canvas Sync] Tasks onSnapshot triggered.");const e=n.docs.map(o=>({id:o.id,...o.data()}));Mi=e;const t=new Set(Object.keys(kt)),i=new Set(e.map(o=>o.id)),r=Vp(He);let s=!1;e.forEach((o,a)=>{var d;let c=kt[o.id];if(o.x===void 0||o.y===void 0){const h=A.taskCanvasContainer.offsetWidth||1e3,p=Math.max(1,Math.floor(h/250));o.x=a%p*250+50,o.y=Math.floor(a/p)*120+50,r.update(he(se,o.id),{x:o.x,y:o.y}),s=!0}if(c){((d=$.draggedNode)==null?void 0:d.dataset.id)!==o.id&&(c.style.left=`${o.x}px`,c.style.top=`${o.y}px`);const h=c.querySelector(".canvas-task-node-text");h&&h.textContent!==o.text&&(h.textContent=o.text),o.completed?c.classList.add("completed-node"):c.classList.remove("completed-node")}else N1(o)}),s&&r.commit().catch(o=>console.warn("Falha ao salvar posições iniciais durante a sincronização.",o)),t.forEach(o=>{if(!i.has(o)){const a=kt[o];a&&(a.remove(),delete kt[o])}}),Ya()},n=>{console.error("Erro de sincronização com o canvas (tasks):",n),pe("Erro de sincronização com o canvas.")}),zt.canvas_free_cards=Ri(Je(De),n=>{console.log("[Canvas Sync] Free cards onSnapshot triggered.");const e=n.docs.map(o=>({id:o.id,...o.data()}));Xs=e;const t=new Set(Object.keys(Ct)),i=new Set(e.map(o=>o.id)),r=Vp(He);let s=!1;e.forEach((o,a)=>{var d;let c=Ct[o.id];if(o.x===void 0||o.y===void 0){const h=A.taskCanvasContainer.offsetWidth||1e3,p=Math.max(1,Math.floor(h/250));o.x=a%p*250+50,o.y=Math.floor(a/p)*120+200,r.update(he(De,o.id),{x:o.x,y:o.y}),s=!0}if(c){((d=$.draggedNode)==null?void 0:d.dataset.id)!==o.id&&(c.style.left=`${o.x}px`,c.style.top=`${o.y}px`);const h=c.querySelector(".canvas-free-card-node-text");h&&h.textContent!==o.text&&(h.textContent=o.text)}else V1(o)}),s&&r.commit().catch(o=>console.warn("Falha ao salvar posições iniciais dos free cards durante a sincronização.",o)),t.forEach(o=>{if(!i.has(o)){const a=Ct[o];a&&(a.remove(),delete Ct[o])}}),Ya()},n=>{console.error("Erro de sincronização com o canvas (free cards):",n),pe("Erro de sincronização com o canvas.")}))}function N1(n){const e=document.createElement("div");e.className="canvas-task-node",e.dataset.id=n.id,e.style.left=`${n.x||0}px`,e.style.top=`${n.y||0}px`,n.completed&&e.classList.add("completed-node"),e.innerHTML=`
        <p class="canvas-task-node-text">${n.text}</p>
    `,e.addEventListener("mousedown",t=>{var r,s;if(((s=(r=t.target)==null?void 0:r.classList)==null?void 0:s.contains("canvas-task-node-link-handle"))||t.shiftKey){t.stopPropagation(),$.isLinking=!0,$.linkStartNodeId=n.id;const o=Ms(e,t.clientX,t.clientY);$.linkStartSide=o,A.taskCanvasContainer.classList.add("linking-mode");const a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("class","linking-line"),A.canvasLinesSvg.appendChild(a)}}),kt[n.id]=e,A.taskCanvas.appendChild(e)}function V1(n){const e=document.createElement("div");e.className="canvas-free-card-node",e.dataset.id=n.id,e.dataset.type="free-card",e.style.left=`${n.x||0}px`,e.style.top=`${n.y||0}px`,e.tabIndex=0,e.innerHTML=`
        <p class="canvas-free-card-node-text">${n.text}</p>
    `,e.addEventListener("click",t=>{t.stopPropagation(),document.querySelectorAll(".canvas-free-card-node.selected").forEach(i=>i.classList.remove("selected")),e.classList.add("selected"),e.focus()}),e.addEventListener("keydown",async t=>{(t.key==="Delete"||t.key==="Del")&&e.classList.contains("selected")&&(t.preventDefault(),De&&(await Ur(he(De,n.id)),pe("Card livre excluído!")))}),e.addEventListener("mousedown",t=>{var s,o,a;const i=(o=(s=t.target)==null?void 0:s.classList)==null?void 0:o.contains("canvas-free-card-node-link-handle");if(((a=t.target)==null?void 0:a.tagName)!=="TEXTAREA"&&(i||t.shiftKey)){t.stopPropagation(),$.isLinking=!0,$.linkStartNodeId=n.id;const c=Ms(e,t.clientX,t.clientY);$.linkStartSide=c,A.taskCanvasContainer.classList.add("linking-mode");const d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("class","linking-line"),A.canvasLinesSvg.appendChild(d)}}),e.addEventListener("dblclick",t=>{t.stopPropagation();const i=e.querySelector(".canvas-free-card-node-text");if(!i)return;const r=i.textContent||"",s=document.createElement("textarea");s.value=r,s.className="w-full p-2 border rounded bg-white text-blue-900",s.style.fontWeight="500",s.style.fontSize="1rem",s.style.resize="none",s.style.minHeight="48px",i.replaceWith(s),s.focus(),s.select();const o=async()=>{const a=s.value.trim();a&&a!==r&&De&&await Se(he(De,n.id),{text:a});const c=document.createElement("p");c.className="canvas-free-card-node-text",c.textContent=a||r,s.replaceWith(c)};s.addEventListener("blur",o),s.addEventListener("keydown",a=>{if(a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),s.blur()),a.key==="Escape"){const c=document.createElement("p");c.className="canvas-free-card-node-text",c.textContent=r,s.replaceWith(c)}})}),Ct[n.id]=e,A.taskCanvas.appendChild(e)}function Ya(){if(!A.canvasLinesSvg)return;const n=A.canvasLinesSvg.querySelector(".linking-line");A.canvasLinesSvg.innerHTML="",n&&A.canvasLinesSvg.appendChild(n),Mi.forEach(e=>{var t;(t=e.connections)!=null&&t.length&&e.connections.forEach(i=>{let r,s,o,a;typeof i=="string"?(r=i,s=void 0,o="right",a="left"):(r=i.targetId,s=i.comment,o=i.sourceSide||"right",a=i.targetSide||"left");const c=kt[e.id],d=kt[r]||Ct[r];if(c&&d){const h=document.createElementNS("http://www.w3.org/2000/svg","g"),p=hg(c,d,!1,void 0,!1,o,a),g=p.cloneNode();if(g.setAttribute("stroke","rgba(0,0,0,0)"),g.setAttribute("stroke-width","16"),g.setAttribute("pointer-events","stroke"),g.setAttribute("class",(p.getAttribute("class")||"")+" hit-area"),g.setAttribute("tabindex","0"),h.appendChild(g),h.appendChild(p),g.addEventListener("click",U=>{U.stopPropagation(),document.querySelectorAll(".canvas-line.selected, .canvas-free-card-line.selected").forEach(q=>q.classList.remove("selected")),p.classList.add("selected"),p.tabIndex=0,g.focus()}),g.addEventListener("keydown",async U=>{if((U.key==="Delete"||U.key==="Del")&&p.classList.contains("selected")&&se){const q=he(se,e.id),I=(e.connections||[]).filter(T=>typeof T=="string"?T!==r:T.targetId!==r);await Se(q,{connections:I}),pe("Conexão removida!")}}),g.addEventListener("focus",()=>p.classList.add("selected")),g.addEventListener("blur",()=>p.classList.remove("selected")),s){const U=c.offsetLeft+c.offsetWidth,q=c.offsetTop+c.offsetHeight/2,I=d.offsetLeft,T=d.offsetTop+d.offsetHeight/2,E=(U+I)/2,R=(q+T)/2,w=document.createElementNS("http://www.w3.org/2000/svg","text");w.setAttribute("x",String(E)),w.setAttribute("y",String(R-10)),w.setAttribute("text-anchor","middle"),w.setAttribute("fill","#6366f1"),w.setAttribute("font-size","13"),w.setAttribute("opacity","0.7"),w.setAttribute("pointer-events","none"),w.textContent=s,h.appendChild(w)}p.addEventListener("dblclick",U=>{U.stopPropagation();const q=(c.offsetLeft+c.offsetWidth+d.offsetLeft)/2,I=(c.offsetTop+c.offsetHeight/2+d.offsetTop+d.offsetHeight/2)/2;mg(e.id,r,q,I,s||"")});const _=document.createElementNS("http://www.w3.org/2000/svg","svg");_.setAttribute("width","20"),_.setAttribute("height","20"),_.setAttribute("viewBox","0 0 448 512"),_.setAttribute("class","canvas-trash-icon"),_.style.display="none",_.style.position="absolute",_.style.cursor="pointer",_.innerHTML='<path fill="#ef4444" d="M135.2 17.7C140.2 7.4 150.5 0 162.3 0h123.4c11.8 0 22.1 7.4 27.1 17.7l19.8 38.3H432c8.8 0 16 7.2 16 16s-7.2 16-16 16h-16l-21.2 339.4c-2.6 41.2-36.7 72.3-77.9 72.3H131.1c-41.2 0-75.3-31.1-77.9-72.3L32 88H16C7.2 88 0 80.8 0 72s7.2-16 16-16h74.4l19.8-38.3zM131.1 464h185.8c23.2 0 42.2-17.5 43.5-40.7L381.2 88H66.8l21.2 335.3c1.3 23.2 20.3 40.7 43.5 40.7zM176 224c8.8 0 16 7.2 16 16v128c0 8.8-7.2 16-16 16s-16-7.2-16-16V240c0-8.8 7.2-16 16-16s16 7.2 16 16z"/>';const C=c.offsetLeft+c.offsetWidth,P=c.offsetTop+c.offsetHeight/2,x=d.offsetLeft,F=d.offsetTop+d.offsetHeight/2,L=(C+x)/2,V=(P+F)/2;_.setAttribute("x",String(L-10)),_.setAttribute("y",String(V-10)),_.style.pointerEvents="auto";let O=null;h.addEventListener("mouseenter",()=>{O&&clearTimeout(O),_.style.display="block"}),h.addEventListener("mouseleave",()=>{O=setTimeout(()=>{_.style.display="none"},350)}),_.addEventListener("mouseenter",()=>{O&&clearTimeout(O),_.style.display="block"}),_.addEventListener("mouseleave",()=>{O=setTimeout(()=>{_.style.display="none"},350)}),_.addEventListener("click",async U=>{if(U.stopPropagation(),se){const q=he(se,e.id),I=(e.connections||[]).filter(T=>typeof T=="string"?T!==r:T.targetId!==r);await Se(q,{connections:I}),pe("Conexão removida!")}}),h.appendChild(_),A.canvasLinesSvg.appendChild(h)}else console.warn(`[Canvas Draw] FAILED to draw line: Could not find nodes in cache. Source (${e.id}): ${!!c}, Target (${r}): ${!!d}`)})}),Xs.forEach(e=>{var t;(t=e.connections)!=null&&t.length&&e.connections.forEach(i=>{let r,s,o,a;typeof i=="string"?(r=i,s=void 0,o="right",a="left"):(r=i.targetId,s=i.comment,o=i.sourceSide||"right",a=i.targetSide||"left");const c=Ct[e.id],d=kt[r]||Ct[r];if(c&&d){const h=document.createElementNS("http://www.w3.org/2000/svg","g"),p=hg(c,d,!1,void 0,!0,o,a),g=p.cloneNode();if(g.setAttribute("stroke","rgba(0,0,0,0)"),g.setAttribute("stroke-width","16"),g.setAttribute("pointer-events","stroke"),g.setAttribute("class",(p.getAttribute("class")||"")+" hit-area"),g.setAttribute("tabindex","0"),h.appendChild(g),h.appendChild(p),g.addEventListener("click",U=>{U.stopPropagation(),document.querySelectorAll(".canvas-line.selected, .canvas-free-card-line.selected").forEach(q=>q.classList.remove("selected")),p.classList.add("selected"),p.tabIndex=0,g.focus()}),g.addEventListener("keydown",async U=>{if((U.key==="Delete"||U.key==="Del")&&p.classList.contains("selected")&&De){const q=he(De,e.id),I=(e.connections||[]).filter(T=>typeof T=="string"?T!==r:T.targetId!==r);await Se(q,{connections:I}),pe("Conexão removida!")}}),g.addEventListener("focus",()=>p.classList.add("selected")),g.addEventListener("blur",()=>p.classList.remove("selected")),s){const U=c.offsetLeft+c.offsetWidth,q=c.offsetTop+c.offsetHeight/2,I=d.offsetLeft,T=d.offsetTop+d.offsetHeight/2,E=(U+I)/2,R=(q+T)/2,w=document.createElementNS("http://www.w3.org/2000/svg","text");w.setAttribute("x",String(E)),w.setAttribute("y",String(R-10)),w.setAttribute("text-anchor","middle"),w.setAttribute("fill","#3b82f6"),w.setAttribute("font-size","13"),w.setAttribute("opacity","0.7"),w.setAttribute("pointer-events","none"),w.textContent=s,h.appendChild(w)}p.addEventListener("dblclick",U=>{U.stopPropagation();const q=(c.offsetLeft+c.offsetWidth+d.offsetLeft)/2,I=(c.offsetTop+c.offsetHeight/2+d.offsetTop+d.offsetHeight/2)/2;mg(e.id,r,q,I,s||"",!0)});const _=document.createElementNS("http://www.w3.org/2000/svg","svg");_.setAttribute("width","20"),_.setAttribute("height","20"),_.setAttribute("viewBox","0 0 448 512"),_.setAttribute("class","canvas-trash-icon"),_.style.display="none",_.style.position="absolute",_.style.cursor="pointer",_.innerHTML='<path fill="#ef4444" d="M135.2 17.7C140.2 7.4 150.5 0 162.3 0h123.4c11.8 0 22.1 7.4 27.1 17.7l19.8 38.3H432c8.8 0 16 7.2 16 16s-7.2 16-16 16h-16l-21.2 339.4c-2.6 41.2-36.7 72.3-77.9 72.3H131.1c-41.2 0-75.3-31.1-77.9-72.3L32 88H16C7.2 88 0 80.8 0 72s7.2-16 16-16h74.4l19.8-38.3zM131.1 464h185.8c23.2 0 42.2-17.5 43.5-40.7L381.2 88H66.8l21.2 335.3c1.3 23.2 20.3 40.7 43.5 40.7zM176 224c8.8 0 16 7.2 16 16v128c0 8.8-7.2 16-16 16s-16-7.2-16-16V240c0-8.8 7.2-16 16-16s16 7.2 16 16z"/>';const C=c.offsetLeft+c.offsetWidth,P=c.offsetTop+c.offsetHeight/2,x=d.offsetLeft,F=d.offsetTop+d.offsetHeight/2,L=(C+x)/2,V=(P+F)/2;_.setAttribute("x",String(L-10)),_.setAttribute("y",String(V-10)),_.style.pointerEvents="auto";let O=null;h.addEventListener("mouseenter",()=>{O&&clearTimeout(O),_.style.display="block"}),h.addEventListener("mouseleave",()=>{O=setTimeout(()=>{_.style.display="none"},350)}),_.addEventListener("mouseenter",()=>{O&&clearTimeout(O),_.style.display="block"}),_.addEventListener("mouseleave",()=>{O=setTimeout(()=>{_.style.display="none"},350)}),_.addEventListener("click",async U=>{if(U.stopPropagation(),De){const q=he(De,e.id),I=(e.connections||[]).filter(T=>typeof T=="string"?T!==r:T.targetId!==r);await Se(q,{connections:I}),pe("Conexão removida!")}}),h.appendChild(_),A.canvasLinesSvg.appendChild(h)}})})}function hg(n,e,t=!1,i,r=!1,s,o){if(A.canvasLinesSvg&&!A.canvasLinesSvg.querySelector("marker#arrowhead")){const C=document.createElementNS("http://www.w3.org/2000/svg","defs");C.innerHTML=`
            <marker id="arrowhead" markerWidth="2" markerHeight="1.2" refX="2" refY="0.6" orient="auto">
                <polygon points="0 0, 2 0.6, 0 1.2" fill="#6366f1"/>
            </marker>
        `,A.canvasLinesSvg.prepend(C)}if(A.canvasLinesSvg&&!A.canvasLinesSvg.querySelector("marker#arrowhead-blue")){const C=A.canvasLinesSvg.querySelector("defs");if(C){const P=document.createElementNS("http://www.w3.org/2000/svg","marker");P.setAttribute("id","arrowhead-blue"),P.setAttribute("markerWidth","2"),P.setAttribute("markerHeight","1.2"),P.setAttribute("refX","2"),P.setAttribute("refY","0.6"),P.setAttribute("orient","auto"),P.innerHTML='<polygon points="0 0, 2 0.6, 0 1.2" fill="#3b82f6"/>',C.appendChild(P)}}function a(C,P){const x=C.offsetLeft,F=C.offsetTop,L=C.offsetWidth,V=C.offsetHeight;switch(P){case"top":return{x:x+L/2,y:F};case"bottom":return{x:x+L/2,y:F+V};case"left":return{x,y:F+V/2};case"right":return{x:x+L,y:F+V/2};default:return{x:x+L,y:F+V/2}}}let c,d,h,p;c=a(n,s||"right").x,d=a(n,s||"right").y,h=a(e,o||"left").x,p=a(e,o||"left").y;const g=document.createElementNS("http://www.w3.org/2000/svg","path"),_=Math.max(50,Math.abs(h-c)*.3);return g.setAttribute("d",`M ${c} ${d} C ${c+_} ${d}, ${h-_} ${p}, ${h} ${p}`),r?(g.setAttribute("class",t?"linking-line":"canvas-free-card-line"),g.setAttribute("stroke","#3b82f6"),g.setAttribute("marker-end","url(#arrowhead-blue)")):(g.setAttribute("class",t?"linking-line":"canvas-line"),g.setAttribute("stroke","#6366f1"),g.setAttribute("marker-end","url(#arrowhead)")),g.setAttribute("stroke-width","2"),g.setAttribute("fill","none"),g.setAttribute("opacity",t?"0.7":"1"),g}function Ic(){const n=`translate(${$.panOffsetX}px, ${$.panOffsetY}px) scale(${$.zoom})`;A.taskCanvas.style.transform=n,A.canvasLinesSvg.style.transform=n}async function L1(n,e){const t=Mi.find(c=>c.id===n);if(!t||!Ne)return;A.canvasPopupTitle.textContent=t.text,A.canvasPopupSubtasks.innerHTML="<p>Carregando...</p>",A.canvasPopupNotes.innerHTML="<p>Carregando...</p>";const i=A.taskCanvasContainer.getBoundingClientRect(),r=e.getBoundingClientRect();A.canvasTaskPopup.style.left=`${r.right-i.left+5}px`,A.canvasTaskPopup.style.top=`${r.top-i.top}px`,A.canvasTaskPopup.classList.remove("hidden");const s=`artifacts/${Gt}/users/${Ne}/tasks/${n}`,[o,a]=await Promise.all([Mt(Je(ct(He,`${s}/subtasks`))),Mt(Je(ct(He,`${s}/taskNotes`)))]);A.canvasPopupSubtasks.innerHTML=o.empty?'<p class="text-gray-400">Nenhuma sub-tarefa.</p>':o.docs.map(c=>{const d=c.data();return`<p class="${d.completed?"completed":""}">${d.text}</p>`}).join(""),A.canvasPopupNotes.innerHTML=a.empty?'<p class="text-gray-400">Nenhuma anotação.</p>':a.docs.map(c=>`<p>${c.data().text}</p>`).join("")}function bs(){A.canvasTaskPopup.classList.add("hidden")}const F1=()=>{Ee.add(A.addTaskBtn,"click",g1),Ee.add(A.saveNoteBtn,"click",y1),Ee.add(A.toggleCompletedBtn,"click",()=>{Ka=!Ka,uT(),kr()}),Ee.add(A.closeDetailModalBtn,"click",C1),Ee.add(A.addSubtaskBtn,"click",w1),Ee.add(A.addTaskNoteBtn,"click",S1),Ee.add(A.calendarBtn,"click",P1),Ee.add(A.closeCalendarBtn,"click",x1),Ee.add(A.prevMonthBtn,"click",()=>{ir.setMonth(ir.getMonth()-1),Ec()}),Ee.add(A.nextMonthBtn,"click",()=>{ir.setMonth(ir.getMonth()+1),Ec()});const n=A.detailTitleContainer.querySelector(".edit-main-task-btn");n&&Ee.add(n,"click",Tc),Ee.add(A.addCategoryBtn,"click",a=>{a.preventDefault(),z1()}),Ee.add(A.themeToggleBtn,"click",K1),Ee.add(document,"click",a=>{const c=a.target;A.userMenuContainer.contains(c)||A.userMenuDropdown.classList.add("hidden"),!A.canvasTaskPopup.classList.contains("hidden")&&!A.canvasTaskPopup.contains(c)&&!a.target.closest(".canvas-task-node")&&bs();const d=document.getElementById("free-card-popup");d&&!d.classList.contains("hidden")&&!d.contains(c)&&Xa(),a.target.closest(".canvas-free-card-node")||document.querySelectorAll(".canvas-free-card-node.selected").forEach(h=>h.classList.remove("selected"))}),Ee.add(A.logoutBtn,"click",async()=>{await MC(wl),A.userMenuDropdown.classList.add("hidden")}),Ee.add(window,"online",vc),Ee.add(window,"offline",vc),Ee.add(A.viewToggleBtn,"click",D1),U1(),Ee.add(A.canvasPopupCloseBtn,"click",bs);const e=document.getElementById("add-free-card-btn");console.log("[Free Card] Botão principal encontrado:",!!e),e&&(Ee.add(e,"click",W1),console.log("[Free Card] Event listener adicionado ao botão principal"));const t=document.getElementById("add-free-card-btn-modal");console.log("[Free Card] Botão do modal encontrado:",!!t),t&&(Ee.add(t,"click",cT),console.log("[Free Card] Event listener adicionado ao botão do modal"));const i=document.getElementById("close-free-card-popup-btn");console.log("[Free Card] Botão de fechar encontrado:",!!i),i&&(Ee.add(i,"click",Xa),console.log("[Free Card] Event listener adicionado ao botão de fechar")),A.userMenuTrigger&&Ee.add(A.userMenuTrigger,"click",a=>{a.stopPropagation(),A.userMenuDropdown.classList.toggle("hidden")});const r=document.getElementById("open-task-popup-btn"),s=document.getElementById("task-popup"),o=document.getElementById("close-task-popup-btn");r&&s&&r.addEventListener("click",()=>{s.classList.remove("hidden"),setTimeout(()=>{const a=document.getElementById("task-input");a&&a.focus()},50)}),o&&s&&o.addEventListener("click",()=>{s.classList.add("hidden")})};function U1(){const n=A.taskCanvasContainer,e=s=>{const o=s.target,a=o.closest(".canvas-task-node"),c=o.closest(".canvas-free-card-node"),d=a||c;if(o.classList.contains("canvas-task-node-link-handle")&&a){s.stopPropagation(),$.isLinking=!0,$.linkStartNodeId=a.dataset.id||null;const h=Ms(a,s.clientX,s.clientY);$.linkStartSide=h,n.classList.add("linking-mode");const p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("class","linking-line"),A.canvasLinesSvg.appendChild(p)}else if(o.classList.contains("canvas-free-card-node-link-handle")&&c){s.stopPropagation(),$.isLinking=!0,$.linkStartNodeId=c.dataset.id||null;const h=Ms(c,s.clientX,s.clientY);$.linkStartSide=h,n.classList.add("linking-mode");const p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("class","linking-line"),A.canvasLinesSvg.appendChild(p)}else d?(s.stopPropagation(),$.isDragging=!0,$.draggedNode=d,$.startX=s.clientX,$.startY=s.clientY,$.nodeInitialX=d.offsetLeft,$.nodeInitialY=d.offsetTop,d.style.zIndex="20"):($.isPanning=!0,n.classList.add("grabbing"),$.startX=s.clientX-$.panOffsetX,$.startY=s.clientY-$.panOffsetY)},t=s=>{if($.isLinking&&$.linkStartNodeId){const o=kt[$.linkStartNodeId]||Ct[$.linkStartNodeId];if(!o)return;const a=$.linkStartSide||"right",c=n.getBoundingClientRect(),d=s.clientX-c.left,h=s.clientY-c.top,p=(d-$.panOffsetX)/$.zoom,g=(h-$.panOffsetY)/$.zoom,_=A.canvasLinesSvg.querySelector(".linking-line");if(_){const P=function(O,U){const q=O.offsetLeft,I=O.offsetTop,T=O.offsetWidth,E=O.offsetHeight;switch(U){case"top":return{x:q+T/2,y:I};case"bottom":return{x:q+T/2,y:I+E};case"left":return{x:q,y:I+E/2};case"right":return{x:q+T,y:I+E/2};default:return{x:q+T,y:I+E/2}}}(o,a),x=P.x,F=P.y,L=Math.max(50,Math.abs(p-x)*.3),V=`M ${x} ${F} C ${x+L} ${F}, ${p-L} ${g}, ${p} ${g}`;_.setAttribute("d",V)}}else if($.isDragging&&$.draggedNode){bs();const o=(s.clientX-$.startX)/$.zoom,a=(s.clientY-$.startY)/$.zoom;$.draggedNode.style.left=`${$.nodeInitialX+o}px`,$.draggedNode.style.top=`${$.nodeInitialY+a}px`,Ya()}else $.isPanning&&(bs(),$.panOffsetX=s.clientX-$.startX,$.panOffsetY=s.clientY-$.startY,Ic())},i=async s=>{try{const o=s.target,a=o.closest(".canvas-task-node"),c=o.closest(".canvas-free-card-node"),d=a||c;if($.isLinking&&$.linkStartNodeId){const h=A.canvasLinesSvg.querySelector(".linking-line");if(h&&h.remove(),d&&d.dataset.id!==$.linkStartNodeId){const p=d.dataset.id,g=$.linkStartNodeId&&Ct[$.linkStartNodeId],_=Ms(d,s.clientX,s.clientY);if($.linkTargetSide=_,p){const C={targetId:p,sourceSide:$.linkStartSide||"right",targetSide:_||"left"};g&&De?await Se(he(De,$.linkStartNodeId),{connections:Np(C)}):se&&await Se(he(se,$.linkStartNodeId),{connections:Np(C)})}}}else if($.isDragging&&$.draggedNode){const h=$.draggedNode.dataset.id,p=$.draggedNode.dataset.type==="free-card",g=s.clientX-$.startX,_=s.clientY-$.startY;if(Math.abs(g)>5||Math.abs(_)>5){if(h){const C=$.draggedNode.offsetLeft,P=$.draggedNode.offsetTop;p&&De?await Se(he(De,h),{x:C,y:P}):se&&await Se(he(se,h),{x:C,y:P})}}else h&&!p&&L1(h,$.draggedNode)}}catch(o){console.error("Error during canvas mouseup operation:",o),pe("Falha ao criar conexão. Verifique o console para detalhes.")}finally{if($.isDragging&&$.draggedNode&&($.draggedNode.style.zIndex="10"),$.isPanning&&n.classList.remove("grabbing"),$.isLinking){const o=A.canvasLinesSvg.querySelector(".linking-line");o&&o.remove(),n.classList.remove("linking-mode")}$.isLinking=!1,$.isDragging=!1,$.isPanning=!1,$.draggedNode=null,$.linkStartNodeId=null,$.linkStartSide=null,$.linkTargetSide=null}},r=s=>{s.preventDefault(),bs();const o=n.getBoundingClientRect(),a=s.clientX-o.left,c=s.clientY-o.top,d=$.zoom,h=1.1;let p=s.deltaY<0?d*h:d/h;p=Math.max(.2,Math.min(p,3));const g=(a-$.panOffsetX)/d,_=(c-$.panOffsetY)/d;$.panOffsetX=a-g*p,$.panOffsetY=c-_*p,$.zoom=p,Ic()};Ee.add(n,"mousedown",e),Ee.add(window,"mousemove",t),Ee.add(window,"mouseup",i),Ee.add(n,"wheel",r)}const O1=()=>{q1(),F1(),$1(),Ja(!1)},B1=()=>{Ee.removeAll(),p1(),A.notesList&&(A.notesList.innerHTML=""),A.taskList&&(A.taskList.innerHTML=""),A.categorySelect&&(A.categorySelect.innerHTML=""),A.filterContainer&&(A.filterContainer.innerHTML=""),A.taskCanvas&&(A.taskCanvas.innerHTML=""),A.canvasLinesSvg&&(A.canvasLinesSvg.innerHTML=""),kt={},Ct={},Mi=[],Xs=[],mi="list",$={isPanning:!1,isDragging:!1,isLinking:!1,draggedNode:null,linkStartNodeId:null,startX:0,startY:0,panOffsetX:0,panOffsetY:0,zoom:1,nodeInitialX:0,nodeInitialY:0,linkStartSide:null,linkTargetSide:null},Ja(!0)},q1=()=>{if(!Ne)return;const n=`artifacts/${Gt}/users/${Ne}`;se=ct(He,`${n}/tasks`),mt=ct(He,`${n}/notes`),sn=ct(He,`${n}/categories`),De=ct(He,`${n}/freeCards`),console.log("[Firestore] Collections configuradas:",{userId:Ne,basePath:n,tasksCollectionRef:!!se,notesCollectionRef:!!mt,categoriesCollectionRef:!!sn,freeCardsCollectionRef:!!De})},$1=()=>{vc(),m1(),uT(),E1();const n=document.getElementById("add-free-card-btn");n?(n.classList.toggle("hidden",mi==="list"),console.log("[Free Card] Botão encontrado, estado inicial:",mi==="list"?"oculto":"visível")):console.warn("[Free Card] Botão não encontrado no DOM"),mi==="list"?kr():requestAnimationFrame(()=>fT()),v1()};function hT(){A.loginContainer.classList.remove("hidden"),A.registerContainer.classList.add("hidden"),A.loginError.textContent=""}function G1(){A.loginContainer.classList.add("hidden"),A.registerContainer.classList.remove("hidden"),A.registerError.textContent=""}A.showRegisterBtn&&(A.showRegisterBtn.onclick=G1);A.showLoginBtn&&(A.showLoginBtn.onclick=hT);A.loginForm&&(A.loginForm.onsubmit=async n=>{n.preventDefault(),console.log("[DEBUG] Tentando logar..."),A.loginError.textContent="";const e=document.getElementById("login-email").value.trim(),t=document.getElementById("login-password").value;try{await PC(wl,e,t)}catch{A.loginError.textContent="E-mail ou senha inválidos."}});A.registerForm&&(A.registerForm.onsubmit=async n=>{n.preventDefault(),A.registerError.textContent="";const e=document.getElementById("register-email").value.trim(),t=document.getElementById("register-password").value;try{await RC(wl,e,t),hT(),A.loginError.textContent="Cadastro realizado! Faça login."}catch{A.registerError.textContent="Erro ao cadastrar. Verifique o e-mail e senha."}});const H1=async()=>{await IR(pe),Ja(!0),bC(wl,n=>{B1(),n?(Ne=n.uid,O1(),A.appContainer.classList.remove("hidden"),A.loginContainer.classList.add("hidden"),A.registerContainer.classList.add("hidden"),n.email?(A.userEmail.textContent=n.email,A.userMenuContainer.classList.remove("hidden")):A.userMenuContainer.classList.add("hidden")):(Ja(!0),Ne=null,A.appContainer.classList.add("hidden"),A.loginContainer.classList.remove("hidden"),A.registerContainer.classList.add("hidden"),A.userMenuContainer.classList.add("hidden"))})};function z1(){A.categoryPopup.classList.remove("hidden"),A.categoryPopupInput.value="",setTimeout(()=>A.categoryPopupInput.focus(),50)}function Md(){A.categoryPopup.classList.add("hidden")}function W1(){const n=document.getElementById("free-card-popup");if(n){n.classList.remove("hidden"),n.style.display="flex",n.style.zIndex="99999",setTimeout(()=>{n.classList.remove("hidden"),n.style.display="flex",n.style.zIndex="99999"},50);const e=document.getElementById("free-card-input");e&&(e.value="",setTimeout(()=>e.focus(),100))}}function Xa(){const n=document.getElementById("free-card-popup");n&&(n.classList.add("hidden"),n.style.display="",n.style.zIndex="")}A.categoryPopupCancel&&(A.categoryPopupCancel.onclick=Md);A.categoryPopupAdd&&(A.categoryPopupAdd.onclick=async()=>{const n=A.categoryPopupInput.value.trim();n?(await I1(n),Md()):A.categoryPopupInput.focus()});A.categoryPopupInput&&A.categoryPopupInput.addEventListener("keydown",n=>{n.key==="Enter"&&A.categoryPopupAdd.click(),n.key==="Escape"&&Md()});const pg=document.getElementById("free-card-input");pg&&pg.addEventListener("keydown",n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),cT()),n.key==="Escape"&&Xa()});function pT(n){n==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}function K1(){const e=(localStorage.getItem("theme")||"dark")==="dark"?"light":"dark";localStorage.setItem("theme",e),pT(e),mT(e)}function mT(n){A.themeToggleBtn&&(A.themeToggleBtn.innerHTML=n==="dark"?'<i class="fas fa-sun fa-lg"></i>':'<i class="fas fa-moon fa-lg"></i>',A.themeToggleBtn.title=n==="dark"?"Modo claro":"Modo escuro")}const gT=localStorage.getItem("theme")||"dark";pT(gT);mT(gT);async function J1(){if(!se||!mt||!navigator.onLine||!Ne){pe("A análise com IA requer uma conexão com a internet.");return}A.aiAnalyzeContent.innerHTML="Analisando com Gemini...",A.aiAnalyzeModal.classList.remove("hidden");try{const e=(await Mt(Je(se,lt("completed","==",!1)))).docs.map(s=>({id:s.id,...s.data()})),i=(await Mt(Je(mt))).docs.map(s=>({id:s.id,...s.data()}));if(e.length===0&&i.length===0){A.aiAnalyzeContent.innerHTML="Parabéns! Não há tarefas ou notas pendentes para analisar.";return}const r=await h1(Ne,e,i);A.aiAnalyzeContent.innerHTML=marked.parse(r)}catch(n){console.error("Error during AI Analysis:",n),A.aiAnalyzeContent.innerHTML="Ocorreu um erro ao gerar a análise. Por favor, tente novamente."}}A.aiAnalyzeBtn&&(A.aiAnalyzeBtn.onclick=J1);A.closeAiAnalyzeModal&&(A.closeAiAnalyzeModal.onclick=()=>A.aiAnalyzeModal.classList.add("hidden"));A.aiAnalyzeModal&&A.aiAnalyzeModal.addEventListener("click",n=>{n.target===A.aiAnalyzeModal&&A.aiAnalyzeModal.classList.add("hidden")});(function(){function e(r){r.getAttribute("data-listener-added")||(r.addEventListener("click",s=>{console.log("[Categoria] Clique no botão + de categoria (observer)"),s.preventDefault();const o=document.getElementById("category-popup");console.log("[Categoria] Popup encontrado (observer):",!!o),o&&o.classList.remove("hidden");const a=document.getElementById("category-popup-input");console.log("[Categoria] Input encontrado (observer):",!!a),a&&(a.value="",setTimeout(()=>{a.focus(),console.log("[Categoria] Input focado (observer)")},50))}),r.setAttribute("data-listener-added","true"),console.log("[Categoria] Evento de clique adicionado ao botão + de categoria (observer)"))}const t=document.getElementById("add-category-btn");t&&e(t),new MutationObserver(()=>{const r=document.getElementById("add-category-btn");r&&e(r)}).observe(document.body,{childList:!0,subtree:!0})})();function Y1(n){const e=document.getElementById("detail-category-select");!e||!sn||(e.innerHTML='<option value="Nenhuma">Sem Categoria</option>',Mt(sn).then(t=>{t.forEach(i=>{const r=i.data().name,s=document.createElement("option");s.value=r,s.textContent=r,e.appendChild(s)}),e.value=n||"Nenhuma"}),e.onchange=async()=>{if(!be||!se)return;const t=e.value==="Nenhuma"?null:e.value;await Se(he(se,be),{category:t}),pe("Categoria atualizada!")})}const _u=document.getElementById("advanced-task-filter");_u&&_u.addEventListener("change",()=>{wn=_u.value,kr()});function mg(n,e,t,i,r,s=!1){const o=document.getElementById("canvas-conn-comment-input");o&&o.remove();const a=document.createElement("input");a.type="text",a.value=r,a.id="canvas-conn-comment-input",a.placeholder="Comentário...",a.style.position="absolute",a.style.left=`${t-60}px`,a.style.top=`${i-18}px`,a.style.width="120px",a.style.zIndex="10000",a.style.background="#fff",a.style.border=s?"1px solid #3b82f6":"1px solid #6366f1",a.style.borderRadius="6px",a.style.padding="2px 8px",a.style.fontSize="13px",a.style.boxShadow=s?"0 2px 8px rgba(59,130,246,0.08)":"0 2px 8px rgba(99,102,241,0.08)",a.style.opacity="0.95",a.style.outline="none",a.style.pointerEvents="auto",a.addEventListener("keydown",async c=>{if(c.key==="Enter"){if(s&&De){const d=he(De,n),h=Xs.find(p=>p.id===n);if(h){let p=[];h.connections&&(p=h.connections.map(g=>typeof g=="string"&&g===e||typeof g=="object"&&g.targetId===e?{targetId:e,comment:a.value.trim()}:g)),await Se(d,{connections:p})}}else if(se){const d=he(se,n),h=Mi.find(p=>p.id===n);if(h){let p=[];h.connections&&(p=h.connections.map(g=>typeof g=="string"&&g===e||typeof g=="object"&&g.targetId===e?{targetId:e,comment:a.value.trim()}:g)),await Se(d,{connections:p})}}a.remove(),Ya()}else c.key==="Escape"&&a.remove()}),setTimeout(()=>a.focus(),30),A.taskCanvasContainer.appendChild(a)}function Ms(n,e,t){const i=n.getBoundingClientRect(),r=e-i.left,s=t-i.top,o=i.width,a=i.height,c=s,d=a-s,h=r,p=o-r,g=Math.min(c,d,h,p);return g===c?"top":g===d?"bottom":g===h?"left":"right"}H1();

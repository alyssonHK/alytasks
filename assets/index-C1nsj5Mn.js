import{signInWithEmailAndPassword as Cp,createUserWithEmailAndPassword as g_,onAuthStateChanged as y_,signOut as __}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";import{collection as et,Timestamp as Kn,addDoc as mo,updateDoc as Ie,doc as ce,query as $e,onSnapshot as Jn,increment as Un,deleteDoc as nr,writeBatch as ed,where as je,getDocs as It,arrayUnion as td,setDoc as v_}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();const T_=()=>{};var nd={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ap=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let r=n.charCodeAt(i);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},E_=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const r=n[t++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){const o=n[t++];e[i++]=String.fromCharCode((r&31)<<6|o&63)}else if(r>239&&r<365){const o=n[t++],s=n[t++],u=n[t++],c=((r&7)<<18|(o&63)<<12|(s&63)<<6|u&63)-65536;e[i++]=String.fromCharCode(55296+(c>>10)),e[i++]=String.fromCharCode(56320+(c&1023))}else{const o=n[t++],s=n[t++];e[i++]=String.fromCharCode((r&15)<<12|(o&63)<<6|s&63)}}return e.join("")},Sp={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<n.length;r+=3){const o=n[r],s=r+1<n.length,u=s?n[r+1]:0,c=r+2<n.length,f=c?n[r+2]:0,h=o>>2,m=(o&3)<<4|u>>4;let y=(u&15)<<2|f>>6,v=f&63;c||(v=64,s||(y=64)),i.push(t[h],t[m],t[y],t[v])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Ap(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):E_(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<n.length;){const o=t[n.charAt(r++)],u=r<n.length?t[n.charAt(r)]:0;++r;const f=r<n.length?t[n.charAt(r)]:64;++r;const m=r<n.length?t[n.charAt(r)]:64;if(++r,o==null||u==null||f==null||m==null)throw new I_;const y=o<<2|u>>4;if(i.push(y),f!==64){const v=u<<4&240|f>>2;if(i.push(v),m!==64){const x=f<<6&192|m;i.push(x)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class I_ extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const C_=function(n){const e=Ap(n);return Sp.encodeByteArray(e,!0)},gs=function(n){return C_(n).replace(/\./g,"")},wp=function(n){try{return Sp.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xp(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A_=()=>xp().__FIREBASE_DEFAULTS__,S_=()=>{if(typeof process>"u"||typeof nd>"u")return;const n=nd.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},w_=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&wp(n[1]);return e&&JSON.parse(e)},Qs=()=>{try{return T_()||A_()||S_()||w_()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Rp=n=>{var e,t;return(t=(e=Qs())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},x_=n=>{const e=Rp(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},Pp=()=>{var n;return(n=Qs())===null||n===void 0?void 0:n.config},kp=n=>{var e;return(e=Qs())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R_{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ir(n){return n.endsWith(".cloudworkstations.dev")}async function Mp(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P_(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",r=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:r,exp:r+3600,auth_time:r,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},n);return[gs(JSON.stringify(t)),gs(JSON.stringify(s)),""].join(".")}const $r={};function k_(){const n={prod:[],emulator:[]};for(const e of Object.keys($r))$r[e]?n.emulator.push(e):n.prod.push(e);return n}function M_(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let id=!1;function bp(n,e){if(typeof window>"u"||typeof document>"u"||!ir(window.location.host)||$r[n]===e||$r[n]||id)return;$r[n]=e;function t(y){return`__firebase__banner__${y}`}const i="__firebase__banner",o=k_().prod.length>0;function s(){const y=document.getElementById(i);y&&y.remove()}function u(y){y.style.display="flex",y.style.background="#7faaf0",y.style.position="fixed",y.style.bottom="5px",y.style.left="5px",y.style.padding=".5em",y.style.borderRadius="5px",y.style.alignItems="center"}function c(y,v){y.setAttribute("width","24"),y.setAttribute("id",v),y.setAttribute("height","24"),y.setAttribute("viewBox","0 0 24 24"),y.setAttribute("fill","none"),y.style.marginLeft="-6px"}function f(){const y=document.createElement("span");return y.style.cursor="pointer",y.style.marginLeft="16px",y.style.fontSize="24px",y.innerHTML=" &times;",y.onclick=()=>{id=!0,s()},y}function h(y,v){y.setAttribute("id",v),y.innerText="Learn more",y.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",y.setAttribute("target","__blank"),y.style.paddingLeft="5px",y.style.textDecoration="underline"}function m(){const y=M_(i),v=t("text"),x=document.getElementById(v)||document.createElement("span"),R=t("learnmore"),D=document.getElementById(R)||document.createElement("a"),U=t("preprendIcon"),V=document.getElementById(U)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(y.created){const N=y.element;u(N),h(D,R);const F=f();c(V,U),N.append(V,x,D,F),document.body.appendChild(N)}o?(x.innerText="Preview backend disconnected.",V.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(V.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,x.innerText="Preview backend running in this workspace."),x.setAttribute("id",v)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",m):m()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function be(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function b_(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(be())}function Dp(){var n;const e=(n=Qs())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function D_(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function N_(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function V_(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function L_(){const n=be();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Np(){return!Dp()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Vp(){return!Dp()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Lp(){try{return typeof indexedDB=="object"}catch{return!1}}function F_(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var o;e(((o=r.error)===null||o===void 0?void 0:o.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U_="FirebaseError";class Yt extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=U_,Object.setPrototypeOf(this,Yt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,go.prototype.create)}}class go{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},r=`${this.service}/${e}`,o=this.errors[e],s=o?B_(o,i):"Error",u=`${this.serviceName}: ${s} (${r}).`;return new Yt(r,u,i)}}function B_(n,e){return n.replace(O_,(t,i)=>{const r=e[i];return r!=null?String(r):`<${i}?>`})}const O_=/\{\$([^}]+)}/g;function $_(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Wn(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const r of t){if(!i.includes(r))return!1;const o=n[r],s=e[r];if(rd(o)&&rd(s)){if(!Wn(o,s))return!1}else if(o!==s)return!1}for(const r of i)if(!t.includes(r))return!1;return!0}function rd(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yo(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function q_(n,e){const t=new G_(n,e);return t.subscribe.bind(t)}class G_{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let r;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");H_(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:i},r.next===void 0&&(r.next=Wa),r.error===void 0&&(r.error=Wa),r.complete===void 0&&(r.complete=Wa);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function H_(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Wa(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rr(n){return n&&n._delegate?n._delegate:n}class Yn{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mn="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z_{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new R_;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&i.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const i=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(o){if(r)return null;throw o}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(J_(e))try{this.getOrInitializeService({instanceIdentifier:Mn})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:r});i.resolve(o)}catch{}}}}clearInstance(e=Mn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Mn){return this.instances.has(e)}getOptions(e=Mn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[o,s]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);i===u&&s.resolve(r)}return r}onInit(e,t){var i;const r=this.normalizeInstanceIdentifier(t),o=(i=this.onInitCallbacks.get(r))!==null&&i!==void 0?i:new Set;o.add(e),this.onInitCallbacks.set(r,o);const s=this.instances.get(r);return s&&e(s,r),()=>{o.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const r of i)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:K_(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=Mn){return this.component?this.component.multipleInstances?e:Mn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function K_(n){return n===Mn?void 0:n}function J_(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W_{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new z_(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var oe;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(oe||(oe={}));const Y_={debug:oe.DEBUG,verbose:oe.VERBOSE,info:oe.INFO,warn:oe.WARN,error:oe.ERROR,silent:oe.SILENT},X_=oe.INFO,Q_={[oe.DEBUG]:"log",[oe.VERBOSE]:"log",[oe.INFO]:"info",[oe.WARN]:"warn",[oe.ERROR]:"error"},Z_=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),r=Q_[e];if(r)console[r](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class cu{constructor(e){this.name=e,this._logLevel=X_,this._logHandler=Z_,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in oe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Y_[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,oe.DEBUG,...e),this._logHandler(this,oe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,oe.VERBOSE,...e),this._logHandler(this,oe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,oe.INFO,...e),this._logHandler(this,oe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,oe.WARN,...e),this._logHandler(this,oe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,oe.ERROR,...e),this._logHandler(this,oe.ERROR,...e)}}const j_=(n,e)=>e.some(t=>n instanceof t);let od,sd;function ev(){return od||(od=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function tv(){return sd||(sd=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Fp=new WeakMap,fl=new WeakMap,Up=new WeakMap,Ya=new WeakMap,du=new WeakMap;function nv(n){const e=new Promise((t,i)=>{const r=()=>{n.removeEventListener("success",o),n.removeEventListener("error",s)},o=()=>{t(mn(n.result)),r()},s=()=>{i(n.error),r()};n.addEventListener("success",o),n.addEventListener("error",s)});return e.then(t=>{t instanceof IDBCursor&&Fp.set(t,n)}).catch(()=>{}),du.set(e,n),e}function iv(n){if(fl.has(n))return;const e=new Promise((t,i)=>{const r=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",s),n.removeEventListener("abort",s)},o=()=>{t(),r()},s=()=>{i(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",o),n.addEventListener("error",s),n.addEventListener("abort",s)});fl.set(n,e)}let hl={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return fl.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Up.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return mn(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function rv(n){hl=n(hl)}function ov(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const i=n.call(Xa(this),e,...t);return Up.set(i,e.sort?e.sort():[e]),mn(i)}:tv().includes(n)?function(...e){return n.apply(Xa(this),e),mn(Fp.get(this))}:function(...e){return mn(n.apply(Xa(this),e))}}function sv(n){return typeof n=="function"?ov(n):(n instanceof IDBTransaction&&iv(n),j_(n,ev())?new Proxy(n,hl):n)}function mn(n){if(n instanceof IDBRequest)return nv(n);if(Ya.has(n))return Ya.get(n);const e=sv(n);return e!==n&&(Ya.set(n,e),du.set(e,n)),e}const Xa=n=>du.get(n);function av(n,e,{blocked:t,upgrade:i,blocking:r,terminated:o}={}){const s=indexedDB.open(n,e),u=mn(s);return i&&s.addEventListener("upgradeneeded",c=>{i(mn(s.result),c.oldVersion,c.newVersion,mn(s.transaction),c)}),t&&s.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),u.then(c=>{o&&c.addEventListener("close",()=>o()),r&&c.addEventListener("versionchange",f=>r(f.oldVersion,f.newVersion,f))}).catch(()=>{}),u}const lv=["get","getKey","getAll","getAllKeys","count"],uv=["put","add","delete","clear"],Qa=new Map;function ad(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Qa.get(e))return Qa.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,r=uv.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(r||lv.includes(t)))return;const o=async function(s,...u){const c=this.transaction(s,r?"readwrite":"readonly");let f=c.store;return i&&(f=f.index(u.shift())),(await Promise.all([f[t](...u),r&&c.done]))[0]};return Qa.set(e,o),o}rv(n=>({...n,get:(e,t,i)=>ad(e,t)||n.get(e,t,i),has:(e,t)=>!!ad(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cv{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(dv(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function dv(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const pl="@firebase/app",ld="0.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zt=new cu("@firebase/app"),fv="@firebase/app-compat",hv="@firebase/analytics-compat",pv="@firebase/analytics",mv="@firebase/app-check-compat",gv="@firebase/app-check",yv="@firebase/auth",_v="@firebase/auth-compat",vv="@firebase/database",Tv="@firebase/data-connect",Ev="@firebase/database-compat",Iv="@firebase/functions",Cv="@firebase/functions-compat",Av="@firebase/installations",Sv="@firebase/installations-compat",wv="@firebase/messaging",xv="@firebase/messaging-compat",Rv="@firebase/performance",Pv="@firebase/performance-compat",kv="@firebase/remote-config",Mv="@firebase/remote-config-compat",bv="@firebase/storage",Dv="@firebase/storage-compat",Nv="@firebase/firestore",Vv="@firebase/ai",Lv="@firebase/firestore-compat",Fv="firebase",Uv="11.9.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ml="[DEFAULT]",Bv={[pl]:"fire-core",[fv]:"fire-core-compat",[pv]:"fire-analytics",[hv]:"fire-analytics-compat",[gv]:"fire-app-check",[mv]:"fire-app-check-compat",[yv]:"fire-auth",[_v]:"fire-auth-compat",[vv]:"fire-rtdb",[Tv]:"fire-data-connect",[Ev]:"fire-rtdb-compat",[Iv]:"fire-fn",[Cv]:"fire-fn-compat",[Av]:"fire-iid",[Sv]:"fire-iid-compat",[wv]:"fire-fcm",[xv]:"fire-fcm-compat",[Rv]:"fire-perf",[Pv]:"fire-perf-compat",[kv]:"fire-rc",[Mv]:"fire-rc-compat",[bv]:"fire-gcs",[Dv]:"fire-gcs-compat",[Nv]:"fire-fst",[Lv]:"fire-fst-compat",[Vv]:"fire-vertex","fire-js":"fire-js",[Fv]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ys=new Map,Ov=new Map,gl=new Map;function ud(n,e){try{n.container.addComponent(e)}catch(t){zt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Ni(n){const e=n.name;if(gl.has(e))return zt.debug(`There were multiple attempts to register component ${e}.`),!1;gl.set(e,n);for(const t of ys.values())ud(t,n);for(const t of Ov.values())ud(t,n);return!0}function fu(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function St(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $v={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},gn=new go("app","Firebase",$v);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qv{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Yn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw gn.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const or=Uv;function Bp(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const i=Object.assign({name:ml,automaticDataCollectionEnabled:!0},e),r=i.name;if(typeof r!="string"||!r)throw gn.create("bad-app-name",{appName:String(r)});if(t||(t=Pp()),!t)throw gn.create("no-options");const o=ys.get(r);if(o){if(Wn(t,o.options)&&Wn(i,o.config))return o;throw gn.create("duplicate-app",{appName:r})}const s=new W_(r);for(const c of gl.values())s.addComponent(c);const u=new qv(t,i,s);return ys.set(r,u),u}function Op(n=ml){const e=ys.get(n);if(!e&&n===ml&&Pp())return Bp();if(!e)throw gn.create("no-app",{appName:n});return e}function yn(n,e,t){var i;let r=(i=Bv[n])!==null&&i!==void 0?i:n;t&&(r+=`-${t}`);const o=r.match(/\s|\//),s=e.match(/\s|\//);if(o||s){const u=[`Unable to register library "${r}" with version "${e}":`];o&&u.push(`library name "${r}" contains illegal characters (whitespace or "/")`),o&&s&&u.push("and"),s&&u.push(`version name "${e}" contains illegal characters (whitespace or "/")`),zt.warn(u.join(" "));return}Ni(new Yn(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gv="firebase-heartbeat-database",Hv=1,eo="firebase-heartbeat-store";let Za=null;function $p(){return Za||(Za=av(Gv,Hv,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(eo)}catch(t){console.warn(t)}}}}).catch(n=>{throw gn.create("idb-open",{originalErrorMessage:n.message})})),Za}async function zv(n){try{const t=(await $p()).transaction(eo),i=await t.objectStore(eo).get(qp(n));return await t.done,i}catch(e){if(e instanceof Yt)zt.warn(e.message);else{const t=gn.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});zt.warn(t.message)}}}async function cd(n,e){try{const i=(await $p()).transaction(eo,"readwrite");await i.objectStore(eo).put(e,qp(n)),await i.done}catch(t){if(t instanceof Yt)zt.warn(t.message);else{const i=gn.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});zt.warn(i.message)}}}function qp(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kv=1024,Jv=30;class Wv{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Xv(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var e,t;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=dd();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(s=>s.date===o))return;if(this._heartbeatsCache.heartbeats.push({date:o,agent:r}),this._heartbeatsCache.heartbeats.length>Jv){const s=Qv(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(i){zt.warn(i)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=dd(),{heartbeatsToSend:i,unsentEntries:r}=Yv(this._heartbeatsCache.heartbeats),o=gs(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(t){return zt.warn(t),""}}}function dd(){return new Date().toISOString().substring(0,10)}function Yv(n,e=Kv){const t=[];let i=n.slice();for(const r of n){const o=t.find(s=>s.agent===r.agent);if(o){if(o.dates.push(r.date),fd(t)>e){o.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),fd(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class Xv{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Lp()?F_().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await zv(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return cd(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return cd(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function fd(n){return gs(JSON.stringify({version:2,heartbeats:n})).length}function Qv(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let i=1;i<n.length;i++)n[i].date<t&&(t=n[i].date,e=i);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zv(n){Ni(new Yn("platform-logger",e=>new cv(e),"PRIVATE")),Ni(new Yn("heartbeat",e=>new Wv(e),"PRIVATE")),yn(pl,ld,n),yn(pl,ld,"esm2017"),yn("fire-js","")}Zv("");var jv="firebase",eT="11.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */yn(jv,eT,"app");function hu(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t}function Gp(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const tT=Gp,Hp=new go("auth","Firebase",Gp());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _s=new cu("@firebase/auth");function nT(n,...e){_s.logLevel<=oe.WARN&&_s.warn(`Auth (${or}): ${n}`,...e)}function es(n,...e){_s.logLevel<=oe.ERROR&&_s.error(`Auth (${or}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kt(n,...e){throw pu(n,...e)}function kt(n,...e){return pu(n,...e)}function zp(n,e,t){const i=Object.assign(Object.assign({},tT()),{[e]:t});return new go("auth","Firebase",i).create(e,{appName:n.name})}function $n(n){return zp(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function pu(n,...e){if(typeof n!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return Hp.create(n,...e)}function j(n,e,...t){if(!n)throw pu(e,...t)}function Ot(n){const e="INTERNAL ASSERTION FAILED: "+n;throw es(e),new Error(e)}function Jt(n,e){n||Ot(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yl(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function iT(){return hd()==="http:"||hd()==="https:"}function hd(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rT(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(iT()||N_()||"connection"in navigator)?navigator.onLine:!0}function oT(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _o{constructor(e,t){this.shortDelay=e,this.longDelay=t,Jt(t>e,"Short delay should be less than long delay!"),this.isMobile=b_()||V_()}get(){return rT()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mu(n,e){Jt(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kp{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ot("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ot("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ot("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sT={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aT=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],lT=new _o(3e4,6e4);function gu(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function sr(n,e,t,i,r={}){return Jp(n,r,async()=>{let o={},s={};i&&(e==="GET"?s=i:o={body:JSON.stringify(i)});const u=yo(Object.assign({key:n.config.apiKey},s)).slice(1),c=await n._getAdditionalHeaders();c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode);const f=Object.assign({method:e,headers:c},o);return D_()||(f.referrerPolicy="no-referrer"),n.emulatorConfig&&ir(n.emulatorConfig.host)&&(f.credentials="include"),Kp.fetch()(await Wp(n,n.config.apiHost,t,u),f)})}async function Jp(n,e,t){n._canInitEmulator=!1;const i=Object.assign(Object.assign({},sT),e);try{const r=new cT(n),o=await Promise.race([t(),r.promise]);r.clearNetworkTimeout();const s=await o.json();if("needConfirmation"in s)throw Ho(n,"account-exists-with-different-credential",s);if(o.ok&&!("errorMessage"in s))return s;{const u=o.ok?s.errorMessage:s.error.message,[c,f]=u.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ho(n,"credential-already-in-use",s);if(c==="EMAIL_EXISTS")throw Ho(n,"email-already-in-use",s);if(c==="USER_DISABLED")throw Ho(n,"user-disabled",s);const h=i[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(f)throw zp(n,h,f);Kt(n,h)}}catch(r){if(r instanceof Yt)throw r;Kt(n,"network-request-failed",{message:String(r)})}}async function uT(n,e,t,i,r={}){const o=await sr(n,e,t,i,r);return"mfaPendingCredential"in o&&Kt(n,"multi-factor-auth-required",{_serverResponse:o}),o}async function Wp(n,e,t,i){const r=`${e}${t}?${i}`,o=n,s=o.config.emulator?mu(n.config,r):`${n.config.apiScheme}://${r}`;return aT.includes(t)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(s).toString():s}class cT{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(kt(this.auth,"network-request-failed")),lT.get())})}}function Ho(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const r=kt(n,e,i);return r.customData._tokenResponse=t,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dT(n,e){return sr(n,"POST","/v1/accounts:delete",e)}async function vs(n,e){return sr(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qr(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function fT(n,e=!1){const t=rr(n),i=await t.getIdToken(e),r=yu(i);j(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const o=typeof r.firebase=="object"?r.firebase:void 0,s=o==null?void 0:o.sign_in_provider;return{claims:r,token:i,authTime:qr(ja(r.auth_time)),issuedAtTime:qr(ja(r.iat)),expirationTime:qr(ja(r.exp)),signInProvider:s||null,signInSecondFactor:(o==null?void 0:o.sign_in_second_factor)||null}}function ja(n){return Number(n)*1e3}function yu(n){const[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return es("JWT malformed, contained fewer than 3 sections"),null;try{const r=wp(t);return r?JSON.parse(r):(es("Failed to decode base64 JWT payload"),null)}catch(r){return es("Caught error parsing JWT payload as JSON",r==null?void 0:r.toString()),null}}function pd(n){const e=yu(n);return j(e,"internal-error"),j(typeof e.exp<"u","internal-error"),j(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function to(n,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof Yt&&hT(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function hT({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pT{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const r=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _l{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=qr(this.lastLoginAt),this.creationTime=qr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ts(n){var e;const t=n.auth,i=await n.getIdToken(),r=await to(n,vs(t,{idToken:i}));j(r==null?void 0:r.users.length,t,"internal-error");const o=r.users[0];n._notifyReloadListener(o);const s=!((e=o.providerUserInfo)===null||e===void 0)&&e.length?Yp(o.providerUserInfo):[],u=gT(n.providerData,s),c=n.isAnonymous,f=!(n.email&&o.passwordHash)&&!(u!=null&&u.length),h=c?f:!1,m={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:u,metadata:new _l(o.createdAt,o.lastLoginAt),isAnonymous:h};Object.assign(n,m)}async function mT(n){const e=rr(n);await Ts(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function gT(n,e){return[...n.filter(i=>!e.some(r=>r.providerId===i.providerId)),...e]}function Yp(n){return n.map(e=>{var{providerId:t}=e,i=hu(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yT(n,e){const t=await Jp(n,{},async()=>{const i=yo({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:o}=n.config,s=await Wp(n,r,"/v1/token",`key=${o}`),u=await n._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:u,body:i};return n.emulatorConfig&&ir(n.emulatorConfig.host)&&(c.credentials="include"),Kp.fetch()(s,c)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function _T(n,e){return sr(n,"POST","/v2/accounts:revokeToken",gu(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pi{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){j(e.idToken,"internal-error"),j(typeof e.idToken<"u","internal-error"),j(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):pd(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){j(e.length!==0,"internal-error");const t=pd(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(j(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:r,expiresIn:o}=await yT(e,t);this.updateTokensAndExpiration(i,r,Number(o))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:r,expirationTime:o}=t,s=new Pi;return i&&(j(typeof i=="string","internal-error",{appName:e}),s.refreshToken=i),r&&(j(typeof r=="string","internal-error",{appName:e}),s.accessToken=r),o&&(j(typeof o=="number","internal-error",{appName:e}),s.expirationTime=o),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Pi,this.toJSON())}_performRefresh(){return Ot("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nn(n,e){j(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class vt{constructor(e){var{uid:t,auth:i,stsTokenManager:r}=e,o=hu(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new pT(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=o.displayName||null,this.email=o.email||null,this.emailVerified=o.emailVerified||!1,this.phoneNumber=o.phoneNumber||null,this.photoURL=o.photoURL||null,this.isAnonymous=o.isAnonymous||!1,this.tenantId=o.tenantId||null,this.providerData=o.providerData?[...o.providerData]:[],this.metadata=new _l(o.createdAt||void 0,o.lastLoginAt||void 0)}async getIdToken(e){const t=await to(this,this.stsTokenManager.getToken(this.auth,e));return j(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return fT(this,e)}reload(){return mT(this)}_assign(e){this!==e&&(j(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new vt(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){j(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await Ts(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(St(this.auth.app))return Promise.reject($n(this.auth));const e=await this.getIdToken();return await to(this,dT(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,r,o,s,u,c,f,h;const m=(i=t.displayName)!==null&&i!==void 0?i:void 0,y=(r=t.email)!==null&&r!==void 0?r:void 0,v=(o=t.phoneNumber)!==null&&o!==void 0?o:void 0,x=(s=t.photoURL)!==null&&s!==void 0?s:void 0,R=(u=t.tenantId)!==null&&u!==void 0?u:void 0,D=(c=t._redirectEventId)!==null&&c!==void 0?c:void 0,U=(f=t.createdAt)!==null&&f!==void 0?f:void 0,V=(h=t.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:N,emailVerified:F,isAnonymous:L,providerData:q,stsTokenManager:I}=t;j(N&&I,e,"internal-error");const T=Pi.fromJSON(this.name,I);j(typeof N=="string",e,"internal-error"),nn(m,e.name),nn(y,e.name),j(typeof F=="boolean",e,"internal-error"),j(typeof L=="boolean",e,"internal-error"),nn(v,e.name),nn(x,e.name),nn(R,e.name),nn(D,e.name),nn(U,e.name),nn(V,e.name);const E=new vt({uid:N,auth:e,email:y,emailVerified:F,displayName:m,isAnonymous:L,photoURL:x,phoneNumber:v,tenantId:R,stsTokenManager:T,createdAt:U,lastLoginAt:V});return q&&Array.isArray(q)&&(E.providerData=q.map(w=>Object.assign({},w))),D&&(E._redirectEventId=D),E}static async _fromIdTokenResponse(e,t,i=!1){const r=new Pi;r.updateFromServerResponse(t);const o=new vt({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:i});return await Ts(o),o}static async _fromGetAccountInfoResponse(e,t,i){const r=t.users[0];j(r.localId!==void 0,"internal-error");const o=r.providerUserInfo!==void 0?Yp(r.providerUserInfo):[],s=!(r.email&&r.passwordHash)&&!(o!=null&&o.length),u=new Pi;u.updateFromIdToken(i);const c=new vt({uid:r.localId,auth:e,stsTokenManager:u,isAnonymous:s}),f={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new _l(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(o!=null&&o.length)};return Object.assign(c,f),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const md=new Map;function $t(n){Jt(n instanceof Function,"Expected a class definition");let e=md.get(n);return e?(Jt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,md.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xp{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Xp.type="NONE";const gd=Xp;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ts(n,e,t){return`firebase:${n}:${e}:${t}`}class ki{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:r,name:o}=this.auth;this.fullUserKey=ts(this.userKey,r.apiKey,o),this.fullPersistenceKey=ts("persistence",r.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await vs(this.auth,{idToken:e}).catch(()=>{});return t?vt._fromGetAccountInfoResponse(this.auth,t,e):null}return vt._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new ki($t(gd),e,i);const r=(await Promise.all(t.map(async f=>{if(await f._isAvailable())return f}))).filter(f=>f);let o=r[0]||$t(gd);const s=ts(i,e.config.apiKey,e.name);let u=null;for(const f of t)try{const h=await f._get(s);if(h){let m;if(typeof h=="string"){const y=await vs(e,{idToken:h}).catch(()=>{});if(!y)break;m=await vt._fromGetAccountInfoResponse(e,y,h)}else m=vt._fromJSON(e,h);f!==o&&(u=m),o=f;break}}catch{}const c=r.filter(f=>f._shouldAllowMigration);return!o._shouldAllowMigration||!c.length?new ki(o,e,i):(o=c[0],u&&await o._set(s,u.toJSON()),await Promise.all(t.map(async f=>{if(f!==o)try{await f._remove(s)}catch{}})),new ki(o,e,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yd(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(em(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Qp(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(nm(e))return"Blackberry";if(im(e))return"Webos";if(Zp(e))return"Safari";if((e.includes("chrome/")||jp(e))&&!e.includes("edge/"))return"Chrome";if(tm(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if((i==null?void 0:i.length)===2)return i[1]}return"Other"}function Qp(n=be()){return/firefox\//i.test(n)}function Zp(n=be()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function jp(n=be()){return/crios\//i.test(n)}function em(n=be()){return/iemobile/i.test(n)}function tm(n=be()){return/android/i.test(n)}function nm(n=be()){return/blackberry/i.test(n)}function im(n=be()){return/webos/i.test(n)}function _u(n=be()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function vT(n=be()){var e;return _u(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function TT(){return L_()&&document.documentMode===10}function rm(n=be()){return _u(n)||tm(n)||im(n)||nm(n)||/windows phone/i.test(n)||em(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function om(n,e=[]){let t;switch(n){case"Browser":t=yd(be());break;case"Worker":t=`${yd(be())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${or}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ET{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=o=>new Promise((s,u)=>{try{const c=e(o);s(c)}catch(c){u(c)}});i.onAbort=t,this.queue.push(i);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const i of this.queue)await i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(const r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i==null?void 0:i.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IT(n,e={}){return sr(n,"GET","/v2/passwordPolicy",gu(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CT=6;class AT{constructor(e){var t,i,r,o;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=s.minPasswordLength)!==null&&t!==void 0?t:CT,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),s.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),s.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),s.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),s.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(r=(i=e.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&r!==void 0?r:"",this.forceUpgradeOnSignin=(o=e.forceUpgradeOnSignin)!==null&&o!==void 0?o:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,i,r,o,s,u;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(t=c.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),c.isValid&&(c.isValid=(i=c.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(r=c.containsLowercaseLetter)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(o=c.containsUppercaseLetter)!==null&&o!==void 0?o:!0),c.isValid&&(c.isValid=(s=c.containsNumericCharacter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(u=c.containsNonAlphanumericCharacter)!==null&&u!==void 0?u:!0),c}validatePasswordLengthOptions(e,t){const i=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let r=0;r<e.length;r++)i=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,r,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ST{constructor(e,t,i,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new _d(this),this.idTokenSubscription=new _d(this),this.beforeStateQueue=new ET(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Hp,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=$t(t)),this._initializationPromise=this.queue(async()=>{var i,r,o;if(!this._deleted&&(this.persistenceManager=await ki.create(this,e),(i=this._resolvePersistenceManagerAvailable)===null||i===void 0||i.call(this),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((o=this.currentUser)===null||o===void 0?void 0:o.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await vs(this,{idToken:e}),i=await vt._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(St(this.app)){const s=this.app.settings.authIdToken;return s?new Promise(u=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(s).then(u,u))}):this.directlySetCurrentUser(null)}const i=await this.assertedPersistence.getCurrentUser();let r=i,o=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const s=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,u=r==null?void 0:r._redirectEventId,c=await this.tryRedirectSignIn(e);(!s||s===u)&&(c!=null&&c.user)&&(r=c.user,o=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(o)try{await this.beforeStateQueue.runMiddleware(r)}catch(s){r=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return j(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Ts(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=oT()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(St(this.app))return Promise.reject($n(this));const t=e?rr(e):null;return t&&j(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&j(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return St(this.app)?Promise.reject($n(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return St(this.app)?Promise.reject($n(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence($t(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await IT(this),t=new AT(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new go("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const i=this.onAuthStateChanged(()=>{i(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),await _T(this,i)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&$t(e)||this._popupRedirectResolver;j(t,this,"argument-error"),this.redirectPersistenceManager=await ki.create(this,[$t(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,r){if(this._deleted)return()=>{};const o=typeof t=="function"?t:t.next.bind(t);let s=!1;const u=this._isInitialized?Promise.resolve():this._initializationPromise;if(j(u,this,"internal-error"),u.then(()=>{s||o(this.currentUser)}),typeof t=="function"){const c=e.addObserver(t,i,r);return()=>{s=!0,c()}}else{const c=e.addObserver(t);return()=>{s=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return j(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=om(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const i=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());i&&(t["X-Firebase-Client"]=i);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;if(St(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&nT(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function vu(n){return rr(n)}class _d{constructor(e){this.auth=e,this.observer=null,this.addObserver=q_(t=>this.observer=t)}get next(){return j(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tu={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function wT(n){Tu=n}function xT(n){return Tu.loadJS(n)}function RT(){return Tu.gapiScript}function PT(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kT(n,e){const t=fu(n,"auth");if(t.isInitialized()){const r=t.getImmediate(),o=t.getOptions();if(Wn(o,e??{}))return r;Kt(r,"already-initialized")}return t.initialize({options:e})}function MT(n,e){const t=(e==null?void 0:e.persistence)||[],i=(Array.isArray(t)?t:[t]).map($t);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e==null?void 0:e.popupRedirectResolver)}function bT(n,e,t){const i=vu(n);j(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const r=!1,o=sm(e),{host:s,port:u}=DT(e),c=u===null?"":`:${u}`,f={url:`${o}//${s}${c}/`},h=Object.freeze({host:s,port:u,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!i._canInitEmulator){j(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),j(Wn(f,i.config.emulator)&&Wn(h,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=f,i.emulatorConfig=h,i.settings.appVerificationDisabledForTesting=!0,ir(s)?(Mp(`${o}//${s}${c}`),bp("Auth",!0)):NT()}function sm(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function DT(n){const e=sm(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const o=r[1];return{host:o,port:vd(i.substr(o.length+1))}}else{const[o,s]=i.split(":");return{host:o,port:vd(s)}}}function vd(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function NT(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class am{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ot("not implemented")}_getIdTokenResponse(e){return Ot("not implemented")}_linkToIdToken(e,t){return Ot("not implemented")}_getReauthenticationResolver(e){return Ot("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mi(n,e){return uT(n,"POST","/v1/accounts:signInWithIdp",gu(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VT="http://localhost";class Xn extends am{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Xn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Kt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:r}=t,o=hu(t,["providerId","signInMethod"]);if(!i||!r)return null;const s=new Xn(i,r);return s.idToken=o.idToken||void 0,s.accessToken=o.accessToken||void 0,s.secret=o.secret,s.nonce=o.nonce,s.pendingToken=o.pendingToken||null,s}_getIdTokenResponse(e){const t=this.buildRequest();return Mi(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,Mi(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Mi(e,t)}buildRequest(){const e={requestUri:VT,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=yo(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lm{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vo extends lm{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class un extends vo{constructor(){super("facebook.com")}static credential(e){return Xn._fromParams({providerId:un.PROVIDER_ID,signInMethod:un.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return un.credentialFromTaggedObject(e)}static credentialFromError(e){return un.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return un.credential(e.oauthAccessToken)}catch{return null}}}un.FACEBOOK_SIGN_IN_METHOD="facebook.com";un.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cn extends vo{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Xn._fromParams({providerId:cn.PROVIDER_ID,signInMethod:cn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return cn.credentialFromTaggedObject(e)}static credentialFromError(e){return cn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return cn.credential(t,i)}catch{return null}}}cn.GOOGLE_SIGN_IN_METHOD="google.com";cn.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn extends vo{constructor(){super("github.com")}static credential(e){return Xn._fromParams({providerId:dn.PROVIDER_ID,signInMethod:dn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return dn.credentialFromTaggedObject(e)}static credentialFromError(e){return dn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return dn.credential(e.oauthAccessToken)}catch{return null}}}dn.GITHUB_SIGN_IN_METHOD="github.com";dn.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn extends vo{constructor(){super("twitter.com")}static credential(e,t){return Xn._fromParams({providerId:fn.PROVIDER_ID,signInMethod:fn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return fn.credentialFromTaggedObject(e)}static credentialFromError(e){return fn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return fn.credential(t,i)}catch{return null}}}fn.TWITTER_SIGN_IN_METHOD="twitter.com";fn.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vi{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,r=!1){const o=await vt._fromIdTokenResponse(e,i,r),s=Td(i);return new Vi({user:o,providerId:s,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const r=Td(i);return new Vi({user:e,providerId:r,_tokenResponse:i,operationType:t})}}function Td(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Es extends Yt{constructor(e,t,i,r){var o;super(t.code,t.message),this.operationType=i,this.user=r,Object.setPrototypeOf(this,Es.prototype),this.customData={appName:e.name,tenantId:(o=e.tenantId)!==null&&o!==void 0?o:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,r){return new Es(e,t,i,r)}}function um(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?Es._fromErrorAndOperation(n,o,e,i):o})}async function LT(n,e,t=!1){const i=await to(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Vi._forOperation(n,"link",i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FT(n,e,t=!1){const{auth:i}=n;if(St(i.app))return Promise.reject($n(i));const r="reauthenticate";try{const o=await to(n,um(i,r,e,n),t);j(o.idToken,i,"internal-error");const s=yu(o.idToken);j(s,i,"internal-error");const{sub:u}=s;return j(n.uid===u,i,"user-mismatch"),Vi._forOperation(n,r,o)}catch(o){throw(o==null?void 0:o.code)==="auth/user-not-found"&&Kt(i,"user-mismatch"),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UT(n,e,t=!1){if(St(n.app))return Promise.reject($n(n));const i="signIn",r=await um(n,i,e),o=await Vi._fromIdTokenResponse(n,i,r);return t||await n._updateCurrentUser(o.user),o}function BT(n,e,t,i){return rr(n).onIdTokenChanged(e,t,i)}function OT(n,e,t){return rr(n).beforeAuthStateChanged(e,t)}const Is="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cm{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Is,"1"),this.storage.removeItem(Is),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $T=1e3,qT=10;class dm extends cm{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=rm(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),r=this.localCache[t];i!==r&&e(t,r,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((s,u,c)=>{this.notifyListeners(s,c)});return}const i=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const s=this.storage.getItem(i);!t&&this.localCache[i]===s||this.notifyListeners(i,s)},o=this.storage.getItem(i);TT()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,qT):r()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const r of Array.from(i))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},$T)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}dm.type="LOCAL";const GT=dm;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fm extends cm{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}fm.type="SESSION";const hm=fm;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HT(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zs{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const i=new Zs(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:r,data:o}=t.data,s=this.handlersMap[r];if(!(s!=null&&s.size))return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:r});const u=Array.from(s).map(async f=>f(t.origin,o)),c=await HT(u);t.ports[0].postMessage({status:"done",eventId:i,eventType:r,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Zs.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eu(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zT{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let o,s;return new Promise((u,c)=>{const f=Eu("",20);r.port1.start();const h=setTimeout(()=>{c(new Error("unsupported_event"))},i);s={messageChannel:r,onMessage(m){const y=m;if(y.data.eventId===f)switch(y.data.status){case"ack":clearTimeout(h),o=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),u(y.data.response);break;default:clearTimeout(h),clearTimeout(o),c(new Error("invalid_response"));break}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:f,data:t},[r.port2])}).finally(()=>{s&&this.removeMessageHandler(s)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mt(){return window}function KT(n){Mt().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pm(){return typeof Mt().WorkerGlobalScope<"u"&&typeof Mt().importScripts=="function"}async function JT(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function WT(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function YT(){return pm()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mm="firebaseLocalStorageDb",XT=1,Cs="firebaseLocalStorage",gm="fbase_key";class To{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function js(n,e){return n.transaction([Cs],e?"readwrite":"readonly").objectStore(Cs)}function QT(){const n=indexedDB.deleteDatabase(mm);return new To(n).toPromise()}function vl(){const n=indexedDB.open(mm,XT);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(Cs,{keyPath:gm})}catch(r){t(r)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains(Cs)?e(i):(i.close(),await QT(),e(await vl()))})})}async function Ed(n,e,t){const i=js(n,!0).put({[gm]:e,value:t});return new To(i).toPromise()}async function ZT(n,e){const t=js(n,!1).get(e),i=await new To(t).toPromise();return i===void 0?null:i.value}function Id(n,e){const t=js(n,!0).delete(e);return new To(t).toPromise()}const jT=800,eE=3;class ym{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await vl(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>eE)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return pm()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Zs._getInstance(YT()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await JT(),!this.activeServiceWorker)return;this.sender=new zT(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);i&&!((e=i[0])===null||e===void 0)&&e.fulfilled&&!((t=i[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||WT()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await vl();return await Ed(e,Is,"1"),await Id(e,Is),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>Ed(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>ZT(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Id(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const o=js(r,!1).getAll();return new To(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;if(e.length!==0)for(const{fbase_key:r,value:o}of e)i.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(o)&&(this.notifyListeners(r,o),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!i.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const r of Array.from(i))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),jT)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}ym.type="LOCAL";const tE=ym;new _o(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nE(n,e){return e?$t(e):(j(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iu extends am{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Mi(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Mi(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Mi(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function iE(n){return UT(n.auth,new Iu(n),n.bypassAuthState)}function rE(n){const{auth:e,user:t}=n;return j(t,e,"internal-error"),FT(t,new Iu(n),n.bypassAuthState)}async function oE(n){const{auth:e,user:t}=n;return j(t,e,"internal-error"),LT(t,new Iu(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _m{constructor(e,t,i,r,o=!1){this.auth=e,this.resolver=i,this.user=r,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:r,tenantId:o,error:s,type:u}=e;if(s){this.reject(s);return}const c={auth:this.auth,requestUri:t,sessionId:i,tenantId:o||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(u)(c))}catch(f){this.reject(f)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return iE;case"linkViaPopup":case"linkViaRedirect":return oE;case"reauthViaPopup":case"reauthViaRedirect":return rE;default:Kt(this.auth,"internal-error")}}resolve(e){Jt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Jt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sE=new _o(2e3,1e4);class Si extends _m{constructor(e,t,i,r,o){super(e,t,r,o),this.provider=i,this.authWindow=null,this.pollId=null,Si.currentPopupAction&&Si.currentPopupAction.cancel(),Si.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return j(e,this.auth,"internal-error"),e}async onExecution(){Jt(this.filter.length===1,"Popup operations only handle one event");const e=Eu();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(kt(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(kt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Si.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;if(!((i=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(kt(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,sE.get())};e()}}Si.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aE="pendingRedirect",ns=new Map;class lE extends _m{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}async execute(){let e=ns.get(this.auth._key());if(!e){try{const i=await uE(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}ns.set(this.auth._key(),e)}return this.bypassAuthState||ns.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function uE(n,e){const t=fE(e),i=dE(n);if(!await i._isAvailable())return!1;const r=await i._get(t)==="true";return await i._remove(t),r}function cE(n,e){ns.set(n._key(),e)}function dE(n){return $t(n._redirectPersistence)}function fE(n){return ts(aE,n.config.apiKey,n.name)}async function hE(n,e,t=!1){if(St(n.app))return Promise.reject($n(n));const i=vu(n),r=nE(i,e),s=await new lE(i,r,t).execute();return s&&!t&&(delete s.user._redirectEventId,await i._persistUserIfCurrent(s.user),await i._setRedirectUser(null,e)),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pE=10*60*1e3;class mE{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!gE(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!vm(e)){const r=((i=e.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";t.onError(kt(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=pE&&this.cachedEventUids.clear(),this.cachedEventUids.has(Cd(e))}saveEventToCache(e){this.cachedEventUids.add(Cd(e)),this.lastProcessedEventTime=Date.now()}}function Cd(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function vm({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function gE(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return vm(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yE(n,e={}){return sr(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _E=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,vE=/^https?/;async function TE(n){if(n.config.emulator)return;const{authorizedDomains:e}=await yE(n);for(const t of e)try{if(EE(t))return}catch{}Kt(n,"unauthorized-domain")}function EE(n){const e=yl(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const s=new URL(n);return s.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&s.hostname===i}if(!vE.test(t))return!1;if(_E.test(n))return i===n;const r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IE=new _o(3e4,6e4);function Ad(){const n=Mt().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function CE(n){return new Promise((e,t)=>{var i,r,o;function s(){Ad(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Ad(),t(kt(n,"network-request-failed"))},timeout:IE.get()})}if(!((r=(i=Mt().gapi)===null||i===void 0?void 0:i.iframes)===null||r===void 0)&&r.Iframe)e(gapi.iframes.getContext());else if(!((o=Mt().gapi)===null||o===void 0)&&o.load)s();else{const u=PT("iframefcb");return Mt()[u]=()=>{gapi.load?s():t(kt(n,"network-request-failed"))},xT(`${RT()}?onload=${u}`).catch(c=>t(c))}}).catch(e=>{throw is=null,e})}let is=null;function AE(n){return is=is||CE(n),is}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SE=new _o(5e3,15e3),wE="__/auth/iframe",xE="emulator/auth/iframe",RE={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},PE=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function kE(n){const e=n.config;j(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?mu(e,xE):`https://${n.config.authDomain}/${wE}`,i={apiKey:e.apiKey,appName:n.name,v:or},r=PE.get(n.config.apiHost);r&&(i.eid=r);const o=n._getFrameworks();return o.length&&(i.fw=o.join(",")),`${t}?${yo(i).slice(1)}`}async function ME(n){const e=await AE(n),t=Mt().gapi;return j(t,n,"internal-error"),e.open({where:document.body,url:kE(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:RE,dontclear:!0},i=>new Promise(async(r,o)=>{await i.restyle({setHideOnLeave:!1});const s=kt(n,"network-request-failed"),u=Mt().setTimeout(()=>{o(s)},SE.get());function c(){Mt().clearTimeout(u),r(i)}i.ping(c).then(c,()=>{o(s)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bE={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},DE=500,NE=600,VE="_blank",LE="http://localhost";class Sd{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function FE(n,e,t,i=DE,r=NE){const o=Math.max((window.screen.availHeight-r)/2,0).toString(),s=Math.max((window.screen.availWidth-i)/2,0).toString();let u="";const c=Object.assign(Object.assign({},bE),{width:i.toString(),height:r.toString(),top:o,left:s}),f=be().toLowerCase();t&&(u=jp(f)?VE:t),Qp(f)&&(e=e||LE,c.scrollbars="yes");const h=Object.entries(c).reduce((y,[v,x])=>`${y}${v}=${x},`,"");if(vT(f)&&u!=="_self")return UE(e||"",u),new Sd(null);const m=window.open(e||"",u,h);j(m,n,"popup-blocked");try{m.focus()}catch{}return new Sd(m)}function UE(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BE="__/auth/handler",OE="emulator/auth/handler",$E=encodeURIComponent("fac");async function wd(n,e,t,i,r,o){j(n.config.authDomain,n,"auth-domain-config-required"),j(n.config.apiKey,n,"invalid-api-key");const s={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:or,eventId:r};if(e instanceof lm){e.setDefaultLanguage(n.languageCode),s.providerId=e.providerId||"",$_(e.getCustomParameters())||(s.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,m]of Object.entries({}))s[h]=m}if(e instanceof vo){const h=e.getScopes().filter(m=>m!=="");h.length>0&&(s.scopes=h.join(","))}n.tenantId&&(s.tid=n.tenantId);const u=s;for(const h of Object.keys(u))u[h]===void 0&&delete u[h];const c=await n._getAppCheckToken(),f=c?`#${$E}=${encodeURIComponent(c)}`:"";return`${qE(n)}?${yo(u).slice(1)}${f}`}function qE({config:n}){return n.emulator?mu(n,OE):`https://${n.authDomain}/${BE}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const el="webStorageSupport";class GE{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=hm,this._completeRedirectFn=hE,this._overrideRedirectResult=cE}async _openPopup(e,t,i,r){var o;Jt((o=this.eventManagers[e._key()])===null||o===void 0?void 0:o.manager,"_initialize() not called before _openPopup()");const s=await wd(e,t,i,yl(),r);return FE(e,s,Eu())}async _openRedirect(e,t,i,r){await this._originValidation(e);const o=await wd(e,t,i,yl(),r);return KT(o),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:o}=this.eventManagers[t];return r?Promise.resolve(r):(Jt(o,"If manager is not set, promise should be"),o)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){const t=await ME(e),i=new mE(e);return t.register("authEvent",r=>(j(r==null?void 0:r.authEvent,e,"invalid-auth-event"),{status:i.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(el,{type:el},r=>{var o;const s=(o=r==null?void 0:r[0])===null||o===void 0?void 0:o[el];s!==void 0&&t(!!s),Kt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=TE(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return rm()||Zp()||_u()}}const HE=GE;var xd="@firebase/auth",Rd="1.10.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zE{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{e((i==null?void 0:i.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){j(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KE(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function JE(n){Ni(new Yn("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:s,authDomain:u}=i.options;j(s&&!s.includes(":"),"invalid-api-key",{appName:i.name});const c={apiKey:s,authDomain:u,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:om(n)},f=new ST(i,r,o,c);return MT(f,t),f},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),Ni(new Yn("auth-internal",e=>{const t=vu(e.getProvider("auth").getImmediate());return(i=>new zE(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),yn(xd,Rd,KE(n)),yn(xd,Rd,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WE=5*60,YE=kp("authIdTokenMaxAge")||WE;let Pd=null;const XE=n=>async e=>{const t=e&&await e.getIdTokenResult(),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>YE)return;const r=t==null?void 0:t.token;Pd!==r&&(Pd=r,await fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function QE(n=Op()){const e=fu(n,"auth");if(e.isInitialized())return e.getImmediate();const t=kT(n,{popupRedirectResolver:HE,persistence:[tE,GT,hm]}),i=kp("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(i,location.origin);if(location.origin===o.origin){const s=XE(o.toString());OT(t,s,()=>s(t.currentUser)),BT(t,u=>s(u))}}const r=Rp("auth");return r&&bT(t,`http://${r}`),t}function ZE(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}wT({loadJS(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=r=>{const o=kt("internal-error");o.customData=r,t(o)},i.type="text/javascript",i.charset="UTF-8",ZE().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});JE("Browser");var kd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Cu;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(I,T){function E(){}E.prototype=T.prototype,I.D=T.prototype,I.prototype=new E,I.prototype.constructor=I,I.C=function(w,C,P){for(var S=Array(arguments.length-2),ct=2;ct<arguments.length;ct++)S[ct-2]=arguments[ct];return T.prototype[C].apply(w,S)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(i,t),i.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(I,T,E){E||(E=0);var w=Array(16);if(typeof T=="string")for(var C=0;16>C;++C)w[C]=T.charCodeAt(E++)|T.charCodeAt(E++)<<8|T.charCodeAt(E++)<<16|T.charCodeAt(E++)<<24;else for(C=0;16>C;++C)w[C]=T[E++]|T[E++]<<8|T[E++]<<16|T[E++]<<24;T=I.g[0],E=I.g[1],C=I.g[2];var P=I.g[3],S=T+(P^E&(C^P))+w[0]+3614090360&4294967295;T=E+(S<<7&4294967295|S>>>25),S=P+(C^T&(E^C))+w[1]+3905402710&4294967295,P=T+(S<<12&4294967295|S>>>20),S=C+(E^P&(T^E))+w[2]+606105819&4294967295,C=P+(S<<17&4294967295|S>>>15),S=E+(T^C&(P^T))+w[3]+3250441966&4294967295,E=C+(S<<22&4294967295|S>>>10),S=T+(P^E&(C^P))+w[4]+4118548399&4294967295,T=E+(S<<7&4294967295|S>>>25),S=P+(C^T&(E^C))+w[5]+1200080426&4294967295,P=T+(S<<12&4294967295|S>>>20),S=C+(E^P&(T^E))+w[6]+2821735955&4294967295,C=P+(S<<17&4294967295|S>>>15),S=E+(T^C&(P^T))+w[7]+4249261313&4294967295,E=C+(S<<22&4294967295|S>>>10),S=T+(P^E&(C^P))+w[8]+1770035416&4294967295,T=E+(S<<7&4294967295|S>>>25),S=P+(C^T&(E^C))+w[9]+2336552879&4294967295,P=T+(S<<12&4294967295|S>>>20),S=C+(E^P&(T^E))+w[10]+4294925233&4294967295,C=P+(S<<17&4294967295|S>>>15),S=E+(T^C&(P^T))+w[11]+2304563134&4294967295,E=C+(S<<22&4294967295|S>>>10),S=T+(P^E&(C^P))+w[12]+1804603682&4294967295,T=E+(S<<7&4294967295|S>>>25),S=P+(C^T&(E^C))+w[13]+4254626195&4294967295,P=T+(S<<12&4294967295|S>>>20),S=C+(E^P&(T^E))+w[14]+2792965006&4294967295,C=P+(S<<17&4294967295|S>>>15),S=E+(T^C&(P^T))+w[15]+1236535329&4294967295,E=C+(S<<22&4294967295|S>>>10),S=T+(C^P&(E^C))+w[1]+4129170786&4294967295,T=E+(S<<5&4294967295|S>>>27),S=P+(E^C&(T^E))+w[6]+3225465664&4294967295,P=T+(S<<9&4294967295|S>>>23),S=C+(T^E&(P^T))+w[11]+643717713&4294967295,C=P+(S<<14&4294967295|S>>>18),S=E+(P^T&(C^P))+w[0]+3921069994&4294967295,E=C+(S<<20&4294967295|S>>>12),S=T+(C^P&(E^C))+w[5]+3593408605&4294967295,T=E+(S<<5&4294967295|S>>>27),S=P+(E^C&(T^E))+w[10]+38016083&4294967295,P=T+(S<<9&4294967295|S>>>23),S=C+(T^E&(P^T))+w[15]+3634488961&4294967295,C=P+(S<<14&4294967295|S>>>18),S=E+(P^T&(C^P))+w[4]+3889429448&4294967295,E=C+(S<<20&4294967295|S>>>12),S=T+(C^P&(E^C))+w[9]+568446438&4294967295,T=E+(S<<5&4294967295|S>>>27),S=P+(E^C&(T^E))+w[14]+3275163606&4294967295,P=T+(S<<9&4294967295|S>>>23),S=C+(T^E&(P^T))+w[3]+4107603335&4294967295,C=P+(S<<14&4294967295|S>>>18),S=E+(P^T&(C^P))+w[8]+1163531501&4294967295,E=C+(S<<20&4294967295|S>>>12),S=T+(C^P&(E^C))+w[13]+2850285829&4294967295,T=E+(S<<5&4294967295|S>>>27),S=P+(E^C&(T^E))+w[2]+4243563512&4294967295,P=T+(S<<9&4294967295|S>>>23),S=C+(T^E&(P^T))+w[7]+1735328473&4294967295,C=P+(S<<14&4294967295|S>>>18),S=E+(P^T&(C^P))+w[12]+2368359562&4294967295,E=C+(S<<20&4294967295|S>>>12),S=T+(E^C^P)+w[5]+4294588738&4294967295,T=E+(S<<4&4294967295|S>>>28),S=P+(T^E^C)+w[8]+2272392833&4294967295,P=T+(S<<11&4294967295|S>>>21),S=C+(P^T^E)+w[11]+1839030562&4294967295,C=P+(S<<16&4294967295|S>>>16),S=E+(C^P^T)+w[14]+4259657740&4294967295,E=C+(S<<23&4294967295|S>>>9),S=T+(E^C^P)+w[1]+2763975236&4294967295,T=E+(S<<4&4294967295|S>>>28),S=P+(T^E^C)+w[4]+1272893353&4294967295,P=T+(S<<11&4294967295|S>>>21),S=C+(P^T^E)+w[7]+4139469664&4294967295,C=P+(S<<16&4294967295|S>>>16),S=E+(C^P^T)+w[10]+3200236656&4294967295,E=C+(S<<23&4294967295|S>>>9),S=T+(E^C^P)+w[13]+681279174&4294967295,T=E+(S<<4&4294967295|S>>>28),S=P+(T^E^C)+w[0]+3936430074&4294967295,P=T+(S<<11&4294967295|S>>>21),S=C+(P^T^E)+w[3]+3572445317&4294967295,C=P+(S<<16&4294967295|S>>>16),S=E+(C^P^T)+w[6]+76029189&4294967295,E=C+(S<<23&4294967295|S>>>9),S=T+(E^C^P)+w[9]+3654602809&4294967295,T=E+(S<<4&4294967295|S>>>28),S=P+(T^E^C)+w[12]+3873151461&4294967295,P=T+(S<<11&4294967295|S>>>21),S=C+(P^T^E)+w[15]+530742520&4294967295,C=P+(S<<16&4294967295|S>>>16),S=E+(C^P^T)+w[2]+3299628645&4294967295,E=C+(S<<23&4294967295|S>>>9),S=T+(C^(E|~P))+w[0]+4096336452&4294967295,T=E+(S<<6&4294967295|S>>>26),S=P+(E^(T|~C))+w[7]+1126891415&4294967295,P=T+(S<<10&4294967295|S>>>22),S=C+(T^(P|~E))+w[14]+2878612391&4294967295,C=P+(S<<15&4294967295|S>>>17),S=E+(P^(C|~T))+w[5]+4237533241&4294967295,E=C+(S<<21&4294967295|S>>>11),S=T+(C^(E|~P))+w[12]+1700485571&4294967295,T=E+(S<<6&4294967295|S>>>26),S=P+(E^(T|~C))+w[3]+2399980690&4294967295,P=T+(S<<10&4294967295|S>>>22),S=C+(T^(P|~E))+w[10]+4293915773&4294967295,C=P+(S<<15&4294967295|S>>>17),S=E+(P^(C|~T))+w[1]+2240044497&4294967295,E=C+(S<<21&4294967295|S>>>11),S=T+(C^(E|~P))+w[8]+1873313359&4294967295,T=E+(S<<6&4294967295|S>>>26),S=P+(E^(T|~C))+w[15]+4264355552&4294967295,P=T+(S<<10&4294967295|S>>>22),S=C+(T^(P|~E))+w[6]+2734768916&4294967295,C=P+(S<<15&4294967295|S>>>17),S=E+(P^(C|~T))+w[13]+1309151649&4294967295,E=C+(S<<21&4294967295|S>>>11),S=T+(C^(E|~P))+w[4]+4149444226&4294967295,T=E+(S<<6&4294967295|S>>>26),S=P+(E^(T|~C))+w[11]+3174756917&4294967295,P=T+(S<<10&4294967295|S>>>22),S=C+(T^(P|~E))+w[2]+718787259&4294967295,C=P+(S<<15&4294967295|S>>>17),S=E+(P^(C|~T))+w[9]+3951481745&4294967295,I.g[0]=I.g[0]+T&4294967295,I.g[1]=I.g[1]+(C+(S<<21&4294967295|S>>>11))&4294967295,I.g[2]=I.g[2]+C&4294967295,I.g[3]=I.g[3]+P&4294967295}i.prototype.u=function(I,T){T===void 0&&(T=I.length);for(var E=T-this.blockSize,w=this.B,C=this.h,P=0;P<T;){if(C==0)for(;P<=E;)r(this,I,P),P+=this.blockSize;if(typeof I=="string"){for(;P<T;)if(w[C++]=I.charCodeAt(P++),C==this.blockSize){r(this,w),C=0;break}}else for(;P<T;)if(w[C++]=I[P++],C==this.blockSize){r(this,w),C=0;break}}this.h=C,this.o+=T},i.prototype.v=function(){var I=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);I[0]=128;for(var T=1;T<I.length-8;++T)I[T]=0;var E=8*this.o;for(T=I.length-8;T<I.length;++T)I[T]=E&255,E/=256;for(this.u(I),I=Array(16),T=E=0;4>T;++T)for(var w=0;32>w;w+=8)I[E++]=this.g[T]>>>w&255;return I};function o(I,T){var E=u;return Object.prototype.hasOwnProperty.call(E,I)?E[I]:E[I]=T(I)}function s(I,T){this.h=T;for(var E=[],w=!0,C=I.length-1;0<=C;C--){var P=I[C]|0;w&&P==T||(E[C]=P,w=!1)}this.g=E}var u={};function c(I){return-128<=I&&128>I?o(I,function(T){return new s([T|0],0>T?-1:0)}):new s([I|0],0>I?-1:0)}function f(I){if(isNaN(I)||!isFinite(I))return m;if(0>I)return D(f(-I));for(var T=[],E=1,w=0;I>=E;w++)T[w]=I/E|0,E*=4294967296;return new s(T,0)}function h(I,T){if(I.length==0)throw Error("number format error: empty string");if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(I.charAt(0)=="-")return D(h(I.substring(1),T));if(0<=I.indexOf("-"))throw Error('number format error: interior "-" character');for(var E=f(Math.pow(T,8)),w=m,C=0;C<I.length;C+=8){var P=Math.min(8,I.length-C),S=parseInt(I.substring(C,C+P),T);8>P?(P=f(Math.pow(T,P)),w=w.j(P).add(f(S))):(w=w.j(E),w=w.add(f(S)))}return w}var m=c(0),y=c(1),v=c(16777216);n=s.prototype,n.m=function(){if(R(this))return-D(this).m();for(var I=0,T=1,E=0;E<this.g.length;E++){var w=this.i(E);I+=(0<=w?w:4294967296+w)*T,T*=4294967296}return I},n.toString=function(I){if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(x(this))return"0";if(R(this))return"-"+D(this).toString(I);for(var T=f(Math.pow(I,6)),E=this,w="";;){var C=F(E,T).g;E=U(E,C.j(T));var P=((0<E.g.length?E.g[0]:E.h)>>>0).toString(I);if(E=C,x(E))return P+w;for(;6>P.length;)P="0"+P;w=P+w}},n.i=function(I){return 0>I?0:I<this.g.length?this.g[I]:this.h};function x(I){if(I.h!=0)return!1;for(var T=0;T<I.g.length;T++)if(I.g[T]!=0)return!1;return!0}function R(I){return I.h==-1}n.l=function(I){return I=U(this,I),R(I)?-1:x(I)?0:1};function D(I){for(var T=I.g.length,E=[],w=0;w<T;w++)E[w]=~I.g[w];return new s(E,~I.h).add(y)}n.abs=function(){return R(this)?D(this):this},n.add=function(I){for(var T=Math.max(this.g.length,I.g.length),E=[],w=0,C=0;C<=T;C++){var P=w+(this.i(C)&65535)+(I.i(C)&65535),S=(P>>>16)+(this.i(C)>>>16)+(I.i(C)>>>16);w=S>>>16,P&=65535,S&=65535,E[C]=S<<16|P}return new s(E,E[E.length-1]&-2147483648?-1:0)};function U(I,T){return I.add(D(T))}n.j=function(I){if(x(this)||x(I))return m;if(R(this))return R(I)?D(this).j(D(I)):D(D(this).j(I));if(R(I))return D(this.j(D(I)));if(0>this.l(v)&&0>I.l(v))return f(this.m()*I.m());for(var T=this.g.length+I.g.length,E=[],w=0;w<2*T;w++)E[w]=0;for(w=0;w<this.g.length;w++)for(var C=0;C<I.g.length;C++){var P=this.i(w)>>>16,S=this.i(w)&65535,ct=I.i(C)>>>16,Xe=I.i(C)&65535;E[2*w+2*C]+=S*Xe,V(E,2*w+2*C),E[2*w+2*C+1]+=P*Xe,V(E,2*w+2*C+1),E[2*w+2*C+1]+=S*ct,V(E,2*w+2*C+1),E[2*w+2*C+2]+=P*ct,V(E,2*w+2*C+2)}for(w=0;w<T;w++)E[w]=E[2*w+1]<<16|E[2*w];for(w=T;w<2*T;w++)E[w]=0;return new s(E,0)};function V(I,T){for(;(I[T]&65535)!=I[T];)I[T+1]+=I[T]>>>16,I[T]&=65535,T++}function N(I,T){this.g=I,this.h=T}function F(I,T){if(x(T))throw Error("division by zero");if(x(I))return new N(m,m);if(R(I))return T=F(D(I),T),new N(D(T.g),D(T.h));if(R(T))return T=F(I,D(T)),new N(D(T.g),T.h);if(30<I.g.length){if(R(I)||R(T))throw Error("slowDivide_ only works with positive integers.");for(var E=y,w=T;0>=w.l(I);)E=L(E),w=L(w);var C=q(E,1),P=q(w,1);for(w=q(w,2),E=q(E,2);!x(w);){var S=P.add(w);0>=S.l(I)&&(C=C.add(E),P=S),w=q(w,1),E=q(E,1)}return T=U(I,C.j(T)),new N(C,T)}for(C=m;0<=I.l(T);){for(E=Math.max(1,Math.floor(I.m()/T.m())),w=Math.ceil(Math.log(E)/Math.LN2),w=48>=w?1:Math.pow(2,w-48),P=f(E),S=P.j(T);R(S)||0<S.l(I);)E-=w,P=f(E),S=P.j(T);x(P)&&(P=y),C=C.add(P),I=U(I,S)}return new N(C,I)}n.A=function(I){return F(this,I).h},n.and=function(I){for(var T=Math.max(this.g.length,I.g.length),E=[],w=0;w<T;w++)E[w]=this.i(w)&I.i(w);return new s(E,this.h&I.h)},n.or=function(I){for(var T=Math.max(this.g.length,I.g.length),E=[],w=0;w<T;w++)E[w]=this.i(w)|I.i(w);return new s(E,this.h|I.h)},n.xor=function(I){for(var T=Math.max(this.g.length,I.g.length),E=[],w=0;w<T;w++)E[w]=this.i(w)^I.i(w);return new s(E,this.h^I.h)};function L(I){for(var T=I.g.length+1,E=[],w=0;w<T;w++)E[w]=I.i(w)<<1|I.i(w-1)>>>31;return new s(E,I.h)}function q(I,T){var E=T>>5;T%=32;for(var w=I.g.length-E,C=[],P=0;P<w;P++)C[P]=0<T?I.i(P+E)>>>T|I.i(P+E+1)<<32-T:I.i(P+E);return new s(C,I.h)}i.prototype.digest=i.prototype.v,i.prototype.reset=i.prototype.s,i.prototype.update=i.prototype.u,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.A,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=f,s.fromString=h,Cu=s}).apply(typeof kd<"u"?kd:typeof self<"u"?self:typeof window<"u"?window:{});var zo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Tm,Fr,Em,rs,Tl,Im,Cm,Am;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(d,p,g){return d==Array.prototype||d==Object.prototype||(d[p]=g.value),d};function t(d){d=[typeof globalThis=="object"&&globalThis,d,typeof window=="object"&&window,typeof self=="object"&&self,typeof zo=="object"&&zo];for(var p=0;p<d.length;++p){var g=d[p];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var i=t(this);function r(d,p){if(p)e:{var g=i;d=d.split(".");for(var _=0;_<d.length-1;_++){var k=d[_];if(!(k in g))break e;g=g[k]}d=d[d.length-1],_=g[d],p=p(_),p!=_&&p!=null&&e(g,d,{configurable:!0,writable:!0,value:p})}}function o(d,p){d instanceof String&&(d+="");var g=0,_=!1,k={next:function(){if(!_&&g<d.length){var b=g++;return{value:p(b,d[b]),done:!1}}return _=!0,{done:!0,value:void 0}}};return k[Symbol.iterator]=function(){return k},k}r("Array.prototype.values",function(d){return d||function(){return o(this,function(p,g){return g})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var s=s||{},u=this||self;function c(d){var p=typeof d;return p=p!="object"?p:d?Array.isArray(d)?"array":p:"null",p=="array"||p=="object"&&typeof d.length=="number"}function f(d){var p=typeof d;return p=="object"&&d!=null||p=="function"}function h(d,p,g){return d.call.apply(d.bind,arguments)}function m(d,p,g){if(!d)throw Error();if(2<arguments.length){var _=Array.prototype.slice.call(arguments,2);return function(){var k=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(k,_),d.apply(p,k)}}return function(){return d.apply(p,arguments)}}function y(d,p,g){return y=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:m,y.apply(null,arguments)}function v(d,p){var g=Array.prototype.slice.call(arguments,1);return function(){var _=g.slice();return _.push.apply(_,arguments),d.apply(this,_)}}function x(d,p){function g(){}g.prototype=p.prototype,d.aa=p.prototype,d.prototype=new g,d.prototype.constructor=d,d.Qb=function(_,k,b){for(var G=Array(arguments.length-2),ye=2;ye<arguments.length;ye++)G[ye-2]=arguments[ye];return p.prototype[k].apply(_,G)}}function R(d){const p=d.length;if(0<p){const g=Array(p);for(let _=0;_<p;_++)g[_]=d[_];return g}return[]}function D(d,p){for(let g=1;g<arguments.length;g++){const _=arguments[g];if(c(_)){const k=d.length||0,b=_.length||0;d.length=k+b;for(let G=0;G<b;G++)d[k+G]=_[G]}else d.push(_)}}class U{constructor(p,g){this.i=p,this.j=g,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function V(d){return/^[\s\xa0]*$/.test(d)}function N(){var d=u.navigator;return d&&(d=d.userAgent)?d:""}function F(d){return F[" "](d),d}F[" "]=function(){};var L=N().indexOf("Gecko")!=-1&&!(N().toLowerCase().indexOf("webkit")!=-1&&N().indexOf("Edge")==-1)&&!(N().indexOf("Trident")!=-1||N().indexOf("MSIE")!=-1)&&N().indexOf("Edge")==-1;function q(d,p,g){for(const _ in d)p.call(g,d[_],_,d)}function I(d,p){for(const g in d)p.call(void 0,d[g],g,d)}function T(d){const p={};for(const g in d)p[g]=d[g];return p}const E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function w(d,p){let g,_;for(let k=1;k<arguments.length;k++){_=arguments[k];for(g in _)d[g]=_[g];for(let b=0;b<E.length;b++)g=E[b],Object.prototype.hasOwnProperty.call(_,g)&&(d[g]=_[g])}}function C(d){var p=1;d=d.split(":");const g=[];for(;0<p&&d.length;)g.push(d.shift()),p--;return d.length&&g.push(d.join(":")),g}function P(d){u.setTimeout(()=>{throw d},0)}function S(){var d=Aa;let p=null;return d.g&&(p=d.g,d.g=d.g.next,d.g||(d.h=null),p.next=null),p}class ct{constructor(){this.h=this.g=null}add(p,g){const _=Xe.get();_.set(p,g),this.h?this.h.next=_:this.g=_,this.h=_}}var Xe=new U(()=>new hr,d=>d.reset());class hr{constructor(){this.next=this.g=this.h=null}set(p,g){this.h=p,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let pr,mr=!1,Aa=new ct,ec=()=>{const d=u.Promise.resolve(void 0);pr=()=>{d.then(Ly)}};var Ly=()=>{for(var d;d=S();){try{d.h.call(d.g)}catch(g){P(g)}var p=Xe;p.j(d),100>p.h&&(p.h++,d.next=p.g,p.g=d)}mr=!1};function Zt(){this.s=this.s,this.C=this.C}Zt.prototype.s=!1,Zt.prototype.ma=function(){this.s||(this.s=!0,this.N())},Zt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ge(d,p){this.type=d,this.g=this.target=p,this.defaultPrevented=!1}Ge.prototype.h=function(){this.defaultPrevented=!0};var Fy=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var d=!1,p=Object.defineProperty({},"passive",{get:function(){d=!0}});try{const g=()=>{};u.addEventListener("test",g,p),u.removeEventListener("test",g,p)}catch{}return d}();function gr(d,p){if(Ge.call(this,d?d.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,d){var g=this.type=d.type,_=d.changedTouches&&d.changedTouches.length?d.changedTouches[0]:null;if(this.target=d.target||d.srcElement,this.g=p,p=d.relatedTarget){if(L){e:{try{F(p.nodeName);var k=!0;break e}catch{}k=!1}k||(p=null)}}else g=="mouseover"?p=d.fromElement:g=="mouseout"&&(p=d.toElement);this.relatedTarget=p,_?(this.clientX=_.clientX!==void 0?_.clientX:_.pageX,this.clientY=_.clientY!==void 0?_.clientY:_.pageY,this.screenX=_.screenX||0,this.screenY=_.screenY||0):(this.clientX=d.clientX!==void 0?d.clientX:d.pageX,this.clientY=d.clientY!==void 0?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0),this.button=d.button,this.key=d.key||"",this.ctrlKey=d.ctrlKey,this.altKey=d.altKey,this.shiftKey=d.shiftKey,this.metaKey=d.metaKey,this.pointerId=d.pointerId||0,this.pointerType=typeof d.pointerType=="string"?d.pointerType:Uy[d.pointerType]||"",this.state=d.state,this.i=d,d.defaultPrevented&&gr.aa.h.call(this)}}x(gr,Ge);var Uy={2:"touch",3:"pen",4:"mouse"};gr.prototype.h=function(){gr.aa.h.call(this);var d=this.i;d.preventDefault?d.preventDefault():d.returnValue=!1};var So="closure_listenable_"+(1e6*Math.random()|0),By=0;function Oy(d,p,g,_,k){this.listener=d,this.proxy=null,this.src=p,this.type=g,this.capture=!!_,this.ha=k,this.key=++By,this.da=this.fa=!1}function wo(d){d.da=!0,d.listener=null,d.proxy=null,d.src=null,d.ha=null}function xo(d){this.src=d,this.g={},this.h=0}xo.prototype.add=function(d,p,g,_,k){var b=d.toString();d=this.g[b],d||(d=this.g[b]=[],this.h++);var G=wa(d,p,_,k);return-1<G?(p=d[G],g||(p.fa=!1)):(p=new Oy(p,this.src,b,!!_,k),p.fa=g,d.push(p)),p};function Sa(d,p){var g=p.type;if(g in d.g){var _=d.g[g],k=Array.prototype.indexOf.call(_,p,void 0),b;(b=0<=k)&&Array.prototype.splice.call(_,k,1),b&&(wo(p),d.g[g].length==0&&(delete d.g[g],d.h--))}}function wa(d,p,g,_){for(var k=0;k<d.length;++k){var b=d[k];if(!b.da&&b.listener==p&&b.capture==!!g&&b.ha==_)return k}return-1}var xa="closure_lm_"+(1e6*Math.random()|0),Ra={};function tc(d,p,g,_,k){if(Array.isArray(p)){for(var b=0;b<p.length;b++)tc(d,p[b],g,_,k);return null}return g=rc(g),d&&d[So]?d.K(p,g,f(_)?!!_.capture:!1,k):$y(d,p,g,!1,_,k)}function $y(d,p,g,_,k,b){if(!p)throw Error("Invalid event type");var G=f(k)?!!k.capture:!!k,ye=ka(d);if(ye||(d[xa]=ye=new xo(d)),g=ye.add(p,g,_,G,b),g.proxy)return g;if(_=qy(),g.proxy=_,_.src=d,_.listener=g,d.addEventListener)Fy||(k=G),k===void 0&&(k=!1),d.addEventListener(p.toString(),_,k);else if(d.attachEvent)d.attachEvent(ic(p.toString()),_);else if(d.addListener&&d.removeListener)d.addListener(_);else throw Error("addEventListener and attachEvent are unavailable.");return g}function qy(){function d(g){return p.call(d.src,d.listener,g)}const p=Gy;return d}function nc(d,p,g,_,k){if(Array.isArray(p))for(var b=0;b<p.length;b++)nc(d,p[b],g,_,k);else _=f(_)?!!_.capture:!!_,g=rc(g),d&&d[So]?(d=d.i,p=String(p).toString(),p in d.g&&(b=d.g[p],g=wa(b,g,_,k),-1<g&&(wo(b[g]),Array.prototype.splice.call(b,g,1),b.length==0&&(delete d.g[p],d.h--)))):d&&(d=ka(d))&&(p=d.g[p.toString()],d=-1,p&&(d=wa(p,g,_,k)),(g=-1<d?p[d]:null)&&Pa(g))}function Pa(d){if(typeof d!="number"&&d&&!d.da){var p=d.src;if(p&&p[So])Sa(p.i,d);else{var g=d.type,_=d.proxy;p.removeEventListener?p.removeEventListener(g,_,d.capture):p.detachEvent?p.detachEvent(ic(g),_):p.addListener&&p.removeListener&&p.removeListener(_),(g=ka(p))?(Sa(g,d),g.h==0&&(g.src=null,p[xa]=null)):wo(d)}}}function ic(d){return d in Ra?Ra[d]:Ra[d]="on"+d}function Gy(d,p){if(d.da)d=!0;else{p=new gr(p,this);var g=d.listener,_=d.ha||d.src;d.fa&&Pa(d),d=g.call(_,p)}return d}function ka(d){return d=d[xa],d instanceof xo?d:null}var Ma="__closure_events_fn_"+(1e9*Math.random()>>>0);function rc(d){return typeof d=="function"?d:(d[Ma]||(d[Ma]=function(p){return d.handleEvent(p)}),d[Ma])}function He(){Zt.call(this),this.i=new xo(this),this.M=this,this.F=null}x(He,Zt),He.prototype[So]=!0,He.prototype.removeEventListener=function(d,p,g,_){nc(this,d,p,g,_)};function Qe(d,p){var g,_=d.F;if(_)for(g=[];_;_=_.F)g.push(_);if(d=d.M,_=p.type||p,typeof p=="string")p=new Ge(p,d);else if(p instanceof Ge)p.target=p.target||d;else{var k=p;p=new Ge(_,d),w(p,k)}if(k=!0,g)for(var b=g.length-1;0<=b;b--){var G=p.g=g[b];k=Ro(G,_,!0,p)&&k}if(G=p.g=d,k=Ro(G,_,!0,p)&&k,k=Ro(G,_,!1,p)&&k,g)for(b=0;b<g.length;b++)G=p.g=g[b],k=Ro(G,_,!1,p)&&k}He.prototype.N=function(){if(He.aa.N.call(this),this.i){var d=this.i,p;for(p in d.g){for(var g=d.g[p],_=0;_<g.length;_++)wo(g[_]);delete d.g[p],d.h--}}this.F=null},He.prototype.K=function(d,p,g,_){return this.i.add(String(d),p,!1,g,_)},He.prototype.L=function(d,p,g,_){return this.i.add(String(d),p,!0,g,_)};function Ro(d,p,g,_){if(p=d.i.g[String(p)],!p)return!0;p=p.concat();for(var k=!0,b=0;b<p.length;++b){var G=p[b];if(G&&!G.da&&G.capture==g){var ye=G.listener,Le=G.ha||G.src;G.fa&&Sa(d.i,G),k=ye.call(Le,_)!==!1&&k}}return k&&!_.defaultPrevented}function oc(d,p,g){if(typeof d=="function")g&&(d=y(d,g));else if(d&&typeof d.handleEvent=="function")d=y(d.handleEvent,d);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:u.setTimeout(d,p||0)}function sc(d){d.g=oc(()=>{d.g=null,d.i&&(d.i=!1,sc(d))},d.l);const p=d.h;d.h=null,d.m.apply(null,p)}class Hy extends Zt{constructor(p,g){super(),this.m=p,this.l=g,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:sc(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function yr(d){Zt.call(this),this.h=d,this.g={}}x(yr,Zt);var ac=[];function lc(d){q(d.g,function(p,g){this.g.hasOwnProperty(g)&&Pa(p)},d),d.g={}}yr.prototype.N=function(){yr.aa.N.call(this),lc(this)},yr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ba=u.JSON.stringify,zy=u.JSON.parse,Ky=class{stringify(d){return u.JSON.stringify(d,void 0)}parse(d){return u.JSON.parse(d,void 0)}};function Da(){}Da.prototype.h=null;function uc(d){return d.h||(d.h=d.i())}function cc(){}var _r={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Na(){Ge.call(this,"d")}x(Na,Ge);function Va(){Ge.call(this,"c")}x(Va,Ge);var Sn={},dc=null;function Po(){return dc=dc||new He}Sn.La="serverreachability";function fc(d){Ge.call(this,Sn.La,d)}x(fc,Ge);function vr(d){const p=Po();Qe(p,new fc(p))}Sn.STAT_EVENT="statevent";function hc(d,p){Ge.call(this,Sn.STAT_EVENT,d),this.stat=p}x(hc,Ge);function Ze(d){const p=Po();Qe(p,new hc(p,d))}Sn.Ma="timingevent";function pc(d,p){Ge.call(this,Sn.Ma,d),this.size=p}x(pc,Ge);function Tr(d,p){if(typeof d!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){d()},p)}function Er(){this.g=!0}Er.prototype.xa=function(){this.g=!1};function Jy(d,p,g,_,k,b){d.info(function(){if(d.g)if(b)for(var G="",ye=b.split("&"),Le=0;Le<ye.length;Le++){var fe=ye[Le].split("=");if(1<fe.length){var ze=fe[0];fe=fe[1];var Ke=ze.split("_");G=2<=Ke.length&&Ke[1]=="type"?G+(ze+"="+fe+"&"):G+(ze+"=redacted&")}}else G=null;else G=b;return"XMLHTTP REQ ("+_+") [attempt "+k+"]: "+p+`
`+g+`
`+G})}function Wy(d,p,g,_,k,b,G){d.info(function(){return"XMLHTTP RESP ("+_+") [ attempt "+k+"]: "+p+`
`+g+`
`+b+" "+G})}function ui(d,p,g,_){d.info(function(){return"XMLHTTP TEXT ("+p+"): "+Xy(d,g)+(_?" "+_:"")})}function Yy(d,p){d.info(function(){return"TIMEOUT: "+p})}Er.prototype.info=function(){};function Xy(d,p){if(!d.g)return p;if(!p)return null;try{var g=JSON.parse(p);if(g){for(d=0;d<g.length;d++)if(Array.isArray(g[d])){var _=g[d];if(!(2>_.length)){var k=_[1];if(Array.isArray(k)&&!(1>k.length)){var b=k[0];if(b!="noop"&&b!="stop"&&b!="close")for(var G=1;G<k.length;G++)k[G]=""}}}}return ba(g)}catch{return p}}var ko={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},mc={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},La;function Mo(){}x(Mo,Da),Mo.prototype.g=function(){return new XMLHttpRequest},Mo.prototype.i=function(){return{}},La=new Mo;function jt(d,p,g,_){this.j=d,this.i=p,this.l=g,this.R=_||1,this.U=new yr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new gc}function gc(){this.i=null,this.g="",this.h=!1}var yc={},Fa={};function Ua(d,p,g){d.L=1,d.v=Vo(Ut(p)),d.m=g,d.P=!0,_c(d,null)}function _c(d,p){d.F=Date.now(),bo(d),d.A=Ut(d.v);var g=d.A,_=d.R;Array.isArray(_)||(_=[String(_)]),bc(g.i,"t",_),d.C=0,g=d.j.J,d.h=new gc,d.g=Xc(d.j,g?p:null,!d.m),0<d.O&&(d.M=new Hy(y(d.Y,d,d.g),d.O)),p=d.U,g=d.g,_=d.ca;var k="readystatechange";Array.isArray(k)||(k&&(ac[0]=k.toString()),k=ac);for(var b=0;b<k.length;b++){var G=tc(g,k[b],_||p.handleEvent,!1,p.h||p);if(!G)break;p.g[G.key]=G}p=d.H?T(d.H):{},d.m?(d.u||(d.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",d.g.ea(d.A,d.u,d.m,p)):(d.u="GET",d.g.ea(d.A,d.u,null,p)),vr(),Jy(d.i,d.u,d.A,d.l,d.R,d.m)}jt.prototype.ca=function(d){d=d.target;const p=this.M;p&&Bt(d)==3?p.j():this.Y(d)},jt.prototype.Y=function(d){try{if(d==this.g)e:{const Ke=Bt(this.g);var p=this.g.Ba();const fi=this.g.Z();if(!(3>Ke)&&(Ke!=3||this.g&&(this.h.h||this.g.oa()||Bc(this.g)))){this.J||Ke!=4||p==7||(p==8||0>=fi?vr(3):vr(2)),Ba(this);var g=this.g.Z();this.X=g;t:if(vc(this)){var _=Bc(this.g);d="";var k=_.length,b=Bt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){wn(this),Ir(this);var G="";break t}this.h.i=new u.TextDecoder}for(p=0;p<k;p++)this.h.h=!0,d+=this.h.i.decode(_[p],{stream:!(b&&p==k-1)});_.length=0,this.h.g+=d,this.C=0,G=this.h.g}else G=this.g.oa();if(this.o=g==200,Wy(this.i,this.u,this.A,this.l,this.R,Ke,g),this.o){if(this.T&&!this.K){t:{if(this.g){var ye,Le=this.g;if((ye=Le.g?Le.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!V(ye)){var fe=ye;break t}}fe=null}if(g=fe)ui(this.i,this.l,g,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Oa(this,g);else{this.o=!1,this.s=3,Ze(12),wn(this),Ir(this);break e}}if(this.P){g=!0;let mt;for(;!this.J&&this.C<G.length;)if(mt=Qy(this,G),mt==Fa){Ke==4&&(this.s=4,Ze(14),g=!1),ui(this.i,this.l,null,"[Incomplete Response]");break}else if(mt==yc){this.s=4,Ze(15),ui(this.i,this.l,G,"[Invalid Chunk]"),g=!1;break}else ui(this.i,this.l,mt,null),Oa(this,mt);if(vc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ke!=4||G.length!=0||this.h.h||(this.s=1,Ze(16),g=!1),this.o=this.o&&g,!g)ui(this.i,this.l,G,"[Invalid Chunked Response]"),wn(this),Ir(this);else if(0<G.length&&!this.W){this.W=!0;var ze=this.j;ze.g==this&&ze.ba&&!ze.M&&(ze.j.info("Great, no buffering proxy detected. Bytes received: "+G.length),Ka(ze),ze.M=!0,Ze(11))}}else ui(this.i,this.l,G,null),Oa(this,G);Ke==4&&wn(this),this.o&&!this.J&&(Ke==4?Kc(this.j,this):(this.o=!1,bo(this)))}else p_(this.g),g==400&&0<G.indexOf("Unknown SID")?(this.s=3,Ze(12)):(this.s=0,Ze(13)),wn(this),Ir(this)}}}catch{}finally{}};function vc(d){return d.g?d.u=="GET"&&d.L!=2&&d.j.Ca:!1}function Qy(d,p){var g=d.C,_=p.indexOf(`
`,g);return _==-1?Fa:(g=Number(p.substring(g,_)),isNaN(g)?yc:(_+=1,_+g>p.length?Fa:(p=p.slice(_,_+g),d.C=_+g,p)))}jt.prototype.cancel=function(){this.J=!0,wn(this)};function bo(d){d.S=Date.now()+d.I,Tc(d,d.I)}function Tc(d,p){if(d.B!=null)throw Error("WatchDog timer not null");d.B=Tr(y(d.ba,d),p)}function Ba(d){d.B&&(u.clearTimeout(d.B),d.B=null)}jt.prototype.ba=function(){this.B=null;const d=Date.now();0<=d-this.S?(Yy(this.i,this.A),this.L!=2&&(vr(),Ze(17)),wn(this),this.s=2,Ir(this)):Tc(this,this.S-d)};function Ir(d){d.j.G==0||d.J||Kc(d.j,d)}function wn(d){Ba(d);var p=d.M;p&&typeof p.ma=="function"&&p.ma(),d.M=null,lc(d.U),d.g&&(p=d.g,d.g=null,p.abort(),p.ma())}function Oa(d,p){try{var g=d.j;if(g.G!=0&&(g.g==d||$a(g.h,d))){if(!d.K&&$a(g.h,d)&&g.G==3){try{var _=g.Da.g.parse(p)}catch{_=null}if(Array.isArray(_)&&_.length==3){var k=_;if(k[0]==0){e:if(!g.u){if(g.g)if(g.g.F+3e3<d.F)$o(g),Bo(g);else break e;za(g),Ze(18)}}else g.za=k[1],0<g.za-g.T&&37500>k[2]&&g.F&&g.v==0&&!g.C&&(g.C=Tr(y(g.Za,g),6e3));if(1>=Cc(g.h)&&g.ca){try{g.ca()}catch{}g.ca=void 0}}else Rn(g,11)}else if((d.K||g.g==d)&&$o(g),!V(p))for(k=g.Da.g.parse(p),p=0;p<k.length;p++){let fe=k[p];if(g.T=fe[0],fe=fe[1],g.G==2)if(fe[0]=="c"){g.K=fe[1],g.ia=fe[2];const ze=fe[3];ze!=null&&(g.la=ze,g.j.info("VER="+g.la));const Ke=fe[4];Ke!=null&&(g.Aa=Ke,g.j.info("SVER="+g.Aa));const fi=fe[5];fi!=null&&typeof fi=="number"&&0<fi&&(_=1.5*fi,g.L=_,g.j.info("backChannelRequestTimeoutMs_="+_)),_=g;const mt=d.g;if(mt){const Go=mt.g?mt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Go){var b=_.h;b.g||Go.indexOf("spdy")==-1&&Go.indexOf("quic")==-1&&Go.indexOf("h2")==-1||(b.j=b.l,b.g=new Set,b.h&&(qa(b,b.h),b.h=null))}if(_.D){const Ja=mt.g?mt.g.getResponseHeader("X-HTTP-Session-Id"):null;Ja&&(_.ya=Ja,ve(_.I,_.D,Ja))}}g.G=3,g.l&&g.l.ua(),g.ba&&(g.R=Date.now()-d.F,g.j.info("Handshake RTT: "+g.R+"ms")),_=g;var G=d;if(_.qa=Yc(_,_.J?_.ia:null,_.W),G.K){Ac(_.h,G);var ye=G,Le=_.L;Le&&(ye.I=Le),ye.B&&(Ba(ye),bo(ye)),_.g=G}else Hc(_);0<g.i.length&&Oo(g)}else fe[0]!="stop"&&fe[0]!="close"||Rn(g,7);else g.G==3&&(fe[0]=="stop"||fe[0]=="close"?fe[0]=="stop"?Rn(g,7):Ha(g):fe[0]!="noop"&&g.l&&g.l.ta(fe),g.v=0)}}vr(4)}catch{}}var Zy=class{constructor(d,p){this.g=d,this.map=p}};function Ec(d){this.l=d||10,u.PerformanceNavigationTiming?(d=u.performance.getEntriesByType("navigation"),d=0<d.length&&(d[0].nextHopProtocol=="hq"||d[0].nextHopProtocol=="h2")):d=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=d?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ic(d){return d.h?!0:d.g?d.g.size>=d.j:!1}function Cc(d){return d.h?1:d.g?d.g.size:0}function $a(d,p){return d.h?d.h==p:d.g?d.g.has(p):!1}function qa(d,p){d.g?d.g.add(p):d.h=p}function Ac(d,p){d.h&&d.h==p?d.h=null:d.g&&d.g.has(p)&&d.g.delete(p)}Ec.prototype.cancel=function(){if(this.i=Sc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const d of this.g.values())d.cancel();this.g.clear()}};function Sc(d){if(d.h!=null)return d.i.concat(d.h.D);if(d.g!=null&&d.g.size!==0){let p=d.i;for(const g of d.g.values())p=p.concat(g.D);return p}return R(d.i)}function jy(d){if(d.V&&typeof d.V=="function")return d.V();if(typeof Map<"u"&&d instanceof Map||typeof Set<"u"&&d instanceof Set)return Array.from(d.values());if(typeof d=="string")return d.split("");if(c(d)){for(var p=[],g=d.length,_=0;_<g;_++)p.push(d[_]);return p}p=[],g=0;for(_ in d)p[g++]=d[_];return p}function e_(d){if(d.na&&typeof d.na=="function")return d.na();if(!d.V||typeof d.V!="function"){if(typeof Map<"u"&&d instanceof Map)return Array.from(d.keys());if(!(typeof Set<"u"&&d instanceof Set)){if(c(d)||typeof d=="string"){var p=[];d=d.length;for(var g=0;g<d;g++)p.push(g);return p}p=[],g=0;for(const _ in d)p[g++]=_;return p}}}function wc(d,p){if(d.forEach&&typeof d.forEach=="function")d.forEach(p,void 0);else if(c(d)||typeof d=="string")Array.prototype.forEach.call(d,p,void 0);else for(var g=e_(d),_=jy(d),k=_.length,b=0;b<k;b++)p.call(void 0,_[b],g&&g[b],d)}var xc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function t_(d,p){if(d){d=d.split("&");for(var g=0;g<d.length;g++){var _=d[g].indexOf("="),k=null;if(0<=_){var b=d[g].substring(0,_);k=d[g].substring(_+1)}else b=d[g];p(b,k?decodeURIComponent(k.replace(/\+/g," ")):"")}}}function xn(d){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,d instanceof xn){this.h=d.h,Do(this,d.j),this.o=d.o,this.g=d.g,No(this,d.s),this.l=d.l;var p=d.i,g=new Sr;g.i=p.i,p.g&&(g.g=new Map(p.g),g.h=p.h),Rc(this,g),this.m=d.m}else d&&(p=String(d).match(xc))?(this.h=!1,Do(this,p[1]||"",!0),this.o=Cr(p[2]||""),this.g=Cr(p[3]||"",!0),No(this,p[4]),this.l=Cr(p[5]||"",!0),Rc(this,p[6]||"",!0),this.m=Cr(p[7]||"")):(this.h=!1,this.i=new Sr(null,this.h))}xn.prototype.toString=function(){var d=[],p=this.j;p&&d.push(Ar(p,Pc,!0),":");var g=this.g;return(g||p=="file")&&(d.push("//"),(p=this.o)&&d.push(Ar(p,Pc,!0),"@"),d.push(encodeURIComponent(String(g)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.s,g!=null&&d.push(":",String(g))),(g=this.l)&&(this.g&&g.charAt(0)!="/"&&d.push("/"),d.push(Ar(g,g.charAt(0)=="/"?r_:i_,!0))),(g=this.i.toString())&&d.push("?",g),(g=this.m)&&d.push("#",Ar(g,s_)),d.join("")};function Ut(d){return new xn(d)}function Do(d,p,g){d.j=g?Cr(p,!0):p,d.j&&(d.j=d.j.replace(/:$/,""))}function No(d,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);d.s=p}else d.s=null}function Rc(d,p,g){p instanceof Sr?(d.i=p,a_(d.i,d.h)):(g||(p=Ar(p,o_)),d.i=new Sr(p,d.h))}function ve(d,p,g){d.i.set(p,g)}function Vo(d){return ve(d,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),d}function Cr(d,p){return d?p?decodeURI(d.replace(/%25/g,"%2525")):decodeURIComponent(d):""}function Ar(d,p,g){return typeof d=="string"?(d=encodeURI(d).replace(p,n_),g&&(d=d.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d):null}function n_(d){return d=d.charCodeAt(0),"%"+(d>>4&15).toString(16)+(d&15).toString(16)}var Pc=/[#\/\?@]/g,i_=/[#\?:]/g,r_=/[#\?]/g,o_=/[#\?@]/g,s_=/#/g;function Sr(d,p){this.h=this.g=null,this.i=d||null,this.j=!!p}function en(d){d.g||(d.g=new Map,d.h=0,d.i&&t_(d.i,function(p,g){d.add(decodeURIComponent(p.replace(/\+/g," ")),g)}))}n=Sr.prototype,n.add=function(d,p){en(this),this.i=null,d=ci(this,d);var g=this.g.get(d);return g||this.g.set(d,g=[]),g.push(p),this.h+=1,this};function kc(d,p){en(d),p=ci(d,p),d.g.has(p)&&(d.i=null,d.h-=d.g.get(p).length,d.g.delete(p))}function Mc(d,p){return en(d),p=ci(d,p),d.g.has(p)}n.forEach=function(d,p){en(this),this.g.forEach(function(g,_){g.forEach(function(k){d.call(p,k,_,this)},this)},this)},n.na=function(){en(this);const d=Array.from(this.g.values()),p=Array.from(this.g.keys()),g=[];for(let _=0;_<p.length;_++){const k=d[_];for(let b=0;b<k.length;b++)g.push(p[_])}return g},n.V=function(d){en(this);let p=[];if(typeof d=="string")Mc(this,d)&&(p=p.concat(this.g.get(ci(this,d))));else{d=Array.from(this.g.values());for(let g=0;g<d.length;g++)p=p.concat(d[g])}return p},n.set=function(d,p){return en(this),this.i=null,d=ci(this,d),Mc(this,d)&&(this.h-=this.g.get(d).length),this.g.set(d,[p]),this.h+=1,this},n.get=function(d,p){return d?(d=this.V(d),0<d.length?String(d[0]):p):p};function bc(d,p,g){kc(d,p),0<g.length&&(d.i=null,d.g.set(ci(d,p),R(g)),d.h+=g.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const d=[],p=Array.from(this.g.keys());for(var g=0;g<p.length;g++){var _=p[g];const b=encodeURIComponent(String(_)),G=this.V(_);for(_=0;_<G.length;_++){var k=b;G[_]!==""&&(k+="="+encodeURIComponent(String(G[_]))),d.push(k)}}return this.i=d.join("&")};function ci(d,p){return p=String(p),d.j&&(p=p.toLowerCase()),p}function a_(d,p){p&&!d.j&&(en(d),d.i=null,d.g.forEach(function(g,_){var k=_.toLowerCase();_!=k&&(kc(this,_),bc(this,k,g))},d)),d.j=p}function l_(d,p){const g=new Er;if(u.Image){const _=new Image;_.onload=v(tn,g,"TestLoadImage: loaded",!0,p,_),_.onerror=v(tn,g,"TestLoadImage: error",!1,p,_),_.onabort=v(tn,g,"TestLoadImage: abort",!1,p,_),_.ontimeout=v(tn,g,"TestLoadImage: timeout",!1,p,_),u.setTimeout(function(){_.ontimeout&&_.ontimeout()},1e4),_.src=d}else p(!1)}function u_(d,p){const g=new Er,_=new AbortController,k=setTimeout(()=>{_.abort(),tn(g,"TestPingServer: timeout",!1,p)},1e4);fetch(d,{signal:_.signal}).then(b=>{clearTimeout(k),b.ok?tn(g,"TestPingServer: ok",!0,p):tn(g,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(k),tn(g,"TestPingServer: error",!1,p)})}function tn(d,p,g,_,k){try{k&&(k.onload=null,k.onerror=null,k.onabort=null,k.ontimeout=null),_(g)}catch{}}function c_(){this.g=new Ky}function d_(d,p,g){const _=g||"";try{wc(d,function(k,b){let G=k;f(k)&&(G=ba(k)),p.push(_+b+"="+encodeURIComponent(G))})}catch(k){throw p.push(_+"type="+encodeURIComponent("_badmap")),k}}function Lo(d){this.l=d.Ub||null,this.j=d.eb||!1}x(Lo,Da),Lo.prototype.g=function(){return new Fo(this.l,this.j)},Lo.prototype.i=function(d){return function(){return d}}({});function Fo(d,p){He.call(this),this.D=d,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}x(Fo,He),n=Fo.prototype,n.open=function(d,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=d,this.A=p,this.readyState=1,xr(this)},n.send=function(d){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};d&&(p.body=d),(this.D||u).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,wr(this)),this.readyState=0},n.Sa=function(d){if(this.g&&(this.l=d,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=d.headers,this.readyState=2,xr(this)),this.g&&(this.readyState=3,xr(this),this.g)))if(this.responseType==="arraybuffer")d.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in d){if(this.j=d.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Dc(this)}else d.text().then(this.Ra.bind(this),this.ga.bind(this))};function Dc(d){d.j.read().then(d.Pa.bind(d)).catch(d.ga.bind(d))}n.Pa=function(d){if(this.g){if(this.o&&d.value)this.response.push(d.value);else if(!this.o){var p=d.value?d.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!d.done}))&&(this.response=this.responseText+=p)}d.done?wr(this):xr(this),this.readyState==3&&Dc(this)}},n.Ra=function(d){this.g&&(this.response=this.responseText=d,wr(this))},n.Qa=function(d){this.g&&(this.response=d,wr(this))},n.ga=function(){this.g&&wr(this)};function wr(d){d.readyState=4,d.l=null,d.j=null,d.v=null,xr(d)}n.setRequestHeader=function(d,p){this.u.append(d,p)},n.getResponseHeader=function(d){return this.h&&this.h.get(d.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const d=[],p=this.h.entries();for(var g=p.next();!g.done;)g=g.value,d.push(g[0]+": "+g[1]),g=p.next();return d.join(`\r
`)};function xr(d){d.onreadystatechange&&d.onreadystatechange.call(d)}Object.defineProperty(Fo.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(d){this.m=d?"include":"same-origin"}});function Nc(d){let p="";return q(d,function(g,_){p+=_,p+=":",p+=g,p+=`\r
`}),p}function Ga(d,p,g){e:{for(_ in g){var _=!1;break e}_=!0}_||(g=Nc(g),typeof d=="string"?g!=null&&encodeURIComponent(String(g)):ve(d,p,g))}function Ae(d){He.call(this),this.headers=new Map,this.o=d||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}x(Ae,He);var f_=/^https?$/i,h_=["POST","PUT"];n=Ae.prototype,n.Ha=function(d){this.J=d},n.ea=function(d,p,g,_){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+d);p=p?p.toUpperCase():"GET",this.D=d,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():La.g(),this.v=this.o?uc(this.o):uc(La),this.g.onreadystatechange=y(this.Ea,this);try{this.B=!0,this.g.open(p,String(d),!0),this.B=!1}catch(b){Vc(this,b);return}if(d=g||"",g=new Map(this.headers),_)if(Object.getPrototypeOf(_)===Object.prototype)for(var k in _)g.set(k,_[k]);else if(typeof _.keys=="function"&&typeof _.get=="function")for(const b of _.keys())g.set(b,_.get(b));else throw Error("Unknown input type for opt_headers: "+String(_));_=Array.from(g.keys()).find(b=>b.toLowerCase()=="content-type"),k=u.FormData&&d instanceof u.FormData,!(0<=Array.prototype.indexOf.call(h_,p,void 0))||_||k||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[b,G]of g)this.g.setRequestHeader(b,G);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Uc(this),this.u=!0,this.g.send(d),this.u=!1}catch(b){Vc(this,b)}};function Vc(d,p){d.h=!1,d.g&&(d.j=!0,d.g.abort(),d.j=!1),d.l=p,d.m=5,Lc(d),Uo(d)}function Lc(d){d.A||(d.A=!0,Qe(d,"complete"),Qe(d,"error"))}n.abort=function(d){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=d||7,Qe(this,"complete"),Qe(this,"abort"),Uo(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Uo(this,!0)),Ae.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Fc(this):this.bb())},n.bb=function(){Fc(this)};function Fc(d){if(d.h&&typeof s<"u"&&(!d.v[1]||Bt(d)!=4||d.Z()!=2)){if(d.u&&Bt(d)==4)oc(d.Ea,0,d);else if(Qe(d,"readystatechange"),Bt(d)==4){d.h=!1;try{const G=d.Z();e:switch(G){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var g;if(!(g=p)){var _;if(_=G===0){var k=String(d.D).match(xc)[1]||null;!k&&u.self&&u.self.location&&(k=u.self.location.protocol.slice(0,-1)),_=!f_.test(k?k.toLowerCase():"")}g=_}if(g)Qe(d,"complete"),Qe(d,"success");else{d.m=6;try{var b=2<Bt(d)?d.g.statusText:""}catch{b=""}d.l=b+" ["+d.Z()+"]",Lc(d)}}finally{Uo(d)}}}}function Uo(d,p){if(d.g){Uc(d);const g=d.g,_=d.v[0]?()=>{}:null;d.g=null,d.v=null,p||Qe(d,"ready");try{g.onreadystatechange=_}catch{}}}function Uc(d){d.I&&(u.clearTimeout(d.I),d.I=null)}n.isActive=function(){return!!this.g};function Bt(d){return d.g?d.g.readyState:0}n.Z=function(){try{return 2<Bt(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(d){if(this.g){var p=this.g.responseText;return d&&p.indexOf(d)==0&&(p=p.substring(d.length)),zy(p)}};function Bc(d){try{if(!d.g)return null;if("response"in d.g)return d.g.response;switch(d.H){case"":case"text":return d.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in d.g)return d.g.mozResponseArrayBuffer}return null}catch{return null}}function p_(d){const p={};d=(d.g&&2<=Bt(d)&&d.g.getAllResponseHeaders()||"").split(`\r
`);for(let _=0;_<d.length;_++){if(V(d[_]))continue;var g=C(d[_]);const k=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();const b=p[k]||[];p[k]=b,b.push(g)}I(p,function(_){return _.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Rr(d,p,g){return g&&g.internalChannelParams&&g.internalChannelParams[d]||p}function Oc(d){this.Aa=0,this.i=[],this.j=new Er,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Rr("failFast",!1,d),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Rr("baseRetryDelayMs",5e3,d),this.cb=Rr("retryDelaySeedMs",1e4,d),this.Wa=Rr("forwardChannelMaxRetries",2,d),this.wa=Rr("forwardChannelRequestTimeoutMs",2e4,d),this.pa=d&&d.xmlHttpFactory||void 0,this.Xa=d&&d.Tb||void 0,this.Ca=d&&d.useFetchStreams||!1,this.L=void 0,this.J=d&&d.supportsCrossDomainXhr||!1,this.K="",this.h=new Ec(d&&d.concurrentRequestLimit),this.Da=new c_,this.P=d&&d.fastHandshake||!1,this.O=d&&d.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=d&&d.Rb||!1,d&&d.xa&&this.j.xa(),d&&d.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&d&&d.detectBufferingProxy||!1,this.ja=void 0,d&&d.longPollingTimeout&&0<d.longPollingTimeout&&(this.ja=d.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Oc.prototype,n.la=8,n.G=1,n.connect=function(d,p,g,_){Ze(0),this.W=d,this.H=p||{},g&&_!==void 0&&(this.H.OSID=g,this.H.OAID=_),this.F=this.X,this.I=Yc(this,null,this.W),Oo(this)};function Ha(d){if($c(d),d.G==3){var p=d.U++,g=Ut(d.I);if(ve(g,"SID",d.K),ve(g,"RID",p),ve(g,"TYPE","terminate"),Pr(d,g),p=new jt(d,d.j,p),p.L=2,p.v=Vo(Ut(g)),g=!1,u.navigator&&u.navigator.sendBeacon)try{g=u.navigator.sendBeacon(p.v.toString(),"")}catch{}!g&&u.Image&&(new Image().src=p.v,g=!0),g||(p.g=Xc(p.j,null),p.g.ea(p.v)),p.F=Date.now(),bo(p)}Wc(d)}function Bo(d){d.g&&(Ka(d),d.g.cancel(),d.g=null)}function $c(d){Bo(d),d.u&&(u.clearTimeout(d.u),d.u=null),$o(d),d.h.cancel(),d.s&&(typeof d.s=="number"&&u.clearTimeout(d.s),d.s=null)}function Oo(d){if(!Ic(d.h)&&!d.s){d.s=!0;var p=d.Ga;pr||ec(),mr||(pr(),mr=!0),Aa.add(p,d),d.B=0}}function m_(d,p){return Cc(d.h)>=d.h.j-(d.s?1:0)?!1:d.s?(d.i=p.D.concat(d.i),!0):d.G==1||d.G==2||d.B>=(d.Va?0:d.Wa)?!1:(d.s=Tr(y(d.Ga,d,p),Jc(d,d.B)),d.B++,!0)}n.Ga=function(d){if(this.s)if(this.s=null,this.G==1){if(!d){this.U=Math.floor(1e5*Math.random()),d=this.U++;const k=new jt(this,this.j,d);let b=this.o;if(this.S&&(b?(b=T(b),w(b,this.S)):b=this.S),this.m!==null||this.O||(k.H=b,b=null),this.P)e:{for(var p=0,g=0;g<this.i.length;g++){t:{var _=this.i[g];if("__data__"in _.map&&(_=_.map.__data__,typeof _=="string")){_=_.length;break t}_=void 0}if(_===void 0)break;if(p+=_,4096<p){p=g;break e}if(p===4096||g===this.i.length-1){p=g+1;break e}}p=1e3}else p=1e3;p=Gc(this,k,p),g=Ut(this.I),ve(g,"RID",d),ve(g,"CVER",22),this.D&&ve(g,"X-HTTP-Session-Id",this.D),Pr(this,g),b&&(this.O?p="headers="+encodeURIComponent(String(Nc(b)))+"&"+p:this.m&&Ga(g,this.m,b)),qa(this.h,k),this.Ua&&ve(g,"TYPE","init"),this.P?(ve(g,"$req",p),ve(g,"SID","null"),k.T=!0,Ua(k,g,null)):Ua(k,g,p),this.G=2}}else this.G==3&&(d?qc(this,d):this.i.length==0||Ic(this.h)||qc(this))};function qc(d,p){var g;p?g=p.l:g=d.U++;const _=Ut(d.I);ve(_,"SID",d.K),ve(_,"RID",g),ve(_,"AID",d.T),Pr(d,_),d.m&&d.o&&Ga(_,d.m,d.o),g=new jt(d,d.j,g,d.B+1),d.m===null&&(g.H=d.o),p&&(d.i=p.D.concat(d.i)),p=Gc(d,g,1e3),g.I=Math.round(.5*d.wa)+Math.round(.5*d.wa*Math.random()),qa(d.h,g),Ua(g,_,p)}function Pr(d,p){d.H&&q(d.H,function(g,_){ve(p,_,g)}),d.l&&wc({},function(g,_){ve(p,_,g)})}function Gc(d,p,g){g=Math.min(d.i.length,g);var _=d.l?y(d.l.Na,d.l,d):null;e:{var k=d.i;let b=-1;for(;;){const G=["count="+g];b==-1?0<g?(b=k[0].g,G.push("ofs="+b)):b=0:G.push("ofs="+b);let ye=!0;for(let Le=0;Le<g;Le++){let fe=k[Le].g;const ze=k[Le].map;if(fe-=b,0>fe)b=Math.max(0,k[Le].g-100),ye=!1;else try{d_(ze,G,"req"+fe+"_")}catch{_&&_(ze)}}if(ye){_=G.join("&");break e}}}return d=d.i.splice(0,g),p.D=d,_}function Hc(d){if(!d.g&&!d.u){d.Y=1;var p=d.Fa;pr||ec(),mr||(pr(),mr=!0),Aa.add(p,d),d.v=0}}function za(d){return d.g||d.u||3<=d.v?!1:(d.Y++,d.u=Tr(y(d.Fa,d),Jc(d,d.v)),d.v++,!0)}n.Fa=function(){if(this.u=null,zc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var d=2*this.R;this.j.info("BP detection timer enabled: "+d),this.A=Tr(y(this.ab,this),d)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ze(10),Bo(this),zc(this))};function Ka(d){d.A!=null&&(u.clearTimeout(d.A),d.A=null)}function zc(d){d.g=new jt(d,d.j,"rpc",d.Y),d.m===null&&(d.g.H=d.o),d.g.O=0;var p=Ut(d.qa);ve(p,"RID","rpc"),ve(p,"SID",d.K),ve(p,"AID",d.T),ve(p,"CI",d.F?"0":"1"),!d.F&&d.ja&&ve(p,"TO",d.ja),ve(p,"TYPE","xmlhttp"),Pr(d,p),d.m&&d.o&&Ga(p,d.m,d.o),d.L&&(d.g.I=d.L);var g=d.g;d=d.ia,g.L=1,g.v=Vo(Ut(p)),g.m=null,g.P=!0,_c(g,d)}n.Za=function(){this.C!=null&&(this.C=null,Bo(this),za(this),Ze(19))};function $o(d){d.C!=null&&(u.clearTimeout(d.C),d.C=null)}function Kc(d,p){var g=null;if(d.g==p){$o(d),Ka(d),d.g=null;var _=2}else if($a(d.h,p))g=p.D,Ac(d.h,p),_=1;else return;if(d.G!=0){if(p.o)if(_==1){g=p.m?p.m.length:0,p=Date.now()-p.F;var k=d.B;_=Po(),Qe(_,new pc(_,g)),Oo(d)}else Hc(d);else if(k=p.s,k==3||k==0&&0<p.X||!(_==1&&m_(d,p)||_==2&&za(d)))switch(g&&0<g.length&&(p=d.h,p.i=p.i.concat(g)),k){case 1:Rn(d,5);break;case 4:Rn(d,10);break;case 3:Rn(d,6);break;default:Rn(d,2)}}}function Jc(d,p){let g=d.Ta+Math.floor(Math.random()*d.cb);return d.isActive()||(g*=2),g*p}function Rn(d,p){if(d.j.info("Error code "+p),p==2){var g=y(d.fb,d),_=d.Xa;const k=!_;_=new xn(_||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||Do(_,"https"),Vo(_),k?l_(_.toString(),g):u_(_.toString(),g)}else Ze(2);d.G=0,d.l&&d.l.sa(p),Wc(d),$c(d)}n.fb=function(d){d?(this.j.info("Successfully pinged google.com"),Ze(2)):(this.j.info("Failed to ping google.com"),Ze(1))};function Wc(d){if(d.G=0,d.ka=[],d.l){const p=Sc(d.h);(p.length!=0||d.i.length!=0)&&(D(d.ka,p),D(d.ka,d.i),d.h.i.length=0,R(d.i),d.i.length=0),d.l.ra()}}function Yc(d,p,g){var _=g instanceof xn?Ut(g):new xn(g);if(_.g!="")p&&(_.g=p+"."+_.g),No(_,_.s);else{var k=u.location;_=k.protocol,p=p?p+"."+k.hostname:k.hostname,k=+k.port;var b=new xn(null);_&&Do(b,_),p&&(b.g=p),k&&No(b,k),g&&(b.l=g),_=b}return g=d.D,p=d.ya,g&&p&&ve(_,g,p),ve(_,"VER",d.la),Pr(d,_),_}function Xc(d,p,g){if(p&&!d.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=d.Ca&&!d.pa?new Ae(new Lo({eb:g})):new Ae(d.pa),p.Ha(d.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Qc(){}n=Qc.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function qo(){}qo.prototype.g=function(d,p){return new st(d,p)};function st(d,p){He.call(this),this.g=new Oc(p),this.l=d,this.h=p&&p.messageUrlParams||null,d=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(d?d["X-Client-Protocol"]="webchannel":d={"X-Client-Protocol":"webchannel"}),this.g.o=d,d=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(d?d["X-WebChannel-Content-Type"]=p.messageContentType:d={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(d?d["X-WebChannel-Client-Profile"]=p.va:d={"X-WebChannel-Client-Profile":p.va}),this.g.S=d,(d=p&&p.Sb)&&!V(d)&&(this.g.m=d),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!V(p)&&(this.g.D=p,d=this.h,d!==null&&p in d&&(d=this.h,p in d&&delete d[p])),this.j=new di(this)}x(st,He),st.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},st.prototype.close=function(){Ha(this.g)},st.prototype.o=function(d){var p=this.g;if(typeof d=="string"){var g={};g.__data__=d,d=g}else this.u&&(g={},g.__data__=ba(d),d=g);p.i.push(new Zy(p.Ya++,d)),p.G==3&&Oo(p)},st.prototype.N=function(){this.g.l=null,delete this.j,Ha(this.g),delete this.g,st.aa.N.call(this)};function Zc(d){Na.call(this),d.__headers__&&(this.headers=d.__headers__,this.statusCode=d.__status__,delete d.__headers__,delete d.__status__);var p=d.__sm__;if(p){e:{for(const g in p){d=g;break e}d=void 0}(this.i=d)&&(d=this.i,p=p!==null&&d in p?p[d]:void 0),this.data=p}else this.data=d}x(Zc,Na);function jc(){Va.call(this),this.status=1}x(jc,Va);function di(d){this.g=d}x(di,Qc),di.prototype.ua=function(){Qe(this.g,"a")},di.prototype.ta=function(d){Qe(this.g,new Zc(d))},di.prototype.sa=function(d){Qe(this.g,new jc)},di.prototype.ra=function(){Qe(this.g,"b")},qo.prototype.createWebChannel=qo.prototype.g,st.prototype.send=st.prototype.o,st.prototype.open=st.prototype.m,st.prototype.close=st.prototype.close,Am=function(){return new qo},Cm=function(){return Po()},Im=Sn,Tl={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ko.NO_ERROR=0,ko.TIMEOUT=8,ko.HTTP_ERROR=6,rs=ko,mc.COMPLETE="complete",Em=mc,cc.EventType=_r,_r.OPEN="a",_r.CLOSE="b",_r.ERROR="c",_r.MESSAGE="d",He.prototype.listen=He.prototype.K,Fr=cc,Ae.prototype.listenOnce=Ae.prototype.L,Ae.prototype.getLastError=Ae.prototype.Ka,Ae.prototype.getLastErrorCode=Ae.prototype.Ba,Ae.prototype.getStatus=Ae.prototype.Z,Ae.prototype.getResponseJson=Ae.prototype.Oa,Ae.prototype.getResponseText=Ae.prototype.oa,Ae.prototype.send=Ae.prototype.ea,Ae.prototype.setWithCredentials=Ae.prototype.Ha,Tm=Ae}).apply(typeof zo<"u"?zo:typeof self<"u"?self:typeof window<"u"?window:{});const Md="@firebase/firestore",bd="4.7.17";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fe{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Fe.UNAUTHENTICATED=new Fe(null),Fe.GOOGLE_CREDENTIALS=new Fe("google-credentials-uid"),Fe.FIRST_PARTY=new Fe("first-party-uid"),Fe.MOCK_USER=new Fe("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ar="11.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qn=new cu("@firebase/firestore");function Ti(){return Qn.logLevel}function H(n,...e){if(Qn.logLevel<=oe.DEBUG){const t=e.map(Au);Qn.debug(`Firestore (${ar}): ${n}`,...t)}}function lt(n,...e){if(Qn.logLevel<=oe.ERROR){const t=e.map(Au);Qn.error(`Firestore (${ar}): ${n}`,...t)}}function ea(n,...e){if(Qn.logLevel<=oe.WARN){const t=e.map(Au);Qn.warn(`Firestore (${ar}): ${n}`,...t)}}function Au(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X(n,e,t){let i="Unexpected state";typeof e=="string"?i=e:t=e,Sm(n,i,t)}function Sm(n,e,t){let i=`FIRESTORE (${ar}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{i+=" CONTEXT: "+JSON.stringify(t)}catch{i+=" CONTEXT: "+t}throw lt(i),new Error(i)}function Q(n,e,t,i){let r="Unexpected state";typeof t=="string"?r=t:i=t,n||Sm(e,r,i)}function Ee(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Z extends Yt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wm{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class jE{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Fe.UNAUTHENTICATED))}shutdown(){}}class eI{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class tI{constructor(e){this.t=e,this.currentUser=Fe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Q(this.o===void 0,42304);let i=this.i;const r=c=>this.i!==i?(i=this.i,t(c)):Promise.resolve();let o=new qn;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new qn,e.enqueueRetryable(()=>r(this.currentUser))};const s=()=>{const c=o;e.enqueueRetryable(async()=>{await c.promise,await r(this.currentUser)})},u=c=>{H("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(H("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new qn)}},0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(H("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(Q(typeof i.accessToken=="string",31837,{l:i}),new wm(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Q(e===null||typeof e=="string",2055,{h:e}),new Fe(e)}}class nI{constructor(e,t,i){this.P=e,this.T=t,this.I=i,this.type="FirstParty",this.user=Fe.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class iI{constructor(e,t,i){this.P=e,this.T=t,this.I=i}getToken(){return Promise.resolve(new nI(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Fe.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Dd{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rI{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,St(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Q(this.o===void 0,3512);const i=o=>{o.error!=null&&H("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const s=o.token!==this.m;return this.m=o.token,H("FirebaseAppCheckTokenProvider",`Received ${s?"new":"existing"} token.`),s?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>i(o))};const r=o=>{H("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(o=>r(o)),setTimeout(()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?r(o):H("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Dd(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Q(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Dd(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oI(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sI(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aI{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let i="";for(;i.length<20;){const r=oI(40);for(let o=0;o<r.length;++o)i.length<20&&r[o]<t&&(i+=e.charAt(r[o]%62))}return i}}function re(n,e){return n<e?-1:n>e?1:0}function El(n,e){let t=0;for(;t<n.length&&t<e.length;){const i=n.codePointAt(t),r=e.codePointAt(t);if(i!==r){if(i<128&&r<128)return re(i,r);{const o=sI(),s=lI(o.encode(Nd(n,t)),o.encode(Nd(e,t)));return s!==0?s:re(i,r)}}t+=i>65535?2:1}return re(n.length,e.length)}function Nd(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function lI(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return re(n[t],e[t]);return re(n.length,e.length)}function Li(n,e,t){return n.length===e.length&&n.every((i,r)=>t(i,e[r]))}function xm(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vd=-62135596800,Ld=1e6;class qe{static now(){return qe.fromMillis(Date.now())}static fromDate(e){return qe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor((e-1e3*t)*Ld);return new qe(t,i)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Z(B.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Z(B.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Vd)throw new Z(B.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Z(B.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Ld}_compareTo(e){return this.seconds===e.seconds?re(this.nanoseconds,e.nanoseconds):re(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-Vd;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ue{static fromTimestamp(e){return new ue(e)}static min(){return new ue(new qe(0,0))}static max(){return new ue(new qe(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fd="__name__";class At{constructor(e,t,i){t===void 0?t=0:t>e.length&&X(637,{offset:t,range:e.length}),i===void 0?i=e.length-t:i>e.length-t&&X(1746,{length:i,range:e.length-t}),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return At.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof At?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let r=0;r<i;r++){const o=At.compareSegments(e.get(r),t.get(r));if(o!==0)return o}return re(e.length,t.length)}static compareSegments(e,t){const i=At.isNumericId(e),r=At.isNumericId(t);return i&&!r?-1:!i&&r?1:i&&r?At.extractNumericId(e).compare(At.extractNumericId(t)):El(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Cu.fromString(e.substring(4,e.length-2))}}class Ce extends At{construct(e,t,i){return new Ce(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new Z(B.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(r=>r.length>0))}return new Ce(t)}static emptyPath(){return new Ce([])}}const uI=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Me extends At{construct(e,t,i){return new Me(e,t,i)}static isValidIdentifier(e){return uI.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Me.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Fd}static keyField(){return new Me([Fd])}static fromServerFormat(e){const t=[];let i="",r=0;const o=()=>{if(i.length===0)throw new Z(B.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let s=!1;for(;r<e.length;){const u=e[r];if(u==="\\"){if(r+1===e.length)throw new Z(B.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[r+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new Z(B.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=c,r+=2}else u==="`"?(s=!s,r++):u!=="."||s?(i+=u,r++):(o(),r++)}if(o(),s)throw new Z(B.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Me(t)}static emptyPath(){return new Me([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W{constructor(e){this.path=e}static fromPath(e){return new W(Ce.fromString(e))}static fromName(e){return new W(Ce.fromString(e).popFirst(5))}static empty(){return new W(Ce.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ce.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ce.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new W(new Ce(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const no=-1;class As{constructor(e,t,i,r){this.indexId=e,this.collectionGroup=t,this.fields=i,this.indexState=r}}function Il(n){return n.fields.find(e=>e.kind===2)}function bn(n){return n.fields.filter(e=>e.kind!==2)}As.UNKNOWN_ID=-1;class os{constructor(e,t){this.fieldPath=e,this.kind=t}}class io{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new io(0,ut.min())}}function cI(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=ue.fromTimestamp(i===1e9?new qe(t+1,0):new qe(t,i));return new ut(r,W.empty(),e)}function Rm(n){return new ut(n.readTime,n.key,no)}class ut{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new ut(ue.min(),W.empty(),no)}static max(){return new ut(ue.max(),W.empty(),no)}}function Su(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=W.comparator(n.documentKey,e.documentKey),t!==0?t:re(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pm="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class km{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ta(n){if(n.code!==B.FAILED_PRECONDITION||n.message!==Pm)throw n;H("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&X(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new M((i,r)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(i,r)},this.catchCallback=o=>{this.wrapFailure(t,o).next(i,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof M?t:M.resolve(t)}catch(t){return M.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):M.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):M.reject(t)}static resolve(e){return new M((t,i)=>{t(e)})}static reject(e){return new M((t,i)=>{i(e)})}static waitFor(e){return new M((t,i)=>{let r=0,o=0,s=!1;e.forEach(u=>{++r,u.next(()=>{++o,s&&o===r&&t()},c=>i(c))}),s=!0,o===r&&t()})}static or(e){let t=M.resolve(!1);for(const i of e)t=t.next(r=>r?M.resolve(r):i());return t}static forEach(e,t){const i=[];return e.forEach((r,o)=>{i.push(t.call(this,r,o))}),this.waitFor(i)}static mapArray(e,t){return new M((i,r)=>{const o=e.length,s=new Array(o);let u=0;for(let c=0;c<o;c++){const f=c;t(e[f]).next(h=>{s[f]=h,++u,u===o&&i(s)},h=>r(h))}})}static doWhile(e,t){return new M((i,r)=>{const o=()=>{e()===!0?t().next(()=>{o()},r):i()};o()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const at="SimpleDb";class na{static open(e,t,i,r){try{return new na(t,e.transaction(r,i))}catch(o){throw new Gr(t,o)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new qn,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Gr(e,t.error)):this.S.resolve()},this.transaction.onerror=i=>{const r=wu(i.target.error);this.S.reject(new Gr(e,r))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(H(at,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new fI(t)}}class _n{static delete(e){return H(at,"Removing database:",e),Nn(xp().indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!Lp())return!1;if(_n.F())return!0;const e=be(),t=_n.M(e),i=0<t&&t<10,r=Mm(e),o=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||i||o)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.O)==="YES"}static N(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),i=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(i)}constructor(e,t,i){this.name=e,this.version=t,this.B=i,this.L=null,_n.M(be())===12.2&&lt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async k(e){return this.db||(H(at,"Opening database:",this.name),this.db=await new Promise((t,i)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=o=>{const s=o.target.result;t(s)},r.onblocked=()=>{i(new Gr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=o=>{const s=o.target.error;s.name==="VersionError"?i(new Z(B.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):s.name==="InvalidStateError"?i(new Z(B.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+s)):i(new Gr(e,s))},r.onupgradeneeded=o=>{H(at,'Database "'+this.name+'" requires upgrade from version:',o.oldVersion);const s=o.target.result;if(this.L!==null&&this.L!==o.oldVersion)throw new Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${o.oldVersion}, event.newVersion=${o.newVersion}, db.version=${s.version}`);this.B.q(s,r.transaction,o.oldVersion,this.version).next(()=>{H(at,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",t=>{const i=t.target;this.L=i.version},{passive:!0})),this.$&&(this.db.onversionchange=t=>this.$(t)),this.db}U(e){this.$=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,i,r){const o=t==="readonly";let s=0;for(;;){++s;try{this.db=await this.k(e);const u=na.open(this.db,e,o?"readonly":"readwrite",i),c=r(u).next(f=>(u.v(),f)).catch(f=>(u.abort(f),M.reject(f))).toPromise();return c.catch(()=>{}),await u.D,c}catch(u){const c=u,f=c.name!=="FirebaseError"&&s<3;if(H(at,"Transaction failed with error:",c.message,"Retrying:",f),this.close(),!f)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}function Mm(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class dI{constructor(e){this.K=e,this.W=!1,this.G=null}get isDone(){return this.W}get j(){return this.G}set cursor(e){this.K=e}done(){this.W=!0}H(e){this.G=e}delete(){return Nn(this.K.delete())}}class Gr extends Z{constructor(e,t){super(B.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ai(n){return n.name==="IndexedDbTransactionError"}class fI{constructor(e){this.store=e}put(e,t){let i;return t!==void 0?(H(at,"PUT",this.store.name,e,t),i=this.store.put(t,e)):(H(at,"PUT",this.store.name,"<auto-key>",e),i=this.store.put(e)),Nn(i)}add(e){return H(at,"ADD",this.store.name,e,e),Nn(this.store.add(e))}get(e){return Nn(this.store.get(e)).next(t=>(t===void 0&&(t=null),H(at,"GET",this.store.name,e,t),t))}delete(e){return H(at,"DELETE",this.store.name,e),Nn(this.store.delete(e))}count(){return H(at,"COUNT",this.store.name),Nn(this.store.count())}J(e,t){const i=this.options(e,t),r=i.index?this.store.index(i.index):this.store;if(typeof r.getAll=="function"){const o=r.getAll(i.range);return new M((s,u)=>{o.onerror=c=>{u(c.target.error)},o.onsuccess=c=>{s(c.target.result)}})}{const o=this.cursor(i),s=[];return this.Y(o,(u,c)=>{s.push(c)}).next(()=>s)}}Z(e,t){const i=this.store.getAll(e,t===null?void 0:t);return new M((r,o)=>{i.onerror=s=>{o(s.target.error)},i.onsuccess=s=>{r(s.target.result)}})}X(e,t){H(at,"DELETE ALL",this.store.name);const i=this.options(e,t);i.ee=!1;const r=this.cursor(i);return this.Y(r,(o,s,u)=>u.delete())}te(e,t){let i;t?i=e:(i={},t=e);const r=this.cursor(i);return this.Y(r,t)}ne(e){const t=this.cursor({});return new M((i,r)=>{t.onerror=o=>{const s=wu(o.target.error);r(s)},t.onsuccess=o=>{const s=o.target.result;s?e(s.primaryKey,s.value).next(u=>{u?s.continue():i()}):i()}})}Y(e,t){const i=[];return new M((r,o)=>{e.onerror=s=>{o(s.target.error)},e.onsuccess=s=>{const u=s.target.result;if(!u)return void r();const c=new dI(u),f=t(u.primaryKey,u.value,c);if(f instanceof M){const h=f.catch(m=>(c.done(),M.reject(m)));i.push(h)}c.isDone?r():c.j===null?u.continue():u.continue(c.j)}}).next(()=>M.waitFor(i))}options(e,t){let i;return e!==void 0&&(typeof e=="string"?i=e:t=e),{index:i,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const i=this.store.index(e.index);return e.ee?i.openKeyCursor(e.range,t):i.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Nn(n){return new M((e,t)=>{n.onsuccess=i=>{const r=i.target.result;e(r)},n.onerror=i=>{const r=wu(i.target.error);t(r)}})}let Ud=!1;function wu(n){const e=_n.M(be());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const i=new Z("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Ud||(Ud=!0,setTimeout(()=>{throw i},0)),i}}return n}const Hr="IndexBackfiller";class hI{constructor(e,t){this.asyncQueue=e,this.re=t,this.task=null}start(){this.ie(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ie(e){H(Hr,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const t=await this.re.se();H(Hr,`Documents written: ${t}`)}catch(t){ai(t)?H(Hr,"Ignoring IndexedDB error during index backfill: ",t):await ta(t)}await this.ie(6e4)})}}class pI{constructor(e,t){this.localStore=e,this.persistence=t}async se(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.oe(t,e))}oe(e,t){const i=new Set;let r=t,o=!0;return M.doWhile(()=>o===!0&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(s=>{if(s!==null&&!i.has(s))return H(Hr,`Processing collection: ${s}`),this._e(e,s,r).next(u=>{r-=u,i.add(s)});o=!1})).next(()=>t-r)}_e(e,t,i){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,i).next(o=>{const s=o.changes;return this.localStore.indexManager.updateIndexEntries(e,s).next(()=>this.ae(r,o)).next(u=>(H(Hr,`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,t,u))).next(()=>s.size)}))}ae(e,t){let i=e;return t.changes.forEach((r,o)=>{const s=Rm(o);Su(s,i)>0&&(i=s)}),new ut(i.readTime,i.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=i=>this.ue(i),this.ce=i=>t.writeSequenceNumber(i))}ue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ce&&this.ce(e),e}}Tt.le=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gn=-1;function ia(n){return n==null}function Ss(n){return n===0&&1/n==-1/0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ws="";function tt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Bd(e)),e=mI(n.get(t),e);return Bd(e)}function mI(n,e){let t=e;const i=n.length;for(let r=0;r<i;r++){const o=n.charAt(r);switch(o){case"\0":t+="";break;case ws:t+="";break;default:t+=o}}return t}function Bd(n){return n+ws+""}function wt(n){const e=n.length;if(Q(e>=2,64408,{path:n}),e===2)return Q(n.charAt(0)===ws&&n.charAt(1)==="",56145,{path:n}),Ce.emptyPath();const t=e-2,i=[];let r="";for(let o=0;o<e;){const s=n.indexOf(ws,o);switch((s<0||s>t)&&X(50515,{path:n}),n.charAt(s+1)){case"":const u=n.substring(o,s);let c;r.length===0?c=u:(r+=u,c=r,r=""),i.push(c);break;case"":r+=n.substring(o,s),r+="\0";break;case"":r+=n.substring(o,s+1);break;default:X(61167,{path:n})}o=s+2}return new Ce(i)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dn="remoteDocuments",Eo="owner",hi="owner",ro="mutationQueues",gI="userId",gt="mutations",Od="batchId",Bn="userMutationsIndex",$d=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ss(n,e){return[n,tt(e)]}function bm(n,e,t){return[n,tt(e),t]}const yI={},Fi="documentMutations",xs="remoteDocumentsV14",_I=["prefixPath","collectionGroup","readTime","documentId"],as="documentKeyIndex",vI=["prefixPath","collectionGroup","documentId"],Dm="collectionGroupIndex",TI=["collectionGroup","readTime","prefixPath","documentId"],oo="remoteDocumentGlobal",Cl="remoteDocumentGlobalKey",Ui="targets",Nm="queryTargetsIndex",EI=["canonicalId","targetId"],Bi="targetDocuments",II=["targetId","path"],xu="documentTargetsIndex",CI=["path","targetId"],Rs="targetGlobalKey",Hn="targetGlobal",so="collectionParents",AI=["collectionId","parent"],Oi="clientMetadata",SI="clientId",ra="bundles",wI="bundleId",oa="namedQueries",xI="name",Ru="indexConfiguration",RI="indexId",Al="collectionGroupIndex",PI="collectionGroup",zr="indexState",kI=["indexId","uid"],Vm="sequenceNumberIndex",MI=["uid","sequenceNumber"],Kr="indexEntries",bI=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Lm="documentKeyIndex",DI=["indexId","uid","orderedDocumentKey"],sa="documentOverlays",NI=["userId","collectionPath","documentId"],Sl="collectionPathOverlayIndex",VI=["userId","collectionPath","largestBatchId"],Fm="collectionGroupOverlayIndex",LI=["userId","collectionGroup","largestBatchId"],Pu="globals",FI="name",Um=[ro,gt,Fi,Dn,Ui,Eo,Hn,Bi,Oi,oo,so,ra,oa],UI=[...Um,sa],Bm=[ro,gt,Fi,xs,Ui,Eo,Hn,Bi,Oi,oo,so,ra,oa,sa],Om=Bm,ku=[...Om,Ru,zr,Kr],BI=ku,$m=[...ku,Pu],OI=$m;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wl extends km{constructor(e,t){super(),this.he=e,this.currentSequenceNumber=t}}function De(n,e){const t=Ee(n);return _n.N(t.he,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qd(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Mu(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function $I(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ot{constructor(e,t){this.comparator=e,this.root=t||Ue.EMPTY}insert(e,t){return new ot(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ue.BLACK,null,null))}remove(e){return new ot(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ue.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const r=this.comparator(e,i.key);if(r===0)return t+i.left.size;r<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){const e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ko(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ko(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ko(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ko(this.root,e,this.comparator,!0)}}class Ko{constructor(e,t,i,r){this.isReverse=r,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?i(e.key,t):1,t&&r&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ue{constructor(e,t,i,r,o){this.key=e,this.value=t,this.color=i??Ue.RED,this.left=r??Ue.EMPTY,this.right=o??Ue.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,r,o){return new Ue(e??this.key,t??this.value,i??this.color,r??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let r=this;const o=i(e,r.key);return r=o<0?r.copy(null,null,null,r.left.insert(e,t,i),null):o===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,i)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Ue.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return Ue.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ue.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ue.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw X(43730,{key:this.key,value:this.value});if(this.right.isRed())throw X(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw X(27949);return e+(this.isRed()?0:1)}}Ue.EMPTY=null,Ue.RED=!0,Ue.BLACK=!1;Ue.EMPTY=new class{constructor(){this.size=0}get key(){throw X(57766)}get value(){throw X(16141)}get color(){throw X(16727)}get left(){throw X(29726)}get right(){throw X(36894)}copy(e,t,i,r,o){return this}insert(e,t,i){return new Ue(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _e{constructor(e){this.comparator=e,this.data=new ot(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const r=i.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Gd(this.data.getIterator())}getIteratorFrom(e){return new Gd(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof _e)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,o=i.getNext().key;if(this.comparator(r,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new _e(this.comparator);return t.data=e,t}}class Gd{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function pi(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt{constructor(e){this.fields=e,e.sort(Me.comparator)}static empty(){return new qt([])}unionWith(e){let t=new _e(Me.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new qt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Li(this.fields,e.fields,(t,i)=>t.isEqual(i))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qI extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ht{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(r){try{return atob(r)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new qI("Invalid base64 string: "+o):o}}(e);return new ht(t)}static fromUint8Array(e){const t=function(r){let o="";for(let s=0;s<r.length;++s)o+=String.fromCharCode(r[s]);return o}(e);return new ht(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return re(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ht.EMPTY_BYTE_STRING=new ht("");const GI=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Tn(n){if(Q(!!n,39018),typeof n=="string"){let e=0;const t=GI.exec(n);if(Q(!!t,46558,{timestamp:n}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ke(n.seconds),nanos:ke(n.nanos)}}function ke(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function $i(n){return typeof n=="string"?ht.fromBase64String(n):ht.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qm="server_timestamp",Gm="__type__",Hm="__previous_value__",zm="__local_write_time__";function bu(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[Gm])===null||t===void 0?void 0:t.stringValue)===qm}function Km(n){const e=n.mapValue.fields[Hm];return bu(e)?Km(e):e}function Ps(n){const e=Tn(n.mapValue.fields[zm].timestampValue);return new qe(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HI{constructor(e,t,i,r,o,s,u,c,f,h){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=r,this.ssl=o,this.forceLongPolling=s,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=f,this.isUsingEmulator=h}}const ks="(default)";class qi{constructor(e,t){this.projectId=e,this.database=t||ks}static empty(){return new qi("","")}get isDefaultDatabase(){return this.database===ks}isEqual(e){return e instanceof qi&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jm="__type__",Wm="__max__",pn={mapValue:{fields:{__type__:{stringValue:Wm}}}},Ym="__vector__",Ms="value",ls={nullValue:"NULL_VALUE"};function Gi(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?bu(n)?4:Xm(n)?9007199254740991:aa(n)?10:11:X(28295,{value:n})}function Vt(n,e){if(n===e)return!0;const t=Gi(n);if(t!==Gi(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ps(n).isEqual(Ps(e));case 3:return function(r,o){if(typeof r.timestampValue=="string"&&typeof o.timestampValue=="string"&&r.timestampValue.length===o.timestampValue.length)return r.timestampValue===o.timestampValue;const s=Tn(r.timestampValue),u=Tn(o.timestampValue);return s.seconds===u.seconds&&s.nanos===u.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(r,o){return $i(r.bytesValue).isEqual($i(o.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,o){return ke(r.geoPointValue.latitude)===ke(o.geoPointValue.latitude)&&ke(r.geoPointValue.longitude)===ke(o.geoPointValue.longitude)}(n,e);case 2:return function(r,o){if("integerValue"in r&&"integerValue"in o)return ke(r.integerValue)===ke(o.integerValue);if("doubleValue"in r&&"doubleValue"in o){const s=ke(r.doubleValue),u=ke(o.doubleValue);return s===u?Ss(s)===Ss(u):isNaN(s)&&isNaN(u)}return!1}(n,e);case 9:return Li(n.arrayValue.values||[],e.arrayValue.values||[],Vt);case 10:case 11:return function(r,o){const s=r.mapValue.fields||{},u=o.mapValue.fields||{};if(qd(s)!==qd(u))return!1;for(const c in s)if(s.hasOwnProperty(c)&&(u[c]===void 0||!Vt(s[c],u[c])))return!1;return!0}(n,e);default:return X(52216,{left:n})}}function ao(n,e){return(n.values||[]).find(t=>Vt(t,e))!==void 0}function En(n,e){if(n===e)return 0;const t=Gi(n),i=Gi(e);if(t!==i)return re(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return re(n.booleanValue,e.booleanValue);case 2:return function(o,s){const u=ke(o.integerValue||o.doubleValue),c=ke(s.integerValue||s.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(n,e);case 3:return Hd(n.timestampValue,e.timestampValue);case 4:return Hd(Ps(n),Ps(e));case 5:return El(n.stringValue,e.stringValue);case 6:return function(o,s){const u=$i(o),c=$i(s);return u.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(o,s){const u=o.split("/"),c=s.split("/");for(let f=0;f<u.length&&f<c.length;f++){const h=re(u[f],c[f]);if(h!==0)return h}return re(u.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(o,s){const u=re(ke(o.latitude),ke(s.latitude));return u!==0?u:re(ke(o.longitude),ke(s.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return zd(n.arrayValue,e.arrayValue);case 10:return function(o,s){var u,c,f,h;const m=o.fields||{},y=s.fields||{},v=(u=m[Ms])===null||u===void 0?void 0:u.arrayValue,x=(c=y[Ms])===null||c===void 0?void 0:c.arrayValue,R=re(((f=v==null?void 0:v.values)===null||f===void 0?void 0:f.length)||0,((h=x==null?void 0:x.values)===null||h===void 0?void 0:h.length)||0);return R!==0?R:zd(v,x)}(n.mapValue,e.mapValue);case 11:return function(o,s){if(o===pn.mapValue&&s===pn.mapValue)return 0;if(o===pn.mapValue)return 1;if(s===pn.mapValue)return-1;const u=o.fields||{},c=Object.keys(u),f=s.fields||{},h=Object.keys(f);c.sort(),h.sort();for(let m=0;m<c.length&&m<h.length;++m){const y=El(c[m],h[m]);if(y!==0)return y;const v=En(u[c[m]],f[h[m]]);if(v!==0)return v}return re(c.length,h.length)}(n.mapValue,e.mapValue);default:throw X(23264,{Pe:t})}}function Hd(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return re(n,e);const t=Tn(n),i=Tn(e),r=re(t.seconds,i.seconds);return r!==0?r:re(t.nanos,i.nanos)}function zd(n,e){const t=n.values||[],i=e.values||[];for(let r=0;r<t.length&&r<i.length;++r){const o=En(t[r],i[r]);if(o)return o}return re(t.length,i.length)}function Hi(n){return xl(n)}function xl(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const i=Tn(t);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return $i(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return W.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let i="[",r=!0;for(const o of t.values||[])r?r=!1:i+=",",i+=xl(o);return i+"]"}(n.arrayValue):"mapValue"in n?function(t){const i=Object.keys(t.fields||{}).sort();let r="{",o=!0;for(const s of i)o?o=!1:r+=",",r+=`${s}:${xl(t.fields[s])}`;return r+"}"}(n.mapValue):X(61005,{value:n})}function Du(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Rl(n){return!!n&&"integerValue"in n}function lo(n){return!!n&&"arrayValue"in n}function Kd(n){return!!n&&"nullValue"in n}function Jd(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function tl(n){return!!n&&"mapValue"in n}function aa(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[Jm])===null||t===void 0?void 0:t.stringValue)===Ym}function Jr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Mu(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=Jr(i)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Jr(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Xm(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Wm}const Qm={mapValue:{fields:{[Jm]:{stringValue:Ym},[Ms]:{arrayValue:{}}}}};function zI(n){return"nullValue"in n?ls:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Du(qi.empty(),W.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?aa(n)?Qm:{mapValue:{}}:X(35942,{value:n})}function KI(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Du(qi.empty(),W.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?Qm:"mapValue"in n?aa(n)?{mapValue:{}}:pn:X(61959,{value:n})}function Wd(n,e){const t=En(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Yd(n,e){const t=En(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yt{constructor(e){this.value=e}static empty(){return new yt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!tl(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Jr(t)}setAll(e){let t=Me.emptyPath(),i={},r=[];e.forEach((s,u)=>{if(!t.isImmediateParentOf(u)){const c=this.getFieldsMap(t);this.applyChanges(c,i,r),i={},r=[],t=u.popLast()}s?i[u.lastSegment()]=Jr(s):r.push(u.lastSegment())});const o=this.getFieldsMap(t);this.applyChanges(o,i,r)}delete(e){const t=this.field(e.popLast());tl(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Vt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let r=t.mapValue.fields[e.get(i)];tl(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,i){Mu(t,(r,o)=>e[r]=o);for(const r of i)delete e[r]}clone(){return new yt(Jr(this.value))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Be{constructor(e,t,i,r,o,s,u){this.key=e,this.documentType=t,this.version=i,this.readTime=r,this.createTime=o,this.data=s,this.documentState=u}static newInvalidDocument(e){return new Be(e,0,ue.min(),ue.min(),ue.min(),yt.empty(),0)}static newFoundDocument(e,t,i,r){return new Be(e,1,t,ue.min(),i,r,0)}static newNoDocument(e,t){return new Be(e,2,t,ue.min(),ue.min(),yt.empty(),0)}static newUnknownDocument(e,t){return new Be(e,3,t,ue.min(),ue.min(),yt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ue.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=yt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=yt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ue.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Be&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Be(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zi{constructor(e,t){this.position=e,this.inclusive=t}}function Xd(n,e,t){let i=0;for(let r=0;r<n.position.length;r++){const o=e[r],s=n.position[r];if(o.field.isKeyField()?i=W.comparator(W.fromName(s.referenceValue),t.key):i=En(s,t.data.field(o.field)),o.dir==="desc"&&(i*=-1),i!==0)break}return i}function Qd(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Vt(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bs{constructor(e,t="asc"){this.field=e,this.dir=t}}function JI(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zm{}class se extends Zm{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new WI(e,t,i):t==="array-contains"?new QI(e,i):t==="in"?new rg(e,i):t==="not-in"?new ZI(e,i):t==="array-contains-any"?new jI(e,i):new se(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new YI(e,i):new XI(e,i)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(En(t,this.value)):t!==null&&Gi(this.value)===Gi(t)&&this.matchesComparison(En(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return X(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ge extends Zm{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new ge(e,t)}matches(e){return Ki(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Te!==null||(this.Te=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function Ki(n){return n.op==="and"}function Pl(n){return n.op==="or"}function Nu(n){return jm(n)&&Ki(n)}function jm(n){for(const e of n.filters)if(e instanceof ge)return!1;return!0}function kl(n){if(n instanceof se)return n.field.canonicalString()+n.op.toString()+Hi(n.value);if(Nu(n))return n.filters.map(e=>kl(e)).join(",");{const e=n.filters.map(t=>kl(t)).join(",");return`${n.op}(${e})`}}function eg(n,e){return n instanceof se?function(i,r){return r instanceof se&&i.op===r.op&&i.field.isEqual(r.field)&&Vt(i.value,r.value)}(n,e):n instanceof ge?function(i,r){return r instanceof ge&&i.op===r.op&&i.filters.length===r.filters.length?i.filters.reduce((o,s,u)=>o&&eg(s,r.filters[u]),!0):!1}(n,e):void X(19439)}function tg(n,e){const t=n.filters.concat(e);return ge.create(t,n.op)}function ng(n){return n instanceof se?function(t){return`${t.field.canonicalString()} ${t.op} ${Hi(t.value)}`}(n):n instanceof ge?function(t){return t.op.toString()+" {"+t.getFilters().map(ng).join(" ,")+"}"}(n):"Filter"}class WI extends se{constructor(e,t,i){super(e,t,i),this.key=W.fromName(i.referenceValue)}matches(e){const t=W.comparator(e.key,this.key);return this.matchesComparison(t)}}class YI extends se{constructor(e,t){super(e,"in",t),this.keys=ig("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class XI extends se{constructor(e,t){super(e,"not-in",t),this.keys=ig("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function ig(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(i=>W.fromName(i.referenceValue))}class QI extends se{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return lo(t)&&ao(t.arrayValue,this.value)}}class rg extends se{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&ao(this.value.arrayValue,t)}}class ZI extends se{constructor(e,t){super(e,"not-in",t)}matches(e){if(ao(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!ao(this.value.arrayValue,t)}}class jI extends se{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!lo(t)||!t.arrayValue.values)&&t.arrayValue.values.some(i=>ao(this.value.arrayValue,i))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eC{constructor(e,t=null,i=[],r=[],o=null,s=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=r,this.limit=o,this.startAt=s,this.endAt=u,this.Ie=null}}function Ml(n,e=null,t=[],i=[],r=null,o=null,s=null){return new eC(n,e,t,i,r,o,s)}function Zn(n){const e=Ee(n);if(e.Ie===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>kl(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>function(o){return o.field.canonicalString()+o.dir}(i)).join(","),ia(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>Hi(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>Hi(i)).join(",")),e.Ie=t}return e.Ie}function Io(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!JI(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!eg(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Qd(n.startAt,e.startAt)&&Qd(n.endAt,e.endAt)}function tC(n){return W.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Ds(n,e){return n.filters.filter(t=>t instanceof se&&t.field.isEqual(e))}function Zd(n,e,t){let i=ls,r=!0;for(const o of Ds(n,e)){let s=ls,u=!0;switch(o.op){case"<":case"<=":s=zI(o.value);break;case"==":case"in":case">=":s=o.value;break;case">":s=o.value,u=!1;break;case"!=":case"not-in":s=ls}Wd({value:i,inclusive:r},{value:s,inclusive:u})<0&&(i=s,r=u)}if(t!==null){for(let o=0;o<n.orderBy.length;++o)if(n.orderBy[o].field.isEqual(e)){const s=t.position[o];Wd({value:i,inclusive:r},{value:s,inclusive:t.inclusive})<0&&(i=s,r=t.inclusive);break}}return{value:i,inclusive:r}}function jd(n,e,t){let i=pn,r=!0;for(const o of Ds(n,e)){let s=pn,u=!0;switch(o.op){case">=":case">":s=KI(o.value),u=!1;break;case"==":case"in":case"<=":s=o.value;break;case"<":s=o.value,u=!1;break;case"!=":case"not-in":s=pn}Yd({value:i,inclusive:r},{value:s,inclusive:u})>0&&(i=s,r=u)}if(t!==null){for(let o=0;o<n.orderBy.length;++o)if(n.orderBy[o].field.isEqual(e)){const s=t.position[o];Yd({value:i,inclusive:r},{value:s,inclusive:t.inclusive})>0&&(i=s,r=t.inclusive);break}}return{value:i,inclusive:r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la{constructor(e,t=null,i=[],r=[],o=null,s="F",u=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=r,this.limit=o,this.limitType=s,this.startAt=u,this.endAt=c,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function nC(n,e,t,i,r,o,s,u){return new la(n,e,t,i,r,o,s,u)}function iC(n){return new la(n)}function ef(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function rC(n){return n.collectionGroup!==null}function Wr(n){const e=Ee(n);if(e.Ee===null){e.Ee=[];const t=new Set;for(const o of e.explicitOrderBy)e.Ee.push(o),t.add(o.field.canonicalString());const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(s){let u=new _e(Me.comparator);return s.filters.forEach(c=>{c.getFlattenedFilters().forEach(f=>{f.isInequality()&&(u=u.add(f.field))})}),u})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ee.push(new bs(o,i))}),t.has(Me.keyField().canonicalString())||e.Ee.push(new bs(Me.keyField(),i))}return e.Ee}function Gt(n){const e=Ee(n);return e.de||(e.de=oC(e,Wr(n))),e.de}function oC(n,e){if(n.limitType==="F")return Ml(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(r=>{const o=r.dir==="desc"?"asc":"desc";return new bs(r.field,o)});const t=n.endAt?new zi(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new zi(n.startAt.position,n.startAt.inclusive):null;return Ml(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function bl(n,e,t){return new la(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function og(n,e){return Io(Gt(n),Gt(e))&&n.limitType===e.limitType}function sg(n){return`${Zn(Gt(n))}|lt:${n.limitType}`}function kr(n){return`Query(target=${function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map(r=>ng(r)).join(", ")}]`),ia(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map(r=>function(s){return`${s.field.canonicalString()} (${s.dir})`}(r)).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map(r=>Hi(r)).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map(r=>Hi(r)).join(",")),`Target(${i})`}(Gt(n))}; limitType=${n.limitType})`}function ua(n,e){return e.isFoundDocument()&&function(i,r){const o=r.key.path;return i.collectionGroup!==null?r.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(o):W.isDocumentKey(i.path)?i.path.isEqual(o):i.path.isImmediateParentOf(o)}(n,e)&&function(i,r){for(const o of Wr(i))if(!o.field.isKeyField()&&r.data.field(o.field)===null)return!1;return!0}(n,e)&&function(i,r){for(const o of i.filters)if(!o.matches(r))return!1;return!0}(n,e)&&function(i,r){return!(i.startAt&&!function(s,u,c){const f=Xd(s,u,c);return s.inclusive?f<=0:f<0}(i.startAt,Wr(i),r)||i.endAt&&!function(s,u,c){const f=Xd(s,u,c);return s.inclusive?f>=0:f>0}(i.endAt,Wr(i),r))}(n,e)}function sC(n){return(e,t)=>{let i=!1;for(const r of Wr(n)){const o=aC(r,e,t);if(o!==0)return o;i=i||r.field.isKeyField()}return 0}}function aC(n,e,t){const i=n.field.isKeyField()?W.comparator(e.key,t.key):function(o,s,u){const c=s.data.field(o),f=u.data.field(o);return c!==null&&f!==null?En(c,f):X(42886)}(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return X(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class An{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(const[r,o]of i)if(this.equalsFn(r,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const i=this.mapKeyFn(e),r=this.inner[i];if(r===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let o=0;o<r.length;o++)if(this.equalsFn(r[o][0],e))return void(r[o]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return i.length===1?delete this.inner[t]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Mu(this.inner,(t,i)=>{for(const[r,o]of i)e(r,o)})}isEmpty(){return $I(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lC=new ot(W.comparator);function On(){return lC}const ag=new ot(W.comparator);function Jo(...n){let e=ag;for(const t of n)e=e.insert(t.key,t);return e}function uC(n){let e=ag;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function xt(){return Yr()}function lg(){return Yr()}function Yr(){return new An(n=>n.toString(),(n,e)=>n.isEqual(e))}const cC=new ot(W.comparator),dC=new _e(W.comparator);function Oe(...n){let e=dC;for(const t of n)e=e.add(t);return e}const fC=new _e(re);function hC(){return fC}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pC(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ss(e)?"-0":e}}function mC(n){return{integerValue:""+n}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ca{constructor(){this._=void 0}}function gC(n,e,t){return n instanceof uo?function(r,o){const s={fields:{[Gm]:{stringValue:qm},[zm]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return o&&bu(o)&&(o=Km(o)),o&&(s.fields[Hm]=o),{mapValue:s}}(t,e):n instanceof Ji?ug(n,e):n instanceof Wi?cg(n,e):function(r,o){const s=_C(r,o),u=tf(s)+tf(r.Re);return Rl(s)&&Rl(r.Re)?mC(u):pC(r.serializer,u)}(n,e)}function yC(n,e,t){return n instanceof Ji?ug(n,e):n instanceof Wi?cg(n,e):t}function _C(n,e){return n instanceof co?function(i){return Rl(i)||function(o){return!!o&&"doubleValue"in o}(i)}(e)?e:{integerValue:0}:null}class uo extends ca{}class Ji extends ca{constructor(e){super(),this.elements=e}}function ug(n,e){const t=dg(e);for(const i of n.elements)t.some(r=>Vt(r,i))||t.push(i);return{arrayValue:{values:t}}}class Wi extends ca{constructor(e){super(),this.elements=e}}function cg(n,e){let t=dg(e);for(const i of n.elements)t=t.filter(r=>!Vt(r,i));return{arrayValue:{values:t}}}class co extends ca{constructor(e,t){super(),this.serializer=e,this.Re=t}}function tf(n){return ke(n.integerValue||n.doubleValue)}function dg(n){return lo(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vC{constructor(e,t){this.field=e,this.transform=t}}function TC(n,e){return n.field.isEqual(e.field)&&function(i,r){return i instanceof Ji&&r instanceof Ji||i instanceof Wi&&r instanceof Wi?Li(i.elements,r.elements,Vt):i instanceof co&&r instanceof co?Vt(i.Re,r.Re):i instanceof uo&&r instanceof uo}(n.transform,e.transform)}class EC{constructor(e,t){this.version=e,this.transformResults=t}}class Et{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Et}static exists(e){return new Et(void 0,e)}static updateTime(e){return new Et(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function us(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class da{}function fg(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Vu(n.key,Et.none()):new Co(n.key,n.data,Et.none());{const t=n.data,i=yt.empty();let r=new _e(Me.comparator);for(let o of e.fields)if(!r.has(o)){let s=t.field(o);s===null&&o.length>1&&(o=o.popLast(),s=t.field(o)),s===null?i.delete(o):i.set(o,s),r=r.add(o)}return new lr(n.key,i,new qt(r.toArray()),Et.none())}}function IC(n,e,t){n instanceof Co?function(r,o,s){const u=r.value.clone(),c=rf(r.fieldTransforms,o,s.transformResults);u.setAll(c),o.convertToFoundDocument(s.version,u).setHasCommittedMutations()}(n,e,t):n instanceof lr?function(r,o,s){if(!us(r.precondition,o))return void o.convertToUnknownDocument(s.version);const u=rf(r.fieldTransforms,o,s.transformResults),c=o.data;c.setAll(hg(r)),c.setAll(u),o.convertToFoundDocument(s.version,c).setHasCommittedMutations()}(n,e,t):function(r,o,s){o.convertToNoDocument(s.version).setHasCommittedMutations()}(0,e,t)}function Xr(n,e,t,i){return n instanceof Co?function(o,s,u,c){if(!us(o.precondition,s))return u;const f=o.value.clone(),h=of(o.fieldTransforms,c,s);return f.setAll(h),s.convertToFoundDocument(s.version,f).setHasLocalMutations(),null}(n,e,t,i):n instanceof lr?function(o,s,u,c){if(!us(o.precondition,s))return u;const f=of(o.fieldTransforms,c,s),h=s.data;return h.setAll(hg(o)),h.setAll(f),s.convertToFoundDocument(s.version,h).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(m=>m.field))}(n,e,t,i):function(o,s,u){return us(o.precondition,s)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):u}(n,e,t)}function nf(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(i,r){return i===void 0&&r===void 0||!(!i||!r)&&Li(i,r,(o,s)=>TC(o,s))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Co extends da{constructor(e,t,i,r=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class lr extends da{constructor(e,t,i,r,o=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=r,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function hg(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}}),e}function rf(n,e,t){const i=new Map;Q(n.length===t.length,32656,{Ve:t.length,me:n.length});for(let r=0;r<t.length;r++){const o=n[r],s=o.transform,u=e.data.field(o.field);i.set(o.field,yC(s,u,t[r]))}return i}function of(n,e,t){const i=new Map;for(const r of n){const o=r.transform,s=t.data.field(r.field);i.set(r.field,gC(o,s,e))}return i}class Vu extends da{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class pg extends da{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lu{constructor(e,t,i,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const o=this.mutations[r];o.key.isEqual(e.key)&&IC(o,e,i[r])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=Xr(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=Xr(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=lg();return this.mutations.forEach(r=>{const o=e.get(r.key),s=o.overlayedDocument;let u=this.applyToLocalView(s,o.mutatedFields);u=t.has(r.key)?null:u;const c=fg(s,u);c!==null&&i.set(r.key,c),s.isValidDocument()||s.convertToNoDocument(ue.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Oe())}isEqual(e){return this.batchId===e.batchId&&Li(this.mutations,e.mutations,(t,i)=>nf(t,i))&&Li(this.baseMutations,e.baseMutations,(t,i)=>nf(t,i))}}class Fu{constructor(e,t,i,r){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=r}static from(e,t,i){Q(e.mutations.length===i.length,58842,{fe:e.mutations.length,ge:i.length});let r=function(){return cC}();const o=e.mutations;for(let s=0;s<o.length;s++)r=r.insert(o[s].key,i[s].version);return new Fu(e,t,i,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uu{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Re,le;function CC(n){switch(n){case B.OK:return X(64938);case B.CANCELLED:case B.UNKNOWN:case B.DEADLINE_EXCEEDED:case B.RESOURCE_EXHAUSTED:case B.INTERNAL:case B.UNAVAILABLE:case B.UNAUTHENTICATED:return!1;case B.INVALID_ARGUMENT:case B.NOT_FOUND:case B.ALREADY_EXISTS:case B.PERMISSION_DENIED:case B.FAILED_PRECONDITION:case B.ABORTED:case B.OUT_OF_RANGE:case B.UNIMPLEMENTED:case B.DATA_LOSS:return!0;default:return X(15467,{code:n})}}function AC(n){if(n===void 0)return lt("GRPC error has no .code"),B.UNKNOWN;switch(n){case Re.OK:return B.OK;case Re.CANCELLED:return B.CANCELLED;case Re.UNKNOWN:return B.UNKNOWN;case Re.DEADLINE_EXCEEDED:return B.DEADLINE_EXCEEDED;case Re.RESOURCE_EXHAUSTED:return B.RESOURCE_EXHAUSTED;case Re.INTERNAL:return B.INTERNAL;case Re.UNAVAILABLE:return B.UNAVAILABLE;case Re.UNAUTHENTICATED:return B.UNAUTHENTICATED;case Re.INVALID_ARGUMENT:return B.INVALID_ARGUMENT;case Re.NOT_FOUND:return B.NOT_FOUND;case Re.ALREADY_EXISTS:return B.ALREADY_EXISTS;case Re.PERMISSION_DENIED:return B.PERMISSION_DENIED;case Re.FAILED_PRECONDITION:return B.FAILED_PRECONDITION;case Re.ABORTED:return B.ABORTED;case Re.OUT_OF_RANGE:return B.OUT_OF_RANGE;case Re.UNIMPLEMENTED:return B.UNIMPLEMENTED;case Re.DATA_LOSS:return B.DATA_LOSS;default:return X(39323,{code:n})}}(le=Re||(Re={}))[le.OK=0]="OK",le[le.CANCELLED=1]="CANCELLED",le[le.UNKNOWN=2]="UNKNOWN",le[le.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",le[le.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",le[le.NOT_FOUND=5]="NOT_FOUND",le[le.ALREADY_EXISTS=6]="ALREADY_EXISTS",le[le.PERMISSION_DENIED=7]="PERMISSION_DENIED",le[le.UNAUTHENTICATED=16]="UNAUTHENTICATED",le[le.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",le[le.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",le[le.ABORTED=10]="ABORTED",le[le.OUT_OF_RANGE=11]="OUT_OF_RANGE",le[le.UNIMPLEMENTED=12]="UNIMPLEMENTED",le[le.INTERNAL=13]="INTERNAL",le[le.UNAVAILABLE=14]="UNAVAILABLE",le[le.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new Cu([4294967295,4294967295],0);const SC={asc:"ASCENDING",desc:"DESCENDING"},wC={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},xC={and:"AND",or:"OR"};class RC{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function PC(n,e){return n.useProto3Json||ia(e)?e:{value:e}}function Dl(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function kC(n,e){return Dl(n,e.toTimestamp())}function Ct(n){return Q(!!n,49232),ue.fromTimestamp(function(t){const i=Tn(t);return new qe(i.seconds,i.nanos)}(n))}function mg(n,e){return Nl(n,e).canonicalString()}function Nl(n,e){const t=function(r){return new Ce(["projects",r.projectId,"databases",r.database])}(n).child("documents");return e===void 0?t:t.child(e)}function gg(n){const e=Ce.fromString(n);return Q(OC(e),10190,{key:e.toString()}),e}function Ns(n,e){return mg(n.databaseId,e.path)}function cs(n,e){const t=gg(e);if(t.get(1)!==n.databaseId.projectId)throw new Z(B.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Z(B.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new W(vg(t))}function yg(n,e){return mg(n.databaseId,e)}function _g(n){const e=gg(n);return e.length===4?Ce.emptyPath():vg(e)}function MC(n){return new Ce(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function vg(n){return Q(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function sf(n,e,t){return{name:Ns(n,e),fields:t.value.mapValue.fields}}function bC(n,e,t){const i=cs(n,e.name),r=Ct(e.updateTime),o=e.createTime?Ct(e.createTime):ue.min(),s=new yt({mapValue:{fields:e.fields}}),u=Be.newFoundDocument(i,r,o,s);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function Vs(n,e){let t;if(e instanceof Co)t={update:sf(n,e.key,e.value)};else if(e instanceof Vu)t={delete:Ns(n,e.key)};else if(e instanceof lr)t={update:sf(n,e.key,e.data),updateMask:BC(e.fieldMask)};else{if(!(e instanceof pg))return X(16599,{ft:e.type});t={verify:Ns(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>function(o,s){const u=s.transform;if(u instanceof uo)return{fieldPath:s.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Ji)return{fieldPath:s.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Wi)return{fieldPath:s.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof co)return{fieldPath:s.field.canonicalString(),increment:u.Re};throw X(20930,{transform:s.transform})}(0,i))),e.precondition.isNone||(t.currentDocument=function(r,o){return o.updateTime!==void 0?{updateTime:kC(r,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:X(27497)}(n,e.precondition)),t}function Vl(n,e){const t=e.currentDocument?function(o){return o.updateTime!==void 0?Et.updateTime(Ct(o.updateTime)):o.exists!==void 0?Et.exists(o.exists):Et.none()}(e.currentDocument):Et.none(),i=e.updateTransforms?e.updateTransforms.map(r=>function(s,u){let c=null;if("setToServerValue"in u)Q(u.setToServerValue==="REQUEST_TIME",16630,{proto:u}),c=new uo;else if("appendMissingElements"in u){const h=u.appendMissingElements.values||[];c=new Ji(h)}else if("removeAllFromArray"in u){const h=u.removeAllFromArray.values||[];c=new Wi(h)}else"increment"in u?c=new co(s,u.increment):X(16584,{proto:u});const f=Me.fromServerFormat(u.fieldPath);return new vC(f,c)}(n,r)):[];if(e.update){e.update.name;const r=cs(n,e.update.name),o=new yt({mapValue:{fields:e.update.fields}});if(e.updateMask){const s=function(c){const f=c.fieldPaths||[];return new qt(f.map(h=>Me.fromServerFormat(h)))}(e.updateMask);return new lr(r,o,s,t,i)}return new Co(r,o,t,i)}if(e.delete){const r=cs(n,e.delete);return new Vu(r,t)}if(e.verify){const r=cs(n,e.verify);return new pg(r,t)}return X(1463,{proto:e})}function DC(n,e){return n&&n.length>0?(Q(e!==void 0,14353),n.map(t=>function(r,o){let s=r.updateTime?Ct(r.updateTime):Ct(o);return s.isEqual(ue.min())&&(s=Ct(o)),new EC(s,r.transformResults||[])}(t,e))):[]}function NC(n,e){return{documents:[yg(n,e.path)]}}function VC(n,e){const t={structuredQuery:{}},i=e.path;let r;e.collectionGroup!==null?(r=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=yg(n,r);const o=function(f){if(f.length!==0)return Ig(ge.create(f,"and"))}(e.filters);o&&(t.structuredQuery.where=o);const s=function(f){if(f.length!==0)return f.map(h=>function(y){return{field:Ei(y.field),direction:LC(y.dir)}}(h))}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const u=PC(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=function(f){return{before:f.inclusive,values:f.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(f){return{before:!f.inclusive,values:f.position}}(e.endAt)),{gt:t,parent:r}}function Tg(n){let e=_g(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let r=null;if(i>0){Q(i===1,65062);const h=t.from[0];h.allDescendants?r=h.collectionId:e=e.child(h.collectionId)}let o=[];t.where&&(o=function(m){const y=Eg(m);return y instanceof ge&&Nu(y)?y.getFilters():[y]}(t.where));let s=[];t.orderBy&&(s=function(m){return m.map(y=>function(x){return new bs(Ii(x.field),function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction))}(y))}(t.orderBy));let u=null;t.limit&&(u=function(m){let y;return y=typeof m=="object"?m.value:m,ia(y)?null:y}(t.limit));let c=null;t.startAt&&(c=function(m){const y=!!m.before,v=m.values||[];return new zi(v,y)}(t.startAt));let f=null;return t.endAt&&(f=function(m){const y=!m.before,v=m.values||[];return new zi(v,y)}(t.endAt)),nC(e,r,s,o,u,"F",c,f)}function Eg(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const i=Ii(t.unaryFilter.field);return se.create(i,"==",{doubleValue:NaN});case"IS_NULL":const r=Ii(t.unaryFilter.field);return se.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Ii(t.unaryFilter.field);return se.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Ii(t.unaryFilter.field);return se.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return X(61313);default:return X(60726)}}(n):n.fieldFilter!==void 0?function(t){return se.create(Ii(t.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return X(58110);default:return X(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ge.create(t.compositeFilter.filters.map(i=>Eg(i)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return X(1026)}}(t.compositeFilter.op))}(n):X(30097,{filter:n})}function LC(n){return SC[n]}function FC(n){return wC[n]}function UC(n){return xC[n]}function Ei(n){return{fieldPath:n.canonicalString()}}function Ii(n){return Me.fromServerFormat(n.fieldPath)}function Ig(n){return n instanceof se?function(t){if(t.op==="=="){if(Jd(t.value))return{unaryFilter:{field:Ei(t.field),op:"IS_NAN"}};if(Kd(t.value))return{unaryFilter:{field:Ei(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Jd(t.value))return{unaryFilter:{field:Ei(t.field),op:"IS_NOT_NAN"}};if(Kd(t.value))return{unaryFilter:{field:Ei(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ei(t.field),op:FC(t.op),value:t.value}}}(n):n instanceof ge?function(t){const i=t.getFilters().map(r=>Ig(r));return i.length===1?i[0]:{compositeFilter:{op:UC(t.op),filters:i}}}(n):X(54877,{filter:n})}function BC(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function OC(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wi{constructor(e,t,i,r,o=ue.min(),s=ue.min(),u=ht.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(e){return new wi(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new wi(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new wi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new wi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cg{constructor(e){this.wt=e}}function $C(n,e){let t;if(e.document)t=bC(n.wt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const i=W.fromSegments(e.noDocument.path),r=ei(e.noDocument.readTime);t=Be.newNoDocument(i,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return X(56709);{const i=W.fromSegments(e.unknownDocument.path),r=ei(e.unknownDocument.version);t=Be.newUnknownDocument(i,r)}}return e.readTime&&t.setReadTime(function(r){const o=new qe(r[0],r[1]);return ue.fromTimestamp(o)}(e.readTime)),t}function af(n,e){const t=e.key,i={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Ls(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())i.document=function(o,s){return{name:Ns(o,s.key),fields:s.data.value.mapValue.fields,updateTime:Dl(o,s.version.toTimestamp()),createTime:Dl(o,s.createTime.toTimestamp())}}(n.wt,e);else if(e.isNoDocument())i.noDocument={path:t.path.toArray(),readTime:jn(e.version)};else{if(!e.isUnknownDocument())return X(57904,{document:e});i.unknownDocument={path:t.path.toArray(),version:jn(e.version)}}return i}function Ls(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function jn(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ei(n){const e=new qe(n.seconds,n.nanoseconds);return ue.fromTimestamp(e)}function Vn(n,e){const t=(e.baseMutations||[]).map(o=>Vl(n.wt,o));for(let o=0;o<e.mutations.length-1;++o){const s=e.mutations[o];if(o+1<e.mutations.length&&e.mutations[o+1].transform!==void 0){const u=e.mutations[o+1];s.updateTransforms=u.transform.fieldTransforms,e.mutations.splice(o+1,1),++o}}const i=e.mutations.map(o=>Vl(n.wt,o)),r=qe.fromMillis(e.localWriteTimeMs);return new Lu(e.batchId,r,t,i)}function Ur(n){const e=ei(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?ei(n.lastLimboFreeSnapshotVersion):ue.min();let i;return i=function(o){return o.documents!==void 0}(n.query)?function(o){const s=o.documents.length;return Q(s===1,1966,{count:s}),Gt(iC(_g(o.documents[0])))}(n.query):function(o){return Gt(Tg(o))}(n.query),new wi(i,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,ht.fromBase64String(n.resumeToken))}function Ag(n,e){const t=jn(e.snapshotVersion),i=jn(e.lastLimboFreeSnapshotVersion);let r;r=tC(e.target)?NC(n.wt,e.target):VC(n.wt,e.target).gt;const o=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Zn(e.target),readTime:t,resumeToken:o,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function Sg(n){const e=Tg({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?bl(e,e.limit,"L"):e}function nl(n,e){return new Uu(e.largestBatchId,Vl(n.wt,e.overlayMutation))}function lf(n,e){const t=e.path.lastSegment();return[n,tt(e.path.popLast()),t]}function uf(n,e,t,i){return{indexId:n,uid:e,sequenceNumber:t,readTime:jn(i.readTime),documentKey:tt(i.documentKey.path),largestBatchId:i.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qC{getBundleMetadata(e,t){return cf(e).get(t).next(i=>{if(i)return function(o){return{id:o.bundleId,createTime:ei(o.createTime),version:o.version}}(i)})}saveBundleMetadata(e,t){return cf(e).put(function(r){return{bundleId:r.id,createTime:jn(Ct(r.createTime)),version:r.version}}(t))}getNamedQuery(e,t){return df(e).get(t).next(i=>{if(i)return function(o){return{name:o.name,query:Sg(o.bundledQuery),readTime:ei(o.readTime)}}(i)})}saveNamedQuery(e,t){return df(e).put(function(r){return{name:r.name,readTime:jn(Ct(r.readTime)),bundledQuery:r.bundledQuery}}(t))}}function cf(n){return De(n,ra)}function df(n){return De(n,oa)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fa{constructor(e,t){this.serializer=e,this.userId=t}static bt(e,t){const i=t.uid||"";return new fa(e,i)}getOverlay(e,t){return Mr(e).get(lf(this.userId,t)).next(i=>i?nl(this.serializer,i):null)}getOverlays(e,t){const i=xt();return M.forEach(t,r=>this.getOverlay(e,r).next(o=>{o!==null&&i.set(r,o)})).next(()=>i)}saveOverlays(e,t,i){const r=[];return i.forEach((o,s)=>{const u=new Uu(t,s);r.push(this.St(e,u))}),M.waitFor(r)}removeOverlaysForBatchId(e,t,i){const r=new Set;t.forEach(s=>r.add(tt(s.getCollectionPath())));const o=[];return r.forEach(s=>{const u=IDBKeyRange.bound([this.userId,s,i],[this.userId,s,i+1],!1,!0);o.push(Mr(e).X(Sl,u))}),M.waitFor(o)}getOverlaysForCollection(e,t,i){const r=xt(),o=tt(t),s=IDBKeyRange.bound([this.userId,o,i],[this.userId,o,Number.POSITIVE_INFINITY],!0);return Mr(e).J(Sl,s).next(u=>{for(const c of u){const f=nl(this.serializer,c);r.set(f.getKey(),f)}return r})}getOverlaysForCollectionGroup(e,t,i,r){const o=xt();let s;const u=IDBKeyRange.bound([this.userId,t,i],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Mr(e).te({index:Fm,range:u},(c,f,h)=>{const m=nl(this.serializer,f);o.size()<r||m.largestBatchId===s?(o.set(m.getKey(),m),s=m.largestBatchId):h.done()}).next(()=>o)}St(e,t){return Mr(e).put(function(r,o,s){const[u,c,f]=lf(o,s.mutation.key);return{userId:o,collectionPath:c,documentId:f,collectionGroup:s.mutation.key.getCollectionGroup(),largestBatchId:s.largestBatchId,overlayMutation:Vs(r.wt,s.mutation)}}(this.serializer,this.userId,t))}}function Mr(n){return De(n,sa)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GC{Dt(e){return De(e,Pu)}getSessionToken(e){return this.Dt(e).get("sessionToken").next(t=>{const i=t==null?void 0:t.value;return i?ht.fromUint8Array(i):ht.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Dt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ln{constructor(){}vt(e,t){this.Ct(e,t),t.Ft()}Ct(e,t){if("nullValue"in e)this.Mt(t,5);else if("booleanValue"in e)this.Mt(t,10),t.xt(e.booleanValue?1:0);else if("integerValue"in e)this.Mt(t,15),t.xt(ke(e.integerValue));else if("doubleValue"in e){const i=ke(e.doubleValue);isNaN(i)?this.Mt(t,13):(this.Mt(t,15),Ss(i)?t.xt(0):t.xt(i))}else if("timestampValue"in e){let i=e.timestampValue;this.Mt(t,20),typeof i=="string"&&(i=Tn(i)),t.Ot(`${i.seconds||""}`),t.xt(i.nanos||0)}else if("stringValue"in e)this.Nt(e.stringValue,t),this.Bt(t);else if("bytesValue"in e)this.Mt(t,30),t.Lt($i(e.bytesValue)),this.Bt(t);else if("referenceValue"in e)this.kt(e.referenceValue,t);else if("geoPointValue"in e){const i=e.geoPointValue;this.Mt(t,45),t.xt(i.latitude||0),t.xt(i.longitude||0)}else"mapValue"in e?Xm(e)?this.Mt(t,Number.MAX_SAFE_INTEGER):aa(e)?this.qt(e.mapValue,t):(this.Qt(e.mapValue,t),this.Bt(t)):"arrayValue"in e?(this.$t(e.arrayValue,t),this.Bt(t)):X(19022,{Ut:e})}Nt(e,t){this.Mt(t,25),this.Kt(e,t)}Kt(e,t){t.Ot(e)}Qt(e,t){const i=e.fields||{};this.Mt(t,55);for(const r of Object.keys(i))this.Nt(r,t),this.Ct(i[r],t)}qt(e,t){var i,r;const o=e.fields||{};this.Mt(t,53);const s=Ms,u=((r=(i=o[s].arrayValue)===null||i===void 0?void 0:i.values)===null||r===void 0?void 0:r.length)||0;this.Mt(t,15),t.xt(ke(u)),this.Nt(s,t),this.Ct(o[s],t)}$t(e,t){const i=e.values||[];this.Mt(t,50);for(const r of i)this.Ct(r,t)}kt(e,t){this.Mt(t,37),W.fromName(e).path.forEach(i=>{this.Mt(t,60),this.Kt(i,t)})}Mt(e,t){e.xt(t)}Bt(e){e.xt(2)}}Ln.Wt=new Ln;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mi=255;function HC(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function ff(n){const e=64-function(i){let r=0;for(let o=0;o<8;++o){const s=HC(255&i[o]);if(r+=s,s!==8)break}return r}(n);return Math.ceil(e/8)}class zC{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Gt(e){const t=e[Symbol.iterator]();let i=t.next();for(;!i.done;)this.zt(i.value),i=t.next();this.jt()}Ht(e){const t=e[Symbol.iterator]();let i=t.next();for(;!i.done;)this.Jt(i.value),i=t.next();this.Yt()}Zt(e){for(const t of e){const i=t.charCodeAt(0);if(i<128)this.zt(i);else if(i<2048)this.zt(960|i>>>6),this.zt(128|63&i);else if(t<"\uD800"||"\uDBFF"<t)this.zt(480|i>>>12),this.zt(128|63&i>>>6),this.zt(128|63&i);else{const r=t.codePointAt(0);this.zt(240|r>>>18),this.zt(128|63&r>>>12),this.zt(128|63&r>>>6),this.zt(128|63&r)}}this.jt()}Xt(e){for(const t of e){const i=t.charCodeAt(0);if(i<128)this.Jt(i);else if(i<2048)this.Jt(960|i>>>6),this.Jt(128|63&i);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|i>>>12),this.Jt(128|63&i>>>6),this.Jt(128|63&i);else{const r=t.codePointAt(0);this.Jt(240|r>>>18),this.Jt(128|63&r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r)}}this.Yt()}en(e){const t=this.tn(e),i=ff(t);this.nn(1+i),this.buffer[this.position++]=255&i;for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=255&t[r]}rn(e){const t=this.tn(e),i=ff(t);this.nn(1+i),this.buffer[this.position++]=~(255&i);for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}sn(){this._n(mi),this._n(255)}an(){this.un(mi),this.un(255)}reset(){this.position=0}seed(e){this.nn(e.length),this.buffer.set(e,this.position),this.position+=e.length}cn(){return this.buffer.slice(0,this.position)}tn(e){const t=function(o){const s=new DataView(new ArrayBuffer(8));return s.setFloat64(0,o,!1),new Uint8Array(s.buffer)}(e),i=!!(128&t[0]);t[0]^=i?255:128;for(let r=1;r<t.length;++r)t[r]^=i?255:0;return t}zt(e){const t=255&e;t===0?(this._n(0),this._n(255)):t===mi?(this._n(mi),this._n(0)):this._n(t)}Jt(e){const t=255&e;t===0?(this.un(0),this.un(255)):t===mi?(this.un(mi),this.un(0)):this.un(e)}jt(){this._n(0),this._n(1)}Yt(){this.un(0),this.un(1)}_n(e){this.nn(1),this.buffer[this.position++]=e}un(e){this.nn(1),this.buffer[this.position++]=~e}nn(e){const t=e+this.position;if(t<=this.buffer.length)return;let i=2*this.buffer.length;i<t&&(i=t);const r=new Uint8Array(i);r.set(this.buffer),this.buffer=r}}class KC{constructor(e){this.ln=e}Lt(e){this.ln.Gt(e)}Ot(e){this.ln.Zt(e)}xt(e){this.ln.en(e)}Ft(){this.ln.sn()}}class JC{constructor(e){this.ln=e}Lt(e){this.ln.Ht(e)}Ot(e){this.ln.Xt(e)}xt(e){this.ln.rn(e)}Ft(){this.ln.an()}}class br{constructor(){this.ln=new zC,this.hn=new KC(this.ln),this.Pn=new JC(this.ln)}seed(e){this.ln.seed(e)}Tn(e){return e===0?this.hn:this.Pn}cn(){return this.ln.cn()}reset(){this.ln.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fn{constructor(e,t,i,r){this.In=e,this.En=t,this.dn=i,this.An=r}Rn(){const e=this.An.length,t=e===0||this.An[e-1]===255?e+1:e,i=new Uint8Array(t);return i.set(this.An,0),t!==e?i.set([0],this.An.length):++i[i.length-1],new Fn(this.In,this.En,this.dn,i)}Vn(e,t,i){return{indexId:this.In,uid:e,arrayValue:ds(this.dn),directionalValue:ds(this.An),orderedDocumentKey:ds(t),documentKey:i.path.toArray()}}mn(e,t,i){const r=this.Vn(e,t,i);return[r.indexId,r.uid,r.arrayValue,r.directionalValue,r.orderedDocumentKey,r.documentKey]}}function rn(n,e){let t=n.In-e.In;return t!==0?t:(t=hf(n.dn,e.dn),t!==0?t:(t=hf(n.An,e.An),t!==0?t:W.comparator(n.En,e.En)))}function hf(n,e){for(let t=0;t<n.length&&t<e.length;++t){const i=n[t]-e[t];if(i!==0)return i}return n.length-e.length}function ds(n){return Vp()?function(t){let i="";for(let r=0;r<t.length;r++)i+=String.fromCharCode(t[r]);return i}(n):n}function pf(n){return typeof n!="string"?n:function(t){const i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return i}(n)}class mf{constructor(e){this.fn=new _e((t,i)=>Me.comparator(t.field,i.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.gn=e.orderBy,this.pn=[];for(const t of e.filters){const i=t;i.isInequality()?this.fn=this.fn.add(i):this.pn.push(i)}}get yn(){return this.fn.size>1}wn(e){if(Q(e.collectionGroup===this.collectionId,49279),this.yn)return!1;const t=Il(e);if(t!==void 0&&!this.bn(t))return!1;const i=bn(e);let r=new Set,o=0,s=0;for(;o<i.length&&this.bn(i[o]);++o)r=r.add(i[o].fieldPath.canonicalString());if(o===i.length)return!0;if(this.fn.size>0){const u=this.fn.getIterator().getNext();if(!r.has(u.field.canonicalString())){const c=i[o];if(!this.Sn(u,c)||!this.Dn(this.gn[s++],c))return!1}++o}for(;o<i.length;++o){const u=i[o];if(s>=this.gn.length||!this.Dn(this.gn[s++],u))return!1}return!0}vn(){if(this.yn)return null;let e=new _e(Me.comparator);const t=[];for(const i of this.pn)if(!i.field.isKeyField())if(i.op==="array-contains"||i.op==="array-contains-any")t.push(new os(i.field,2));else{if(e.has(i.field))continue;e=e.add(i.field),t.push(new os(i.field,0))}for(const i of this.gn)i.field.isKeyField()||e.has(i.field)||(e=e.add(i.field),t.push(new os(i.field,i.dir==="asc"?0:1)));return new As(As.UNKNOWN_ID,this.collectionId,t,io.empty())}bn(e){for(const t of this.pn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const i=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===i}Dn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wg(n){var e,t;if(Q(n instanceof se||n instanceof ge,20012),n instanceof se){if(n instanceof rg){const r=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(o=>se.create(n.field,"==",o)))||[];return ge.create(r,"or")}return n}const i=n.filters.map(r=>wg(r));return ge.create(i,n.op)}function WC(n){if(n.getFilters().length===0)return[];const e=Ul(wg(n));return Q(xg(e),7391),Ll(e)||Fl(e)?[e]:e.getFilters()}function Ll(n){return n instanceof se}function Fl(n){return n instanceof ge&&Nu(n)}function xg(n){return Ll(n)||Fl(n)||function(t){if(t instanceof ge&&Pl(t)){for(const i of t.getFilters())if(!Ll(i)&&!Fl(i))return!1;return!0}return!1}(n)}function Ul(n){if(Q(n instanceof se||n instanceof ge,34018),n instanceof se)return n;if(n.filters.length===1)return Ul(n.filters[0]);const e=n.filters.map(i=>Ul(i));let t=ge.create(e,n.op);return t=Fs(t),xg(t)?t:(Q(t instanceof ge,64498),Q(Ki(t),40251),Q(t.filters.length>1,57927),t.filters.reduce((i,r)=>Bu(i,r)))}function Bu(n,e){let t;return Q(n instanceof se||n instanceof ge,38388),Q(e instanceof se||e instanceof ge,25473),t=n instanceof se?e instanceof se?function(r,o){return ge.create([r,o],"and")}(n,e):gf(n,e):e instanceof se?gf(e,n):function(r,o){if(Q(r.filters.length>0&&o.filters.length>0,48005),Ki(r)&&Ki(o))return tg(r,o.getFilters());const s=Pl(r)?r:o,u=Pl(r)?o:r,c=s.filters.map(f=>Bu(f,u));return ge.create(c,"or")}(n,e),Fs(t)}function gf(n,e){if(Ki(e))return tg(e,n.getFilters());{const t=e.filters.map(i=>Bu(n,i));return ge.create(t,"or")}}function Fs(n){if(Q(n instanceof se||n instanceof ge,11850),n instanceof se)return n;const e=n.getFilters();if(e.length===1)return Fs(e[0]);if(jm(n))return n;const t=e.map(r=>Fs(r)),i=[];return t.forEach(r=>{r instanceof se?i.push(r):r instanceof ge&&(r.op===n.op?i.push(...r.filters):i.push(r))}),i.length===1?i[0]:ge.create(i,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YC{constructor(){this.Cn=new Ou}addToCollectionParentIndex(e,t){return this.Cn.add(t),M.resolve()}getCollectionParents(e,t){return M.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return M.resolve()}deleteFieldIndex(e,t){return M.resolve()}deleteAllFieldIndexes(e){return M.resolve()}createTargetIndexes(e,t){return M.resolve()}getDocumentsMatchingTarget(e,t){return M.resolve(null)}getIndexType(e,t){return M.resolve(0)}getFieldIndexes(e,t){return M.resolve([])}getNextCollectionGroupToUpdate(e){return M.resolve(null)}getMinOffset(e,t){return M.resolve(ut.min())}getMinOffsetFromCollectionGroup(e,t){return M.resolve(ut.min())}updateCollectionGroup(e,t,i){return M.resolve()}updateIndexEntries(e,t){return M.resolve()}}class Ou{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),r=this.index[t]||new _e(Ce.comparator),o=!r.has(i);return this.index[t]=r.add(i),o}has(e){const t=e.lastSegment(),i=e.popLast(),r=this.index[t];return r&&r.has(i)}getEntries(e){return(this.index[e]||new _e(Ce.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yf="IndexedDbIndexManager",Wo=new Uint8Array(0);class XC{constructor(e,t){this.databaseId=t,this.Fn=new Ou,this.Mn=new An(i=>Zn(i),(i,r)=>Io(i,r)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Fn.has(t)){const i=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.Fn.add(t)});const o={collectionId:i,parent:tt(r)};return _f(e).put(o)}return M.resolve()}getCollectionParents(e,t){const i=[],r=IDBKeyRange.bound([t,""],[xm(t),""],!1,!0);return _f(e).J(r).next(o=>{for(const s of o){if(s.collectionId!==t)break;i.push(wt(s.parent))}return i})}addFieldIndex(e,t){const i=Dr(e),r=function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete r.indexId;const o=i.add(r);if(t.indexState){const s=yi(e);return o.next(u=>{s.put(uf(u,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return o.next()}deleteFieldIndex(e,t){const i=Dr(e),r=yi(e),o=gi(e);return i.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>o.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Dr(e),i=gi(e),r=yi(e);return t.X().next(()=>i.X()).next(()=>r.X())}createTargetIndexes(e,t){return M.forEach(this.xn(t),i=>this.getIndexType(e,i).next(r=>{if(r===0||r===1){const o=new mf(i).vn();if(o!=null)return this.addFieldIndex(e,o)}}))}getDocumentsMatchingTarget(e,t){const i=gi(e);let r=!0;const o=new Map;return M.forEach(this.xn(t),s=>this.On(e,s).next(u=>{r&&(r=!!u),o.set(s,u)})).next(()=>{if(r){let s=Oe();const u=[];return M.forEach(o,(c,f)=>{H(yf,`Using index ${function(N){return`id=${N.indexId}|cg=${N.collectionGroup}|f=${N.fields.map(F=>`${F.fieldPath}:${F.kind}`).join(",")}`}(c)} to execute ${Zn(t)}`);const h=function(N,F){const L=Il(F);if(L===void 0)return null;for(const q of Ds(N,L.fieldPath))switch(q.op){case"array-contains-any":return q.value.arrayValue.values||[];case"array-contains":return[q.value]}return null}(f,c),m=function(N,F){const L=new Map;for(const q of bn(F))for(const I of Ds(N,q.fieldPath))switch(I.op){case"==":case"in":L.set(q.fieldPath.canonicalString(),I.value);break;case"not-in":case"!=":return L.set(q.fieldPath.canonicalString(),I.value),Array.from(L.values())}return null}(f,c),y=function(N,F){const L=[];let q=!0;for(const I of bn(F)){const T=I.kind===0?Zd(N,I.fieldPath,N.startAt):jd(N,I.fieldPath,N.startAt);L.push(T.value),q&&(q=T.inclusive)}return new zi(L,q)}(f,c),v=function(N,F){const L=[];let q=!0;for(const I of bn(F)){const T=I.kind===0?jd(N,I.fieldPath,N.endAt):Zd(N,I.fieldPath,N.endAt);L.push(T.value),q&&(q=T.inclusive)}return new zi(L,q)}(f,c),x=this.Nn(c,f,y),R=this.Nn(c,f,v),D=this.Bn(c,f,m),U=this.Ln(c.indexId,h,x,y.inclusive,R,v.inclusive,D);return M.forEach(U,V=>i.Z(V,t.limit).next(N=>{N.forEach(F=>{const L=W.fromSegments(F.documentKey);s.has(L)||(s=s.add(L),u.push(L))})}))}).next(()=>u)}return M.resolve(null)})}xn(e){let t=this.Mn.get(e);return t||(e.filters.length===0?t=[e]:t=WC(ge.create(e.filters,"and")).map(i=>Ml(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.Mn.set(e,t),t)}Ln(e,t,i,r,o,s,u){const c=(t!=null?t.length:1)*Math.max(i.length,o.length),f=c/(t!=null?t.length:1),h=[];for(let m=0;m<c;++m){const y=t?this.kn(t[m/f]):Wo,v=this.qn(e,y,i[m%f],r),x=this.Qn(e,y,o[m%f],s),R=u.map(D=>this.qn(e,y,D,!0));h.push(...this.createRange(v,x,R))}return h}qn(e,t,i,r){const o=new Fn(e,W.empty(),t,i);return r?o:o.Rn()}Qn(e,t,i,r){const o=new Fn(e,W.empty(),t,i);return r?o.Rn():o}On(e,t){const i=new mf(t),r=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(o=>{let s=null;for(const u of o)i.wn(u)&&(!s||u.fields.length>s.fields.length)&&(s=u);return s})}getIndexType(e,t){let i=2;const r=this.xn(t);return M.forEach(r,o=>this.On(e,o).next(s=>{s?i!==0&&s.fields.length<function(c){let f=new _e(Me.comparator),h=!1;for(const m of c.filters)for(const y of m.getFlattenedFilters())y.field.isKeyField()||(y.op==="array-contains"||y.op==="array-contains-any"?h=!0:f=f.add(y.field));for(const m of c.orderBy)m.field.isKeyField()||(f=f.add(m.field));return f.size+(h?1:0)}(o)&&(i=1):i=0})).next(()=>function(s){return s.limit!==null}(t)&&r.length>1&&i===2?1:i)}$n(e,t){const i=new br;for(const r of bn(e)){const o=t.data.field(r.fieldPath);if(o==null)return null;const s=i.Tn(r.kind);Ln.Wt.vt(o,s)}return i.cn()}kn(e){const t=new br;return Ln.Wt.vt(e,t.Tn(0)),t.cn()}Un(e,t){const i=new br;return Ln.Wt.vt(Du(this.databaseId,t),i.Tn(function(o){const s=bn(o);return s.length===0?0:s[s.length-1].kind}(e))),i.cn()}Bn(e,t,i){if(i===null)return[];let r=[];r.push(new br);let o=0;for(const s of bn(e)){const u=i[o++];for(const c of r)if(this.Kn(t,s.fieldPath)&&lo(u))r=this.Wn(r,s,u);else{const f=c.Tn(s.kind);Ln.Wt.vt(u,f)}}return this.Gn(r)}Nn(e,t,i){return this.Bn(e,t,i.position)}Gn(e){const t=[];for(let i=0;i<e.length;++i)t[i]=e[i].cn();return t}Wn(e,t,i){const r=[...e],o=[];for(const s of i.arrayValue.values||[])for(const u of r){const c=new br;c.seed(u.cn()),Ln.Wt.vt(s,c.Tn(t.kind)),o.push(c)}return o}Kn(e,t){return!!e.filters.find(i=>i instanceof se&&i.field.isEqual(t)&&(i.op==="in"||i.op==="not-in"))}getFieldIndexes(e,t){const i=Dr(e),r=yi(e);return(t?i.J(Al,IDBKeyRange.bound(t,t)):i.J()).next(o=>{const s=[];return M.forEach(o,u=>r.get([u.indexId,this.uid]).next(c=>{s.push(function(h,m){const y=m?new io(m.sequenceNumber,new ut(ei(m.readTime),new W(wt(m.documentKey)),m.largestBatchId)):io.empty(),v=h.fields.map(([x,R])=>new os(Me.fromServerFormat(x),R));return new As(h.indexId,h.collectionGroup,v,y)}(u,c))})).next(()=>s)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((i,r)=>{const o=i.indexState.sequenceNumber-r.indexState.sequenceNumber;return o!==0?o:re(i.collectionGroup,r.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,i){const r=Dr(e),o=yi(e);return this.zn(e).next(s=>r.J(Al,IDBKeyRange.bound(t,t)).next(u=>M.forEach(u,c=>o.put(uf(c.indexId,this.uid,s,i)))))}updateIndexEntries(e,t){const i=new Map;return M.forEach(t,(r,o)=>{const s=i.get(r.collectionGroup);return(s?M.resolve(s):this.getFieldIndexes(e,r.collectionGroup)).next(u=>(i.set(r.collectionGroup,u),M.forEach(u,c=>this.jn(e,r,c).next(f=>{const h=this.Hn(o,c);return f.isEqual(h)?M.resolve():this.Jn(e,o,c,f,h)}))))})}Yn(e,t,i,r){return gi(e).put(r.Vn(this.uid,this.Un(i,t.key),t.key))}Zn(e,t,i,r){return gi(e).delete(r.mn(this.uid,this.Un(i,t.key),t.key))}jn(e,t,i){const r=gi(e);let o=new _e(rn);return r.te({index:Lm,range:IDBKeyRange.only([i.indexId,this.uid,ds(this.Un(i,t))])},(s,u)=>{o=o.add(new Fn(i.indexId,t,pf(u.arrayValue),pf(u.directionalValue)))}).next(()=>o)}Hn(e,t){let i=new _e(rn);const r=this.$n(t,e);if(r==null)return i;const o=Il(t);if(o!=null){const s=e.data.field(o.fieldPath);if(lo(s))for(const u of s.arrayValue.values||[])i=i.add(new Fn(t.indexId,e.key,this.kn(u),r))}else i=i.add(new Fn(t.indexId,e.key,Wo,r));return i}Jn(e,t,i,r,o){H(yf,"Updating index entries for document '%s'",t.key);const s=[];return function(c,f,h,m,y){const v=c.getIterator(),x=f.getIterator();let R=pi(v),D=pi(x);for(;R||D;){let U=!1,V=!1;if(R&&D){const N=h(R,D);N<0?V=!0:N>0&&(U=!0)}else R!=null?V=!0:U=!0;U?(m(D),D=pi(x)):V?(y(R),R=pi(v)):(R=pi(v),D=pi(x))}}(r,o,rn,u=>{s.push(this.Yn(e,t,i,u))},u=>{s.push(this.Zn(e,t,i,u))}),M.waitFor(s)}zn(e){let t=1;return yi(e).te({index:Vm,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,r,o)=>{o.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,i){i=i.sort((s,u)=>rn(s,u)).filter((s,u,c)=>!u||rn(s,c[u-1])!==0);const r=[];r.push(e);for(const s of i){const u=rn(s,e),c=rn(s,t);if(u===0)r[0]=e.Rn();else if(u>0&&c<0)r.push(s),r.push(s.Rn());else if(c>0)break}r.push(t);const o=[];for(let s=0;s<r.length;s+=2){if(this.Xn(r[s],r[s+1]))return[];const u=r[s].mn(this.uid,Wo,W.empty()),c=r[s+1].mn(this.uid,Wo,W.empty());o.push(IDBKeyRange.bound(u,c))}return o}Xn(e,t){return rn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(vf)}getMinOffset(e,t){return M.mapArray(this.xn(t),i=>this.On(e,i).next(r=>r||X(44426))).next(vf)}}function _f(n){return De(n,so)}function gi(n){return De(n,Kr)}function Dr(n){return De(n,Ru)}function yi(n){return De(n,zr)}function vf(n){Q(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let i=1;i<n.length;i++){const r=n[i].indexState.offset;Su(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new ut(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tf={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Rg=41943040;class it{static withCacheSize(e){return new it(e,it.DEFAULT_COLLECTION_PERCENTILE,it.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pg(n,e,t){const i=n.store(gt),r=n.store(Fi),o=[],s=IDBKeyRange.only(t.batchId);let u=0;const c=i.te({range:s},(h,m,y)=>(u++,y.delete()));o.push(c.next(()=>{Q(u===1,47070,{batchId:t.batchId})}));const f=[];for(const h of t.mutations){const m=bm(e,h.key.path,t.batchId);o.push(r.delete(m)),f.push(h.key)}return M.waitFor(o).next(()=>f)}function Us(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw X(14731);e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */it.DEFAULT_COLLECTION_PERCENTILE=10,it.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,it.DEFAULT=new it(Rg,it.DEFAULT_COLLECTION_PERCENTILE,it.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),it.DISABLED=new it(-1,0,0);class ha{constructor(e,t,i,r){this.userId=e,this.serializer=t,this.indexManager=i,this.referenceDelegate=r,this.er={}}static bt(e,t,i,r){Q(e.uid!=="",64387);const o=e.isAuthenticated()?e.uid:"";return new ha(o,t,i,r)}checkEmpty(e){let t=!0;const i=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return on(e).te({index:Bn,range:i},(r,o,s)=>{t=!1,s.done()}).next(()=>t)}addMutationBatch(e,t,i,r){const o=Ci(e),s=on(e);return s.add({}).next(u=>{Q(typeof u=="number",49019);const c=new Lu(u,t,i,r),f=function(v,x,R){const D=R.baseMutations.map(V=>Vs(v.wt,V)),U=R.mutations.map(V=>Vs(v.wt,V));return{userId:x,batchId:R.batchId,localWriteTimeMs:R.localWriteTime.toMillis(),baseMutations:D,mutations:U}}(this.serializer,this.userId,c),h=[];let m=new _e((y,v)=>re(y.canonicalString(),v.canonicalString()));for(const y of r){const v=bm(this.userId,y.key.path,u);m=m.add(y.key.path.popLast()),h.push(s.put(f)),h.push(o.put(v,yI))}return m.forEach(y=>{h.push(this.indexManager.addToCollectionParentIndex(e,y))}),e.addOnCommittedListener(()=>{this.er[u]=c.keys()}),M.waitFor(h).next(()=>c)})}lookupMutationBatch(e,t){return on(e).get(t).next(i=>i?(Q(i.userId===this.userId,48,"Unexpected user for mutation batch",{userId:i.userId,batchId:t}),Vn(this.serializer,i)):null)}tr(e,t){return this.er[t]?M.resolve(this.er[t]):this.lookupMutationBatch(e,t).next(i=>{if(i){const r=i.keys();return this.er[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){const i=t+1,r=IDBKeyRange.lowerBound([this.userId,i]);let o=null;return on(e).te({index:Bn,range:r},(s,u,c)=>{u.userId===this.userId&&(Q(u.batchId>=i,47524,{nr:i}),o=Vn(this.serializer,u)),c.done()}).next(()=>o)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let i=Gn;return on(e).te({index:Bn,range:t,reverse:!0},(r,o,s)=>{i=o.batchId,s.done()}).next(()=>i)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,Gn],[this.userId,Number.POSITIVE_INFINITY]);return on(e).J(Bn,t).next(i=>i.map(r=>Vn(this.serializer,r)))}getAllMutationBatchesAffectingDocumentKey(e,t){const i=ss(this.userId,t.path),r=IDBKeyRange.lowerBound(i),o=[];return Ci(e).te({range:r},(s,u,c)=>{const[f,h,m]=s,y=wt(h);if(f===this.userId&&t.path.isEqual(y))return on(e).get(m).next(v=>{if(!v)throw X(61480,{rr:s,batchId:m});Q(v.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:v.userId,batchId:m}),o.push(Vn(this.serializer,v))});c.done()}).next(()=>o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new _e(re);const r=[];return t.forEach(o=>{const s=ss(this.userId,o.path),u=IDBKeyRange.lowerBound(s),c=Ci(e).te({range:u},(f,h,m)=>{const[y,v,x]=f,R=wt(v);y===this.userId&&o.path.isEqual(R)?i=i.add(x):m.done()});r.push(c)}),M.waitFor(r).next(()=>this.ir(e,i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,r=i.length+1,o=ss(this.userId,i),s=IDBKeyRange.lowerBound(o);let u=new _e(re);return Ci(e).te({range:s},(c,f,h)=>{const[m,y,v]=c,x=wt(y);m===this.userId&&i.isPrefixOf(x)?x.length===r&&(u=u.add(v)):h.done()}).next(()=>this.ir(e,u))}ir(e,t){const i=[],r=[];return t.forEach(o=>{r.push(on(e).get(o).next(s=>{if(s===null)throw X(35274,{batchId:o});Q(s.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:s.userId,batchId:o}),i.push(Vn(this.serializer,s))}))}),M.waitFor(r).next(()=>i)}removeMutationBatch(e,t){return Pg(e.he,this.userId,t).next(i=>(e.addOnCommittedListener(()=>{this.sr(t.batchId)}),M.forEach(i,r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))}sr(e){delete this.er[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return M.resolve();const i=IDBKeyRange.lowerBound(function(s){return[s]}(this.userId)),r=[];return Ci(e).te({range:i},(o,s,u)=>{if(o[0]===this.userId){const c=wt(o[1]);r.push(c)}else u.done()}).next(()=>{Q(r.length===0,56720,{_r:r.map(o=>o.canonicalString())})})})}containsKey(e,t){return kg(e,this.userId,t)}ar(e){return Mg(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:Gn,lastStreamToken:""})}}function kg(n,e,t){const i=ss(e,t.path),r=i[1],o=IDBKeyRange.lowerBound(i);let s=!1;return Ci(n).te({range:o,ee:!0},(u,c,f)=>{const[h,m,y]=u;h===e&&m===r&&(s=!0),f.done()}).next(()=>s)}function on(n){return De(n,gt)}function Ci(n){return De(n,Fi)}function Mg(n){return De(n,ro)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ti{constructor(e){this.ur=e}next(){return this.ur+=2,this.ur}static cr(){return new ti(0)}static lr(){return new ti(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QC{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.hr(e).next(t=>{const i=new ti(t.highestTargetId);return t.highestTargetId=i.next(),this.Pr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.hr(e).next(t=>ue.fromTimestamp(new qe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.hr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,i){return this.hr(e).next(r=>(r.highestListenSequenceNumber=t,i&&(r.lastRemoteSnapshotVersion=i.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Pr(e,r)))}addTargetData(e,t){return this.Tr(e,t).next(()=>this.hr(e).next(i=>(i.targetCount+=1,this.Ir(t,i),this.Pr(e,i))))}updateTargetData(e,t){return this.Tr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>_i(e).delete(t.targetId)).next(()=>this.hr(e)).next(i=>(Q(i.targetCount>0,8065),i.targetCount-=1,this.Pr(e,i)))}removeTargets(e,t,i){let r=0;const o=[];return _i(e).te((s,u)=>{const c=Ur(u);c.sequenceNumber<=t&&i.get(c.targetId)===null&&(r++,o.push(this.removeTargetData(e,c)))}).next(()=>M.waitFor(o)).next(()=>r)}forEachTarget(e,t){return _i(e).te((i,r)=>{const o=Ur(r);t(o)})}hr(e){return Ef(e).get(Rs).next(t=>(Q(t!==null,2888),t))}Pr(e,t){return Ef(e).put(Rs,t)}Tr(e,t){return _i(e).put(Ag(this.serializer,t))}Ir(e,t){let i=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,i=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,i=!0),i}getTargetCount(e){return this.hr(e).next(t=>t.targetCount)}getTargetData(e,t){const i=Zn(t),r=IDBKeyRange.bound([i,Number.NEGATIVE_INFINITY],[i,Number.POSITIVE_INFINITY]);let o=null;return _i(e).te({range:r,index:Nm},(s,u,c)=>{const f=Ur(u);Io(t,f.target)&&(o=f,c.done())}).next(()=>o)}addMatchingKeys(e,t,i){const r=[],o=hn(e);return t.forEach(s=>{const u=tt(s.path);r.push(o.put({targetId:i,path:u})),r.push(this.referenceDelegate.addReference(e,i,s))}),M.waitFor(r)}removeMatchingKeys(e,t,i){const r=hn(e);return M.forEach(t,o=>{const s=tt(o.path);return M.waitFor([r.delete([i,s]),this.referenceDelegate.removeReference(e,i,o)])})}removeMatchingKeysForTargetId(e,t){const i=hn(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return i.delete(r)}getMatchingKeysForTargetId(e,t){const i=IDBKeyRange.bound([t],[t+1],!1,!0),r=hn(e);let o=Oe();return r.te({range:i,ee:!0},(s,u,c)=>{const f=wt(s[1]),h=new W(f);o=o.add(h)}).next(()=>o)}containsKey(e,t){const i=tt(t.path),r=IDBKeyRange.bound([i],[xm(i)],!1,!0);let o=0;return hn(e).te({index:xu,ee:!0,range:r},([s,u],c,f)=>{s!==0&&(o++,f.done())}).next(()=>o>0)}Rt(e,t){return _i(e).get(t).next(i=>i?Ur(i):null)}}function _i(n){return De(n,Ui)}function Ef(n){return De(n,Hn)}function hn(n){return De(n,Bi)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const If="LruGarbageCollector",ZC=1048576;function Cf([n,e],[t,i]){const r=re(n,t);return r===0?re(e,i):r}class jC{constructor(e){this.Er=e,this.buffer=new _e(Cf),this.dr=0}Ar(){return++this.dr}Rr(e){const t=[e,this.Ar()];if(this.buffer.size<this.Er)this.buffer=this.buffer.add(t);else{const i=this.buffer.last();Cf(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}}class eA{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.Vr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.mr(6e4)}stop(){this.Vr&&(this.Vr.cancel(),this.Vr=null)}get started(){return this.Vr!==null}mr(e){H(If,`Garbage collection scheduled in ${e}ms`),this.Vr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Vr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){ai(t)?H(If,"Ignoring IndexedDB error during garbage collection: ",t):await ta(t)}await this.mr(3e5)})}}class tA{constructor(e,t){this.gr=e,this.params=t}calculateTargetCount(e,t){return this.gr.pr(e).next(i=>Math.floor(t/100*i))}nthSequenceNumber(e,t){if(t===0)return M.resolve(Tt.le);const i=new jC(t);return this.gr.forEachTarget(e,r=>i.Rr(r.sequenceNumber)).next(()=>this.gr.yr(e,r=>i.Rr(r))).next(()=>i.maxValue)}removeTargets(e,t,i){return this.gr.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.gr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(H("LruGarbageCollector","Garbage collection skipped; disabled"),M.resolve(Tf)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(H("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Tf):this.wr(e,t))}getCacheSize(e){return this.gr.getCacheSize(e)}wr(e,t){let i,r,o,s,u,c,f;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(H("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),r=this.params.maximumSequenceNumbersToCollect):r=m,s=Date.now(),this.nthSequenceNumber(e,r))).next(m=>(i=m,u=Date.now(),this.removeTargets(e,i,t))).next(m=>(o=m,c=Date.now(),this.removeOrphanedDocuments(e,i))).next(m=>(f=Date.now(),Ti()<=oe.DEBUG&&H("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-h}ms
	Determined least recently used ${r} in `+(u-s)+`ms
	Removed ${o} targets in `+(c-u)+`ms
	Removed ${m} documents in `+(f-c)+`ms
Total Duration: ${f-h}ms`),M.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:o,documentsRemoved:m})))}}function nA(n,e){return new tA(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iA{constructor(e,t){this.db=e,this.garbageCollector=nA(this,t)}pr(e){const t=this.br(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(r=>i+r))}br(e){let t=0;return this.yr(e,i=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}yr(e,t){return this.Sr(e,(i,r)=>t(r))}addReference(e,t,i){return Yo(e,i)}removeReference(e,t,i){return Yo(e,i)}removeTargets(e,t,i){return this.db.getTargetCache().removeTargets(e,t,i)}markPotentiallyOrphaned(e,t){return Yo(e,t)}Dr(e,t){return function(r,o){let s=!1;return Mg(r).ne(u=>kg(r,u,o).next(c=>(c&&(s=!0),M.resolve(!c)))).next(()=>s)}(e,t)}removeOrphanedDocuments(e,t){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let o=0;return this.Sr(e,(s,u)=>{if(u<=t){const c=this.Dr(e,s).next(f=>{if(!f)return o++,i.getEntry(e,s).next(()=>(i.removeEntry(s,ue.min()),hn(e).delete(function(m){return[0,tt(m.path)]}(s))))});r.push(c)}}).next(()=>M.waitFor(r)).next(()=>i.apply(e)).next(()=>o)}removeTarget(e,t){const i=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,i)}updateLimboDocument(e,t){return Yo(e,t)}Sr(e,t){const i=hn(e);let r,o=Tt.le;return i.te({index:xu},([s,u],{path:c,sequenceNumber:f})=>{s===0?(o!==Tt.le&&t(new W(wt(r)),o),o=f,r=c):o=Tt.le}).next(()=>{o!==Tt.le&&t(new W(wt(r)),o)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Yo(n,e){return hn(n).put(function(i,r){return{targetId:0,path:tt(i.path),sequenceNumber:r}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bg{constructor(){this.changes=new An(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Be.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return i!==void 0?M.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rA{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,i){return Pn(e).put(i)}removeEntry(e,t,i){return Pn(e).delete(function(o,s){const u=o.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Ls(s),u[u.length-1]]}(t,i))}updateMetadata(e,t){return this.getMetadata(e).next(i=>(i.byteSize+=t,this.vr(e,i)))}getEntry(e,t){let i=Be.newInvalidDocument(t);return Pn(e).te({index:as,range:IDBKeyRange.only(Nr(t))},(r,o)=>{i=this.Cr(t,o)}).next(()=>i)}Fr(e,t){let i={size:0,document:Be.newInvalidDocument(t)};return Pn(e).te({index:as,range:IDBKeyRange.only(Nr(t))},(r,o)=>{i={document:this.Cr(t,o),size:Us(o)}}).next(()=>i)}getEntries(e,t){let i=On();return this.Mr(e,t,(r,o)=>{const s=this.Cr(r,o);i=i.insert(r,s)}).next(()=>i)}Or(e,t){let i=On(),r=new ot(W.comparator);return this.Mr(e,t,(o,s)=>{const u=this.Cr(o,s);i=i.insert(o,u),r=r.insert(o,Us(s))}).next(()=>({documents:i,Nr:r}))}Mr(e,t,i){if(t.isEmpty())return M.resolve();let r=new _e(wf);t.forEach(c=>r=r.add(c));const o=IDBKeyRange.bound(Nr(r.first()),Nr(r.last())),s=r.getIterator();let u=s.getNext();return Pn(e).te({index:as,range:o},(c,f,h)=>{const m=W.fromSegments([...f.prefixPath,f.collectionGroup,f.documentId]);for(;u&&wf(u,m)<0;)i(u,null),u=s.getNext();u&&u.isEqual(m)&&(i(u,f),u=s.hasNext()?s.getNext():null),u?h.H(Nr(u)):h.done()}).next(()=>{for(;u;)i(u,null),u=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,i,r,o){const s=t.path,u=[s.popLast().toArray(),s.lastSegment(),Ls(i.readTime),i.documentKey.path.isEmpty()?"":i.documentKey.path.lastSegment()],c=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Pn(e).J(IDBKeyRange.bound(u,c,!0)).next(f=>{o==null||o.incrementDocumentReadCount(f.length);let h=On();for(const m of f){const y=this.Cr(W.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);y.isFoundDocument()&&(ua(t,y)||r.has(y.key))&&(h=h.insert(y.key,y))}return h})}getAllFromCollectionGroup(e,t,i,r){let o=On();const s=Sf(t,i),u=Sf(t,ut.max());return Pn(e).te({index:Dm,range:IDBKeyRange.bound(s,u,!0)},(c,f,h)=>{const m=this.Cr(W.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);o=o.insert(m.key,m),o.size===r&&h.done()}).next(()=>o)}newChangeBuffer(e){return new oA(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Af(e).get(Cl).next(t=>(Q(!!t,20021),t))}vr(e,t){return Af(e).put(Cl,t)}Cr(e,t){if(t){const i=$C(this.serializer,t);if(!(i.isNoDocument()&&i.version.isEqual(ue.min())))return i}return Be.newInvalidDocument(e)}}function Dg(n){return new rA(n)}class oA extends bg{constructor(e,t){super(),this.Br=e,this.trackRemovals=t,this.Lr=new An(i=>i.toString(),(i,r)=>i.isEqual(r))}applyChanges(e){const t=[];let i=0,r=new _e((o,s)=>re(o.canonicalString(),s.canonicalString()));return this.changes.forEach((o,s)=>{const u=this.Lr.get(o);if(t.push(this.Br.removeEntry(e,o,u.readTime)),s.isValidDocument()){const c=af(this.Br.serializer,s);r=r.add(o.path.popLast());const f=Us(c);i+=f-u.size,t.push(this.Br.addEntry(e,o,c))}else if(i-=u.size,this.trackRemovals){const c=af(this.Br.serializer,s.convertToNoDocument(ue.min()));t.push(this.Br.addEntry(e,o,c))}}),r.forEach(o=>{t.push(this.Br.indexManager.addToCollectionParentIndex(e,o))}),t.push(this.Br.updateMetadata(e,i)),M.waitFor(t)}getFromCache(e,t){return this.Br.Fr(e,t).next(i=>(this.Lr.set(t,{size:i.size,readTime:i.document.readTime}),i.document))}getAllFromCache(e,t){return this.Br.Or(e,t).next(({documents:i,Nr:r})=>(r.forEach((o,s)=>{this.Lr.set(o,{size:s,readTime:i.get(o).readTime})}),i))}}function Af(n){return De(n,oo)}function Pn(n){return De(n,xs)}function Nr(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Sf(n,e){const t=e.documentKey.path.toArray();return[n,Ls(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function wf(n,e){const t=n.path.toArray(),i=e.path.toArray();let r=0;for(let o=0;o<t.length-2&&o<i.length-2;++o)if(r=re(t[o],i[o]),r)return r;return r=re(t.length,i.length),r||(r=re(t[t.length-2],i[i.length-2]),r||re(t[t.length-1],i[i.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sA{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ng{constructor(e,t,i,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=r}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(i=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(i!==null&&Xr(i.mutation,r,qt.empty(),qe.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,Oe()).next(()=>i))}getLocalViewOfDocuments(e,t,i=Oe()){const r=xt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,i).next(o=>{let s=Jo();return o.forEach((u,c)=>{s=s.insert(u,c.overlayedDocument)}),s}))}getOverlayedDocuments(e,t){const i=xt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,Oe()))}populateOverlays(e,t,i){const r=[];return i.forEach(o=>{t.has(o)||r.push(o)}),this.documentOverlayCache.getOverlays(e,r).next(o=>{o.forEach((s,u)=>{t.set(s,u)})})}computeViews(e,t,i,r){let o=On();const s=Yr(),u=function(){return Yr()}();return t.forEach((c,f)=>{const h=i.get(f.key);r.has(f.key)&&(h===void 0||h.mutation instanceof lr)?o=o.insert(f.key,f):h!==void 0?(s.set(f.key,h.mutation.getFieldMask()),Xr(h.mutation,f,h.mutation.getFieldMask(),qe.now())):s.set(f.key,qt.empty())}),this.recalculateAndSaveOverlays(e,o).next(c=>(c.forEach((f,h)=>s.set(f,h)),t.forEach((f,h)=>{var m;return u.set(f,new sA(h,(m=s.get(f))!==null&&m!==void 0?m:null))}),u))}recalculateAndSaveOverlays(e,t){const i=Yr();let r=new ot((s,u)=>s-u),o=Oe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(s=>{for(const u of s)u.keys().forEach(c=>{const f=t.get(c);if(f===null)return;let h=i.get(c)||qt.empty();h=u.applyToLocalView(f,h),i.set(c,h);const m=(r.get(u.batchId)||Oe()).add(c);r=r.insert(u.batchId,m)})}).next(()=>{const s=[],u=r.getReverseIterator();for(;u.hasNext();){const c=u.getNext(),f=c.key,h=c.value,m=lg();h.forEach(y=>{if(!o.has(y)){const v=fg(t.get(y),i.get(y));v!==null&&m.set(y,v),o=o.add(y)}}),s.push(this.documentOverlayCache.saveOverlays(e,f,m))}return M.waitFor(s)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i,r){return function(s){return W.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):rC(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,r):this.getDocumentsMatchingCollectionQuery(e,t,i,r)}getNextDocuments(e,t,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,r).next(o=>{const s=r-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,r-o.size):M.resolve(xt());let u=no,c=o;return s.next(f=>M.forEach(f,(h,m)=>(u<m.largestBatchId&&(u=m.largestBatchId),o.get(h)?M.resolve():this.remoteDocumentCache.getEntry(e,h).next(y=>{c=c.insert(h,y)}))).next(()=>this.populateOverlays(e,f,o)).next(()=>this.computeViews(e,c,f,Oe())).next(h=>({batchId:u,changes:uC(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new W(t)).next(i=>{let r=Jo();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,i,r){const o=t.collectionGroup;let s=Jo();return this.indexManager.getCollectionParents(e,o).next(u=>M.forEach(u,c=>{const f=function(m,y){return new la(y,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(t,c.child(o));return this.getDocumentsMatchingCollectionQuery(e,f,i,r).next(h=>{h.forEach((m,y)=>{s=s.insert(m,y)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,i,r){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next(s=>(o=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,o,r))).next(s=>{o.forEach((c,f)=>{const h=f.getKey();s.get(h)===null&&(s=s.insert(h,Be.newInvalidDocument(h)))});let u=Jo();return s.forEach((c,f)=>{const h=o.get(c);h!==void 0&&Xr(h.mutation,f,qt.empty(),qe.now()),ua(t,f)&&(u=u.insert(c,f))}),u})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aA{constructor(e){this.serializer=e,this.kr=new Map,this.qr=new Map}getBundleMetadata(e,t){return M.resolve(this.kr.get(t))}saveBundleMetadata(e,t){return this.kr.set(t.id,function(r){return{id:r.id,version:r.version,createTime:Ct(r.createTime)}}(t)),M.resolve()}getNamedQuery(e,t){return M.resolve(this.qr.get(t))}saveNamedQuery(e,t){return this.qr.set(t.name,function(r){return{name:r.name,query:Sg(r.bundledQuery),readTime:Ct(r.readTime)}}(t)),M.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lA{constructor(){this.overlays=new ot(W.comparator),this.Qr=new Map}getOverlay(e,t){return M.resolve(this.overlays.get(t))}getOverlays(e,t){const i=xt();return M.forEach(t,r=>this.getOverlay(e,r).next(o=>{o!==null&&i.set(r,o)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((r,o)=>{this.St(e,t,o)}),M.resolve()}removeOverlaysForBatchId(e,t,i){const r=this.Qr.get(i);return r!==void 0&&(r.forEach(o=>this.overlays=this.overlays.remove(o)),this.Qr.delete(i)),M.resolve()}getOverlaysForCollection(e,t,i){const r=xt(),o=t.length+1,s=new W(t.child("")),u=this.overlays.getIteratorFrom(s);for(;u.hasNext();){const c=u.getNext().value,f=c.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===o&&c.largestBatchId>i&&r.set(c.getKey(),c)}return M.resolve(r)}getOverlaysForCollectionGroup(e,t,i,r){let o=new ot((f,h)=>f-h);const s=this.overlays.getIterator();for(;s.hasNext();){const f=s.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>i){let h=o.get(f.largestBatchId);h===null&&(h=xt(),o=o.insert(f.largestBatchId,h)),h.set(f.getKey(),f)}}const u=xt(),c=o.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((f,h)=>u.set(f,h)),!(u.size()>=r)););return M.resolve(u)}St(e,t,i){const r=this.overlays.get(i.key);if(r!==null){const s=this.Qr.get(r.largestBatchId).delete(i.key);this.Qr.set(r.largestBatchId,s)}this.overlays=this.overlays.insert(i.key,new Uu(t,i));let o=this.Qr.get(t);o===void 0&&(o=Oe(),this.Qr.set(t,o)),this.Qr.set(t,o.add(i.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uA{constructor(){this.sessionToken=ht.EMPTY_BYTE_STRING}getSessionToken(e){return M.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,M.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $u{constructor(){this.$r=new _e(Ne.Ur),this.Kr=new _e(Ne.Wr)}isEmpty(){return this.$r.isEmpty()}addReference(e,t){const i=new Ne(e,t);this.$r=this.$r.add(i),this.Kr=this.Kr.add(i)}Gr(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.zr(new Ne(e,t))}jr(e,t){e.forEach(i=>this.removeReference(i,t))}Hr(e){const t=new W(new Ce([])),i=new Ne(t,e),r=new Ne(t,e+1),o=[];return this.Kr.forEachInRange([i,r],s=>{this.zr(s),o.push(s.key)}),o}Jr(){this.$r.forEach(e=>this.zr(e))}zr(e){this.$r=this.$r.delete(e),this.Kr=this.Kr.delete(e)}Yr(e){const t=new W(new Ce([])),i=new Ne(t,e),r=new Ne(t,e+1);let o=Oe();return this.Kr.forEachInRange([i,r],s=>{o=o.add(s.key)}),o}containsKey(e){const t=new Ne(e,0),i=this.$r.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}}class Ne{constructor(e,t){this.key=e,this.Zr=t}static Ur(e,t){return W.comparator(e.key,t.key)||re(e.Zr,t.Zr)}static Wr(e,t){return re(e.Zr,t.Zr)||W.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cA{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nr=1,this.Xr=new _e(Ne.Ur)}checkEmpty(e){return M.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,r){const o=this.nr;this.nr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Lu(o,t,i,r);this.mutationQueue.push(s);for(const u of r)this.Xr=this.Xr.add(new Ne(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return M.resolve(s)}lookupMutationBatch(e,t){return M.resolve(this.ei(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,r=this.ti(i),o=r<0?0:r;return M.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return M.resolve(this.mutationQueue.length===0?Gn:this.nr-1)}getAllMutationBatches(e){return M.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new Ne(t,0),r=new Ne(t,Number.POSITIVE_INFINITY),o=[];return this.Xr.forEachInRange([i,r],s=>{const u=this.ei(s.Zr);o.push(u)}),M.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new _e(re);return t.forEach(r=>{const o=new Ne(r,0),s=new Ne(r,Number.POSITIVE_INFINITY);this.Xr.forEachInRange([o,s],u=>{i=i.add(u.Zr)})}),M.resolve(this.ni(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,r=i.length+1;let o=i;W.isDocumentKey(o)||(o=o.child(""));const s=new Ne(new W(o),0);let u=new _e(re);return this.Xr.forEachWhile(c=>{const f=c.key.path;return!!i.isPrefixOf(f)&&(f.length===r&&(u=u.add(c.Zr)),!0)},s),M.resolve(this.ni(u))}ni(e){const t=[];return e.forEach(i=>{const r=this.ei(i);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){Q(this.ri(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let i=this.Xr;return M.forEach(t.mutations,r=>{const o=new Ne(r.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Xr=i})}sr(e){}containsKey(e,t){const i=new Ne(t,0),r=this.Xr.firstAfterOrEqual(i);return M.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,M.resolve()}ri(e,t){return this.ti(e)}ti(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}ei(e){const t=this.ti(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dA{constructor(e){this.ii=e,this.docs=function(){return new ot(W.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,r=this.docs.get(i),o=r?r.size:0,s=this.ii(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:s}),this.size+=s-o,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return M.resolve(i?i.document.mutableCopy():Be.newInvalidDocument(t))}getEntries(e,t){let i=On();return t.forEach(r=>{const o=this.docs.get(r);i=i.insert(r,o?o.document.mutableCopy():Be.newInvalidDocument(r))}),M.resolve(i)}getDocumentsMatchingQuery(e,t,i,r){let o=On();const s=t.path,u=new W(s.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){const{key:f,value:{document:h}}=c.getNext();if(!s.isPrefixOf(f.path))break;f.path.length>s.length+1||Su(Rm(h),i)<=0||(r.has(h.key)||ua(t,h))&&(o=o.insert(h.key,h.mutableCopy()))}return M.resolve(o)}getAllFromCollectionGroup(e,t,i,r){X(9500)}si(e,t){return M.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new fA(this)}getSize(e){return M.resolve(this.size)}}class fA extends bg{constructor(e){super(),this.Br=e}applyChanges(e){const t=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?t.push(this.Br.addEntry(e,r)):this.Br.removeEntry(i)}),M.waitFor(t)}getFromCache(e,t){return this.Br.getEntry(e,t)}getAllFromCache(e,t){return this.Br.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hA{constructor(e){this.persistence=e,this.oi=new An(t=>Zn(t),Io),this.lastRemoteSnapshotVersion=ue.min(),this.highestTargetId=0,this._i=0,this.ai=new $u,this.targetCount=0,this.ui=ti.cr()}forEachTarget(e,t){return this.oi.forEach((i,r)=>t(r)),M.resolve()}getLastRemoteSnapshotVersion(e){return M.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return M.resolve(this._i)}allocateTargetId(e){return this.highestTargetId=this.ui.next(),M.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this._i&&(this._i=t),M.resolve()}Tr(e){this.oi.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ui=new ti(t),this.highestTargetId=t),e.sequenceNumber>this._i&&(this._i=e.sequenceNumber)}addTargetData(e,t){return this.Tr(t),this.targetCount+=1,M.resolve()}updateTargetData(e,t){return this.Tr(t),M.resolve()}removeTargetData(e,t){return this.oi.delete(t.target),this.ai.Hr(t.targetId),this.targetCount-=1,M.resolve()}removeTargets(e,t,i){let r=0;const o=[];return this.oi.forEach((s,u)=>{u.sequenceNumber<=t&&i.get(u.targetId)===null&&(this.oi.delete(s),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),r++)}),M.waitFor(o).next(()=>r)}getTargetCount(e){return M.resolve(this.targetCount)}getTargetData(e,t){const i=this.oi.get(t)||null;return M.resolve(i)}addMatchingKeys(e,t,i){return this.ai.Gr(t,i),M.resolve()}removeMatchingKeys(e,t,i){this.ai.jr(t,i);const r=this.persistence.referenceDelegate,o=[];return r&&t.forEach(s=>{o.push(r.markPotentiallyOrphaned(e,s))}),M.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.ai.Hr(t),M.resolve()}getMatchingKeysForTargetId(e,t){const i=this.ai.Yr(t);return M.resolve(i)}containsKey(e,t){return M.resolve(this.ai.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vg{constructor(e,t){this.ci={},this.overlays={},this.li=new Tt(0),this.hi=!1,this.hi=!0,this.Pi=new uA,this.referenceDelegate=e(this),this.Ti=new hA(this),this.indexManager=new YC,this.remoteDocumentCache=function(r){return new dA(r)}(i=>this.referenceDelegate.Ii(i)),this.serializer=new Cg(t),this.Ei=new aA(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.hi=!1,Promise.resolve()}get started(){return this.hi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new lA,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.ci[e.toKey()];return i||(i=new cA(t,this.referenceDelegate),this.ci[e.toKey()]=i),i}getGlobalsCache(){return this.Pi}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ei}runTransaction(e,t,i){H("MemoryPersistence","Starting transaction:",e);const r=new pA(this.li.next());return this.referenceDelegate.di(),i(r).next(o=>this.referenceDelegate.Ai(r).next(()=>o)).toPromise().then(o=>(r.raiseOnCommittedEvent(),o))}Ri(e,t){return M.or(Object.values(this.ci).map(i=>()=>i.containsKey(e,t)))}}class pA extends km{constructor(e){super(),this.currentSequenceNumber=e}}class pa{constructor(e){this.persistence=e,this.Vi=new $u,this.mi=null}static fi(e){return new pa(e)}get gi(){if(this.mi)return this.mi;throw X(60996)}addReference(e,t,i){return this.Vi.addReference(i,t),this.gi.delete(i.toString()),M.resolve()}removeReference(e,t,i){return this.Vi.removeReference(i,t),this.gi.add(i.toString()),M.resolve()}markPotentiallyOrphaned(e,t){return this.gi.add(t.toString()),M.resolve()}removeTarget(e,t){this.Vi.Hr(t.targetId).forEach(r=>this.gi.add(r.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(o=>this.gi.add(o.toString()))}).next(()=>i.removeTargetData(e,t))}di(){this.mi=new Set}Ai(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return M.forEach(this.gi,i=>{const r=W.fromPath(i);return this.pi(e,r).next(o=>{o||t.removeEntry(r,ue.min())})}).next(()=>(this.mi=null,t.apply(e)))}updateLimboDocument(e,t){return this.pi(e,t).next(i=>{i?this.gi.delete(t.toString()):this.gi.add(t.toString())})}Ii(e){return 0}pi(e,t){return M.or([()=>M.resolve(this.Vi.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ri(e,t)])}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mA{constructor(e){this.serializer=e}q(e,t,i,r){const o=new na("createOrUpgrade",t);i<1&&r>=1&&(function(c){c.createObjectStore(Eo)}(e),function(c){c.createObjectStore(ro,{keyPath:gI}),c.createObjectStore(gt,{keyPath:Od,autoIncrement:!0}).createIndex(Bn,$d,{unique:!0}),c.createObjectStore(Fi)}(e),xf(e),function(c){c.createObjectStore(Dn)}(e));let s=M.resolve();return i<3&&r>=3&&(i!==0&&(function(c){c.deleteObjectStore(Bi),c.deleteObjectStore(Ui),c.deleteObjectStore(Hn)}(e),xf(e)),s=s.next(()=>function(c){const f=c.store(Hn),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ue.min().toTimestamp(),targetCount:0};return f.put(Rs,h)}(o))),i<4&&r>=4&&(i!==0&&(s=s.next(()=>function(c,f){return f.store(gt).J().next(m=>{c.deleteObjectStore(gt),c.createObjectStore(gt,{keyPath:Od,autoIncrement:!0}).createIndex(Bn,$d,{unique:!0});const y=f.store(gt),v=m.map(x=>y.put(x));return M.waitFor(v)})}(e,o))),s=s.next(()=>{(function(c){c.createObjectStore(Oi,{keyPath:SI})})(e)})),i<5&&r>=5&&(s=s.next(()=>this.wi(o))),i<6&&r>=6&&(s=s.next(()=>(function(c){c.createObjectStore(oo)}(e),this.bi(o)))),i<7&&r>=7&&(s=s.next(()=>this.Si(o))),i<8&&r>=8&&(s=s.next(()=>this.Di(e,o))),i<9&&r>=9&&(s=s.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),i<10&&r>=10&&(s=s.next(()=>this.Ci(o))),i<11&&r>=11&&(s=s.next(()=>{(function(c){c.createObjectStore(ra,{keyPath:wI})})(e),function(c){c.createObjectStore(oa,{keyPath:xI})}(e)})),i<12&&r>=12&&(s=s.next(()=>{(function(c){const f=c.createObjectStore(sa,{keyPath:NI});f.createIndex(Sl,VI,{unique:!1}),f.createIndex(Fm,LI,{unique:!1})})(e)})),i<13&&r>=13&&(s=s.next(()=>function(c){const f=c.createObjectStore(xs,{keyPath:_I});f.createIndex(as,vI),f.createIndex(Dm,TI)}(e)).next(()=>this.Fi(e,o)).next(()=>e.deleteObjectStore(Dn))),i<14&&r>=14&&(s=s.next(()=>this.Mi(e,o))),i<15&&r>=15&&(s=s.next(()=>function(c){c.createObjectStore(Ru,{keyPath:RI,autoIncrement:!0}).createIndex(Al,PI,{unique:!1}),c.createObjectStore(zr,{keyPath:kI}).createIndex(Vm,MI,{unique:!1}),c.createObjectStore(Kr,{keyPath:bI}).createIndex(Lm,DI,{unique:!1})}(e))),i<16&&r>=16&&(s=s.next(()=>{t.objectStore(zr).clear()}).next(()=>{t.objectStore(Kr).clear()})),i<17&&r>=17&&(s=s.next(()=>{(function(c){c.createObjectStore(Pu,{keyPath:FI})})(e)})),i<18&&r>=18&&Vp()&&(s=s.next(()=>{t.objectStore(zr).clear()}).next(()=>{t.objectStore(Kr).clear()})),s}bi(e){let t=0;return e.store(Dn).te((i,r)=>{t+=Us(r)}).next(()=>{const i={byteSize:t};return e.store(oo).put(Cl,i)})}wi(e){const t=e.store(ro),i=e.store(gt);return t.J().next(r=>M.forEach(r,o=>{const s=IDBKeyRange.bound([o.userId,Gn],[o.userId,o.lastAcknowledgedBatchId]);return i.J(Bn,s).next(u=>M.forEach(u,c=>{Q(c.userId===o.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});const f=Vn(this.serializer,c);return Pg(e,o.userId,f).next(()=>{})}))}))}Si(e){const t=e.store(Bi),i=e.store(Dn);return e.store(Hn).get(Rs).next(r=>{const o=[];return i.te((s,u)=>{const c=new Ce(s),f=function(m){return[0,tt(m)]}(c);o.push(t.get(f).next(h=>h?M.resolve():(m=>t.put({targetId:0,path:tt(m),sequenceNumber:r.highestListenSequenceNumber}))(c)))}).next(()=>M.waitFor(o))})}Di(e,t){e.createObjectStore(so,{keyPath:AI});const i=t.store(so),r=new Ou,o=s=>{if(r.add(s)){const u=s.lastSegment(),c=s.popLast();return i.put({collectionId:u,parent:tt(c)})}};return t.store(Dn).te({ee:!0},(s,u)=>{const c=new Ce(s);return o(c.popLast())}).next(()=>t.store(Fi).te({ee:!0},([s,u,c],f)=>{const h=wt(u);return o(h.popLast())}))}Ci(e){const t=e.store(Ui);return t.te((i,r)=>{const o=Ur(r),s=Ag(this.serializer,o);return t.put(s)})}Fi(e,t){const i=t.store(Dn),r=[];return i.te((o,s)=>{const u=t.store(xs),c=function(m){return m.document?new W(Ce.fromString(m.document.name).popFirst(5)):m.noDocument?W.fromSegments(m.noDocument.path):m.unknownDocument?W.fromSegments(m.unknownDocument.path):X(36783)}(s).path.toArray(),f={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:s.readTime||[0,0],unknownDocument:s.unknownDocument,noDocument:s.noDocument,document:s.document,hasCommittedMutations:!!s.hasCommittedMutations};r.push(u.put(f))}).next(()=>M.waitFor(r))}Mi(e,t){const i=t.store(gt),r=Dg(this.serializer),o=new Vg(pa.fi,this.serializer.wt);return i.J().next(s=>{const u=new Map;return s.forEach(c=>{var f;let h=(f=u.get(c.userId))!==null&&f!==void 0?f:Oe();Vn(this.serializer,c).keys().forEach(m=>h=h.add(m)),u.set(c.userId,h)}),M.forEach(u,(c,f)=>{const h=new Fe(f),m=fa.bt(this.serializer,h),y=o.getIndexManager(h),v=ha.bt(h,this.serializer,y,o.referenceDelegate);return new Ng(r,v,m,y).recalculateAndSaveOverlaysForDocumentKeys(new wl(t,Tt.le),c).next()})})}}function xf(n){n.createObjectStore(Bi,{keyPath:II}).createIndex(xu,CI,{unique:!0}),n.createObjectStore(Ui,{keyPath:"targetId"}).createIndex(Nm,EI,{unique:!0}),n.createObjectStore(Hn)}const sn="IndexedDbPersistence",il=18e5,rl=5e3,ol="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",gA="main";class qu{constructor(e,t,i,r,o,s,u,c,f,h,m=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=i,this.xi=o,this.window=s,this.document=u,this.Oi=f,this.Ni=h,this.Bi=m,this.li=null,this.hi=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Li=null,this.inForeground=!1,this.ki=null,this.qi=null,this.Qi=Number.NEGATIVE_INFINITY,this.$i=y=>Promise.resolve(),!qu.C())throw new Z(B.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new iA(this,r),this.Ui=t+gA,this.serializer=new Cg(c),this.Ki=new _n(this.Ui,this.Bi,new mA(this.serializer)),this.Pi=new GC,this.Ti=new QC(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Dg(this.serializer),this.Ei=new qC,this.window&&this.window.localStorage?this.Wi=this.window.localStorage:(this.Wi=null,h===!1&&lt(sn,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Gi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Z(B.FAILED_PRECONDITION,ol);return this.zi(),this.ji(),this.Hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ti.getHighestSequenceNumber(e))}).then(e=>{this.li=new Tt(e,this.Oi)}).then(()=>{this.hi=!0}).catch(e=>(this.Ki&&this.Ki.close(),Promise.reject(e)))}Ji(e){return this.$i=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ki.U(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.xi.enqueueAndForget(async()=>{this.started&&await this.Gi()}))}Gi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Xo(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Yi(e).next(t=>{t||(this.isPrimary=!1,this.xi.enqueueRetryable(()=>this.$i(!1)))})}).next(()=>this.Zi(e)).next(t=>this.isPrimary&&!t?this.Xi(e).next(()=>!1):!!t&&this.es(e).next(()=>!0))).catch(e=>{if(ai(e))return H(sn,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return H(sn,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.xi.enqueueRetryable(()=>this.$i(e)),this.isPrimary=e})}Yi(e){return Vr(e).get(hi).next(t=>M.resolve(this.ts(t)))}ns(e){return Xo(e).delete(this.clientId)}async rs(){if(this.isPrimary&&!this.ss(this.Qi,il)){this.Qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const i=De(t,Oi);return i.J().next(r=>{const o=this._s(r,il),s=r.filter(u=>o.indexOf(u)===-1);return M.forEach(s,u=>i.delete(u.clientId)).next(()=>s)})}).catch(()=>[]);if(this.Wi)for(const t of e)this.Wi.removeItem(this.us(t.clientId))}}Hi(){this.qi=this.xi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Gi().then(()=>this.rs()).then(()=>this.Hi()))}ts(e){return!!e&&e.ownerId===this.clientId}Zi(e){return this.Ni?M.resolve(!0):Vr(e).get(hi).next(t=>{if(t!==null&&this.ss(t.leaseTimestampMs,rl)&&!this.cs(t.ownerId)){if(this.ts(t)&&this.networkEnabled)return!0;if(!this.ts(t)){if(!t.allowTabSynchronization)throw new Z(B.FAILED_PRECONDITION,ol);return!1}}return!(!this.networkEnabled||!this.inForeground)||Xo(e).J().next(i=>this._s(i,rl).find(r=>{if(this.clientId!==r.clientId){const o=!this.networkEnabled&&r.networkEnabled,s=!this.inForeground&&r.inForeground,u=this.networkEnabled===r.networkEnabled;if(o||s&&u)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&H(sn,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.hi=!1,this.ls(),this.qi&&(this.qi.cancel(),this.qi=null),this.hs(),this.Ps(),await this.Ki.runTransaction("shutdown","readwrite",[Eo,Oi],e=>{const t=new wl(e,Tt.le);return this.Xi(t).next(()=>this.ns(t))}),this.Ki.close(),this.Ts()}_s(e,t){return e.filter(i=>this.ss(i.updateTimeMs,t)&&!this.cs(i.clientId))}Is(){return this.runTransaction("getActiveClients","readonly",e=>Xo(e).J().next(t=>this._s(t,il).map(i=>i.clientId)))}get started(){return this.hi}getGlobalsCache(){return this.Pi}getMutationQueue(e,t){return ha.bt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new XC(e,this.serializer.wt.databaseId)}getDocumentOverlayCache(e){return fa.bt(this.serializer,e)}getBundleCache(){return this.Ei}runTransaction(e,t,i){H(sn,"Starting transaction:",e);const r=t==="readonly"?"readonly":"readwrite",o=function(c){return c===18?OI:c===17?$m:c===16?BI:c===15?ku:c===14?Om:c===13?Bm:c===12?UI:c===11?Um:void X(60245)}(this.Bi);let s;return this.Ki.runTransaction(e,r,o,u=>(s=new wl(u,this.li?this.li.next():Tt.le),t==="readwrite-primary"?this.Yi(s).next(c=>!!c||this.Zi(s)).next(c=>{if(!c)throw lt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.xi.enqueueRetryable(()=>this.$i(!1)),new Z(B.FAILED_PRECONDITION,Pm);return i(s)}).next(c=>this.es(s).next(()=>c)):this.Es(s).next(()=>i(s)))).then(u=>(s.raiseOnCommittedEvent(),u))}Es(e){return Vr(e).get(hi).next(t=>{if(t!==null&&this.ss(t.leaseTimestampMs,rl)&&!this.cs(t.ownerId)&&!this.ts(t)&&!(this.Ni||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Z(B.FAILED_PRECONDITION,ol)})}es(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Vr(e).put(hi,t)}static C(){return _n.C()}Xi(e){const t=Vr(e);return t.get(hi).next(i=>this.ts(i)?(H(sn,"Releasing primary lease."),t.delete(hi)):M.resolve())}ss(e,t){const i=Date.now();return!(e<i-t)&&(!(e>i)||(lt(`Detected an update time that is in the future: ${e} > ${i}`),!1))}zi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.ki=()=>{this.xi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Gi()))},this.document.addEventListener("visibilitychange",this.ki),this.inForeground=this.document.visibilityState==="visible")}hs(){this.ki&&(this.document.removeEventListener("visibilitychange",this.ki),this.ki=null)}ji(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Li=()=>{this.ls();const t=/(?:Version|Mobile)\/1[456]/;Np()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.xi.enterRestrictedMode(!0),this.xi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Li))}Ps(){this.Li&&(this.window.removeEventListener("pagehide",this.Li),this.Li=null)}cs(e){var t;try{const i=((t=this.Wi)===null||t===void 0?void 0:t.getItem(this.us(e)))!==null;return H(sn,`Client '${e}' ${i?"is":"is not"} zombied in LocalStorage`),i}catch(i){return lt(sn,"Failed to get zombied client id.",i),!1}}ls(){if(this.Wi)try{this.Wi.setItem(this.us(this.clientId),String(Date.now()))}catch(e){lt("Failed to set zombie client id.",e)}}Ts(){if(this.Wi)try{this.Wi.removeItem(this.us(this.clientId))}catch{}}us(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Vr(n){return De(n,Eo)}function Xo(n){return De(n,Oi)}function yA(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gu{constructor(e,t,i,r){this.targetId=e,this.fromCache=t,this.ds=i,this.As=r}static Rs(e,t){let i=Oe(),r=Oe();for(const o of t.docChanges)switch(o.type){case 0:i=i.add(o.doc.key);break;case 1:r=r.add(o.doc.key)}return new Gu(e,t.fromCache,i,r)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _A{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lg{constructor(){this.Vs=!1,this.fs=!1,this.gs=100,this.ps=function(){return Np()?8:Mm(be())>0?6:4}()}initialize(e,t){this.ys=e,this.indexManager=t,this.Vs=!0}getDocumentsMatchingQuery(e,t,i,r){const o={result:null};return this.ws(e,t).next(s=>{o.result=s}).next(()=>{if(!o.result)return this.bs(e,t,r,i).next(s=>{o.result=s})}).next(()=>{if(o.result)return;const s=new _A;return this.Ss(e,t,s).next(u=>{if(o.result=u,this.fs)return this.Ds(e,t,s,u.size)})}).next(()=>o.result)}Ds(e,t,i,r){return i.documentReadCount<this.gs?(Ti()<=oe.DEBUG&&H("QueryEngine","SDK will not create cache indexes for query:",kr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.gs,"documents"),M.resolve()):(Ti()<=oe.DEBUG&&H("QueryEngine","Query:",kr(t),"scans",i.documentReadCount,"local documents and returns",r,"documents as results."),i.documentReadCount>this.ps*r?(Ti()<=oe.DEBUG&&H("QueryEngine","The SDK decides to create cache indexes for query:",kr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Gt(t))):M.resolve())}ws(e,t){if(ef(t))return M.resolve(null);let i=Gt(t);return this.indexManager.getIndexType(e,i).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=bl(t,null,"F"),i=Gt(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(o=>{const s=Oe(...o);return this.ys.getDocuments(e,s).next(u=>this.indexManager.getMinOffset(e,i).next(c=>{const f=this.vs(t,u);return this.Cs(t,f,s,c.readTime)?this.ws(e,bl(t,null,"F")):this.Fs(e,f,t,c)}))})))}bs(e,t,i,r){return ef(t)||r.isEqual(ue.min())?M.resolve(null):this.ys.getDocuments(e,i).next(o=>{const s=this.vs(t,o);return this.Cs(t,s,i,r)?M.resolve(null):(Ti()<=oe.DEBUG&&H("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),kr(t)),this.Fs(e,s,t,cI(r,no)).next(u=>u))})}vs(e,t){let i=new _e(sC(e));return t.forEach((r,o)=>{ua(e,o)&&(i=i.add(o))}),i}Cs(e,t,i,r){if(e.limit===null)return!1;if(i.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(r)>0)}Ss(e,t,i){return Ti()<=oe.DEBUG&&H("QueryEngine","Using full collection scan to execute query:",kr(t)),this.ys.getDocumentsMatchingQuery(e,t,ut.min(),i)}Fs(e,t,i,r){return this.ys.getDocumentsMatchingQuery(e,i,r).next(o=>(t.forEach(s=>{o=o.insert(s.key,s)}),o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vA="LocalStore";class TA{constructor(e,t,i,r){this.persistence=e,this.Ms=t,this.serializer=r,this.xs=new ot(re),this.Os=new An(o=>Zn(o),Io),this.Ns=new Map,this.Bs=e.getRemoteDocumentCache(),this.Ti=e.getTargetCache(),this.Ei=e.getBundleCache(),this.Ls(i)}Ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ng(this.Bs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Ms.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.xs))}}function Fg(n,e,t,i){return new TA(n,e,t,i)}async function EA(n,e){const t=Ee(n);return await t.persistence.runTransaction("Handle user change","readonly",i=>{let r;return t.mutationQueue.getAllMutationBatches(i).next(o=>(r=o,t.Ls(e),t.mutationQueue.getAllMutationBatches(i))).next(o=>{const s=[],u=[];let c=Oe();for(const f of r){s.push(f.batchId);for(const h of f.mutations)c=c.add(h.key)}for(const f of o){u.push(f.batchId);for(const h of f.mutations)c=c.add(h.key)}return t.localDocuments.getDocuments(i,c).next(f=>({ks:f,removedBatchIds:s,addedBatchIds:u}))})})}function IA(n,e){const t=Ee(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const r=e.batch.keys(),o=t.Bs.newChangeBuffer({trackRemovals:!0});return function(u,c,f,h){const m=f.batch,y=m.keys();let v=M.resolve();return y.forEach(x=>{v=v.next(()=>h.getEntry(c,x)).next(R=>{const D=f.docVersions.get(x);Q(D!==null,48541),R.version.compareTo(D)<0&&(m.applyToRemoteDocument(R,f),R.isValidDocument()&&(R.setReadTime(f.commitVersion),h.addEntry(R)))})}),v.next(()=>u.mutationQueue.removeMutationBatch(c,m))}(t,i,e,o).next(()=>o.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(u){let c=Oe();for(let f=0;f<u.mutationResults.length;++f)u.mutationResults[f].transformResults.length>0&&(c=c.add(u.batch.mutations[f].key));return c}(e))).next(()=>t.localDocuments.getDocuments(i,r))})}function CA(n){const e=Ee(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ti.getLastRemoteSnapshotVersion(t))}function AA(n,e){const t=Ee(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=Gn),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}class Rf{constructor(){this.activeTargetIds=hC()}js(e){this.activeTargetIds=this.activeTargetIds.add(e)}Hs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}zs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ug{constructor(){this.xo=new Rf,this.Oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.xo.js(e),this.Oo[e]||"not-current"}updateQueryState(e,t,i){this.Oo[e]=t}removeLocalQueryTarget(e){this.xo.Hs(e)}isLocalQueryTarget(e){return this.xo.activeTargetIds.has(e)}clearQueryState(e){delete this.Oo[e]}getAllActiveQueryTargets(){return this.xo.activeTargetIds}isActiveQueryTarget(e){return this.xo.activeTargetIds.has(e)}start(){return this.xo=new Rf,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SA{No(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pf="ConnectivityMonitor";class kf{constructor(){this.Bo=()=>this.Lo(),this.ko=()=>this.qo(),this.Qo=[],this.$o()}No(e){this.Qo.push(e)}shutdown(){window.removeEventListener("online",this.Bo),window.removeEventListener("offline",this.ko)}$o(){window.addEventListener("online",this.Bo),window.addEventListener("offline",this.ko)}Lo(){H(Pf,"Network connectivity changed: AVAILABLE");for(const e of this.Qo)e(0)}qo(){H(Pf,"Network connectivity changed: UNAVAILABLE");for(const e of this.Qo)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qo=null;function Bl(){return Qo===null?Qo=function(){return 268435456+Math.round(2147483648*Math.random())}():Qo++,"0x"+Qo.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sl="RestConnection",wA={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class xA{get Uo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Ko=t+"://"+e.host,this.Wo=`projects/${i}/databases/${r}`,this.Go=this.databaseId.database===ks?`project_id=${i}`:`project_id=${i}&database_id=${r}`}zo(e,t,i,r,o){const s=Bl(),u=this.jo(e,t.toUriEncodedString());H(sl,`Sending RPC '${e}' ${s}:`,u,i);const c={"google-cloud-resource-prefix":this.Wo,"x-goog-request-params":this.Go};this.Ho(c,r,o);const{host:f}=new URL(u),h=ir(f);return this.Jo(e,u,c,i,h).then(m=>(H(sl,`Received RPC '${e}' ${s}: `,m),m),m=>{throw ea(sl,`RPC '${e}' ${s} failed with error: `,m,"url: ",u,"request:",i),m})}Yo(e,t,i,r,o,s){return this.zo(e,t,i,r,o)}Ho(e,t,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ar}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((r,o)=>e[o]=r),i&&i.headers.forEach((r,o)=>e[o]=r)}jo(e,t){const i=wA[e];return`${this.Ko}/v1/${t}:${i}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RA{constructor(e){this.Zo=e.Zo,this.Xo=e.Xo}e_(e){this.t_=e}n_(e){this.r_=e}i_(e){this.s_=e}onMessage(e){this.o_=e}close(){this.Xo()}send(e){this.Zo(e)}__(){this.t_()}a_(){this.r_()}u_(e){this.s_(e)}c_(e){this.o_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Je="WebChannelConnection";class PA extends xA{constructor(e){super(e),this.l_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,i,r,o){const s=Bl();return new Promise((u,c)=>{const f=new Tm;f.setWithCredentials(!0),f.listenOnce(Em.COMPLETE,()=>{try{switch(f.getLastErrorCode()){case rs.NO_ERROR:const m=f.getResponseJson();H(Je,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(m)),u(m);break;case rs.TIMEOUT:H(Je,`RPC '${e}' ${s} timed out`),c(new Z(B.DEADLINE_EXCEEDED,"Request time out"));break;case rs.HTTP_ERROR:const y=f.getStatus();if(H(Je,`RPC '${e}' ${s} failed with status:`,y,"response text:",f.getResponseText()),y>0){let v=f.getResponseJson();Array.isArray(v)&&(v=v[0]);const x=v==null?void 0:v.error;if(x&&x.status&&x.message){const R=function(U){const V=U.toLowerCase().replace(/_/g,"-");return Object.values(B).indexOf(V)>=0?V:B.UNKNOWN}(x.status);c(new Z(R,x.message))}else c(new Z(B.UNKNOWN,"Server responded with status "+f.getStatus()))}else c(new Z(B.UNAVAILABLE,"Connection failed."));break;default:X(9055,{h_:e,streamId:s,P_:f.getLastErrorCode(),T_:f.getLastError()})}}finally{H(Je,`RPC '${e}' ${s} completed.`)}});const h=JSON.stringify(r);H(Je,`RPC '${e}' ${s} sending request:`,r),f.send(t,"POST",h,i,15)})}I_(e,t,i){const r=Bl(),o=[this.Ko,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=Am(),u=Cm(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(c.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Ho(c.initMessageHeaders,t,i),c.encodeInitMessageHeaders=!0;const h=o.join("");H(Je,`Creating RPC '${e}' stream ${r}: ${h}`,c);const m=s.createWebChannel(h,c);this.E_(m);let y=!1,v=!1;const x=new RA({Zo:D=>{v?H(Je,`Not sending because RPC '${e}' stream ${r} is closed:`,D):(y||(H(Je,`Opening RPC '${e}' stream ${r} transport.`),m.open(),y=!0),H(Je,`RPC '${e}' stream ${r} sending:`,D),m.send(D))},Xo:()=>m.close()}),R=(D,U,V)=>{D.listen(U,N=>{try{V(N)}catch(F){setTimeout(()=>{throw F},0)}})};return R(m,Fr.EventType.OPEN,()=>{v||(H(Je,`RPC '${e}' stream ${r} transport opened.`),x.__())}),R(m,Fr.EventType.CLOSE,()=>{v||(v=!0,H(Je,`RPC '${e}' stream ${r} transport closed`),x.u_(),this.d_(m))}),R(m,Fr.EventType.ERROR,D=>{v||(v=!0,ea(Je,`RPC '${e}' stream ${r} transport errored. Name:`,D.name,"Message:",D.message),x.u_(new Z(B.UNAVAILABLE,"The operation could not be completed")))}),R(m,Fr.EventType.MESSAGE,D=>{var U;if(!v){const V=D.data[0];Q(!!V,16349);const N=V,F=(N==null?void 0:N.error)||((U=N[0])===null||U===void 0?void 0:U.error);if(F){H(Je,`RPC '${e}' stream ${r} received error:`,F);const L=F.status;let q=function(E){const w=Re[E];if(w!==void 0)return AC(w)}(L),I=F.message;q===void 0&&(q=B.INTERNAL,I="Unknown error status: "+L+" with message "+F.message),v=!0,x.u_(new Z(q,I)),m.close()}else H(Je,`RPC '${e}' stream ${r} received:`,V),x.c_(V)}}),R(u,Im.STAT_EVENT,D=>{D.stat===Tl.PROXY?H(Je,`RPC '${e}' stream ${r} detected buffering proxy`):D.stat===Tl.NOPROXY&&H(Je,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{x.a_()},0),x}terminate(){this.l_.forEach(e=>e.close()),this.l_=[]}E_(e){this.l_.push(e)}d_(e){this.l_=this.l_.filter(t=>t===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kA(){return typeof window<"u"?window:null}function fs(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bg(n){return new RC(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Og{constructor(e,t,i=1e3,r=1.5,o=6e4){this.xi=e,this.timerId=t,this.A_=i,this.R_=r,this.V_=o,this.m_=0,this.f_=null,this.g_=Date.now(),this.reset()}reset(){this.m_=0}p_(){this.m_=this.V_}y_(e){this.cancel();const t=Math.floor(this.m_+this.w_()),i=Math.max(0,Date.now()-this.g_),r=Math.max(0,t-i);r>0&&H("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.m_} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.f_=this.xi.enqueueAfterDelay(this.timerId,r,()=>(this.g_=Date.now(),e())),this.m_*=this.R_,this.m_<this.A_&&(this.m_=this.A_),this.m_>this.V_&&(this.m_=this.V_)}b_(){this.f_!==null&&(this.f_.skipDelay(),this.f_=null)}cancel(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}w_(){return(Math.random()-.5)*this.m_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mf="PersistentStream";class MA{constructor(e,t,i,r,o,s,u,c){this.xi=e,this.S_=i,this.D_=r,this.connection=o,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.v_=0,this.C_=null,this.F_=null,this.stream=null,this.M_=0,this.x_=new Og(e,t)}O_(){return this.state===1||this.state===5||this.N_()}N_(){return this.state===2||this.state===3}start(){this.M_=0,this.state!==4?this.auth():this.B_()}async stop(){this.O_()&&await this.close(0)}L_(){this.state=0,this.x_.reset()}k_(){this.N_()&&this.C_===null&&(this.C_=this.xi.enqueueAfterDelay(this.S_,6e4,()=>this.q_()))}Q_(e){this.U_(),this.stream.send(e)}async q_(){if(this.N_())return this.close(0)}U_(){this.C_&&(this.C_.cancel(),this.C_=null)}K_(){this.F_&&(this.F_.cancel(),this.F_=null)}async close(e,t){this.U_(),this.K_(),this.x_.cancel(),this.v_++,e!==4?this.x_.reset():t&&t.code===B.RESOURCE_EXHAUSTED?(lt(t.toString()),lt("Using maximum backoff delay to prevent overloading the backend."),this.x_.p_()):t&&t.code===B.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.i_(t)}W_(){}auth(){this.state=1;const e=this.G_(this.v_),t=this.v_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.v_===t&&this.z_(i,r)},i=>{e(()=>{const r=new Z(B.UNKNOWN,"Fetching auth token failed: "+i.message);return this.j_(r)})})}z_(e,t){const i=this.G_(this.v_);this.stream=this.H_(e,t),this.stream.e_(()=>{i(()=>this.listener.e_())}),this.stream.n_(()=>{i(()=>(this.state=2,this.F_=this.xi.enqueueAfterDelay(this.D_,1e4,()=>(this.N_()&&(this.state=3),Promise.resolve())),this.listener.n_()))}),this.stream.i_(r=>{i(()=>this.j_(r))}),this.stream.onMessage(r=>{i(()=>++this.M_==1?this.J_(r):this.onNext(r))})}B_(){this.state=5,this.x_.y_(async()=>{this.state=0,this.start()})}j_(e){return H(Mf,`close with error: ${e}`),this.stream=null,this.close(4,e)}G_(e){return t=>{this.xi.enqueueAndForget(()=>this.v_===e?t():(H(Mf,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class bA extends MA{constructor(e,t,i,r,o,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,r,s),this.serializer=o}get ea(){return this.M_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.ea&&this.ta([])}H_(e,t){return this.connection.I_("Write",e,t)}J_(e){return Q(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Q(!e.writeResults||e.writeResults.length===0,55816),this.listener.na()}onNext(e){Q(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.x_.reset();const t=DC(e.writeResults,e.commitTime),i=Ct(e.commitTime);return this.listener.ra(i,t)}ia(){const e={};e.database=MC(this.serializer),this.Q_(e)}ta(e){const t={streamToken:this.lastStreamToken,writes:e.map(i=>Vs(this.serializer,i))};this.Q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DA{}class NA extends DA{constructor(e,t,i,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=r,this.sa=!1}oa(){if(this.sa)throw new Z(B.FAILED_PRECONDITION,"The client has already been terminated.")}zo(e,t,i,r){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,s])=>this.connection.zo(e,Nl(t,i),r,o,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===B.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Z(B.UNKNOWN,o.toString())})}Yo(e,t,i,r,o){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,u])=>this.connection.Yo(e,Nl(t,i),r,s,u,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===B.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new Z(B.UNKNOWN,s.toString())})}terminate(){this.sa=!0,this.connection.terminate()}}class VA{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this._a=0,this.aa=null,this.ua=!0}ca(){this._a===0&&(this.la("Unknown"),this.aa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.aa=null,this.ha("Backend didn't respond within 10 seconds."),this.la("Offline"),Promise.resolve())))}Pa(e){this.state==="Online"?this.la("Unknown"):(this._a++,this._a>=1&&(this.Ta(),this.ha(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.la("Offline")))}set(e){this.Ta(),this._a=0,e==="Online"&&(this.ua=!1),this.la(e)}la(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ha(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ua?(lt(t),this.ua=!1):H("OnlineStateTracker",t)}Ta(){this.aa!==null&&(this.aa.cancel(),this.aa=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ma="RemoteStore";class LA{constructor(e,t,i,r,o){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.Ia=[],this.Ea=new Map,this.da=new Set,this.Aa=[],this.Ra=o,this.Ra.No(s=>{i.enqueueAndForget(async()=>{ya(this)&&(H(ma,"Restarting streams for network reachability change."),await async function(c){const f=Ee(c);f.da.add(4),await ga(f),f.Va.set("Unknown"),f.da.delete(4),await Hu(f)}(this))})}),this.Va=new VA(i,r)}}async function Hu(n){if(ya(n))for(const e of n.Aa)await e(!0)}async function ga(n){for(const e of n.Aa)await e(!1)}function ya(n){return Ee(n).da.size===0}async function $g(n,e,t){if(!ai(e))throw e;n.da.add(1),await ga(n),n.Va.set("Offline"),t||(t=()=>CA(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{H(ma,"Retrying IndexedDB access"),await t(),n.da.delete(1),await Hu(n)})}function qg(n,e){return e().catch(t=>$g(n,t,e))}async function _a(n){const e=Ee(n),t=In(e);let i=e.Ia.length>0?e.Ia[e.Ia.length-1].batchId:Gn;for(;FA(e);)try{const r=await AA(e.localStore,i);if(r===null){e.Ia.length===0&&t.k_();break}i=r.batchId,UA(e,r)}catch(r){await $g(e,r)}Gg(e)&&Hg(e)}function FA(n){return ya(n)&&n.Ia.length<10}function UA(n,e){n.Ia.push(e);const t=In(n);t.N_()&&t.ea&&t.ta(e.mutations)}function Gg(n){return ya(n)&&!In(n).O_()&&n.Ia.length>0}function Hg(n){In(n).start()}async function BA(n){In(n).ia()}async function OA(n){const e=In(n);for(const t of n.Ia)e.ta(t.mutations)}async function $A(n,e,t){const i=n.Ia.shift(),r=Fu.from(i,e,t);await qg(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),await _a(n)}async function qA(n,e){e&&In(n).ea&&await async function(i,r){if(function(s){return CC(s)&&s!==B.ABORTED}(r.code)){const o=i.Ia.shift();In(i).L_(),await qg(i,()=>i.remoteSyncer.rejectFailedWrite(o.batchId,r)),await _a(i)}}(n,e),Gg(n)&&Hg(n)}async function GA(n,e){const t=Ee(n);e?(t.da.delete(2),await Hu(t)):e||(t.da.add(2),await ga(t),t.Va.set("Unknown"))}function In(n){return n.ga||(n.ga=function(t,i,r){const o=Ee(t);return o.oa(),new bA(i,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,r)}(n.datastore,n.asyncQueue,{e_:()=>Promise.resolve(),n_:BA.bind(null,n),i_:qA.bind(null,n),na:OA.bind(null,n),ra:$A.bind(null,n)}),n.Aa.push(async e=>{e?(n.ga.L_(),await _a(n)):(await n.ga.stop(),n.Ia.length>0&&(H(ma,`Stopping write stream with ${n.Ia.length} pending writes`),n.Ia=[]))})),n.ga}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zu{constructor(e,t,i,r,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=r,this.removalCallback=o,this.deferred=new qn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(s=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,r,o){const s=Date.now()+i,u=new zu(e,t,s,r,o);return u.start(i),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Z(B.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function HA(n,e){if(lt("AsyncQueue",`${e}: ${n}`),ai(n))return new Z(B.UNAVAILABLE,`${e}: ${n}`);throw n}class zA{constructor(){this.queries=bf(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,i){const r=Ee(t),o=r.queries;r.queries=bf(),o.forEach((s,u)=>{for(const c of u.Sa)c.onError(i)})})(this,new Z(B.ABORTED,"Firestore shutting down"))}}function bf(){return new An(n=>sg(n),og)}function KA(n){n.Ca.forEach(e=>{e.next()})}var Df,Nf;(Nf=Df||(Df={})).xa="default",Nf.Cache="cache";const JA="SyncEngine";class WA{constructor(e,t,i,r,o,s){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=r,this.currentUser=o,this.maxConcurrentLimboResolutions=s,this.lu={},this.hu=new An(u=>sg(u),og),this.Pu=new Map,this.Tu=new Set,this.Iu=new ot(W.comparator),this.Eu=new Map,this.du=new $u,this.Au={},this.Ru=new Map,this.Vu=ti.lr(),this.onlineState="Unknown",this.mu=void 0}get isPrimaryClient(){return this.mu===!0}}function Vf(n,e,t){const i=Ee(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){const r=[];i.hu.forEach((o,s)=>{const u=s.view.Fa(e);u.snapshot&&r.push(u.snapshot)}),function(s,u){const c=Ee(s);c.onlineState=u;let f=!1;c.queries.forEach((h,m)=>{for(const y of m.Sa)y.Fa(u)&&(f=!0)}),f&&KA(c)}(i.eventManager,e),r.length&&i.lu.Y_(r),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function YA(n,e){const t=Ee(n),i=e.batch.batchId;try{const r=await IA(t.localStore,e);Kg(t,i,null),zg(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),await Ku(t,r)}catch(r){await ta(r)}}async function XA(n,e,t){const i=Ee(n);try{const r=await function(s,u){const c=Ee(s);return c.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let h;return c.mutationQueue.lookupMutationBatch(f,u).next(m=>(Q(m!==null,37113),h=m.keys(),c.mutationQueue.removeMutationBatch(f,m))).next(()=>c.mutationQueue.performConsistencyCheck(f)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(f,h,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,h)).next(()=>c.localDocuments.getDocuments(f,h))})}(i.localStore,e);Kg(i,e,t),zg(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),await Ku(i,r)}catch(r){await ta(r)}}function zg(n,e){(n.Ru.get(e)||[]).forEach(t=>{t.resolve()}),n.Ru.delete(e)}function Kg(n,e,t){const i=Ee(n);let r=i.Au[i.currentUser.toKey()];if(r){const o=r.get(e);o&&(t?o.reject(t):o.resolve(),r=r.remove(e)),i.Au[i.currentUser.toKey()]=r}}async function Ku(n,e,t){const i=Ee(n),r=[],o=[],s=[];i.hu.isEmpty()||(i.hu.forEach((u,c)=>{s.push(i.fu(c,e,t).then(f=>{var h;if((f||t)&&i.isPrimaryClient){const m=f?!f.fromCache:(h=void 0)===null||h===void 0?void 0:h.current;i.sharedClientState.updateQueryState(c.targetId,m?"current":"not-current")}if(f){r.push(f);const m=Gu.Rs(c.targetId,f);o.push(m)}}))}),await Promise.all(s),i.lu.Y_(r),await async function(c,f){const h=Ee(c);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>M.forEach(f,y=>M.forEach(y.ds,v=>h.persistence.referenceDelegate.addReference(m,y.targetId,v)).next(()=>M.forEach(y.As,v=>h.persistence.referenceDelegate.removeReference(m,y.targetId,v)))))}catch(m){if(!ai(m))throw m;H(vA,"Failed to update sequence numbers: "+m)}for(const m of f){const y=m.targetId;if(!m.fromCache){const v=h.xs.get(y),x=v.snapshotVersion,R=v.withLastLimboFreeSnapshotVersion(x);h.xs=h.xs.insert(y,R)}}}(i.localStore,o))}async function QA(n,e){const t=Ee(n);if(!t.currentUser.isEqual(e)){H(JA,"User change. New user:",e.toKey());const i=await EA(t.localStore,e);t.currentUser=e,function(o,s){o.Ru.forEach(u=>{u.forEach(c=>{c.reject(new Z(B.CANCELLED,s))})}),o.Ru.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await Ku(t,i.ks)}}function ZA(n){const e=Ee(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=YA.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=XA.bind(null,e),e}class Ol{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Bg(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Su(e),await this.persistence.start(),this.localStore=this.Du(e),this.gcScheduler=this.vu(e,this.localStore),this.indexBackfillerScheduler=this.Cu(e,this.localStore)}vu(e,t){return null}Cu(e,t){return null}Du(e){return Fg(this.persistence,new Lg,e.initialUser,this.serializer)}Su(e){return new Vg(pa.fi,this.serializer)}bu(e){return new Ug}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ol.provider={build:()=>new Ol};class jA extends Ol{constructor(e,t,i){super(),this.Fu=e,this.cacheSizeBytes=t,this.forceOwnership=i,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Fu.initialize(this,e),await ZA(this.Fu.syncEngine),await _a(this.Fu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}Du(e){return Fg(this.persistence,new Lg,e.initialUser,this.serializer)}vu(e,t){const i=this.persistence.referenceDelegate.garbageCollector;return new eA(i,e.asyncQueue,t)}Cu(e,t){const i=new pI(t,this.persistence);return new hI(e.asyncQueue,i)}Su(e){const t=yA(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),i=this.cacheSizeBytes!==void 0?it.withCacheSize(this.cacheSizeBytes):it.DEFAULT;return new qu(this.synchronizeTabs,t,e.clientId,i,e.asyncQueue,kA(),fs(),this.serializer,this.sharedClientState,!!this.forceOwnership)}bu(e){return new Ug}}class $l{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Vf(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=QA.bind(null,this.syncEngine),await GA(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new zA}()}createDatastore(e){const t=Bg(e.databaseInfo.databaseId),i=function(o){return new PA(o)}(e.databaseInfo);return function(o,s,u,c){return new NA(o,s,u,c)}(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return function(i,r,o,s,u){return new LA(i,r,o,s,u)}(this.localStore,this.datastore,e.asyncQueue,t=>Vf(this.syncEngine,t,0),function(){return kf.C()?new kf:new SA}())}createSyncEngine(e,t){return function(r,o,s,u,c,f,h){const m=new WA(r,o,s,u,c,f);return h&&(m.mu=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(r){const o=Ee(r);H(ma,"RemoteStore shutting down."),o.da.add(5),await ga(o),o.Ra.shutdown(),o.Va.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}$l.provider={build:()=>new $l};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lf="FirestoreClient";class eS{constructor(e,t,i,r,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=r,this.user=Fe.UNAUTHENTICATED,this.clientId=aI.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(i,async s=>{H(Lf,"Received user=",s.uid),await this.authCredentialListener(s),this.user=s}),this.appCheckCredentials.start(i,s=>(H(Lf,"Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new qn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=HA(t,"Failed to shutdown persistence");e.reject(i)}}),e.promise}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jg(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ff=new Map;function tS(n,e,t,i){if(e===!0&&i===!0)throw new Z(B.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function nS(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(i){return i.constructor?i.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":X(12329,{type:typeof n})}function Wg(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Z(B.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=nS(n);throw new Z(B.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yg="firestore.googleapis.com",Uf=!0;class Bf{constructor(e){var t,i;if(e.host===void 0){if(e.ssl!==void 0)throw new Z(B.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Yg,this.ssl=Uf}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:Uf;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Rg;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<ZC)throw new Z(B.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}tS("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Jg((i=e.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new Z(B.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new Z(B.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new Z(B.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(i,r){return i.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Xg{constructor(e,t,i,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Bf({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Z(B.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Z(B.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Bf(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new jE;switch(i.type){case"firstParty":return new iI(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new Z(B.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const i=Ff.get(t);i&&(H("ComponentProvider","Removing Datastore"),Ff.delete(t),i.terminate())}(this),Promise.resolve()}}function iS(n,e,t,i={}){var r;n=Wg(n,Xg);const o=ir(e),s=n._getSettings(),u=Object.assign(Object.assign({},s),{emulatorOptions:n._getEmulatorOptions()}),c=`${e}:${t}`;o&&(Mp(`https://${c}`),bp("Firestore",!0)),s.host!==Yg&&s.host!==c&&ea("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const f=Object.assign(Object.assign({},s),{host:c,ssl:o,emulatorOptions:i});if(!Wn(f,u)&&(n._setSettings(f),i.mockUserToken)){let h,m;if(typeof i.mockUserToken=="string")h=i.mockUserToken,m=Fe.MOCK_USER;else{h=P_(i.mockUserToken,(r=n._app)===null||r===void 0?void 0:r.options.projectId);const y=i.mockUserToken.sub||i.mockUserToken.user_id;if(!y)throw new Z(B.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");m=new Fe(y)}n._authCredentials=new eI(new wm(h,m))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Of="AsyncQueue";class $f{constructor(e=Promise.resolve()){this.Ju=[],this.Yu=!1,this.Zu=[],this.Xu=null,this.ec=!1,this.tc=!1,this.nc=[],this.x_=new Og(this,"async_queue_retry"),this.rc=()=>{const i=fs();i&&H(Of,"Visibility state changed to "+i.visibilityState),this.x_.b_()},this.sc=e;const t=fs();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.rc)}get isShuttingDown(){return this.Yu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.oc(),this._c(e)}enterRestrictedMode(e){if(!this.Yu){this.Yu=!0,this.tc=e||!1;const t=fs();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.rc)}}enqueue(e){if(this.oc(),this.Yu)return new Promise(()=>{});const t=new qn;return this._c(()=>this.Yu&&this.tc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ju.push(e),this.ac()))}async ac(){if(this.Ju.length!==0){try{await this.Ju[0](),this.Ju.shift(),this.x_.reset()}catch(e){if(!ai(e))throw e;H(Of,"Operation failed with retryable error: "+e)}this.Ju.length>0&&this.x_.y_(()=>this.ac())}}_c(e){const t=this.sc.then(()=>(this.ec=!0,e().catch(i=>{throw this.Xu=i,this.ec=!1,lt("INTERNAL UNHANDLED ERROR: ",qf(i)),i}).then(i=>(this.ec=!1,i))));return this.sc=t,t}enqueueAfterDelay(e,t,i){this.oc(),this.nc.indexOf(e)>-1&&(t=0);const r=zu.createAndSchedule(this,e,t,i,o=>this.uc(o));return this.Zu.push(r),r}oc(){this.Xu&&X(47125,{cc:qf(this.Xu)})}verifyOperationInProgress(){}async lc(){let e;do e=this.sc,await e;while(e!==this.sc)}hc(e){for(const t of this.Zu)if(t.timerId===e)return!0;return!1}Pc(e){return this.lc().then(()=>{this.Zu.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(const t of this.Zu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.lc()})}Tc(e){this.nc.push(e)}uc(e){const t=this.Zu.indexOf(e);this.Zu.splice(t,1)}}function qf(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class Qg extends Xg{constructor(e,t,i,r){super(e,t,i,r),this.type="firestore",this._queue=new $f,this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new $f(e),this._firestoreClient=void 0,await e}}}function rS(n,e){const t=typeof n=="object"?n:Op(),i=typeof n=="string"?n:ks,r=fu(t,"firestore").getImmediate({identifier:i});if(!r._initialized){const o=x_("firestore");o&&iS(r,...o)}return r}function oS(n){var e,t,i;const r=n._freezeSettings(),o=function(u,c,f,h){return new HI(u,c,f,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,Jg(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,r);n._componentsProvider||!((t=r.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((i=r.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider}),n._firestoreClient=new eS(n._authCredentials,n._appCheckCredentials,n._queue,o,n._componentsProvider&&function(u){const c=u==null?void 0:u._online.build();return{_offline:u==null?void 0:u._offline.build(c),_online:c}}(n._componentsProvider))}function sS(n,e){ea("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return aS(n,$l.provider,{build:i=>new jA(i,t.cacheSizeBytes,void 0)}),Promise.resolve()}function aS(n,e,t){if((n=Wg(n,Qg))._firestoreClient||n._terminated)throw new Z(B.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new Z(B.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},oS(n)}(function(e,t=!0){(function(r){ar=r})(or),Ni(new Yn("firestore",(i,{instanceIdentifier:r,options:o})=>{const s=i.getProvider("app").getImmediate(),u=new Qg(new tI(i.getProvider("auth-internal")),new rI(s,i.getProvider("app-check-internal")),function(f,h){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new Z(B.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new qi(f.options.projectId,h)}(s,r),s);return o=Object.assign({useFetchStreams:t},o),u._setSettings(o),u},"PUBLIC").setMultipleInstances(!0)),yn(Md,bd,e),yn(Md,bd,"esm2017")})();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const lS={apiKey:"AIzaSyA-9arO3bMG1IK9PoJP93LEiMCAPwyT6pg",authDomain:"agenda-9bc62.firebaseapp.com",projectId:"agenda-9bc62",storageBucket:"agenda-9bc62.appspot.com",messagingSenderId:"340413052561",appId:"1:340413052561:web:69c04c0a640050f3f7f130",measurementId:"G-X0VPQGJVGG"},bt="default-task-manager",Zg=Bp(lS),ur=QE(Zg),Ve=rS(Zg),uS=async n=>{try{await sS(Ve)}catch(e){e.code=="failed-precondition"?(console.warn("Firestore persistence failed: multiple tabs open."),n("Os dados não serão salvos offline. Mantenha apenas uma aba do app aberta.",5e3)):e.code=="unimplemented"&&(console.error("Firestore persistence not supported in this browser."),n("Seu navegador não suporta modo offline.",5e3))}};var he;(function(n){n.assertEqual=r=>{};function e(r){}n.assertIs=e;function t(r){throw new Error}n.assertNever=t,n.arrayToEnum=r=>{const o={};for(const s of r)o[s]=s;return o},n.getValidEnumValues=r=>{const o=n.objectKeys(r).filter(u=>typeof r[r[u]]!="number"),s={};for(const u of o)s[u]=r[u];return n.objectValues(s)},n.objectValues=r=>n.objectKeys(r).map(function(o){return r[o]}),n.objectKeys=typeof Object.keys=="function"?r=>Object.keys(r):r=>{const o=[];for(const s in r)Object.prototype.hasOwnProperty.call(r,s)&&o.push(s);return o},n.find=(r,o)=>{for(const s of r)if(o(s))return s},n.isInteger=typeof Number.isInteger=="function"?r=>Number.isInteger(r):r=>typeof r=="number"&&Number.isFinite(r)&&Math.floor(r)===r;function i(r,o=" | "){return r.map(s=>typeof s=="string"?`'${s}'`:s).join(o)}n.joinValues=i,n.jsonStringifyReplacer=(r,o)=>typeof o=="bigint"?o.toString():o})(he||(he={}));var Gf;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(Gf||(Gf={}));const K=he.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ln=n=>{switch(typeof n){case"undefined":return K.undefined;case"string":return K.string;case"number":return Number.isNaN(n)?K.nan:K.number;case"boolean":return K.boolean;case"function":return K.function;case"bigint":return K.bigint;case"symbol":return K.symbol;case"object":return Array.isArray(n)?K.array:n===null?K.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?K.promise:typeof Map<"u"&&n instanceof Map?K.map:typeof Set<"u"&&n instanceof Set?K.set:typeof Date<"u"&&n instanceof Date?K.date:K.object;default:return K.unknown}},$=he.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Wt extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=i=>{this.issues=[...this.issues,i]},this.addIssues=(i=[])=>{this.issues=[...this.issues,...i]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(o){return o.message},i={_errors:[]},r=o=>{for(const s of o.issues)if(s.code==="invalid_union")s.unionErrors.map(r);else if(s.code==="invalid_return_type")r(s.returnTypeError);else if(s.code==="invalid_arguments")r(s.argumentsError);else if(s.path.length===0)i._errors.push(t(s));else{let u=i,c=0;for(;c<s.path.length;){const f=s.path[c];c===s.path.length-1?(u[f]=u[f]||{_errors:[]},u[f]._errors.push(t(s))):u[f]=u[f]||{_errors:[]},u=u[f],c++}}};return r(this),i}static assert(e){if(!(e instanceof Wt))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,he.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},i=[];for(const r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):i.push(e(r));return{formErrors:i,fieldErrors:t}}get formErrors(){return this.flatten()}}Wt.create=n=>new Wt(n);const ql=(n,e)=>{let t;switch(n.code){case $.invalid_type:n.received===K.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case $.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,he.jsonStringifyReplacer)}`;break;case $.unrecognized_keys:t=`Unrecognized key(s) in object: ${he.joinValues(n.keys,", ")}`;break;case $.invalid_union:t="Invalid input";break;case $.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${he.joinValues(n.options)}`;break;case $.invalid_enum_value:t=`Invalid enum value. Expected ${he.joinValues(n.options)}, received '${n.received}'`;break;case $.invalid_arguments:t="Invalid function arguments";break;case $.invalid_return_type:t="Invalid function return type";break;case $.invalid_date:t="Invalid date";break;case $.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:he.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case $.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case $.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case $.custom:t="Invalid input";break;case $.invalid_intersection_types:t="Intersection results could not be merged";break;case $.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case $.not_finite:t="Number must be finite";break;default:t=e.defaultError,he.assertNever(n)}return{message:t}};let cS=ql;function dS(){return cS}const fS=n=>{const{data:e,path:t,errorMaps:i,issueData:r}=n,o=[...t,...r.path||[]],s={...r,path:o};if(r.message!==void 0)return{...r,path:o,message:r.message};let u="";const c=i.filter(f=>!!f).slice().reverse();for(const f of c)u=f(s,{data:e,defaultError:u}).message;return{...r,path:o,message:u}};function z(n,e){const t=dS(),i=fS({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===ql?void 0:ql].filter(r=>!!r)});n.common.issues.push(i)}class nt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const i=[];for(const r of t){if(r.status==="aborted")return te;r.status==="dirty"&&e.dirty(),i.push(r.value)}return{status:e.value,value:i}}static async mergeObjectAsync(e,t){const i=[];for(const r of t){const o=await r.key,s=await r.value;i.push({key:o,value:s})}return nt.mergeObjectSync(e,i)}static mergeObjectSync(e,t){const i={};for(const r of t){const{key:o,value:s}=r;if(o.status==="aborted"||s.status==="aborted")return te;o.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),o.value!=="__proto__"&&(typeof s.value<"u"||r.alwaysSet)&&(i[o.value]=s.value)}return{status:e.value,value:i}}}const te=Object.freeze({status:"aborted"}),Br=n=>({status:"dirty",value:n}),pt=n=>({status:"valid",value:n}),Hf=n=>n.status==="aborted",zf=n=>n.status==="dirty",Yi=n=>n.status==="valid",Bs=n=>typeof Promise<"u"&&n instanceof Promise;var J;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(J||(J={}));class Lt{constructor(e,t,i,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=i,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Kf=(n,e)=>{if(Yi(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Wt(n.common.issues);return this._error=t,this._error}}};function ie(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:i,description:r}=n;if(e&&(t||i))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:r}:{errorMap:(s,u)=>{const{message:c}=n;return s.code==="invalid_enum_value"?{message:c??u.defaultError}:typeof u.data>"u"?{message:c??i??u.defaultError}:s.code!=="invalid_type"?{message:u.defaultError}:{message:c??t??u.defaultError}},description:r}}class ae{get description(){return this._def.description}_getType(e){return ln(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:ln(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new nt,ctx:{common:e.parent.common,data:e.data,parsedType:ln(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Bs(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const i=this.safeParse(e,t);if(i.success)return i.data;throw i.error}safeParse(e,t){const i={common:{issues:[],async:(t==null?void 0:t.async)??!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ln(e)},r=this._parseSync({data:e,path:i.path,parent:i});return Kf(i,r)}"~validate"(e){var i,r;const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ln(e)};if(!this["~standard"].async)try{const o=this._parseSync({data:e,path:[],parent:t});return Yi(o)?{value:o.value}:{issues:t.common.issues}}catch(o){(r=(i=o==null?void 0:o.message)==null?void 0:i.toLowerCase())!=null&&r.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(o=>Yi(o)?{value:o.value}:{issues:t.common.issues})}async parseAsync(e,t){const i=await this.safeParseAsync(e,t);if(i.success)return i.data;throw i.error}async safeParseAsync(e,t){const i={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ln(e)},r=this._parse({data:e,path:i.path,parent:i}),o=await(Bs(r)?r:Promise.resolve(r));return Kf(i,o)}refine(e,t){const i=r=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(r):t;return this._refinement((r,o)=>{const s=e(r),u=()=>o.addIssue({code:$.custom,...i(r)});return typeof Promise<"u"&&s instanceof Promise?s.then(c=>c?!0:(u(),!1)):s?!0:(u(),!1)})}refinement(e,t){return this._refinement((i,r)=>e(i)?!0:(r.addIssue(typeof t=="function"?t(i,r):t),!1))}_refinement(e){return new Zi({schema:this,typeName:ee.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return vn.create(this,this._def)}nullable(){return ji.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Dt.create(this)}promise(){return Hs.create(this,this._def)}or(e){return $s.create([this,e],this._def)}and(e){return qs.create(this,e,this._def)}transform(e){return new Zi({...ie(this._def),schema:this,typeName:ee.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Kl({...ie(this._def),innerType:this,defaultValue:t,typeName:ee.ZodDefault})}brand(){return new VS({typeName:ee.ZodBranded,type:this,...ie(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Jl({...ie(this._def),innerType:this,catchValue:t,typeName:ee.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Ju.create(this,e)}readonly(){return Wl.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const hS=/^c[^\s-]{8,}$/i,pS=/^[0-9a-z]+$/,mS=/^[0-9A-HJKMNP-TV-Z]{26}$/i,gS=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,yS=/^[a-z0-9_-]{21}$/i,_S=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,vS=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,TS=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,ES="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let al;const IS=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,CS=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,AS=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,SS=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,wS=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,xS=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,jg="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",RS=new RegExp(`^${jg}$`);function ey(n){let e="[0-5]\\d";n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`);const t=n.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function PS(n){return new RegExp(`^${ey(n)}$`)}function kS(n){let e=`${jg}T${ey(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function MS(n,e){return!!((e==="v4"||!e)&&IS.test(n)||(e==="v6"||!e)&&AS.test(n))}function bS(n,e){if(!_S.test(n))return!1;try{const[t]=n.split("."),i=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),r=JSON.parse(atob(i));return!(typeof r!="object"||r===null||"typ"in r&&(r==null?void 0:r.typ)!=="JWT"||!r.alg||e&&r.alg!==e)}catch{return!1}}function DS(n,e){return!!((e==="v4"||!e)&&CS.test(n)||(e==="v6"||!e)&&SS.test(n))}class Rt extends ae{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==K.string){const o=this._getOrReturnCtx(e);return z(o,{code:$.invalid_type,expected:K.string,received:o.parsedType}),te}const i=new nt;let r;for(const o of this._def.checks)if(o.kind==="min")e.data.length<o.value&&(r=this._getOrReturnCtx(e,r),z(r,{code:$.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),i.dirty());else if(o.kind==="max")e.data.length>o.value&&(r=this._getOrReturnCtx(e,r),z(r,{code:$.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),i.dirty());else if(o.kind==="length"){const s=e.data.length>o.value,u=e.data.length<o.value;(s||u)&&(r=this._getOrReturnCtx(e,r),s?z(r,{code:$.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):u&&z(r,{code:$.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),i.dirty())}else if(o.kind==="email")TS.test(e.data)||(r=this._getOrReturnCtx(e,r),z(r,{validation:"email",code:$.invalid_string,message:o.message}),i.dirty());else if(o.kind==="emoji")al||(al=new RegExp(ES,"u")),al.test(e.data)||(r=this._getOrReturnCtx(e,r),z(r,{validation:"emoji",code:$.invalid_string,message:o.message}),i.dirty());else if(o.kind==="uuid")gS.test(e.data)||(r=this._getOrReturnCtx(e,r),z(r,{validation:"uuid",code:$.invalid_string,message:o.message}),i.dirty());else if(o.kind==="nanoid")yS.test(e.data)||(r=this._getOrReturnCtx(e,r),z(r,{validation:"nanoid",code:$.invalid_string,message:o.message}),i.dirty());else if(o.kind==="cuid")hS.test(e.data)||(r=this._getOrReturnCtx(e,r),z(r,{validation:"cuid",code:$.invalid_string,message:o.message}),i.dirty());else if(o.kind==="cuid2")pS.test(e.data)||(r=this._getOrReturnCtx(e,r),z(r,{validation:"cuid2",code:$.invalid_string,message:o.message}),i.dirty());else if(o.kind==="ulid")mS.test(e.data)||(r=this._getOrReturnCtx(e,r),z(r,{validation:"ulid",code:$.invalid_string,message:o.message}),i.dirty());else if(o.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),z(r,{validation:"url",code:$.invalid_string,message:o.message}),i.dirty()}else o.kind==="regex"?(o.regex.lastIndex=0,o.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),z(r,{validation:"regex",code:$.invalid_string,message:o.message}),i.dirty())):o.kind==="trim"?e.data=e.data.trim():o.kind==="includes"?e.data.includes(o.value,o.position)||(r=this._getOrReturnCtx(e,r),z(r,{code:$.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),i.dirty()):o.kind==="toLowerCase"?e.data=e.data.toLowerCase():o.kind==="toUpperCase"?e.data=e.data.toUpperCase():o.kind==="startsWith"?e.data.startsWith(o.value)||(r=this._getOrReturnCtx(e,r),z(r,{code:$.invalid_string,validation:{startsWith:o.value},message:o.message}),i.dirty()):o.kind==="endsWith"?e.data.endsWith(o.value)||(r=this._getOrReturnCtx(e,r),z(r,{code:$.invalid_string,validation:{endsWith:o.value},message:o.message}),i.dirty()):o.kind==="datetime"?kS(o).test(e.data)||(r=this._getOrReturnCtx(e,r),z(r,{code:$.invalid_string,validation:"datetime",message:o.message}),i.dirty()):o.kind==="date"?RS.test(e.data)||(r=this._getOrReturnCtx(e,r),z(r,{code:$.invalid_string,validation:"date",message:o.message}),i.dirty()):o.kind==="time"?PS(o).test(e.data)||(r=this._getOrReturnCtx(e,r),z(r,{code:$.invalid_string,validation:"time",message:o.message}),i.dirty()):o.kind==="duration"?vS.test(e.data)||(r=this._getOrReturnCtx(e,r),z(r,{validation:"duration",code:$.invalid_string,message:o.message}),i.dirty()):o.kind==="ip"?MS(e.data,o.version)||(r=this._getOrReturnCtx(e,r),z(r,{validation:"ip",code:$.invalid_string,message:o.message}),i.dirty()):o.kind==="jwt"?bS(e.data,o.alg)||(r=this._getOrReturnCtx(e,r),z(r,{validation:"jwt",code:$.invalid_string,message:o.message}),i.dirty()):o.kind==="cidr"?DS(e.data,o.version)||(r=this._getOrReturnCtx(e,r),z(r,{validation:"cidr",code:$.invalid_string,message:o.message}),i.dirty()):o.kind==="base64"?wS.test(e.data)||(r=this._getOrReturnCtx(e,r),z(r,{validation:"base64",code:$.invalid_string,message:o.message}),i.dirty()):o.kind==="base64url"?xS.test(e.data)||(r=this._getOrReturnCtx(e,r),z(r,{validation:"base64url",code:$.invalid_string,message:o.message}),i.dirty()):he.assertNever(o);return{status:i.value,value:e.data}}_regex(e,t,i){return this.refinement(r=>e.test(r),{validation:t,code:$.invalid_string,...J.errToObj(i)})}_addCheck(e){return new Rt({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...J.errToObj(e)})}url(e){return this._addCheck({kind:"url",...J.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...J.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...J.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...J.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...J.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...J.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...J.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...J.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...J.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...J.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...J.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...J.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...J.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...J.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...J.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...J.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...J.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...J.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...J.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...J.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...J.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...J.errToObj(t)})}nonempty(e){return this.min(1,J.errToObj(e))}trim(){return new Rt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Rt({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Rt({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Rt.create=n=>new Rt({checks:[],typeName:ee.ZodString,coerce:(n==null?void 0:n.coerce)??!1,...ie(n)});function NS(n,e){const t=(n.toString().split(".")[1]||"").length,i=(e.toString().split(".")[1]||"").length,r=t>i?t:i,o=Number.parseInt(n.toFixed(r).replace(".","")),s=Number.parseInt(e.toFixed(r).replace(".",""));return o%s/10**r}class ni extends ae{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==K.number){const o=this._getOrReturnCtx(e);return z(o,{code:$.invalid_type,expected:K.number,received:o.parsedType}),te}let i;const r=new nt;for(const o of this._def.checks)o.kind==="int"?he.isInteger(e.data)||(i=this._getOrReturnCtx(e,i),z(i,{code:$.invalid_type,expected:"integer",received:"float",message:o.message}),r.dirty()):o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(i=this._getOrReturnCtx(e,i),z(i,{code:$.too_small,minimum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),r.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(i=this._getOrReturnCtx(e,i),z(i,{code:$.too_big,maximum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),r.dirty()):o.kind==="multipleOf"?NS(e.data,o.value)!==0&&(i=this._getOrReturnCtx(e,i),z(i,{code:$.not_multiple_of,multipleOf:o.value,message:o.message}),r.dirty()):o.kind==="finite"?Number.isFinite(e.data)||(i=this._getOrReturnCtx(e,i),z(i,{code:$.not_finite,message:o.message}),r.dirty()):he.assertNever(o);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,J.toString(t))}gt(e,t){return this.setLimit("min",e,!1,J.toString(t))}lte(e,t){return this.setLimit("max",e,!0,J.toString(t))}lt(e,t){return this.setLimit("max",e,!1,J.toString(t))}setLimit(e,t,i,r){return new ni({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:i,message:J.toString(r)}]})}_addCheck(e){return new ni({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:J.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:J.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:J.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:J.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:J.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:J.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:J.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:J.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:J.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&he.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const i of this._def.checks){if(i.kind==="finite"||i.kind==="int"||i.kind==="multipleOf")return!0;i.kind==="min"?(t===null||i.value>t)&&(t=i.value):i.kind==="max"&&(e===null||i.value<e)&&(e=i.value)}return Number.isFinite(t)&&Number.isFinite(e)}}ni.create=n=>new ni({checks:[],typeName:ee.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...ie(n)});class ii extends ae{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==K.bigint)return this._getInvalidInput(e);let i;const r=new nt;for(const o of this._def.checks)o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(i=this._getOrReturnCtx(e,i),z(i,{code:$.too_small,type:"bigint",minimum:o.value,inclusive:o.inclusive,message:o.message}),r.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(i=this._getOrReturnCtx(e,i),z(i,{code:$.too_big,type:"bigint",maximum:o.value,inclusive:o.inclusive,message:o.message}),r.dirty()):o.kind==="multipleOf"?e.data%o.value!==BigInt(0)&&(i=this._getOrReturnCtx(e,i),z(i,{code:$.not_multiple_of,multipleOf:o.value,message:o.message}),r.dirty()):he.assertNever(o);return{status:r.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return z(t,{code:$.invalid_type,expected:K.bigint,received:t.parsedType}),te}gte(e,t){return this.setLimit("min",e,!0,J.toString(t))}gt(e,t){return this.setLimit("min",e,!1,J.toString(t))}lte(e,t){return this.setLimit("max",e,!0,J.toString(t))}lt(e,t){return this.setLimit("max",e,!1,J.toString(t))}setLimit(e,t,i,r){return new ii({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:i,message:J.toString(r)}]})}_addCheck(e){return new ii({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:J.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:J.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:J.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:J.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:J.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}ii.create=n=>new ii({checks:[],typeName:ee.ZodBigInt,coerce:(n==null?void 0:n.coerce)??!1,...ie(n)});class Os extends ae{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==K.boolean){const i=this._getOrReturnCtx(e);return z(i,{code:$.invalid_type,expected:K.boolean,received:i.parsedType}),te}return pt(e.data)}}Os.create=n=>new Os({typeName:ee.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...ie(n)});class Xi extends ae{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==K.date){const o=this._getOrReturnCtx(e);return z(o,{code:$.invalid_type,expected:K.date,received:o.parsedType}),te}if(Number.isNaN(e.data.getTime())){const o=this._getOrReturnCtx(e);return z(o,{code:$.invalid_date}),te}const i=new nt;let r;for(const o of this._def.checks)o.kind==="min"?e.data.getTime()<o.value&&(r=this._getOrReturnCtx(e,r),z(r,{code:$.too_small,message:o.message,inclusive:!0,exact:!1,minimum:o.value,type:"date"}),i.dirty()):o.kind==="max"?e.data.getTime()>o.value&&(r=this._getOrReturnCtx(e,r),z(r,{code:$.too_big,message:o.message,inclusive:!0,exact:!1,maximum:o.value,type:"date"}),i.dirty()):he.assertNever(o);return{status:i.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Xi({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:J.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:J.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Xi.create=n=>new Xi({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:ee.ZodDate,...ie(n)});class Jf extends ae{_parse(e){if(this._getType(e)!==K.symbol){const i=this._getOrReturnCtx(e);return z(i,{code:$.invalid_type,expected:K.symbol,received:i.parsedType}),te}return pt(e.data)}}Jf.create=n=>new Jf({typeName:ee.ZodSymbol,...ie(n)});class Wf extends ae{_parse(e){if(this._getType(e)!==K.undefined){const i=this._getOrReturnCtx(e);return z(i,{code:$.invalid_type,expected:K.undefined,received:i.parsedType}),te}return pt(e.data)}}Wf.create=n=>new Wf({typeName:ee.ZodUndefined,...ie(n)});class Yf extends ae{_parse(e){if(this._getType(e)!==K.null){const i=this._getOrReturnCtx(e);return z(i,{code:$.invalid_type,expected:K.null,received:i.parsedType}),te}return pt(e.data)}}Yf.create=n=>new Yf({typeName:ee.ZodNull,...ie(n)});class Xf extends ae{constructor(){super(...arguments),this._any=!0}_parse(e){return pt(e.data)}}Xf.create=n=>new Xf({typeName:ee.ZodAny,...ie(n)});class Gl extends ae{constructor(){super(...arguments),this._unknown=!0}_parse(e){return pt(e.data)}}Gl.create=n=>new Gl({typeName:ee.ZodUnknown,...ie(n)});class Cn extends ae{_parse(e){const t=this._getOrReturnCtx(e);return z(t,{code:$.invalid_type,expected:K.never,received:t.parsedType}),te}}Cn.create=n=>new Cn({typeName:ee.ZodNever,...ie(n)});class Qf extends ae{_parse(e){if(this._getType(e)!==K.undefined){const i=this._getOrReturnCtx(e);return z(i,{code:$.invalid_type,expected:K.void,received:i.parsedType}),te}return pt(e.data)}}Qf.create=n=>new Qf({typeName:ee.ZodVoid,...ie(n)});class Dt extends ae{_parse(e){const{ctx:t,status:i}=this._processInputParams(e),r=this._def;if(t.parsedType!==K.array)return z(t,{code:$.invalid_type,expected:K.array,received:t.parsedType}),te;if(r.exactLength!==null){const s=t.data.length>r.exactLength.value,u=t.data.length<r.exactLength.value;(s||u)&&(z(t,{code:s?$.too_big:$.too_small,minimum:u?r.exactLength.value:void 0,maximum:s?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),i.dirty())}if(r.minLength!==null&&t.data.length<r.minLength.value&&(z(t,{code:$.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),i.dirty()),r.maxLength!==null&&t.data.length>r.maxLength.value&&(z(t,{code:$.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),i.dirty()),t.common.async)return Promise.all([...t.data].map((s,u)=>r.type._parseAsync(new Lt(t,s,t.path,u)))).then(s=>nt.mergeArray(i,s));const o=[...t.data].map((s,u)=>r.type._parseSync(new Lt(t,s,t.path,u)));return nt.mergeArray(i,o)}get element(){return this._def.type}min(e,t){return new Dt({...this._def,minLength:{value:e,message:J.toString(t)}})}max(e,t){return new Dt({...this._def,maxLength:{value:e,message:J.toString(t)}})}length(e,t){return new Dt({...this._def,exactLength:{value:e,message:J.toString(t)}})}nonempty(e){return this.min(1,e)}}Dt.create=(n,e)=>new Dt({type:n,minLength:null,maxLength:null,exactLength:null,typeName:ee.ZodArray,...ie(e)});function Ai(n){if(n instanceof Pe){const e={};for(const t in n.shape){const i=n.shape[t];e[t]=vn.create(Ai(i))}return new Pe({...n._def,shape:()=>e})}else return n instanceof Dt?new Dt({...n._def,type:Ai(n.element)}):n instanceof vn?vn.create(Ai(n.unwrap())):n instanceof ji?ji.create(Ai(n.unwrap())):n instanceof ri?ri.create(n.items.map(e=>Ai(e))):n}class Pe extends ae{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=he.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==K.object){const f=this._getOrReturnCtx(e);return z(f,{code:$.invalid_type,expected:K.object,received:f.parsedType}),te}const{status:i,ctx:r}=this._processInputParams(e),{shape:o,keys:s}=this._getCached(),u=[];if(!(this._def.catchall instanceof Cn&&this._def.unknownKeys==="strip"))for(const f in r.data)s.includes(f)||u.push(f);const c=[];for(const f of s){const h=o[f],m=r.data[f];c.push({key:{status:"valid",value:f},value:h._parse(new Lt(r,m,r.path,f)),alwaysSet:f in r.data})}if(this._def.catchall instanceof Cn){const f=this._def.unknownKeys;if(f==="passthrough")for(const h of u)c.push({key:{status:"valid",value:h},value:{status:"valid",value:r.data[h]}});else if(f==="strict")u.length>0&&(z(r,{code:$.unrecognized_keys,keys:u}),i.dirty());else if(f!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const f=this._def.catchall;for(const h of u){const m=r.data[h];c.push({key:{status:"valid",value:h},value:f._parse(new Lt(r,m,r.path,h)),alwaysSet:h in r.data})}}return r.common.async?Promise.resolve().then(async()=>{const f=[];for(const h of c){const m=await h.key,y=await h.value;f.push({key:m,value:y,alwaysSet:h.alwaysSet})}return f}).then(f=>nt.mergeObjectSync(i,f)):nt.mergeObjectSync(i,c)}get shape(){return this._def.shape()}strict(e){return J.errToObj,new Pe({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,i)=>{var o,s;const r=((s=(o=this._def).errorMap)==null?void 0:s.call(o,t,i).message)??i.defaultError;return t.code==="unrecognized_keys"?{message:J.errToObj(e).message??r}:{message:r}}}:{}})}strip(){return new Pe({...this._def,unknownKeys:"strip"})}passthrough(){return new Pe({...this._def,unknownKeys:"passthrough"})}extend(e){return new Pe({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Pe({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:ee.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Pe({...this._def,catchall:e})}pick(e){const t={};for(const i of he.objectKeys(e))e[i]&&this.shape[i]&&(t[i]=this.shape[i]);return new Pe({...this._def,shape:()=>t})}omit(e){const t={};for(const i of he.objectKeys(this.shape))e[i]||(t[i]=this.shape[i]);return new Pe({...this._def,shape:()=>t})}deepPartial(){return Ai(this)}partial(e){const t={};for(const i of he.objectKeys(this.shape)){const r=this.shape[i];e&&!e[i]?t[i]=r:t[i]=r.optional()}return new Pe({...this._def,shape:()=>t})}required(e){const t={};for(const i of he.objectKeys(this.shape))if(e&&!e[i])t[i]=this.shape[i];else{let o=this.shape[i];for(;o instanceof vn;)o=o._def.innerType;t[i]=o}return new Pe({...this._def,shape:()=>t})}keyof(){return ty(he.objectKeys(this.shape))}}Pe.create=(n,e)=>new Pe({shape:()=>n,unknownKeys:"strip",catchall:Cn.create(),typeName:ee.ZodObject,...ie(e)});Pe.strictCreate=(n,e)=>new Pe({shape:()=>n,unknownKeys:"strict",catchall:Cn.create(),typeName:ee.ZodObject,...ie(e)});Pe.lazycreate=(n,e)=>new Pe({shape:n,unknownKeys:"strip",catchall:Cn.create(),typeName:ee.ZodObject,...ie(e)});class $s extends ae{_parse(e){const{ctx:t}=this._processInputParams(e),i=this._def.options;function r(o){for(const u of o)if(u.result.status==="valid")return u.result;for(const u of o)if(u.result.status==="dirty")return t.common.issues.push(...u.ctx.common.issues),u.result;const s=o.map(u=>new Wt(u.ctx.common.issues));return z(t,{code:$.invalid_union,unionErrors:s}),te}if(t.common.async)return Promise.all(i.map(async o=>{const s={...t,common:{...t.common,issues:[]},parent:null};return{result:await o._parseAsync({data:t.data,path:t.path,parent:s}),ctx:s}})).then(r);{let o;const s=[];for(const c of i){const f={...t,common:{...t.common,issues:[]},parent:null},h=c._parseSync({data:t.data,path:t.path,parent:f});if(h.status==="valid")return h;h.status==="dirty"&&!o&&(o={result:h,ctx:f}),f.common.issues.length&&s.push(f.common.issues)}if(o)return t.common.issues.push(...o.ctx.common.issues),o.result;const u=s.map(c=>new Wt(c));return z(t,{code:$.invalid_union,unionErrors:u}),te}}get options(){return this._def.options}}$s.create=(n,e)=>new $s({options:n,typeName:ee.ZodUnion,...ie(e)});function Hl(n,e){const t=ln(n),i=ln(e);if(n===e)return{valid:!0,data:n};if(t===K.object&&i===K.object){const r=he.objectKeys(e),o=he.objectKeys(n).filter(u=>r.indexOf(u)!==-1),s={...n,...e};for(const u of o){const c=Hl(n[u],e[u]);if(!c.valid)return{valid:!1};s[u]=c.data}return{valid:!0,data:s}}else if(t===K.array&&i===K.array){if(n.length!==e.length)return{valid:!1};const r=[];for(let o=0;o<n.length;o++){const s=n[o],u=e[o],c=Hl(s,u);if(!c.valid)return{valid:!1};r.push(c.data)}return{valid:!0,data:r}}else return t===K.date&&i===K.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class qs extends ae{_parse(e){const{status:t,ctx:i}=this._processInputParams(e),r=(o,s)=>{if(Hf(o)||Hf(s))return te;const u=Hl(o.value,s.value);return u.valid?((zf(o)||zf(s))&&t.dirty(),{status:t.value,value:u.data}):(z(i,{code:$.invalid_intersection_types}),te)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([o,s])=>r(o,s)):r(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}}qs.create=(n,e,t)=>new qs({left:n,right:e,typeName:ee.ZodIntersection,...ie(t)});class ri extends ae{_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==K.array)return z(i,{code:$.invalid_type,expected:K.array,received:i.parsedType}),te;if(i.data.length<this._def.items.length)return z(i,{code:$.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),te;!this._def.rest&&i.data.length>this._def.items.length&&(z(i,{code:$.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const o=[...i.data].map((s,u)=>{const c=this._def.items[u]||this._def.rest;return c?c._parse(new Lt(i,s,i.path,u)):null}).filter(s=>!!s);return i.common.async?Promise.all(o).then(s=>nt.mergeArray(t,s)):nt.mergeArray(t,o)}get items(){return this._def.items}rest(e){return new ri({...this._def,rest:e})}}ri.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ri({items:n,typeName:ee.ZodTuple,rest:null,...ie(e)})};class Gs extends ae{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==K.object)return z(i,{code:$.invalid_type,expected:K.object,received:i.parsedType}),te;const r=[],o=this._def.keyType,s=this._def.valueType;for(const u in i.data)r.push({key:o._parse(new Lt(i,u,i.path,u)),value:s._parse(new Lt(i,i.data[u],i.path,u)),alwaysSet:u in i.data});return i.common.async?nt.mergeObjectAsync(t,r):nt.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(e,t,i){return t instanceof ae?new Gs({keyType:e,valueType:t,typeName:ee.ZodRecord,...ie(i)}):new Gs({keyType:Rt.create(),valueType:e,typeName:ee.ZodRecord,...ie(t)})}}class Zf extends ae{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==K.map)return z(i,{code:$.invalid_type,expected:K.map,received:i.parsedType}),te;const r=this._def.keyType,o=this._def.valueType,s=[...i.data.entries()].map(([u,c],f)=>({key:r._parse(new Lt(i,u,i.path,[f,"key"])),value:o._parse(new Lt(i,c,i.path,[f,"value"]))}));if(i.common.async){const u=new Map;return Promise.resolve().then(async()=>{for(const c of s){const f=await c.key,h=await c.value;if(f.status==="aborted"||h.status==="aborted")return te;(f.status==="dirty"||h.status==="dirty")&&t.dirty(),u.set(f.value,h.value)}return{status:t.value,value:u}})}else{const u=new Map;for(const c of s){const f=c.key,h=c.value;if(f.status==="aborted"||h.status==="aborted")return te;(f.status==="dirty"||h.status==="dirty")&&t.dirty(),u.set(f.value,h.value)}return{status:t.value,value:u}}}}Zf.create=(n,e,t)=>new Zf({valueType:e,keyType:n,typeName:ee.ZodMap,...ie(t)});class fo extends ae{_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==K.set)return z(i,{code:$.invalid_type,expected:K.set,received:i.parsedType}),te;const r=this._def;r.minSize!==null&&i.data.size<r.minSize.value&&(z(i,{code:$.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),r.maxSize!==null&&i.data.size>r.maxSize.value&&(z(i,{code:$.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const o=this._def.valueType;function s(c){const f=new Set;for(const h of c){if(h.status==="aborted")return te;h.status==="dirty"&&t.dirty(),f.add(h.value)}return{status:t.value,value:f}}const u=[...i.data.values()].map((c,f)=>o._parse(new Lt(i,c,i.path,f)));return i.common.async?Promise.all(u).then(c=>s(c)):s(u)}min(e,t){return new fo({...this._def,minSize:{value:e,message:J.toString(t)}})}max(e,t){return new fo({...this._def,maxSize:{value:e,message:J.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}fo.create=(n,e)=>new fo({valueType:n,minSize:null,maxSize:null,typeName:ee.ZodSet,...ie(e)});class zl extends ae{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}zl.create=(n,e)=>new zl({getter:n,typeName:ee.ZodLazy,...ie(e)});class jf extends ae{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return z(t,{received:t.data,code:$.invalid_literal,expected:this._def.value}),te}return{status:"valid",value:e.data}}get value(){return this._def.value}}jf.create=(n,e)=>new jf({value:n,typeName:ee.ZodLiteral,...ie(e)});function ty(n,e){return new Qi({values:n,typeName:ee.ZodEnum,...ie(e)})}class Qi extends ae{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),i=this._def.values;return z(t,{expected:he.joinValues(i),received:t.parsedType,code:$.invalid_type}),te}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),i=this._def.values;return z(t,{received:t.data,code:$.invalid_enum_value,options:i}),te}return pt(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Qi.create(e,{...this._def,...t})}exclude(e,t=this._def){return Qi.create(this.options.filter(i=>!e.includes(i)),{...this._def,...t})}}Qi.create=ty;class eh extends ae{_parse(e){const t=he.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(e);if(i.parsedType!==K.string&&i.parsedType!==K.number){const r=he.objectValues(t);return z(i,{expected:he.joinValues(r),received:i.parsedType,code:$.invalid_type}),te}if(this._cache||(this._cache=new Set(he.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const r=he.objectValues(t);return z(i,{received:i.data,code:$.invalid_enum_value,options:r}),te}return pt(e.data)}get enum(){return this._def.values}}eh.create=(n,e)=>new eh({values:n,typeName:ee.ZodNativeEnum,...ie(e)});class Hs extends ae{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==K.promise&&t.common.async===!1)return z(t,{code:$.invalid_type,expected:K.promise,received:t.parsedType}),te;const i=t.parsedType===K.promise?t.data:Promise.resolve(t.data);return pt(i.then(r=>this._def.type.parseAsync(r,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Hs.create=(n,e)=>new Hs({type:n,typeName:ee.ZodPromise,...ie(e)});class Zi extends ae{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ee.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:i}=this._processInputParams(e),r=this._def.effect||null,o={addIssue:s=>{z(i,s),s.fatal?t.abort():t.dirty()},get path(){return i.path}};if(o.addIssue=o.addIssue.bind(o),r.type==="preprocess"){const s=r.transform(i.data,o);if(i.common.async)return Promise.resolve(s).then(async u=>{if(t.value==="aborted")return te;const c=await this._def.schema._parseAsync({data:u,path:i.path,parent:i});return c.status==="aborted"?te:c.status==="dirty"||t.value==="dirty"?Br(c.value):c});{if(t.value==="aborted")return te;const u=this._def.schema._parseSync({data:s,path:i.path,parent:i});return u.status==="aborted"?te:u.status==="dirty"||t.value==="dirty"?Br(u.value):u}}if(r.type==="refinement"){const s=u=>{const c=r.refinement(u,o);if(i.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return u};if(i.common.async===!1){const u=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return u.status==="aborted"?te:(u.status==="dirty"&&t.dirty(),s(u.value),{status:t.value,value:u.value})}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(u=>u.status==="aborted"?te:(u.status==="dirty"&&t.dirty(),s(u.value).then(()=>({status:t.value,value:u.value}))))}if(r.type==="transform")if(i.common.async===!1){const s=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!Yi(s))return te;const u=r.transform(s.value,o);if(u instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:u}}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(s=>Yi(s)?Promise.resolve(r.transform(s.value,o)).then(u=>({status:t.value,value:u})):te);he.assertNever(r)}}Zi.create=(n,e,t)=>new Zi({schema:n,typeName:ee.ZodEffects,effect:e,...ie(t)});Zi.createWithPreprocess=(n,e,t)=>new Zi({schema:e,effect:{type:"preprocess",transform:n},typeName:ee.ZodEffects,...ie(t)});class vn extends ae{_parse(e){return this._getType(e)===K.undefined?pt(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}vn.create=(n,e)=>new vn({innerType:n,typeName:ee.ZodOptional,...ie(e)});class ji extends ae{_parse(e){return this._getType(e)===K.null?pt(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ji.create=(n,e)=>new ji({innerType:n,typeName:ee.ZodNullable,...ie(e)});class Kl extends ae{_parse(e){const{ctx:t}=this._processInputParams(e);let i=t.data;return t.parsedType===K.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Kl.create=(n,e)=>new Kl({innerType:n,typeName:ee.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...ie(e)});class Jl extends ae{_parse(e){const{ctx:t}=this._processInputParams(e),i={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:i.data,path:i.path,parent:{...i}});return Bs(r)?r.then(o=>({status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new Wt(i.common.issues)},input:i.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new Wt(i.common.issues)},input:i.data})}}removeCatch(){return this._def.innerType}}Jl.create=(n,e)=>new Jl({innerType:n,typeName:ee.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...ie(e)});class th extends ae{_parse(e){if(this._getType(e)!==K.nan){const i=this._getOrReturnCtx(e);return z(i,{code:$.invalid_type,expected:K.nan,received:i.parsedType}),te}return{status:"valid",value:e.data}}}th.create=n=>new th({typeName:ee.ZodNaN,...ie(n)});class VS extends ae{_parse(e){const{ctx:t}=this._processInputParams(e),i=t.data;return this._def.type._parse({data:i,path:t.path,parent:t})}unwrap(){return this._def.type}}class Ju extends ae{_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.common.async)return(async()=>{const o=await this._def.in._parseAsync({data:i.data,path:i.path,parent:i});return o.status==="aborted"?te:o.status==="dirty"?(t.dirty(),Br(o.value)):this._def.out._parseAsync({data:o.value,path:i.path,parent:i})})();{const r=this._def.in._parseSync({data:i.data,path:i.path,parent:i});return r.status==="aborted"?te:r.status==="dirty"?(t.dirty(),{status:"dirty",value:r.value}):this._def.out._parseSync({data:r.value,path:i.path,parent:i})}}static create(e,t){return new Ju({in:e,out:t,typeName:ee.ZodPipeline})}}class Wl extends ae{_parse(e){const t=this._def.innerType._parse(e),i=r=>(Yi(r)&&(r.value=Object.freeze(r.value)),r);return Bs(t)?t.then(r=>i(r)):i(t)}unwrap(){return this._def.innerType}}Wl.create=(n,e)=>new Wl({innerType:n,typeName:ee.ZodReadonly,...ie(e)});var ee;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(ee||(ee={}));const kn=Rt.create,nh=ni.create;ii.create;const LS=Os.create;Xi.create;const ih=Gl.create;Cn.create;const Or=Dt.create,FS=Pe.create,US=$s.create;qs.create;ri.create;const BS=Gs.create,OS=zl.create,$S=Qi.create;Hs.create;vn.create;ji.create;const vi={string:n=>Rt.create({...n,coerce:!0}),number:n=>ni.create({...n,coerce:!0}),boolean:n=>Os.create({...n,coerce:!0}),bigint:n=>ii.create({...n,coerce:!0}),date:n=>Xi.create({...n,coerce:!0})};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let qS,GS;function HS(){return{geminiUrl:qS,vertexUrl:GS}}function zS(n,e,t){var i,r,o;if(!(!((i=n.httpOptions)===null||i===void 0)&&i.baseUrl)){const s=HS();return n.vertexai?(r=s.vertexUrl)!==null&&r!==void 0?r:e:(o=s.geminiUrl)!==null&&o!==void 0?o:t}return n.httpOptions.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class li{}function Y(n,e){const t=/\{([^}]+)\}/g;return n.replace(t,(i,r)=>{if(Object.prototype.hasOwnProperty.call(e,r)){const o=e[r];return o!=null?String(o):""}else throw new Error(`Key '${r}' not found in valueMap.`)})}function l(n,e,t){for(let o=0;o<e.length-1;o++){const s=e[o];if(s.endsWith("[]")){const u=s.slice(0,-2);if(!(u in n))if(Array.isArray(t))n[u]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${s}`);if(Array.isArray(n[u])){const c=n[u];if(Array.isArray(t))for(let f=0;f<c.length;f++){const h=c[f];l(h,e.slice(o+1),t[f])}else for(const f of c)l(f,e.slice(o+1),t)}return}else if(s.endsWith("[0]")){const u=s.slice(0,-3);u in n||(n[u]=[{}]);const c=n[u];l(c[0],e.slice(o+1),t);return}(!n[s]||typeof n[s]!="object")&&(n[s]={}),n=n[s]}const i=e[e.length-1],r=n[i];if(r!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===r)return;if(typeof r=="object"&&typeof t=="object"&&r!==null&&t!==null)Object.assign(r,t);else throw new Error(`Cannot set value for an existing key. Key: ${i}`)}else n[i]=t}function a(n,e){try{if(e.length===1&&e[0]==="_self")return n;for(let t=0;t<e.length;t++){if(typeof n!="object"||n===null)return;const i=e[t];if(i.endsWith("[]")){const r=i.slice(0,-2);if(r in n){const o=n[r];return Array.isArray(o)?o.map(s=>a(s,e.slice(t+1))):void 0}else return}else n=n[i]}return n}catch(t){if(t instanceof TypeError)return;throw t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var rh;(function(n){n.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",n.OUTCOME_OK="OUTCOME_OK",n.OUTCOME_FAILED="OUTCOME_FAILED",n.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(rh||(rh={}));var oh;(function(n){n.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",n.PYTHON="PYTHON"})(oh||(oh={}));var Pt;(function(n){n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT",n.NULL="NULL"})(Pt||(Pt={}));var sh;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(sh||(sh={}));var ah;(function(n){n.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",n.SEVERITY="SEVERITY",n.PROBABILITY="PROBABILITY"})(ah||(ah={}));var lh;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE",n.OFF="OFF"})(lh||(lh={}));var uh;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(uh||(uh={}));var ch;(function(n){n.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",n.NO_AUTH="NO_AUTH",n.API_KEY_AUTH="API_KEY_AUTH",n.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",n.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",n.OAUTH="OAUTH",n.OIDC_AUTH="OIDC_AUTH"})(ch||(ch={}));var dh;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.IMAGE_SAFETY="IMAGE_SAFETY",n.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL"})(dh||(dh={}));var fh;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(fh||(fh={}));var hh;(function(n){n.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",n.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",n.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",n.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",n.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(hh||(hh={}));var ph;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT"})(ph||(ph={}));var mh;(function(n){n.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",n.ON_DEMAND="ON_DEMAND",n.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(mh||(mh={}));var zs;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO"})(zs||(zs={}));var gh;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(gh||(gh={}));var Yl;(function(n){n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Yl||(Yl={}));var yh;(function(n){n.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",n.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",n.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",n.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",n.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",n.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",n.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(yh||(yh={}));var _h;(function(n){n.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",n.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",n.BALANCED="BALANCED",n.PRIORITIZE_COST="PRIORITIZE_COST"})(_h||(_h={}));var vh;(function(n){n.UNSPECIFIED="UNSPECIFIED",n.BLOCKING="BLOCKING",n.NON_BLOCKING="NON_BLOCKING"})(vh||(vh={}));var Th;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(Th||(Th={}));var Eh;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE"})(Eh||(Eh={}));var Ih;(function(n){n.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",n.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",n.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR"})(Ih||(Ih={}));var Ch;(function(n){n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(Ch||(Ch={}));var Ah;(function(n){n.DONT_ALLOW="DONT_ALLOW",n.ALLOW_ADULT="ALLOW_ADULT",n.ALLOW_ALL="ALLOW_ALL"})(Ah||(Ah={}));var Sh;(function(n){n.auto="auto",n.en="en",n.ja="ja",n.ko="ko",n.hi="hi"})(Sh||(Sh={}));var wh;(function(n){n.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",n.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",n.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",n.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",n.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(wh||(wh={}));var xh;(function(n){n.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",n.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",n.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",n.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(xh||(xh={}));var Rh;(function(n){n.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",n.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",n.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",n.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Rh||(Rh={}));var Ph;(function(n){n.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",n.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",n.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",n.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",n.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",n.EDIT_MODE_STYLE="EDIT_MODE_STYLE",n.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",n.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Ph||(Ph={}));var kh;(function(n){n.OPTIMIZED="OPTIMIZED",n.LOSSLESS="LOSSLESS"})(kh||(kh={}));var Mh;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.PROCESSING="PROCESSING",n.ACTIVE="ACTIVE",n.FAILED="FAILED"})(Mh||(Mh={}));var bh;(function(n){n.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",n.UPLOADED="UPLOADED",n.GENERATED="GENERATED"})(bh||(bh={}));var Dh;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.VIDEO="VIDEO",n.AUDIO="AUDIO",n.DOCUMENT="DOCUMENT"})(Dh||(Dh={}));var Nh;(function(n){n.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",n.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",n.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Nh||(Nh={}));var Vh;(function(n){n.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",n.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",n.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Vh||(Vh={}));var Lh;(function(n){n.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",n.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",n.NO_INTERRUPTION="NO_INTERRUPTION"})(Lh||(Lh={}));var Fh;(function(n){n.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",n.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",n.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Fh||(Fh={}));var Uh;(function(n){n.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",n.SILENT="SILENT",n.WHEN_IDLE="WHEN_IDLE",n.INTERRUPT="INTERRUPT"})(Uh||(Uh={}));var Bh;(function(n){n.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",n.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",n.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",n.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",n.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",n.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",n.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",n.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",n.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",n.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",n.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",n.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",n.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Bh||(Bh={}));var xi;(function(n){n.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.RESET_CONTEXT="RESET_CONTEXT"})(xi||(xi={}));class Xl{constructor(e){const t={};for(const i of e.headers.entries())t[i[0]]=i[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class Lr{get text(){var e,t,i,r,o,s,u,c;if(((r=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let f="",h=!1;const m=[];for(const y of(c=(u=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||u===void 0?void 0:u.parts)!==null&&c!==void 0?c:[]){for(const[v,x]of Object.entries(y))v!=="text"&&v!=="thought"&&(x!==null||x!==void 0)&&m.push(v);if(typeof y.text=="string"){if(typeof y.thought=="boolean"&&y.thought)continue;h=!0,f+=y.text}}return m.length>0&&console.warn(`there are non-text parts ${m} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),h?f:void 0}get data(){var e,t,i,r,o,s,u,c;if(((r=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let f="";const h=[];for(const m of(c=(u=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||u===void 0?void 0:u.parts)!==null&&c!==void 0?c:[]){for(const[y,v]of Object.entries(m))y!=="inlineData"&&(v!==null||v!==void 0)&&h.push(y);m.inlineData&&typeof m.inlineData.data=="string"&&(f+=atob(m.inlineData.data))}return h.length>0&&console.warn(`there are non-data parts ${h} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),f.length>0?btoa(f):void 0}get functionCalls(){var e,t,i,r,o,s,u,c;if(((r=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const f=(c=(u=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||u===void 0?void 0:u.parts)===null||c===void 0?void 0:c.filter(h=>h.functionCall).map(h=>h.functionCall).filter(h=>h!==void 0);if((f==null?void 0:f.length)!==0)return f}get executableCode(){var e,t,i,r,o,s,u,c,f;if(((r=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const h=(c=(u=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||u===void 0?void 0:u.parts)===null||c===void 0?void 0:c.filter(m=>m.executableCode).map(m=>m.executableCode).filter(m=>m!==void 0);if((h==null?void 0:h.length)!==0)return(f=h==null?void 0:h[0])===null||f===void 0?void 0:f.code}get codeExecutionResult(){var e,t,i,r,o,s,u,c,f;if(((r=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const h=(c=(u=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||u===void 0?void 0:u.parts)===null||c===void 0?void 0:c.filter(m=>m.codeExecutionResult).map(m=>m.codeExecutionResult).filter(m=>m!==void 0);if((h==null?void 0:h.length)!==0)return(f=h==null?void 0:h[0])===null||f===void 0?void 0:f.output}}class Oh{}class $h{}class KS{}class JS{}class qh{}class Gh{}class Hh{}class WS{}class zh{}class Kh{}class Jh{}class YS{}class XS{}class QS{}class Wh{}class ZS{get text(){var e,t,i;let r="",o=!1;const s=[];for(const u of(i=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&i!==void 0?i:[]){for(const[c,f]of Object.entries(u))c!=="text"&&c!=="thought"&&f!==null&&s.push(c);if(typeof u.text=="string"){if(typeof u.thought=="boolean"&&u.thought)continue;o=!0,r+=u.text}}return s.length>0&&console.warn(`there are non-text parts ${s} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),o?r:void 0}get data(){var e,t,i;let r="";const o=[];for(const s of(i=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&i!==void 0?i:[]){for(const[u,c]of Object.entries(s))u!=="inlineData"&&c!==null&&o.push(u);s.inlineData&&typeof s.inlineData.data=="string"&&(r+=atob(s.inlineData.data))}return o.length>0&&console.warn(`there are non-data parts ${o} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),r.length>0?btoa(r):void 0}}class jS{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function pe(n,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(n.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function ny(n,e){const t=pe(n,e);return t?t.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:t.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${t}`:t:""}function iy(n){return Array.isArray(n)?n.map(e=>Ks(e)):[Ks(n)]}function Ks(n){if(typeof n=="object"&&n!==null)return n;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof n}`)}function ew(n){const e=Ks(n);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function tw(n){const e=Ks(n);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Yh(n){if(n==null)throw new Error("PartUnion is required");if(typeof n=="object")return n;if(typeof n=="string")return{text:n};throw new Error(`Unsupported part type: ${typeof n}`)}function ry(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map(e=>Yh(e)):[Yh(n)]}function Ql(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function Xh(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function Qh(n){return n!=null&&typeof n=="object"&&"functionResponse"in n}function We(n){if(n==null)throw new Error("ContentUnion is required");return Ql(n)?n:{role:"user",parts:ry(n)}}function oy(n,e){if(!e)return[];if(n.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const i=We(t);return i.parts&&i.parts.length>0&&i.parts[0].text!==void 0?[i.parts[0].text]:[]});if(n.isVertexAI()){const t=We(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>We(t)):[We(e)]}function ft(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("contents are required");if(!Array.isArray(n)){if(Xh(n)||Qh(n))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[We(n)]}const e=[],t=[],i=Ql(n[0]);for(const r of n){const o=Ql(r);if(o!=i)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(o)e.push(r);else{if(Xh(r)||Qh(r))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(r)}}return i||e.push({role:"user",parts:ry(t)}),e}const nw=new Set(["type","format","title","description","default","items","minItems","maxItems","enum","properties","required","minProperties","maxProperties","minimum","maximum","minLength","maxLength","pattern","anyOf","propertyOrdering"]),Zh=$S(["string","number","integer","object","array","boolean","null"]),iw=US([Zh,Or(Zh)]);function rw(n=!0){const e=OS(()=>{const t=FS({type:iw.optional(),format:kn().optional(),title:kn().optional(),description:kn().optional(),default:ih().optional(),items:e.optional(),minItems:vi.string().optional(),maxItems:vi.string().optional(),enum:Or(ih()).optional(),properties:BS(kn(),e).optional(),required:Or(kn()).optional(),minProperties:vi.string().optional(),maxProperties:vi.string().optional(),propertyOrdering:Or(kn()).optional(),minimum:nh().optional(),maximum:nh().optional(),minLength:vi.string().optional(),maxLength:vi.string().optional(),pattern:kn().optional(),anyOf:Or(e).optional(),additionalProperties:LS().optional()});return n?t.strict():t});return e}function ow(n,e){n.includes("null")&&(e.nullable=!0);const t=n.filter(i=>i!=="null");if(t.length===1)e.type=Object.values(Pt).includes(t[0].toUpperCase())?t[0].toUpperCase():Pt.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const i of t)e.anyOf.push({type:Object.values(Pt).includes(i.toUpperCase())?i.toUpperCase():Pt.TYPE_UNSPECIFIED})}}function bi(n){const e={},t=["items"],i=["anyOf"],r=["properties"];if(n.type&&n.anyOf)throw new Error("type and anyOf cannot be both populated.");const o=n.anyOf;o!=null&&o.length==2&&(o[0].type==="null"?(e.nullable=!0,n=o[1]):o[1].type==="null"&&(e.nullable=!0,n=o[0])),n.type instanceof Array&&ow(n.type,e);for(const[s,u]of Object.entries(n))if(u!=null)if(s=="type"){if(u==="null")throw new Error("type: null can not be the only possible type for the field.");if(u instanceof Array)continue;e.type=Object.values(Pt).includes(u.toUpperCase())?u.toUpperCase():Pt.TYPE_UNSPECIFIED}else if(t.includes(s))e[s]=bi(u);else if(i.includes(s)){const c=[];for(const f of u){if(f.type=="null"){e.nullable=!0;continue}c.push(bi(f))}e[s]=c}else if(r.includes(s)){const c={};for(const[f,h]of Object.entries(u))c[f]=bi(h);e[s]=c}else{if(s==="additionalProperties")continue;e[s]=u}return e}function ho(n){if(Object.keys(n).includes("$schema")){delete n.$schema;const e=rw().parse(n);return bi(e)}else return bi(n)}function Wu(n){if(typeof n=="object")return n;if(typeof n=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error(`Unsupported speechConfig type: ${typeof n}`)}function Yu(n){if("multiSpeakerVoiceConfig"in n)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return n}function cr(n){if(n.functionDeclarations)for(const e of n.functionDeclarations)e.parameters&&(e.parameters=ho(e.parameters)),e.response&&(e.response=ho(e.response));return n}function dr(n){if(n==null)throw new Error("tools is required");if(!Array.isArray(n))throw new Error("tools is required and must be an array of Tools");const e=[];for(const t of n)e.push(t);return e}function sw(n,e,t,i=1){const r=!e.startsWith(`${t}/`)&&e.split("/").length===i;return n.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${n.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:r?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}/${e}`:e:r?`${t}/${e}`:e}function Xt(n,e){if(typeof e!="string")throw new Error("name must be a string");return sw(n,e,"cachedContents")}function sy(n){switch(n){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return n}}function Qt(n){if(typeof n!="string")throw new Error("fromImageBytes must be a string");return n}function aw(n){return n!=null&&typeof n=="object"&&"name"in n}function lw(n){return n!=null&&typeof n=="object"&&"video"in n}function uw(n){return n!=null&&typeof n=="object"&&"uri"in n}function ay(n){var e;let t;if(aw(n)&&(t=n.name),!(uw(n)&&(t=n.uri,t===void 0))&&!(lw(n)&&(t=(e=n.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof n=="string"&&(t=n),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){const r=t.split("files/")[1].match(/[a-z0-9]+/);if(r===null)throw new Error(`Could not extract file name from URI ${t}`);t=r[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function ly(n,e){let t;return n.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function uy(n){for(const e of["models","tunedModels","publisherModels"])if(cw(n,e))return n[e];return[]}function cw(n,e){return n!==null&&typeof n=="object"&&e in n}function dw(n,e={}){const t=n,i={name:t.name,description:t.description,parameters:bi(va(t.inputSchema))};return e.behavior&&(i.behavior=e.behavior),{functionDeclarations:[i]}}function fw(n,e={}){const t=[],i=new Set;for(const r of n){const o=r.name;if(i.has(o))throw new Error(`Duplicate function name ${o} found in MCP tools. Please ensure function names are unique.`);i.add(o);const s=dw(r,e);s.functionDeclarations&&t.push(...s.functionDeclarations)}return{functionDeclarations:t}}function hw(n){const e=[];for(const t of n)e.push(va(t));return e}function pw(n){const e={};for(const[t,i]of Object.entries(n)){const r=i;e[t]=va(r)}return e}function va(n){const e=new Set(["items"]),t=new Set(["anyOf"]),i=new Set(["properties"]),r={};for(const[o,s]of Object.entries(n))if(e.has(o))r[o]=va(s);else if(t.has(o))r[o]=hw(s);else if(i.has(o))r[o]=pw(s);else if(o==="type"){const u=s.toUpperCase();r[o]=Object.values(Pt).includes(u)?u:Pt.TYPE_UNSPECIFIED}else nw.has(o)&&(r[o]=s);return r}function cy(n,e){if(typeof e!="string"&&!Array.isArray(e)){if(n&&n.isVertexAI()){if(e.gcsUri&&e.bigqueryUri)throw new Error("Only one of `gcsUri` or `bigqueryUri` can be set.");if(!e.gcsUri&&!e.bigqueryUri)throw new Error("One of `gcsUri` or `bigqueryUri` must be set.")}else{if(e.inlinedRequests&&e.fileName)throw new Error("Only one of `inlinedRequests` or `fileName` can be set.");if(!e.inlinedRequests&&!e.fileName)throw new Error("One of `inlinedRequests` or `fileName` must be set.")}return e}else{if(Array.isArray(e))return{inlinedRequests:e};if(typeof e=="string"){if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:[e]};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};if(e.startsWith("files/"))return{fileName:e}}}throw new Error(`Unsupported source: ${e}`)}function mw(n){const e=n;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function Ta(n,e){const t=e;if(!n.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function dy(n){const e=n;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function gw(n){const e={},t=a(n,["fps"]);t!=null&&l(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&l(e,["endOffset"],i);const r=a(n,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function yw(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["data"]);t!=null&&l(e,["data"],t);const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function _w(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["fileUri"]);t!=null&&l(e,["fileUri"],t);const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function vw(n){const e={},t=a(n,["videoMetadata"]);t!=null&&l(e,["videoMetadata"],gw(t));const i=a(n,["thought"]);i!=null&&l(e,["thought"],i);const r=a(n,["inlineData"]);r!=null&&l(e,["inlineData"],yw(r));const o=a(n,["fileData"]);o!=null&&l(e,["fileData"],_w(o));const s=a(n,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);const u=a(n,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);const c=a(n,["executableCode"]);c!=null&&l(e,["executableCode"],c);const f=a(n,["functionCall"]);f!=null&&l(e,["functionCall"],f);const h=a(n,["functionResponse"]);h!=null&&l(e,["functionResponse"],h);const m=a(n,["text"]);return m!=null&&l(e,["text"],m),e}function fy(n){const e={},t=a(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>vw(o))),l(e,["parts"],r)}const i=a(n,["role"]);return i!=null&&l(e,["role"],i),e}function Tw(n){const e={},t=a(n,["anyOf"]);t!=null&&l(e,["anyOf"],t);const i=a(n,["default"]);i!=null&&l(e,["default"],i);const r=a(n,["description"]);r!=null&&l(e,["description"],r);const o=a(n,["enum"]);o!=null&&l(e,["enum"],o);const s=a(n,["example"]);s!=null&&l(e,["example"],s);const u=a(n,["format"]);u!=null&&l(e,["format"],u);const c=a(n,["items"]);c!=null&&l(e,["items"],c);const f=a(n,["maxItems"]);f!=null&&l(e,["maxItems"],f);const h=a(n,["maxLength"]);h!=null&&l(e,["maxLength"],h);const m=a(n,["maxProperties"]);m!=null&&l(e,["maxProperties"],m);const y=a(n,["maximum"]);y!=null&&l(e,["maximum"],y);const v=a(n,["minItems"]);v!=null&&l(e,["minItems"],v);const x=a(n,["minLength"]);x!=null&&l(e,["minLength"],x);const R=a(n,["minProperties"]);R!=null&&l(e,["minProperties"],R);const D=a(n,["minimum"]);D!=null&&l(e,["minimum"],D);const U=a(n,["nullable"]);U!=null&&l(e,["nullable"],U);const V=a(n,["pattern"]);V!=null&&l(e,["pattern"],V);const N=a(n,["properties"]);N!=null&&l(e,["properties"],N);const F=a(n,["propertyOrdering"]);F!=null&&l(e,["propertyOrdering"],F);const L=a(n,["required"]);L!=null&&l(e,["required"],L);const q=a(n,["title"]);q!=null&&l(e,["title"],q);const I=a(n,["type"]);return I!=null&&l(e,["type"],I),e}function Ew(n){const e={};if(a(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const t=a(n,["category"]);t!=null&&l(e,["category"],t);const i=a(n,["threshold"]);return i!=null&&l(e,["threshold"],i),e}function Iw(n){const e={},t=a(n,["behavior"]);t!=null&&l(e,["behavior"],t);const i=a(n,["description"]);i!=null&&l(e,["description"],i);const r=a(n,["name"]);r!=null&&l(e,["name"],r);const o=a(n,["parameters"]);o!=null&&l(e,["parameters"],o);const s=a(n,["parametersJsonSchema"]);s!=null&&l(e,["parametersJsonSchema"],s);const u=a(n,["response"]);u!=null&&l(e,["response"],u);const c=a(n,["responseJsonSchema"]);return c!=null&&l(e,["responseJsonSchema"],c),e}function Cw(n){const e={},t=a(n,["startTime"]);t!=null&&l(e,["startTime"],t);const i=a(n,["endTime"]);return i!=null&&l(e,["endTime"],i),e}function Aw(n){const e={},t=a(n,["timeRangeFilter"]);return t!=null&&l(e,["timeRangeFilter"],Cw(t)),e}function Sw(n){const e={},t=a(n,["mode"]);t!=null&&l(e,["mode"],t);const i=a(n,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function ww(n){const e={},t=a(n,["dynamicRetrievalConfig"]);return t!=null&&l(e,["dynamicRetrievalConfig"],Sw(t)),e}function xw(){return{}}function Rw(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(c=>Iw(c))),l(e,["functionDeclarations"],u)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=a(n,["googleSearch"]);i!=null&&l(e,["googleSearch"],Aw(i));const r=a(n,["googleSearchRetrieval"]);if(r!=null&&l(e,["googleSearchRetrieval"],ww(r)),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(a(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");a(n,["urlContext"])!=null&&l(e,["urlContext"],xw());const s=a(n,["codeExecution"]);return s!=null&&l(e,["codeExecution"],s),e}function Pw(n){const e={},t=a(n,["mode"]);t!=null&&l(e,["mode"],t);const i=a(n,["allowedFunctionNames"]);return i!=null&&l(e,["allowedFunctionNames"],i),e}function kw(n){const e={},t=a(n,["latitude"]);t!=null&&l(e,["latitude"],t);const i=a(n,["longitude"]);return i!=null&&l(e,["longitude"],i),e}function Mw(n){const e={},t=a(n,["latLng"]);t!=null&&l(e,["latLng"],kw(t));const i=a(n,["languageCode"]);return i!=null&&l(e,["languageCode"],i),e}function bw(n){const e={},t=a(n,["functionCallingConfig"]);t!=null&&l(e,["functionCallingConfig"],Pw(t));const i=a(n,["retrievalConfig"]);return i!=null&&l(e,["retrievalConfig"],Mw(i)),e}function Dw(n){const e={},t=a(n,["voiceName"]);return t!=null&&l(e,["voiceName"],t),e}function hy(n){const e={},t=a(n,["prebuiltVoiceConfig"]);return t!=null&&l(e,["prebuiltVoiceConfig"],Dw(t)),e}function Nw(n){const e={},t=a(n,["speaker"]);t!=null&&l(e,["speaker"],t);const i=a(n,["voiceConfig"]);return i!=null&&l(e,["voiceConfig"],hy(i)),e}function Vw(n){const e={},t=a(n,["speakerVoiceConfigs"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>Nw(r))),l(e,["speakerVoiceConfigs"],i)}return e}function Lw(n){const e={},t=a(n,["voiceConfig"]);t!=null&&l(e,["voiceConfig"],hy(t));const i=a(n,["multiSpeakerVoiceConfig"]);i!=null&&l(e,["multiSpeakerVoiceConfig"],Vw(i));const r=a(n,["languageCode"]);return r!=null&&l(e,["languageCode"],r),e}function Fw(n){const e={},t=a(n,["includeThoughts"]);t!=null&&l(e,["includeThoughts"],t);const i=a(n,["thinkingBudget"]);return i!=null&&l(e,["thinkingBudget"],i),e}function Uw(n,e,t){const i={},r=a(e,["systemInstruction"]);t!==void 0&&r!=null&&l(t,["systemInstruction"],fy(We(r)));const o=a(e,["temperature"]);o!=null&&l(i,["temperature"],o);const s=a(e,["topP"]);s!=null&&l(i,["topP"],s);const u=a(e,["topK"]);u!=null&&l(i,["topK"],u);const c=a(e,["candidateCount"]);c!=null&&l(i,["candidateCount"],c);const f=a(e,["maxOutputTokens"]);f!=null&&l(i,["maxOutputTokens"],f);const h=a(e,["stopSequences"]);h!=null&&l(i,["stopSequences"],h);const m=a(e,["responseLogprobs"]);m!=null&&l(i,["responseLogprobs"],m);const y=a(e,["logprobs"]);y!=null&&l(i,["logprobs"],y);const v=a(e,["presencePenalty"]);v!=null&&l(i,["presencePenalty"],v);const x=a(e,["frequencyPenalty"]);x!=null&&l(i,["frequencyPenalty"],x);const R=a(e,["seed"]);R!=null&&l(i,["seed"],R);const D=a(e,["responseMimeType"]);D!=null&&l(i,["responseMimeType"],D);const U=a(e,["responseSchema"]);U!=null&&l(i,["responseSchema"],Tw(ho(U)));const V=a(e,["responseJsonSchema"]);if(V!=null&&l(i,["responseJsonSchema"],V),a(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(a(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const N=a(e,["safetySettings"]);if(t!==void 0&&N!=null){let C=N;Array.isArray(C)&&(C=C.map(P=>Ew(P))),l(t,["safetySettings"],C)}const F=a(e,["tools"]);if(t!==void 0&&F!=null){let C=dr(F);Array.isArray(C)&&(C=C.map(P=>Rw(cr(P)))),l(t,["tools"],C)}const L=a(e,["toolConfig"]);if(t!==void 0&&L!=null&&l(t,["toolConfig"],bw(L)),a(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const q=a(e,["cachedContent"]);t!==void 0&&q!=null&&l(t,["cachedContent"],Xt(n,q));const I=a(e,["responseModalities"]);I!=null&&l(i,["responseModalities"],I);const T=a(e,["mediaResolution"]);T!=null&&l(i,["mediaResolution"],T);const E=a(e,["speechConfig"]);if(E!=null&&l(i,["speechConfig"],Lw(Wu(E))),a(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const w=a(e,["thinkingConfig"]);return w!=null&&l(i,["thinkingConfig"],Fw(w)),i}function Bw(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["request","model"],pe(n,i));const r=a(e,["contents"]);if(r!=null){let s=ft(r);Array.isArray(s)&&(s=s.map(u=>fy(u))),l(t,["request","contents"],s)}const o=a(e,["config"]);return o!=null&&l(t,["request","generationConfig"],Uw(n,o,t)),t}function Ow(n,e){const t={};if(a(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(a(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(a(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const i=a(e,["fileName"]);i!=null&&l(t,["fileName"],i);const r=a(e,["inlinedRequests"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>Bw(n,s))),l(t,["requests","requests"],o)}return t}function $w(n,e){const t={},i=a(n,["displayName"]);if(e!==void 0&&i!=null&&l(e,["batch","displayName"],i),a(n,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function qw(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],pe(n,i));const r=a(e,["src"]);r!=null&&l(t,["batch","inputConfig"],Ow(n,cy(n,r)));const o=a(e,["config"]);return o!=null&&l(t,["config"],$w(o,t)),t}function Gw(n,e){const t={},i=a(e,["name"]);i!=null&&l(t,["_url","name"],Ta(n,i));const r=a(e,["config"]);return r!=null&&l(t,["config"],r),t}function Hw(n,e){const t={},i=a(e,["name"]);i!=null&&l(t,["_url","name"],Ta(n,i));const r=a(e,["config"]);return r!=null&&l(t,["config"],r),t}function zw(n,e){const t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const r=a(n,["pageToken"]);if(e!==void 0&&r!=null&&l(e,["_query","pageToken"],r),a(n,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function Kw(n){const e={},t=a(n,["config"]);return t!=null&&l(e,["config"],zw(t,e)),e}function Jw(n){const e={},t=a(n,["format"]);t!=null&&l(e,["instancesFormat"],t);const i=a(n,["gcsUri"]);i!=null&&l(e,["gcsSource","uris"],i);const r=a(n,["bigqueryUri"]);if(r!=null&&l(e,["bigquerySource","inputUri"],r),a(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(a(n,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function Ww(n){const e={},t=a(n,["format"]);t!=null&&l(e,["predictionsFormat"],t);const i=a(n,["gcsUri"]);i!=null&&l(e,["gcsDestination","outputUriPrefix"],i);const r=a(n,["bigqueryUri"]);if(r!=null&&l(e,["bigqueryDestination","outputUri"],r),a(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(a(n,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");return e}function Yw(n,e){const t={},i=a(n,["displayName"]);e!==void 0&&i!=null&&l(e,["displayName"],i);const r=a(n,["dest"]);return e!==void 0&&r!=null&&l(e,["outputConfig"],Ww(mw(r))),t}function Xw(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["model"],pe(n,i));const r=a(e,["src"]);r!=null&&l(t,["inputConfig"],Jw(cy(n,r)));const o=a(e,["config"]);return o!=null&&l(t,["config"],Yw(o,t)),t}function Qw(n,e){const t={},i=a(e,["name"]);i!=null&&l(t,["_url","name"],Ta(n,i));const r=a(e,["config"]);return r!=null&&l(t,["config"],r),t}function Zw(n,e){const t={},i=a(e,["name"]);i!=null&&l(t,["_url","name"],Ta(n,i));const r=a(e,["config"]);return r!=null&&l(t,["config"],r),t}function jw(n,e){const t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const r=a(n,["pageToken"]);e!==void 0&&r!=null&&l(e,["_query","pageToken"],r);const o=a(n,["filter"]);return e!==void 0&&o!=null&&l(e,["_query","filter"],o),t}function e0(n){const e={},t=a(n,["config"]);return t!=null&&l(e,["config"],jw(t,e)),e}function t0(){return{}}function n0(n){const e={},t=a(n,["fps"]);t!=null&&l(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&l(e,["endOffset"],i);const r=a(n,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function i0(n){const e={},t=a(n,["data"]);t!=null&&l(e,["data"],t);const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function r0(n){const e={},t=a(n,["fileUri"]);t!=null&&l(e,["fileUri"],t);const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function o0(n){const e={},t=a(n,["videoMetadata"]);t!=null&&l(e,["videoMetadata"],n0(t));const i=a(n,["thought"]);i!=null&&l(e,["thought"],i);const r=a(n,["inlineData"]);r!=null&&l(e,["inlineData"],i0(r));const o=a(n,["fileData"]);o!=null&&l(e,["fileData"],r0(o));const s=a(n,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);const u=a(n,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);const c=a(n,["executableCode"]);c!=null&&l(e,["executableCode"],c);const f=a(n,["functionCall"]);f!=null&&l(e,["functionCall"],f);const h=a(n,["functionResponse"]);h!=null&&l(e,["functionResponse"],h);const m=a(n,["text"]);return m!=null&&l(e,["text"],m),e}function s0(n){const e={},t=a(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>o0(o))),l(e,["parts"],r)}const i=a(n,["role"]);return i!=null&&l(e,["role"],i),e}function a0(n){const e={},t=a(n,["citationSources"]);return t!=null&&l(e,["citations"],t),e}function l0(n){const e={},t=a(n,["retrievedUrl"]);t!=null&&l(e,["retrievedUrl"],t);const i=a(n,["urlRetrievalStatus"]);return i!=null&&l(e,["urlRetrievalStatus"],i),e}function u0(n){const e={},t=a(n,["urlMetadata"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>l0(r))),l(e,["urlMetadata"],i)}return e}function c0(n){const e={},t=a(n,["content"]);t!=null&&l(e,["content"],s0(t));const i=a(n,["citationMetadata"]);i!=null&&l(e,["citationMetadata"],a0(i));const r=a(n,["tokenCount"]);r!=null&&l(e,["tokenCount"],r);const o=a(n,["finishReason"]);o!=null&&l(e,["finishReason"],o);const s=a(n,["urlContextMetadata"]);s!=null&&l(e,["urlContextMetadata"],u0(s));const u=a(n,["avgLogprobs"]);u!=null&&l(e,["avgLogprobs"],u);const c=a(n,["groundingMetadata"]);c!=null&&l(e,["groundingMetadata"],c);const f=a(n,["index"]);f!=null&&l(e,["index"],f);const h=a(n,["logprobsResult"]);h!=null&&l(e,["logprobsResult"],h);const m=a(n,["safetyRatings"]);return m!=null&&l(e,["safetyRatings"],m),e}function d0(n){const e={},t=a(n,["candidates"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(u=>c0(u))),l(e,["candidates"],s)}const i=a(n,["modelVersion"]);i!=null&&l(e,["modelVersion"],i);const r=a(n,["promptFeedback"]);r!=null&&l(e,["promptFeedback"],r);const o=a(n,["usageMetadata"]);return o!=null&&l(e,["usageMetadata"],o),e}function f0(n){const e={},t=a(n,["response"]);return t!=null&&l(e,["response"],d0(t)),a(n,["error"])!=null&&l(e,["error"],t0()),e}function h0(n){const e={},t=a(n,["responsesFile"]);t!=null&&l(e,["fileName"],t);const i=a(n,["inlinedResponses","inlinedResponses"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>f0(o))),l(e,["inlinedResponses"],r)}return e}function Zl(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["metadata","displayName"]);i!=null&&l(e,["displayName"],i);const r=a(n,["metadata","state"]);r!=null&&l(e,["state"],dy(r));const o=a(n,["metadata","createTime"]);o!=null&&l(e,["createTime"],o);const s=a(n,["metadata","endTime"]);s!=null&&l(e,["endTime"],s);const u=a(n,["metadata","updateTime"]);u!=null&&l(e,["updateTime"],u);const c=a(n,["metadata","model"]);c!=null&&l(e,["model"],c);const f=a(n,["metadata","output"]);return f!=null&&l(e,["dest"],h0(f)),e}function p0(n){const e={},t=a(n,["nextPageToken"]);t!=null&&l(e,["nextPageToken"],t);const i=a(n,["operations"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>Zl(o))),l(e,["batchJobs"],r)}return e}function m0(n){const e={},t=a(n,["details"]);t!=null&&l(e,["details"],t);const i=a(n,["code"]);i!=null&&l(e,["code"],i);const r=a(n,["message"]);return r!=null&&l(e,["message"],r),e}function g0(n){const e={},t=a(n,["instancesFormat"]);t!=null&&l(e,["format"],t);const i=a(n,["gcsSource","uris"]);i!=null&&l(e,["gcsUri"],i);const r=a(n,["bigquerySource","inputUri"]);return r!=null&&l(e,["bigqueryUri"],r),e}function y0(n){const e={},t=a(n,["predictionsFormat"]);t!=null&&l(e,["format"],t);const i=a(n,["gcsDestination","outputUriPrefix"]);i!=null&&l(e,["gcsUri"],i);const r=a(n,["bigqueryDestination","outputUri"]);return r!=null&&l(e,["bigqueryUri"],r),e}function jl(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["displayName"]);i!=null&&l(e,["displayName"],i);const r=a(n,["state"]);r!=null&&l(e,["state"],dy(r));const o=a(n,["error"]);o!=null&&l(e,["error"],m0(o));const s=a(n,["createTime"]);s!=null&&l(e,["createTime"],s);const u=a(n,["startTime"]);u!=null&&l(e,["startTime"],u);const c=a(n,["endTime"]);c!=null&&l(e,["endTime"],c);const f=a(n,["updateTime"]);f!=null&&l(e,["updateTime"],f);const h=a(n,["model"]);h!=null&&l(e,["model"],h);const m=a(n,["inputConfig"]);m!=null&&l(e,["src"],g0(m));const y=a(n,["outputConfig"]);return y!=null&&l(e,["dest"],y0(y)),e}function _0(n){const e={},t=a(n,["nextPageToken"]);t!=null&&l(e,["nextPageToken"],t);const i=a(n,["batchPredictionJobs"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>jl(o))),l(e,["batchJobs"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var oi;(function(n){n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(oi||(oi={}));class Ao{constructor(e,t,i,r){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,i,r)}init(e,t,i){var r,o;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.idxInternal=0;let s={config:{}};i?typeof i=="object"?s=Object.assign({},i):s=i:s={config:{}},s.config&&(s.config.pageToken=t.nextPageToken),this.paramsInternal=s,this.pageInternalSize=(o=(r=s.config)===null||r===void 0?void 0:r.pageSize)!==null&&o!==void 0?o:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class v0 extends li{constructor(e){super(),this.apiClient=e,this.create=async t=>{if(this.apiClient.isVertexAI()){if(Array.isArray(t.src))throw new Error("InlinedRequest[] is not supported in Vertex AI. Please use Google Cloud Storage URI or BigQuery URI instead.");if(t.config=t.config||{},t.config.displayName===void 0&&(t.config.displayName="genaiBatchJob_"),t.config.dest===void 0&&typeof t.src=="string")if(t.src.startsWith("gs://")&&t.src.endsWith(".jsonl"))t.config.dest=`${t.src.slice(0,-6)}/dest`;else if(t.src.startsWith("bq://"))t.config.dest=`${t.src}_dest_`;else throw new Error("Unsupported source:"+t.src)}return await this.createInternal(t)},this.list=async(t={})=>new Ao(oi.PAGED_ITEM_BATCH_JOBS,i=>this.listInternal(i),await this.listInternal(t),t)}async createInternal(e){var t,i,r,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const f=Xw(this.apiClient,e);return u=Y("batchPredictionJobs",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>jl(h))}else{const f=qw(this.apiClient,e);return u=Y("{model}:batchGenerateContent",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>Zl(h))}}async get(e){var t,i,r,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const f=Qw(this.apiClient,e);return u=Y("batchPredictionJobs/{name}",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>jl(h))}else{const f=Gw(this.apiClient,e);return u=Y("batches/{name}",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>Zl(h))}}async cancel(e){var t,i,r,o;let s="",u={};if(this.apiClient.isVertexAI()){const c=Zw(this.apiClient,e);s=Y("batchPredictionJobs/{name}:cancel",c._url),u=c._query,delete c.config,delete c._url,delete c._query,await this.apiClient.request({path:s,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}else{const c=Hw(this.apiClient,e);s=Y("batches/{name}:cancel",c._url),u=c._query,delete c.config,delete c._url,delete c._query,await this.apiClient.request({path:s,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(e){var t,i,r,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const f=e0(e);return u=Y("batchPredictionJobs",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>{const m=_0(h),y=new Wh;return Object.assign(y,m),y})}else{const f=Kw(e);return u=Y("batches",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>{const m=p0(h),y=new Wh;return Object.assign(y,m),y})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function T0(n){const e={},t=a(n,["fps"]);t!=null&&l(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&l(e,["endOffset"],i);const r=a(n,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function E0(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["data"]);t!=null&&l(e,["data"],t);const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function I0(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["fileUri"]);t!=null&&l(e,["fileUri"],t);const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function C0(n){const e={},t=a(n,["videoMetadata"]);t!=null&&l(e,["videoMetadata"],T0(t));const i=a(n,["thought"]);i!=null&&l(e,["thought"],i);const r=a(n,["inlineData"]);r!=null&&l(e,["inlineData"],E0(r));const o=a(n,["fileData"]);o!=null&&l(e,["fileData"],I0(o));const s=a(n,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);const u=a(n,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);const c=a(n,["executableCode"]);c!=null&&l(e,["executableCode"],c);const f=a(n,["functionCall"]);f!=null&&l(e,["functionCall"],f);const h=a(n,["functionResponse"]);h!=null&&l(e,["functionResponse"],h);const m=a(n,["text"]);return m!=null&&l(e,["text"],m),e}function jh(n){const e={},t=a(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>C0(o))),l(e,["parts"],r)}const i=a(n,["role"]);return i!=null&&l(e,["role"],i),e}function A0(n){const e={},t=a(n,["behavior"]);t!=null&&l(e,["behavior"],t);const i=a(n,["description"]);i!=null&&l(e,["description"],i);const r=a(n,["name"]);r!=null&&l(e,["name"],r);const o=a(n,["parameters"]);o!=null&&l(e,["parameters"],o);const s=a(n,["parametersJsonSchema"]);s!=null&&l(e,["parametersJsonSchema"],s);const u=a(n,["response"]);u!=null&&l(e,["response"],u);const c=a(n,["responseJsonSchema"]);return c!=null&&l(e,["responseJsonSchema"],c),e}function S0(n){const e={},t=a(n,["startTime"]);t!=null&&l(e,["startTime"],t);const i=a(n,["endTime"]);return i!=null&&l(e,["endTime"],i),e}function w0(n){const e={},t=a(n,["timeRangeFilter"]);return t!=null&&l(e,["timeRangeFilter"],S0(t)),e}function x0(n){const e={},t=a(n,["mode"]);t!=null&&l(e,["mode"],t);const i=a(n,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function R0(n){const e={},t=a(n,["dynamicRetrievalConfig"]);return t!=null&&l(e,["dynamicRetrievalConfig"],x0(t)),e}function P0(){return{}}function k0(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(c=>A0(c))),l(e,["functionDeclarations"],u)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=a(n,["googleSearch"]);i!=null&&l(e,["googleSearch"],w0(i));const r=a(n,["googleSearchRetrieval"]);if(r!=null&&l(e,["googleSearchRetrieval"],R0(r)),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(a(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");a(n,["urlContext"])!=null&&l(e,["urlContext"],P0());const s=a(n,["codeExecution"]);return s!=null&&l(e,["codeExecution"],s),e}function M0(n){const e={},t=a(n,["mode"]);t!=null&&l(e,["mode"],t);const i=a(n,["allowedFunctionNames"]);return i!=null&&l(e,["allowedFunctionNames"],i),e}function b0(n){const e={},t=a(n,["latitude"]);t!=null&&l(e,["latitude"],t);const i=a(n,["longitude"]);return i!=null&&l(e,["longitude"],i),e}function D0(n){const e={},t=a(n,["latLng"]);t!=null&&l(e,["latLng"],b0(t));const i=a(n,["languageCode"]);return i!=null&&l(e,["languageCode"],i),e}function N0(n){const e={},t=a(n,["functionCallingConfig"]);t!=null&&l(e,["functionCallingConfig"],M0(t));const i=a(n,["retrievalConfig"]);return i!=null&&l(e,["retrievalConfig"],D0(i)),e}function V0(n,e){const t={},i=a(n,["ttl"]);e!==void 0&&i!=null&&l(e,["ttl"],i);const r=a(n,["expireTime"]);e!==void 0&&r!=null&&l(e,["expireTime"],r);const o=a(n,["displayName"]);e!==void 0&&o!=null&&l(e,["displayName"],o);const s=a(n,["contents"]);if(e!==void 0&&s!=null){let h=ft(s);Array.isArray(h)&&(h=h.map(m=>jh(m))),l(e,["contents"],h)}const u=a(n,["systemInstruction"]);e!==void 0&&u!=null&&l(e,["systemInstruction"],jh(We(u)));const c=a(n,["tools"]);if(e!==void 0&&c!=null){let h=c;Array.isArray(h)&&(h=h.map(m=>k0(m))),l(e,["tools"],h)}const f=a(n,["toolConfig"]);if(e!==void 0&&f!=null&&l(e,["toolConfig"],N0(f)),a(n,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function L0(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["model"],ny(n,i));const r=a(e,["config"]);return r!=null&&l(t,["config"],V0(r,t)),t}function F0(n,e){const t={},i=a(e,["name"]);i!=null&&l(t,["_url","name"],Xt(n,i));const r=a(e,["config"]);return r!=null&&l(t,["config"],r),t}function U0(n,e){const t={},i=a(e,["name"]);i!=null&&l(t,["_url","name"],Xt(n,i));const r=a(e,["config"]);return r!=null&&l(t,["config"],r),t}function B0(n,e){const t={},i=a(n,["ttl"]);e!==void 0&&i!=null&&l(e,["ttl"],i);const r=a(n,["expireTime"]);return e!==void 0&&r!=null&&l(e,["expireTime"],r),t}function O0(n,e){const t={},i=a(e,["name"]);i!=null&&l(t,["_url","name"],Xt(n,i));const r=a(e,["config"]);return r!=null&&l(t,["config"],B0(r,t)),t}function $0(n,e){const t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const r=a(n,["pageToken"]);return e!==void 0&&r!=null&&l(e,["_query","pageToken"],r),t}function q0(n){const e={},t=a(n,["config"]);return t!=null&&l(e,["config"],$0(t,e)),e}function G0(n){const e={},t=a(n,["fps"]);t!=null&&l(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&l(e,["endOffset"],i);const r=a(n,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function H0(n){const e={},t=a(n,["displayName"]);t!=null&&l(e,["displayName"],t);const i=a(n,["data"]);i!=null&&l(e,["data"],i);const r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function z0(n){const e={},t=a(n,["displayName"]);t!=null&&l(e,["displayName"],t);const i=a(n,["fileUri"]);i!=null&&l(e,["fileUri"],i);const r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function K0(n){const e={},t=a(n,["videoMetadata"]);t!=null&&l(e,["videoMetadata"],G0(t));const i=a(n,["thought"]);i!=null&&l(e,["thought"],i);const r=a(n,["inlineData"]);r!=null&&l(e,["inlineData"],H0(r));const o=a(n,["fileData"]);o!=null&&l(e,["fileData"],z0(o));const s=a(n,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);const u=a(n,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);const c=a(n,["executableCode"]);c!=null&&l(e,["executableCode"],c);const f=a(n,["functionCall"]);f!=null&&l(e,["functionCall"],f);const h=a(n,["functionResponse"]);h!=null&&l(e,["functionResponse"],h);const m=a(n,["text"]);return m!=null&&l(e,["text"],m),e}function ep(n){const e={},t=a(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>K0(o))),l(e,["parts"],r)}const i=a(n,["role"]);return i!=null&&l(e,["role"],i),e}function J0(n){const e={};if(a(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=a(n,["description"]);t!=null&&l(e,["description"],t);const i=a(n,["name"]);i!=null&&l(e,["name"],i);const r=a(n,["parameters"]);r!=null&&l(e,["parameters"],r);const o=a(n,["parametersJsonSchema"]);o!=null&&l(e,["parametersJsonSchema"],o);const s=a(n,["response"]);s!=null&&l(e,["response"],s);const u=a(n,["responseJsonSchema"]);return u!=null&&l(e,["responseJsonSchema"],u),e}function W0(n){const e={},t=a(n,["startTime"]);t!=null&&l(e,["startTime"],t);const i=a(n,["endTime"]);return i!=null&&l(e,["endTime"],i),e}function Y0(n){const e={},t=a(n,["timeRangeFilter"]);return t!=null&&l(e,["timeRangeFilter"],W0(t)),e}function X0(n){const e={},t=a(n,["mode"]);t!=null&&l(e,["mode"],t);const i=a(n,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function Q0(n){const e={},t=a(n,["dynamicRetrievalConfig"]);return t!=null&&l(e,["dynamicRetrievalConfig"],X0(t)),e}function Z0(){return{}}function j0(n){const e={},t=a(n,["apiKeyString"]);return t!=null&&l(e,["apiKeyString"],t),e}function ex(n){const e={},t=a(n,["apiKeyConfig"]);t!=null&&l(e,["apiKeyConfig"],j0(t));const i=a(n,["authType"]);i!=null&&l(e,["authType"],i);const r=a(n,["googleServiceAccountConfig"]);r!=null&&l(e,["googleServiceAccountConfig"],r);const o=a(n,["httpBasicAuthConfig"]);o!=null&&l(e,["httpBasicAuthConfig"],o);const s=a(n,["oauthConfig"]);s!=null&&l(e,["oauthConfig"],s);const u=a(n,["oidcConfig"]);return u!=null&&l(e,["oidcConfig"],u),e}function tx(n){const e={},t=a(n,["authConfig"]);return t!=null&&l(e,["authConfig"],ex(t)),e}function nx(){return{}}function ix(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(m=>J0(m))),l(e,["functionDeclarations"],h)}const i=a(n,["retrieval"]);i!=null&&l(e,["retrieval"],i);const r=a(n,["googleSearch"]);r!=null&&l(e,["googleSearch"],Y0(r));const o=a(n,["googleSearchRetrieval"]);o!=null&&l(e,["googleSearchRetrieval"],Q0(o)),a(n,["enterpriseWebSearch"])!=null&&l(e,["enterpriseWebSearch"],Z0());const u=a(n,["googleMaps"]);u!=null&&l(e,["googleMaps"],tx(u)),a(n,["urlContext"])!=null&&l(e,["urlContext"],nx());const f=a(n,["codeExecution"]);return f!=null&&l(e,["codeExecution"],f),e}function rx(n){const e={},t=a(n,["mode"]);t!=null&&l(e,["mode"],t);const i=a(n,["allowedFunctionNames"]);return i!=null&&l(e,["allowedFunctionNames"],i),e}function ox(n){const e={},t=a(n,["latitude"]);t!=null&&l(e,["latitude"],t);const i=a(n,["longitude"]);return i!=null&&l(e,["longitude"],i),e}function sx(n){const e={},t=a(n,["latLng"]);t!=null&&l(e,["latLng"],ox(t));const i=a(n,["languageCode"]);return i!=null&&l(e,["languageCode"],i),e}function ax(n){const e={},t=a(n,["functionCallingConfig"]);t!=null&&l(e,["functionCallingConfig"],rx(t));const i=a(n,["retrievalConfig"]);return i!=null&&l(e,["retrievalConfig"],sx(i)),e}function lx(n,e){const t={},i=a(n,["ttl"]);e!==void 0&&i!=null&&l(e,["ttl"],i);const r=a(n,["expireTime"]);e!==void 0&&r!=null&&l(e,["expireTime"],r);const o=a(n,["displayName"]);e!==void 0&&o!=null&&l(e,["displayName"],o);const s=a(n,["contents"]);if(e!==void 0&&s!=null){let m=ft(s);Array.isArray(m)&&(m=m.map(y=>ep(y))),l(e,["contents"],m)}const u=a(n,["systemInstruction"]);e!==void 0&&u!=null&&l(e,["systemInstruction"],ep(We(u)));const c=a(n,["tools"]);if(e!==void 0&&c!=null){let m=c;Array.isArray(m)&&(m=m.map(y=>ix(y))),l(e,["tools"],m)}const f=a(n,["toolConfig"]);e!==void 0&&f!=null&&l(e,["toolConfig"],ax(f));const h=a(n,["kmsKeyName"]);return e!==void 0&&h!=null&&l(e,["encryption_spec","kmsKeyName"],h),t}function ux(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["model"],ny(n,i));const r=a(e,["config"]);return r!=null&&l(t,["config"],lx(r,t)),t}function cx(n,e){const t={},i=a(e,["name"]);i!=null&&l(t,["_url","name"],Xt(n,i));const r=a(e,["config"]);return r!=null&&l(t,["config"],r),t}function dx(n,e){const t={},i=a(e,["name"]);i!=null&&l(t,["_url","name"],Xt(n,i));const r=a(e,["config"]);return r!=null&&l(t,["config"],r),t}function fx(n,e){const t={},i=a(n,["ttl"]);e!==void 0&&i!=null&&l(e,["ttl"],i);const r=a(n,["expireTime"]);return e!==void 0&&r!=null&&l(e,["expireTime"],r),t}function hx(n,e){const t={},i=a(e,["name"]);i!=null&&l(t,["_url","name"],Xt(n,i));const r=a(e,["config"]);return r!=null&&l(t,["config"],fx(r,t)),t}function px(n,e){const t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const r=a(n,["pageToken"]);return e!==void 0&&r!=null&&l(e,["_query","pageToken"],r),t}function mx(n){const e={},t=a(n,["config"]);return t!=null&&l(e,["config"],px(t,e)),e}function hs(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["displayName"]);i!=null&&l(e,["displayName"],i);const r=a(n,["model"]);r!=null&&l(e,["model"],r);const o=a(n,["createTime"]);o!=null&&l(e,["createTime"],o);const s=a(n,["updateTime"]);s!=null&&l(e,["updateTime"],s);const u=a(n,["expireTime"]);u!=null&&l(e,["expireTime"],u);const c=a(n,["usageMetadata"]);return c!=null&&l(e,["usageMetadata"],c),e}function gx(){return{}}function yx(n){const e={},t=a(n,["nextPageToken"]);t!=null&&l(e,["nextPageToken"],t);const i=a(n,["cachedContents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>hs(o))),l(e,["cachedContents"],r)}return e}function ps(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["displayName"]);i!=null&&l(e,["displayName"],i);const r=a(n,["model"]);r!=null&&l(e,["model"],r);const o=a(n,["createTime"]);o!=null&&l(e,["createTime"],o);const s=a(n,["updateTime"]);s!=null&&l(e,["updateTime"],s);const u=a(n,["expireTime"]);u!=null&&l(e,["expireTime"],u);const c=a(n,["usageMetadata"]);return c!=null&&l(e,["usageMetadata"],c),e}function _x(){return{}}function vx(n){const e={},t=a(n,["nextPageToken"]);t!=null&&l(e,["nextPageToken"],t);const i=a(n,["cachedContents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>ps(o))),l(e,["cachedContents"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Tx extends li{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Ao(oi.PAGED_ITEM_CACHED_CONTENTS,i=>this.listInternal(i),await this.listInternal(t),t)}async create(e){var t,i,r,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const f=ux(this.apiClient,e);return u=Y("cachedContents",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>ps(h))}else{const f=L0(this.apiClient,e);return u=Y("cachedContents",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>hs(h))}}async get(e){var t,i,r,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const f=cx(this.apiClient,e);return u=Y("{name}",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>ps(h))}else{const f=F0(this.apiClient,e);return u=Y("{name}",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>hs(h))}}async delete(e){var t,i,r,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const f=dx(this.apiClient,e);return u=Y("{name}",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(()=>{const h=_x(),m=new Kh;return Object.assign(m,h),m})}else{const f=U0(this.apiClient,e);return u=Y("{name}",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(()=>{const h=gx(),m=new Kh;return Object.assign(m,h),m})}}async update(e){var t,i,r,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const f=hx(this.apiClient,e);return u=Y("{name}",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>ps(h))}else{const f=O0(this.apiClient,e);return u=Y("{name}",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"PATCH",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>hs(h))}}async listInternal(e){var t,i,r,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const f=mx(e);return u=Y("cachedContents",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>{const m=vx(h),y=new Jh;return Object.assign(y,m),y})}else{const f=q0(e);return u=Y("cachedContents",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>{const m=yx(h),y=new Jh;return Object.assign(y,m),y})}}}function tp(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Te(n){return this instanceof Te?(this.v=n,this):new Te(n)}function Di(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),r,o=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",s),r[Symbol.asyncIterator]=function(){return this},r;function s(v){return function(x){return Promise.resolve(x).then(v,m)}}function u(v,x){i[v]&&(r[v]=function(R){return new Promise(function(D,U){o.push([v,R,D,U])>1||c(v,R)})},x&&(r[v]=x(r[v])))}function c(v,x){try{f(i[v](x))}catch(R){y(o[0][3],R)}}function f(v){v.value instanceof Te?Promise.resolve(v.value.v).then(h,m):y(o[0][2],v)}function h(v){c("next",v)}function m(v){c("throw",v)}function y(v,x){v(x),o.shift(),o.length&&c(o[0][0],o[0][1])}}function Qr(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof tp=="function"?tp(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(o){t[o]=n[o]&&function(s){return new Promise(function(u,c){s=n[o](s),r(u,c,s.done,s.value)})}}function r(o,s,u,c){Promise.resolve(c).then(function(f){o({value:f,done:u})},s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ex(n){var e;if(n.candidates==null||n.candidates.length===0)return!1;const t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:py(t)}function py(n){if(n.parts===void 0||n.parts.length===0)return!1;for(const e of n.parts)if(e===void 0||Object.keys(e).length===0||!e.thought&&e.text!==void 0&&e.text==="")return!1;return!0}function Ix(n){if(n.length!==0){for(const e of n)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function np(n){if(n===void 0||n.length===0)return[];const e=[],t=n.length;let i=0;for(;i<t;)if(n[i].role==="user")e.push(n[i]),i++;else{const r=[];let o=!0;for(;i<t&&n[i].role==="model";)r.push(n[i]),o&&!py(n[i])&&(o=!1),i++;o?e.push(...r):e.pop()}return e}class Cx{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new Ax(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class Ax{constructor(e,t,i,r={},o=[]){this.apiClient=e,this.modelsModule=t,this.model=i,this.config=r,this.history=o,this.sendPromise=Promise.resolve(),Ix(o)}async sendMessage(e){var t;await this.sendPromise;const i=We(e.message),r=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(i),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var o,s,u;const c=await r,f=(s=(o=c.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content,h=c.automaticFunctionCallingHistory,m=this.getHistory(!0).length;let y=[];h!=null&&(y=(u=h.slice(m))!==null&&u!==void 0?u:[]);const v=f?[f]:[];this.recordHistory(i,v,y)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),r}async sendMessageStream(e){var t;await this.sendPromise;const i=We(e.message),r=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(i),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=r.then(()=>{}).catch(()=>{});const o=await r;return this.processStreamResponse(o,i)}getHistory(e=!1){const t=e?np(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){var i,r;return Di(this,arguments,function*(){var s,u,c,f;const h=[];try{for(var m=!0,y=Qr(e),v;v=yield Te(y.next()),s=v.done,!s;m=!0){f=v.value,m=!1;const x=f;if(Ex(x)){const R=(r=(i=x.candidates)===null||i===void 0?void 0:i[0])===null||r===void 0?void 0:r.content;R!==void 0&&h.push(R)}yield yield Te(x)}}catch(x){u={error:x}}finally{try{!m&&!s&&(c=y.return)&&(yield Te(c.call(y)))}finally{if(u)throw u.error}}this.recordHistory(t,h)})}recordHistory(e,t,i){let r=[];t.length>0&&t.every(o=>o.role!==void 0)?r=t:r.push({role:"model",parts:[]}),i&&i.length>0?this.history.push(...np(i)):this.history.push(e),this.history.push(...r)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ea extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Ea.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Sx(n,e){const t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const r=a(n,["pageToken"]);return e!==void 0&&r!=null&&l(e,["_query","pageToken"],r),t}function wx(n){const e={},t=a(n,["config"]);return t!=null&&l(e,["config"],Sx(t,e)),e}function xx(n){const e={},t=a(n,["details"]);t!=null&&l(e,["details"],t);const i=a(n,["message"]);i!=null&&l(e,["message"],i);const r=a(n,["code"]);return r!=null&&l(e,["code"],r),e}function Rx(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["displayName"]);i!=null&&l(e,["displayName"],i);const r=a(n,["mimeType"]);r!=null&&l(e,["mimeType"],r);const o=a(n,["sizeBytes"]);o!=null&&l(e,["sizeBytes"],o);const s=a(n,["createTime"]);s!=null&&l(e,["createTime"],s);const u=a(n,["expirationTime"]);u!=null&&l(e,["expirationTime"],u);const c=a(n,["updateTime"]);c!=null&&l(e,["updateTime"],c);const f=a(n,["sha256Hash"]);f!=null&&l(e,["sha256Hash"],f);const h=a(n,["uri"]);h!=null&&l(e,["uri"],h);const m=a(n,["downloadUri"]);m!=null&&l(e,["downloadUri"],m);const y=a(n,["state"]);y!=null&&l(e,["state"],y);const v=a(n,["source"]);v!=null&&l(e,["source"],v);const x=a(n,["videoMetadata"]);x!=null&&l(e,["videoMetadata"],x);const R=a(n,["error"]);return R!=null&&l(e,["error"],xx(R)),e}function Px(n){const e={},t=a(n,["file"]);t!=null&&l(e,["file"],Rx(t));const i=a(n,["config"]);return i!=null&&l(e,["config"],i),e}function kx(n){const e={},t=a(n,["name"]);t!=null&&l(e,["_url","file"],ay(t));const i=a(n,["config"]);return i!=null&&l(e,["config"],i),e}function Mx(n){const e={},t=a(n,["name"]);t!=null&&l(e,["_url","file"],ay(t));const i=a(n,["config"]);return i!=null&&l(e,["config"],i),e}function bx(n){const e={},t=a(n,["details"]);t!=null&&l(e,["details"],t);const i=a(n,["message"]);i!=null&&l(e,["message"],i);const r=a(n,["code"]);return r!=null&&l(e,["code"],r),e}function eu(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["displayName"]);i!=null&&l(e,["displayName"],i);const r=a(n,["mimeType"]);r!=null&&l(e,["mimeType"],r);const o=a(n,["sizeBytes"]);o!=null&&l(e,["sizeBytes"],o);const s=a(n,["createTime"]);s!=null&&l(e,["createTime"],s);const u=a(n,["expirationTime"]);u!=null&&l(e,["expirationTime"],u);const c=a(n,["updateTime"]);c!=null&&l(e,["updateTime"],c);const f=a(n,["sha256Hash"]);f!=null&&l(e,["sha256Hash"],f);const h=a(n,["uri"]);h!=null&&l(e,["uri"],h);const m=a(n,["downloadUri"]);m!=null&&l(e,["downloadUri"],m);const y=a(n,["state"]);y!=null&&l(e,["state"],y);const v=a(n,["source"]);v!=null&&l(e,["source"],v);const x=a(n,["videoMetadata"]);x!=null&&l(e,["videoMetadata"],x);const R=a(n,["error"]);return R!=null&&l(e,["error"],bx(R)),e}function Dx(n){const e={},t=a(n,["nextPageToken"]);t!=null&&l(e,["nextPageToken"],t);const i=a(n,["files"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>eu(o))),l(e,["files"],r)}return e}function Nx(){return{}}function Vx(){return{}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Lx extends li{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Ao(oi.PAGED_ITEM_FILES,i=>this.listInternal(i),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>eu(t))}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=wx(e);return o=Y("files",u._url),s=u._query,delete u.config,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>{const f=Dx(c),h=new YS;return Object.assign(h,f),h})}}async createInternal(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Px(e);return o=Y("upload/v1beta/files",u._url),s=u._query,delete u.config,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(()=>{const c=Nx(),f=new XS;return Object.assign(f,c),f})}}async get(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=kx(e);return o=Y("files/{file}",u._url),s=u._query,delete u.config,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>eu(c))}}async delete(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Mx(e);return o=Y("files/{file}",u._url),s=u._query,delete u.config,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(()=>{const c=Vx(),f=new QS;return Object.assign(f,c),f})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Fx(n){const e={},t=a(n,["voiceName"]);return t!=null&&l(e,["voiceName"],t),e}function Ux(n){const e={},t=a(n,["voiceName"]);return t!=null&&l(e,["voiceName"],t),e}function my(n){const e={},t=a(n,["prebuiltVoiceConfig"]);return t!=null&&l(e,["prebuiltVoiceConfig"],Fx(t)),e}function Bx(n){const e={},t=a(n,["prebuiltVoiceConfig"]);return t!=null&&l(e,["prebuiltVoiceConfig"],Ux(t)),e}function Ox(n){const e={},t=a(n,["speaker"]);t!=null&&l(e,["speaker"],t);const i=a(n,["voiceConfig"]);return i!=null&&l(e,["voiceConfig"],my(i)),e}function $x(n){const e={},t=a(n,["speakerVoiceConfigs"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>Ox(r))),l(e,["speakerVoiceConfigs"],i)}return e}function qx(n){const e={},t=a(n,["voiceConfig"]);t!=null&&l(e,["voiceConfig"],my(t));const i=a(n,["multiSpeakerVoiceConfig"]);i!=null&&l(e,["multiSpeakerVoiceConfig"],$x(i));const r=a(n,["languageCode"]);return r!=null&&l(e,["languageCode"],r),e}function Gx(n){const e={},t=a(n,["voiceConfig"]);if(t!=null&&l(e,["voiceConfig"],Bx(t)),a(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const i=a(n,["languageCode"]);return i!=null&&l(e,["languageCode"],i),e}function Hx(n){const e={},t=a(n,["fps"]);t!=null&&l(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&l(e,["endOffset"],i);const r=a(n,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function zx(n){const e={},t=a(n,["fps"]);t!=null&&l(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&l(e,["endOffset"],i);const r=a(n,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function Kx(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["data"]);t!=null&&l(e,["data"],t);const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Jx(n){const e={},t=a(n,["displayName"]);t!=null&&l(e,["displayName"],t);const i=a(n,["data"]);i!=null&&l(e,["data"],i);const r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function Wx(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["fileUri"]);t!=null&&l(e,["fileUri"],t);const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Yx(n){const e={},t=a(n,["displayName"]);t!=null&&l(e,["displayName"],t);const i=a(n,["fileUri"]);i!=null&&l(e,["fileUri"],i);const r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function Xx(n){const e={},t=a(n,["videoMetadata"]);t!=null&&l(e,["videoMetadata"],Hx(t));const i=a(n,["thought"]);i!=null&&l(e,["thought"],i);const r=a(n,["inlineData"]);r!=null&&l(e,["inlineData"],Kx(r));const o=a(n,["fileData"]);o!=null&&l(e,["fileData"],Wx(o));const s=a(n,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);const u=a(n,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);const c=a(n,["executableCode"]);c!=null&&l(e,["executableCode"],c);const f=a(n,["functionCall"]);f!=null&&l(e,["functionCall"],f);const h=a(n,["functionResponse"]);h!=null&&l(e,["functionResponse"],h);const m=a(n,["text"]);return m!=null&&l(e,["text"],m),e}function Qx(n){const e={},t=a(n,["videoMetadata"]);t!=null&&l(e,["videoMetadata"],zx(t));const i=a(n,["thought"]);i!=null&&l(e,["thought"],i);const r=a(n,["inlineData"]);r!=null&&l(e,["inlineData"],Jx(r));const o=a(n,["fileData"]);o!=null&&l(e,["fileData"],Yx(o));const s=a(n,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);const u=a(n,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);const c=a(n,["executableCode"]);c!=null&&l(e,["executableCode"],c);const f=a(n,["functionCall"]);f!=null&&l(e,["functionCall"],f);const h=a(n,["functionResponse"]);h!=null&&l(e,["functionResponse"],h);const m=a(n,["text"]);return m!=null&&l(e,["text"],m),e}function Zx(n){const e={},t=a(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>Xx(o))),l(e,["parts"],r)}const i=a(n,["role"]);return i!=null&&l(e,["role"],i),e}function jx(n){const e={},t=a(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>Qx(o))),l(e,["parts"],r)}const i=a(n,["role"]);return i!=null&&l(e,["role"],i),e}function eR(n){const e={},t=a(n,["behavior"]);t!=null&&l(e,["behavior"],t);const i=a(n,["description"]);i!=null&&l(e,["description"],i);const r=a(n,["name"]);r!=null&&l(e,["name"],r);const o=a(n,["parameters"]);o!=null&&l(e,["parameters"],o);const s=a(n,["parametersJsonSchema"]);s!=null&&l(e,["parametersJsonSchema"],s);const u=a(n,["response"]);u!=null&&l(e,["response"],u);const c=a(n,["responseJsonSchema"]);return c!=null&&l(e,["responseJsonSchema"],c),e}function tR(n){const e={};if(a(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=a(n,["description"]);t!=null&&l(e,["description"],t);const i=a(n,["name"]);i!=null&&l(e,["name"],i);const r=a(n,["parameters"]);r!=null&&l(e,["parameters"],r);const o=a(n,["parametersJsonSchema"]);o!=null&&l(e,["parametersJsonSchema"],o);const s=a(n,["response"]);s!=null&&l(e,["response"],s);const u=a(n,["responseJsonSchema"]);return u!=null&&l(e,["responseJsonSchema"],u),e}function nR(n){const e={},t=a(n,["startTime"]);t!=null&&l(e,["startTime"],t);const i=a(n,["endTime"]);return i!=null&&l(e,["endTime"],i),e}function iR(n){const e={},t=a(n,["startTime"]);t!=null&&l(e,["startTime"],t);const i=a(n,["endTime"]);return i!=null&&l(e,["endTime"],i),e}function rR(n){const e={},t=a(n,["timeRangeFilter"]);return t!=null&&l(e,["timeRangeFilter"],nR(t)),e}function oR(n){const e={},t=a(n,["timeRangeFilter"]);return t!=null&&l(e,["timeRangeFilter"],iR(t)),e}function sR(n){const e={},t=a(n,["mode"]);t!=null&&l(e,["mode"],t);const i=a(n,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function aR(n){const e={},t=a(n,["mode"]);t!=null&&l(e,["mode"],t);const i=a(n,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function lR(n){const e={},t=a(n,["dynamicRetrievalConfig"]);return t!=null&&l(e,["dynamicRetrievalConfig"],sR(t)),e}function uR(n){const e={},t=a(n,["dynamicRetrievalConfig"]);return t!=null&&l(e,["dynamicRetrievalConfig"],aR(t)),e}function cR(){return{}}function dR(n){const e={},t=a(n,["apiKeyString"]);return t!=null&&l(e,["apiKeyString"],t),e}function fR(n){const e={},t=a(n,["apiKeyConfig"]);t!=null&&l(e,["apiKeyConfig"],dR(t));const i=a(n,["authType"]);i!=null&&l(e,["authType"],i);const r=a(n,["googleServiceAccountConfig"]);r!=null&&l(e,["googleServiceAccountConfig"],r);const o=a(n,["httpBasicAuthConfig"]);o!=null&&l(e,["httpBasicAuthConfig"],o);const s=a(n,["oauthConfig"]);s!=null&&l(e,["oauthConfig"],s);const u=a(n,["oidcConfig"]);return u!=null&&l(e,["oidcConfig"],u),e}function hR(n){const e={},t=a(n,["authConfig"]);return t!=null&&l(e,["authConfig"],fR(t)),e}function pR(){return{}}function mR(){return{}}function gR(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(c=>eR(c))),l(e,["functionDeclarations"],u)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=a(n,["googleSearch"]);i!=null&&l(e,["googleSearch"],rR(i));const r=a(n,["googleSearchRetrieval"]);if(r!=null&&l(e,["googleSearchRetrieval"],lR(r)),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(a(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");a(n,["urlContext"])!=null&&l(e,["urlContext"],pR());const s=a(n,["codeExecution"]);return s!=null&&l(e,["codeExecution"],s),e}function yR(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(m=>tR(m))),l(e,["functionDeclarations"],h)}const i=a(n,["retrieval"]);i!=null&&l(e,["retrieval"],i);const r=a(n,["googleSearch"]);r!=null&&l(e,["googleSearch"],oR(r));const o=a(n,["googleSearchRetrieval"]);o!=null&&l(e,["googleSearchRetrieval"],uR(o)),a(n,["enterpriseWebSearch"])!=null&&l(e,["enterpriseWebSearch"],cR());const u=a(n,["googleMaps"]);u!=null&&l(e,["googleMaps"],hR(u)),a(n,["urlContext"])!=null&&l(e,["urlContext"],mR());const f=a(n,["codeExecution"]);return f!=null&&l(e,["codeExecution"],f),e}function _R(n){const e={},t=a(n,["handle"]);if(t!=null&&l(e,["handle"],t),a(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function vR(n){const e={},t=a(n,["handle"]);t!=null&&l(e,["handle"],t);const i=a(n,["transparent"]);return i!=null&&l(e,["transparent"],i),e}function ip(){return{}}function rp(){return{}}function TR(n){const e={},t=a(n,["disabled"]);t!=null&&l(e,["disabled"],t);const i=a(n,["startOfSpeechSensitivity"]);i!=null&&l(e,["startOfSpeechSensitivity"],i);const r=a(n,["endOfSpeechSensitivity"]);r!=null&&l(e,["endOfSpeechSensitivity"],r);const o=a(n,["prefixPaddingMs"]);o!=null&&l(e,["prefixPaddingMs"],o);const s=a(n,["silenceDurationMs"]);return s!=null&&l(e,["silenceDurationMs"],s),e}function ER(n){const e={},t=a(n,["disabled"]);t!=null&&l(e,["disabled"],t);const i=a(n,["startOfSpeechSensitivity"]);i!=null&&l(e,["startOfSpeechSensitivity"],i);const r=a(n,["endOfSpeechSensitivity"]);r!=null&&l(e,["endOfSpeechSensitivity"],r);const o=a(n,["prefixPaddingMs"]);o!=null&&l(e,["prefixPaddingMs"],o);const s=a(n,["silenceDurationMs"]);return s!=null&&l(e,["silenceDurationMs"],s),e}function IR(n){const e={},t=a(n,["automaticActivityDetection"]);t!=null&&l(e,["automaticActivityDetection"],TR(t));const i=a(n,["activityHandling"]);i!=null&&l(e,["activityHandling"],i);const r=a(n,["turnCoverage"]);return r!=null&&l(e,["turnCoverage"],r),e}function CR(n){const e={},t=a(n,["automaticActivityDetection"]);t!=null&&l(e,["automaticActivityDetection"],ER(t));const i=a(n,["activityHandling"]);i!=null&&l(e,["activityHandling"],i);const r=a(n,["turnCoverage"]);return r!=null&&l(e,["turnCoverage"],r),e}function AR(n){const e={},t=a(n,["targetTokens"]);return t!=null&&l(e,["targetTokens"],t),e}function SR(n){const e={},t=a(n,["targetTokens"]);return t!=null&&l(e,["targetTokens"],t),e}function wR(n){const e={},t=a(n,["triggerTokens"]);t!=null&&l(e,["triggerTokens"],t);const i=a(n,["slidingWindow"]);return i!=null&&l(e,["slidingWindow"],AR(i)),e}function xR(n){const e={},t=a(n,["triggerTokens"]);t!=null&&l(e,["triggerTokens"],t);const i=a(n,["slidingWindow"]);return i!=null&&l(e,["slidingWindow"],SR(i)),e}function RR(n){const e={},t=a(n,["proactiveAudio"]);return t!=null&&l(e,["proactiveAudio"],t),e}function PR(n){const e={},t=a(n,["proactiveAudio"]);return t!=null&&l(e,["proactiveAudio"],t),e}function kR(n,e){const t={},i=a(n,["generationConfig"]);e!==void 0&&i!=null&&l(e,["setup","generationConfig"],i);const r=a(n,["responseModalities"]);e!==void 0&&r!=null&&l(e,["setup","generationConfig","responseModalities"],r);const o=a(n,["temperature"]);e!==void 0&&o!=null&&l(e,["setup","generationConfig","temperature"],o);const s=a(n,["topP"]);e!==void 0&&s!=null&&l(e,["setup","generationConfig","topP"],s);const u=a(n,["topK"]);e!==void 0&&u!=null&&l(e,["setup","generationConfig","topK"],u);const c=a(n,["maxOutputTokens"]);e!==void 0&&c!=null&&l(e,["setup","generationConfig","maxOutputTokens"],c);const f=a(n,["mediaResolution"]);e!==void 0&&f!=null&&l(e,["setup","generationConfig","mediaResolution"],f);const h=a(n,["seed"]);e!==void 0&&h!=null&&l(e,["setup","generationConfig","seed"],h);const m=a(n,["speechConfig"]);e!==void 0&&m!=null&&l(e,["setup","generationConfig","speechConfig"],qx(Yu(m)));const y=a(n,["enableAffectiveDialog"]);e!==void 0&&y!=null&&l(e,["setup","generationConfig","enableAffectiveDialog"],y);const v=a(n,["systemInstruction"]);e!==void 0&&v!=null&&l(e,["setup","systemInstruction"],Zx(We(v)));const x=a(n,["tools"]);if(e!==void 0&&x!=null){let L=dr(x);Array.isArray(L)&&(L=L.map(q=>gR(cr(q)))),l(e,["setup","tools"],L)}const R=a(n,["sessionResumption"]);e!==void 0&&R!=null&&l(e,["setup","sessionResumption"],_R(R));const D=a(n,["inputAudioTranscription"]);e!==void 0&&D!=null&&l(e,["setup","inputAudioTranscription"],ip());const U=a(n,["outputAudioTranscription"]);e!==void 0&&U!=null&&l(e,["setup","outputAudioTranscription"],ip());const V=a(n,["realtimeInputConfig"]);e!==void 0&&V!=null&&l(e,["setup","realtimeInputConfig"],IR(V));const N=a(n,["contextWindowCompression"]);e!==void 0&&N!=null&&l(e,["setup","contextWindowCompression"],wR(N));const F=a(n,["proactivity"]);return e!==void 0&&F!=null&&l(e,["setup","proactivity"],RR(F)),t}function MR(n,e){const t={},i=a(n,["generationConfig"]);e!==void 0&&i!=null&&l(e,["setup","generationConfig"],i);const r=a(n,["responseModalities"]);e!==void 0&&r!=null&&l(e,["setup","generationConfig","responseModalities"],r);const o=a(n,["temperature"]);e!==void 0&&o!=null&&l(e,["setup","generationConfig","temperature"],o);const s=a(n,["topP"]);e!==void 0&&s!=null&&l(e,["setup","generationConfig","topP"],s);const u=a(n,["topK"]);e!==void 0&&u!=null&&l(e,["setup","generationConfig","topK"],u);const c=a(n,["maxOutputTokens"]);e!==void 0&&c!=null&&l(e,["setup","generationConfig","maxOutputTokens"],c);const f=a(n,["mediaResolution"]);e!==void 0&&f!=null&&l(e,["setup","generationConfig","mediaResolution"],f);const h=a(n,["seed"]);e!==void 0&&h!=null&&l(e,["setup","generationConfig","seed"],h);const m=a(n,["speechConfig"]);e!==void 0&&m!=null&&l(e,["setup","generationConfig","speechConfig"],Gx(Yu(m)));const y=a(n,["enableAffectiveDialog"]);e!==void 0&&y!=null&&l(e,["setup","generationConfig","enableAffectiveDialog"],y);const v=a(n,["systemInstruction"]);e!==void 0&&v!=null&&l(e,["setup","systemInstruction"],jx(We(v)));const x=a(n,["tools"]);if(e!==void 0&&x!=null){let L=dr(x);Array.isArray(L)&&(L=L.map(q=>yR(cr(q)))),l(e,["setup","tools"],L)}const R=a(n,["sessionResumption"]);e!==void 0&&R!=null&&l(e,["setup","sessionResumption"],vR(R));const D=a(n,["inputAudioTranscription"]);e!==void 0&&D!=null&&l(e,["setup","inputAudioTranscription"],rp());const U=a(n,["outputAudioTranscription"]);e!==void 0&&U!=null&&l(e,["setup","outputAudioTranscription"],rp());const V=a(n,["realtimeInputConfig"]);e!==void 0&&V!=null&&l(e,["setup","realtimeInputConfig"],CR(V));const N=a(n,["contextWindowCompression"]);e!==void 0&&N!=null&&l(e,["setup","contextWindowCompression"],xR(N));const F=a(n,["proactivity"]);return e!==void 0&&F!=null&&l(e,["setup","proactivity"],PR(F)),t}function bR(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["setup","model"],pe(n,i));const r=a(e,["config"]);return r!=null&&l(t,["config"],kR(r,t)),t}function DR(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["setup","model"],pe(n,i));const r=a(e,["config"]);return r!=null&&l(t,["config"],MR(r,t)),t}function NR(){return{}}function VR(){return{}}function LR(){return{}}function FR(){return{}}function UR(n){const e={},t=a(n,["media"]);t!=null&&l(e,["mediaChunks"],iy(t));const i=a(n,["audio"]);i!=null&&l(e,["audio"],tw(i));const r=a(n,["audioStreamEnd"]);r!=null&&l(e,["audioStreamEnd"],r);const o=a(n,["video"]);o!=null&&l(e,["video"],ew(o));const s=a(n,["text"]);return s!=null&&l(e,["text"],s),a(n,["activityStart"])!=null&&l(e,["activityStart"],NR()),a(n,["activityEnd"])!=null&&l(e,["activityEnd"],LR()),e}function BR(n){const e={},t=a(n,["media"]);if(t!=null&&l(e,["mediaChunks"],iy(t)),a(n,["audio"])!==void 0)throw new Error("audio parameter is not supported in Vertex AI.");const i=a(n,["audioStreamEnd"]);if(i!=null&&l(e,["audioStreamEnd"],i),a(n,["video"])!==void 0)throw new Error("video parameter is not supported in Vertex AI.");if(a(n,["text"])!==void 0)throw new Error("text parameter is not supported in Vertex AI.");return a(n,["activityStart"])!=null&&l(e,["activityStart"],VR()),a(n,["activityEnd"])!=null&&l(e,["activityEnd"],FR()),e}function gy(n){const e={},t=a(n,["text"]);t!=null&&l(e,["text"],t);const i=a(n,["weight"]);return i!=null&&l(e,["weight"],i),e}function OR(n){const e={},t=a(n,["weightedPrompts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>gy(r))),l(e,["weightedPrompts"],i)}return e}function yy(n){const e={},t=a(n,["temperature"]);t!=null&&l(e,["temperature"],t);const i=a(n,["topK"]);i!=null&&l(e,["topK"],i);const r=a(n,["seed"]);r!=null&&l(e,["seed"],r);const o=a(n,["guidance"]);o!=null&&l(e,["guidance"],o);const s=a(n,["bpm"]);s!=null&&l(e,["bpm"],s);const u=a(n,["density"]);u!=null&&l(e,["density"],u);const c=a(n,["brightness"]);c!=null&&l(e,["brightness"],c);const f=a(n,["scale"]);f!=null&&l(e,["scale"],f);const h=a(n,["muteBass"]);h!=null&&l(e,["muteBass"],h);const m=a(n,["muteDrums"]);m!=null&&l(e,["muteDrums"],m);const y=a(n,["onlyBassAndDrums"]);return y!=null&&l(e,["onlyBassAndDrums"],y),e}function $R(n){const e={},t=a(n,["musicGenerationConfig"]);return t!=null&&l(e,["musicGenerationConfig"],yy(t)),e}function _y(n){const e={},t=a(n,["model"]);return t!=null&&l(e,["model"],t),e}function vy(n){const e={},t=a(n,["weightedPrompts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>gy(r))),l(e,["weightedPrompts"],i)}return e}function tu(n){const e={},t=a(n,["setup"]);t!=null&&l(e,["setup"],_y(t));const i=a(n,["clientContent"]);i!=null&&l(e,["clientContent"],vy(i));const r=a(n,["musicGenerationConfig"]);r!=null&&l(e,["musicGenerationConfig"],yy(r));const o=a(n,["playbackControl"]);return o!=null&&l(e,["playbackControl"],o),e}function qR(){return{}}function GR(){return{}}function HR(n){const e={},t=a(n,["fps"]);t!=null&&l(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&l(e,["endOffset"],i);const r=a(n,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function zR(n){const e={},t=a(n,["fps"]);t!=null&&l(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&l(e,["endOffset"],i);const r=a(n,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function KR(n){const e={},t=a(n,["data"]);t!=null&&l(e,["data"],t);const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function JR(n){const e={},t=a(n,["displayName"]);t!=null&&l(e,["displayName"],t);const i=a(n,["data"]);i!=null&&l(e,["data"],i);const r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function WR(n){const e={},t=a(n,["fileUri"]);t!=null&&l(e,["fileUri"],t);const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function YR(n){const e={},t=a(n,["displayName"]);t!=null&&l(e,["displayName"],t);const i=a(n,["fileUri"]);i!=null&&l(e,["fileUri"],i);const r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function XR(n){const e={},t=a(n,["videoMetadata"]);t!=null&&l(e,["videoMetadata"],HR(t));const i=a(n,["thought"]);i!=null&&l(e,["thought"],i);const r=a(n,["inlineData"]);r!=null&&l(e,["inlineData"],KR(r));const o=a(n,["fileData"]);o!=null&&l(e,["fileData"],WR(o));const s=a(n,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);const u=a(n,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);const c=a(n,["executableCode"]);c!=null&&l(e,["executableCode"],c);const f=a(n,["functionCall"]);f!=null&&l(e,["functionCall"],f);const h=a(n,["functionResponse"]);h!=null&&l(e,["functionResponse"],h);const m=a(n,["text"]);return m!=null&&l(e,["text"],m),e}function QR(n){const e={},t=a(n,["videoMetadata"]);t!=null&&l(e,["videoMetadata"],zR(t));const i=a(n,["thought"]);i!=null&&l(e,["thought"],i);const r=a(n,["inlineData"]);r!=null&&l(e,["inlineData"],JR(r));const o=a(n,["fileData"]);o!=null&&l(e,["fileData"],YR(o));const s=a(n,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);const u=a(n,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);const c=a(n,["executableCode"]);c!=null&&l(e,["executableCode"],c);const f=a(n,["functionCall"]);f!=null&&l(e,["functionCall"],f);const h=a(n,["functionResponse"]);h!=null&&l(e,["functionResponse"],h);const m=a(n,["text"]);return m!=null&&l(e,["text"],m),e}function ZR(n){const e={},t=a(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>XR(o))),l(e,["parts"],r)}const i=a(n,["role"]);return i!=null&&l(e,["role"],i),e}function jR(n){const e={},t=a(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>QR(o))),l(e,["parts"],r)}const i=a(n,["role"]);return i!=null&&l(e,["role"],i),e}function op(n){const e={},t=a(n,["text"]);t!=null&&l(e,["text"],t);const i=a(n,["finished"]);return i!=null&&l(e,["finished"],i),e}function sp(n){const e={},t=a(n,["text"]);t!=null&&l(e,["text"],t);const i=a(n,["finished"]);return i!=null&&l(e,["finished"],i),e}function eP(n){const e={},t=a(n,["retrievedUrl"]);t!=null&&l(e,["retrievedUrl"],t);const i=a(n,["urlRetrievalStatus"]);return i!=null&&l(e,["urlRetrievalStatus"],i),e}function tP(n){const e={},t=a(n,["urlMetadata"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>eP(r))),l(e,["urlMetadata"],i)}return e}function nP(n){const e={},t=a(n,["modelTurn"]);t!=null&&l(e,["modelTurn"],ZR(t));const i=a(n,["turnComplete"]);i!=null&&l(e,["turnComplete"],i);const r=a(n,["interrupted"]);r!=null&&l(e,["interrupted"],r);const o=a(n,["groundingMetadata"]);o!=null&&l(e,["groundingMetadata"],o);const s=a(n,["generationComplete"]);s!=null&&l(e,["generationComplete"],s);const u=a(n,["inputTranscription"]);u!=null&&l(e,["inputTranscription"],op(u));const c=a(n,["outputTranscription"]);c!=null&&l(e,["outputTranscription"],op(c));const f=a(n,["urlContextMetadata"]);return f!=null&&l(e,["urlContextMetadata"],tP(f)),e}function iP(n){const e={},t=a(n,["modelTurn"]);t!=null&&l(e,["modelTurn"],jR(t));const i=a(n,["turnComplete"]);i!=null&&l(e,["turnComplete"],i);const r=a(n,["interrupted"]);r!=null&&l(e,["interrupted"],r);const o=a(n,["groundingMetadata"]);o!=null&&l(e,["groundingMetadata"],o);const s=a(n,["generationComplete"]);s!=null&&l(e,["generationComplete"],s);const u=a(n,["inputTranscription"]);u!=null&&l(e,["inputTranscription"],sp(u));const c=a(n,["outputTranscription"]);return c!=null&&l(e,["outputTranscription"],sp(c)),e}function rP(n){const e={},t=a(n,["id"]);t!=null&&l(e,["id"],t);const i=a(n,["args"]);i!=null&&l(e,["args"],i);const r=a(n,["name"]);return r!=null&&l(e,["name"],r),e}function oP(n){const e={},t=a(n,["args"]);t!=null&&l(e,["args"],t);const i=a(n,["name"]);return i!=null&&l(e,["name"],i),e}function sP(n){const e={},t=a(n,["functionCalls"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>rP(r))),l(e,["functionCalls"],i)}return e}function aP(n){const e={},t=a(n,["functionCalls"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>oP(r))),l(e,["functionCalls"],i)}return e}function lP(n){const e={},t=a(n,["ids"]);return t!=null&&l(e,["ids"],t),e}function uP(n){const e={},t=a(n,["ids"]);return t!=null&&l(e,["ids"],t),e}function Zo(n){const e={},t=a(n,["modality"]);t!=null&&l(e,["modality"],t);const i=a(n,["tokenCount"]);return i!=null&&l(e,["tokenCount"],i),e}function jo(n){const e={},t=a(n,["modality"]);t!=null&&l(e,["modality"],t);const i=a(n,["tokenCount"]);return i!=null&&l(e,["tokenCount"],i),e}function cP(n){const e={},t=a(n,["promptTokenCount"]);t!=null&&l(e,["promptTokenCount"],t);const i=a(n,["cachedContentTokenCount"]);i!=null&&l(e,["cachedContentTokenCount"],i);const r=a(n,["responseTokenCount"]);r!=null&&l(e,["responseTokenCount"],r);const o=a(n,["toolUsePromptTokenCount"]);o!=null&&l(e,["toolUsePromptTokenCount"],o);const s=a(n,["thoughtsTokenCount"]);s!=null&&l(e,["thoughtsTokenCount"],s);const u=a(n,["totalTokenCount"]);u!=null&&l(e,["totalTokenCount"],u);const c=a(n,["promptTokensDetails"]);if(c!=null){let y=c;Array.isArray(y)&&(y=y.map(v=>Zo(v))),l(e,["promptTokensDetails"],y)}const f=a(n,["cacheTokensDetails"]);if(f!=null){let y=f;Array.isArray(y)&&(y=y.map(v=>Zo(v))),l(e,["cacheTokensDetails"],y)}const h=a(n,["responseTokensDetails"]);if(h!=null){let y=h;Array.isArray(y)&&(y=y.map(v=>Zo(v))),l(e,["responseTokensDetails"],y)}const m=a(n,["toolUsePromptTokensDetails"]);if(m!=null){let y=m;Array.isArray(y)&&(y=y.map(v=>Zo(v))),l(e,["toolUsePromptTokensDetails"],y)}return e}function dP(n){const e={},t=a(n,["promptTokenCount"]);t!=null&&l(e,["promptTokenCount"],t);const i=a(n,["cachedContentTokenCount"]);i!=null&&l(e,["cachedContentTokenCount"],i);const r=a(n,["candidatesTokenCount"]);r!=null&&l(e,["responseTokenCount"],r);const o=a(n,["toolUsePromptTokenCount"]);o!=null&&l(e,["toolUsePromptTokenCount"],o);const s=a(n,["thoughtsTokenCount"]);s!=null&&l(e,["thoughtsTokenCount"],s);const u=a(n,["totalTokenCount"]);u!=null&&l(e,["totalTokenCount"],u);const c=a(n,["promptTokensDetails"]);if(c!=null){let v=c;Array.isArray(v)&&(v=v.map(x=>jo(x))),l(e,["promptTokensDetails"],v)}const f=a(n,["cacheTokensDetails"]);if(f!=null){let v=f;Array.isArray(v)&&(v=v.map(x=>jo(x))),l(e,["cacheTokensDetails"],v)}const h=a(n,["candidatesTokensDetails"]);if(h!=null){let v=h;Array.isArray(v)&&(v=v.map(x=>jo(x))),l(e,["responseTokensDetails"],v)}const m=a(n,["toolUsePromptTokensDetails"]);if(m!=null){let v=m;Array.isArray(v)&&(v=v.map(x=>jo(x))),l(e,["toolUsePromptTokensDetails"],v)}const y=a(n,["trafficType"]);return y!=null&&l(e,["trafficType"],y),e}function fP(n){const e={},t=a(n,["timeLeft"]);return t!=null&&l(e,["timeLeft"],t),e}function hP(n){const e={},t=a(n,["timeLeft"]);return t!=null&&l(e,["timeLeft"],t),e}function pP(n){const e={},t=a(n,["newHandle"]);t!=null&&l(e,["newHandle"],t);const i=a(n,["resumable"]);i!=null&&l(e,["resumable"],i);const r=a(n,["lastConsumedClientMessageIndex"]);return r!=null&&l(e,["lastConsumedClientMessageIndex"],r),e}function mP(n){const e={},t=a(n,["newHandle"]);t!=null&&l(e,["newHandle"],t);const i=a(n,["resumable"]);i!=null&&l(e,["resumable"],i);const r=a(n,["lastConsumedClientMessageIndex"]);return r!=null&&l(e,["lastConsumedClientMessageIndex"],r),e}function gP(n){const e={};a(n,["setupComplete"])!=null&&l(e,["setupComplete"],qR());const i=a(n,["serverContent"]);i!=null&&l(e,["serverContent"],nP(i));const r=a(n,["toolCall"]);r!=null&&l(e,["toolCall"],sP(r));const o=a(n,["toolCallCancellation"]);o!=null&&l(e,["toolCallCancellation"],lP(o));const s=a(n,["usageMetadata"]);s!=null&&l(e,["usageMetadata"],cP(s));const u=a(n,["goAway"]);u!=null&&l(e,["goAway"],fP(u));const c=a(n,["sessionResumptionUpdate"]);return c!=null&&l(e,["sessionResumptionUpdate"],pP(c)),e}function yP(n){const e={};a(n,["setupComplete"])!=null&&l(e,["setupComplete"],GR());const i=a(n,["serverContent"]);i!=null&&l(e,["serverContent"],iP(i));const r=a(n,["toolCall"]);r!=null&&l(e,["toolCall"],aP(r));const o=a(n,["toolCallCancellation"]);o!=null&&l(e,["toolCallCancellation"],uP(o));const s=a(n,["usageMetadata"]);s!=null&&l(e,["usageMetadata"],dP(s));const u=a(n,["goAway"]);u!=null&&l(e,["goAway"],hP(u));const c=a(n,["sessionResumptionUpdate"]);return c!=null&&l(e,["sessionResumptionUpdate"],mP(c)),e}function _P(){return{}}function vP(n){const e={},t=a(n,["text"]);t!=null&&l(e,["text"],t);const i=a(n,["weight"]);return i!=null&&l(e,["weight"],i),e}function TP(n){const e={},t=a(n,["weightedPrompts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>vP(r))),l(e,["weightedPrompts"],i)}return e}function EP(n){const e={},t=a(n,["temperature"]);t!=null&&l(e,["temperature"],t);const i=a(n,["topK"]);i!=null&&l(e,["topK"],i);const r=a(n,["seed"]);r!=null&&l(e,["seed"],r);const o=a(n,["guidance"]);o!=null&&l(e,["guidance"],o);const s=a(n,["bpm"]);s!=null&&l(e,["bpm"],s);const u=a(n,["density"]);u!=null&&l(e,["density"],u);const c=a(n,["brightness"]);c!=null&&l(e,["brightness"],c);const f=a(n,["scale"]);f!=null&&l(e,["scale"],f);const h=a(n,["muteBass"]);h!=null&&l(e,["muteBass"],h);const m=a(n,["muteDrums"]);m!=null&&l(e,["muteDrums"],m);const y=a(n,["onlyBassAndDrums"]);return y!=null&&l(e,["onlyBassAndDrums"],y),e}function IP(n){const e={},t=a(n,["clientContent"]);t!=null&&l(e,["clientContent"],TP(t));const i=a(n,["musicGenerationConfig"]);return i!=null&&l(e,["musicGenerationConfig"],EP(i)),e}function CP(n){const e={},t=a(n,["data"]);t!=null&&l(e,["data"],t);const i=a(n,["mimeType"]);i!=null&&l(e,["mimeType"],i);const r=a(n,["sourceMetadata"]);return r!=null&&l(e,["sourceMetadata"],IP(r)),e}function AP(n){const e={},t=a(n,["audioChunks"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>CP(r))),l(e,["audioChunks"],i)}return e}function SP(n){const e={},t=a(n,["text"]);t!=null&&l(e,["text"],t);const i=a(n,["filteredReason"]);return i!=null&&l(e,["filteredReason"],i),e}function wP(n){const e={};a(n,["setupComplete"])!=null&&l(e,["setupComplete"],_P());const i=a(n,["serverContent"]);i!=null&&l(e,["serverContent"],AP(i));const r=a(n,["filteredPrompt"]);return r!=null&&l(e,["filteredPrompt"],SP(r)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function xP(n){const e={},t=a(n,["fps"]);t!=null&&l(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&l(e,["endOffset"],i);const r=a(n,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function RP(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["data"]);t!=null&&l(e,["data"],t);const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function PP(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["fileUri"]);t!=null&&l(e,["fileUri"],t);const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function kP(n){const e={},t=a(n,["videoMetadata"]);t!=null&&l(e,["videoMetadata"],xP(t));const i=a(n,["thought"]);i!=null&&l(e,["thought"],i);const r=a(n,["inlineData"]);r!=null&&l(e,["inlineData"],RP(r));const o=a(n,["fileData"]);o!=null&&l(e,["fileData"],PP(o));const s=a(n,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);const u=a(n,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);const c=a(n,["executableCode"]);c!=null&&l(e,["executableCode"],c);const f=a(n,["functionCall"]);f!=null&&l(e,["functionCall"],f);const h=a(n,["functionResponse"]);h!=null&&l(e,["functionResponse"],h);const m=a(n,["text"]);return m!=null&&l(e,["text"],m),e}function Ia(n){const e={},t=a(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>kP(o))),l(e,["parts"],r)}const i=a(n,["role"]);return i!=null&&l(e,["role"],i),e}function MP(n){const e={},t=a(n,["anyOf"]);t!=null&&l(e,["anyOf"],t);const i=a(n,["default"]);i!=null&&l(e,["default"],i);const r=a(n,["description"]);r!=null&&l(e,["description"],r);const o=a(n,["enum"]);o!=null&&l(e,["enum"],o);const s=a(n,["example"]);s!=null&&l(e,["example"],s);const u=a(n,["format"]);u!=null&&l(e,["format"],u);const c=a(n,["items"]);c!=null&&l(e,["items"],c);const f=a(n,["maxItems"]);f!=null&&l(e,["maxItems"],f);const h=a(n,["maxLength"]);h!=null&&l(e,["maxLength"],h);const m=a(n,["maxProperties"]);m!=null&&l(e,["maxProperties"],m);const y=a(n,["maximum"]);y!=null&&l(e,["maximum"],y);const v=a(n,["minItems"]);v!=null&&l(e,["minItems"],v);const x=a(n,["minLength"]);x!=null&&l(e,["minLength"],x);const R=a(n,["minProperties"]);R!=null&&l(e,["minProperties"],R);const D=a(n,["minimum"]);D!=null&&l(e,["minimum"],D);const U=a(n,["nullable"]);U!=null&&l(e,["nullable"],U);const V=a(n,["pattern"]);V!=null&&l(e,["pattern"],V);const N=a(n,["properties"]);N!=null&&l(e,["properties"],N);const F=a(n,["propertyOrdering"]);F!=null&&l(e,["propertyOrdering"],F);const L=a(n,["required"]);L!=null&&l(e,["required"],L);const q=a(n,["title"]);q!=null&&l(e,["title"],q);const I=a(n,["type"]);return I!=null&&l(e,["type"],I),e}function bP(n){const e={};if(a(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const t=a(n,["category"]);t!=null&&l(e,["category"],t);const i=a(n,["threshold"]);return i!=null&&l(e,["threshold"],i),e}function DP(n){const e={},t=a(n,["behavior"]);t!=null&&l(e,["behavior"],t);const i=a(n,["description"]);i!=null&&l(e,["description"],i);const r=a(n,["name"]);r!=null&&l(e,["name"],r);const o=a(n,["parameters"]);o!=null&&l(e,["parameters"],o);const s=a(n,["parametersJsonSchema"]);s!=null&&l(e,["parametersJsonSchema"],s);const u=a(n,["response"]);u!=null&&l(e,["response"],u);const c=a(n,["responseJsonSchema"]);return c!=null&&l(e,["responseJsonSchema"],c),e}function NP(n){const e={},t=a(n,["startTime"]);t!=null&&l(e,["startTime"],t);const i=a(n,["endTime"]);return i!=null&&l(e,["endTime"],i),e}function VP(n){const e={},t=a(n,["timeRangeFilter"]);return t!=null&&l(e,["timeRangeFilter"],NP(t)),e}function LP(n){const e={},t=a(n,["mode"]);t!=null&&l(e,["mode"],t);const i=a(n,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function FP(n){const e={},t=a(n,["dynamicRetrievalConfig"]);return t!=null&&l(e,["dynamicRetrievalConfig"],LP(t)),e}function UP(){return{}}function BP(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(c=>DP(c))),l(e,["functionDeclarations"],u)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=a(n,["googleSearch"]);i!=null&&l(e,["googleSearch"],VP(i));const r=a(n,["googleSearchRetrieval"]);if(r!=null&&l(e,["googleSearchRetrieval"],FP(r)),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(a(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");a(n,["urlContext"])!=null&&l(e,["urlContext"],UP());const s=a(n,["codeExecution"]);return s!=null&&l(e,["codeExecution"],s),e}function OP(n){const e={},t=a(n,["mode"]);t!=null&&l(e,["mode"],t);const i=a(n,["allowedFunctionNames"]);return i!=null&&l(e,["allowedFunctionNames"],i),e}function $P(n){const e={},t=a(n,["latitude"]);t!=null&&l(e,["latitude"],t);const i=a(n,["longitude"]);return i!=null&&l(e,["longitude"],i),e}function qP(n){const e={},t=a(n,["latLng"]);t!=null&&l(e,["latLng"],$P(t));const i=a(n,["languageCode"]);return i!=null&&l(e,["languageCode"],i),e}function GP(n){const e={},t=a(n,["functionCallingConfig"]);t!=null&&l(e,["functionCallingConfig"],OP(t));const i=a(n,["retrievalConfig"]);return i!=null&&l(e,["retrievalConfig"],qP(i)),e}function HP(n){const e={},t=a(n,["voiceName"]);return t!=null&&l(e,["voiceName"],t),e}function Ty(n){const e={},t=a(n,["prebuiltVoiceConfig"]);return t!=null&&l(e,["prebuiltVoiceConfig"],HP(t)),e}function zP(n){const e={},t=a(n,["speaker"]);t!=null&&l(e,["speaker"],t);const i=a(n,["voiceConfig"]);return i!=null&&l(e,["voiceConfig"],Ty(i)),e}function KP(n){const e={},t=a(n,["speakerVoiceConfigs"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>zP(r))),l(e,["speakerVoiceConfigs"],i)}return e}function JP(n){const e={},t=a(n,["voiceConfig"]);t!=null&&l(e,["voiceConfig"],Ty(t));const i=a(n,["multiSpeakerVoiceConfig"]);i!=null&&l(e,["multiSpeakerVoiceConfig"],KP(i));const r=a(n,["languageCode"]);return r!=null&&l(e,["languageCode"],r),e}function WP(n){const e={},t=a(n,["includeThoughts"]);t!=null&&l(e,["includeThoughts"],t);const i=a(n,["thinkingBudget"]);return i!=null&&l(e,["thinkingBudget"],i),e}function YP(n,e,t){const i={},r=a(e,["systemInstruction"]);t!==void 0&&r!=null&&l(t,["systemInstruction"],Ia(We(r)));const o=a(e,["temperature"]);o!=null&&l(i,["temperature"],o);const s=a(e,["topP"]);s!=null&&l(i,["topP"],s);const u=a(e,["topK"]);u!=null&&l(i,["topK"],u);const c=a(e,["candidateCount"]);c!=null&&l(i,["candidateCount"],c);const f=a(e,["maxOutputTokens"]);f!=null&&l(i,["maxOutputTokens"],f);const h=a(e,["stopSequences"]);h!=null&&l(i,["stopSequences"],h);const m=a(e,["responseLogprobs"]);m!=null&&l(i,["responseLogprobs"],m);const y=a(e,["logprobs"]);y!=null&&l(i,["logprobs"],y);const v=a(e,["presencePenalty"]);v!=null&&l(i,["presencePenalty"],v);const x=a(e,["frequencyPenalty"]);x!=null&&l(i,["frequencyPenalty"],x);const R=a(e,["seed"]);R!=null&&l(i,["seed"],R);const D=a(e,["responseMimeType"]);D!=null&&l(i,["responseMimeType"],D);const U=a(e,["responseSchema"]);U!=null&&l(i,["responseSchema"],MP(ho(U)));const V=a(e,["responseJsonSchema"]);if(V!=null&&l(i,["responseJsonSchema"],V),a(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(a(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const N=a(e,["safetySettings"]);if(t!==void 0&&N!=null){let C=N;Array.isArray(C)&&(C=C.map(P=>bP(P))),l(t,["safetySettings"],C)}const F=a(e,["tools"]);if(t!==void 0&&F!=null){let C=dr(F);Array.isArray(C)&&(C=C.map(P=>BP(cr(P)))),l(t,["tools"],C)}const L=a(e,["toolConfig"]);if(t!==void 0&&L!=null&&l(t,["toolConfig"],GP(L)),a(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const q=a(e,["cachedContent"]);t!==void 0&&q!=null&&l(t,["cachedContent"],Xt(n,q));const I=a(e,["responseModalities"]);I!=null&&l(i,["responseModalities"],I);const T=a(e,["mediaResolution"]);T!=null&&l(i,["mediaResolution"],T);const E=a(e,["speechConfig"]);if(E!=null&&l(i,["speechConfig"],JP(Wu(E))),a(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const w=a(e,["thinkingConfig"]);return w!=null&&l(i,["thinkingConfig"],WP(w)),i}function ap(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],pe(n,i));const r=a(e,["contents"]);if(r!=null){let s=ft(r);Array.isArray(s)&&(s=s.map(u=>Ia(u))),l(t,["contents"],s)}const o=a(e,["config"]);return o!=null&&l(t,["generationConfig"],YP(n,o,t)),t}function XP(n,e){const t={},i=a(n,["taskType"]);e!==void 0&&i!=null&&l(e,["requests[]","taskType"],i);const r=a(n,["title"]);e!==void 0&&r!=null&&l(e,["requests[]","title"],r);const o=a(n,["outputDimensionality"]);if(e!==void 0&&o!=null&&l(e,["requests[]","outputDimensionality"],o),a(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(a(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function QP(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],pe(n,i));const r=a(e,["contents"]);r!=null&&l(t,["requests[]","content"],oy(n,r));const o=a(e,["config"]);o!=null&&l(t,["config"],XP(o,t));const s=a(e,["model"]);return s!==void 0&&l(t,["requests[]","model"],pe(n,s)),t}function ZP(n,e){const t={};if(a(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(a(n,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const i=a(n,["numberOfImages"]);e!==void 0&&i!=null&&l(e,["parameters","sampleCount"],i);const r=a(n,["aspectRatio"]);e!==void 0&&r!=null&&l(e,["parameters","aspectRatio"],r);const o=a(n,["guidanceScale"]);if(e!==void 0&&o!=null&&l(e,["parameters","guidanceScale"],o),a(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const s=a(n,["safetyFilterLevel"]);e!==void 0&&s!=null&&l(e,["parameters","safetySetting"],s);const u=a(n,["personGeneration"]);e!==void 0&&u!=null&&l(e,["parameters","personGeneration"],u);const c=a(n,["includeSafetyAttributes"]);e!==void 0&&c!=null&&l(e,["parameters","includeSafetyAttributes"],c);const f=a(n,["includeRaiReason"]);e!==void 0&&f!=null&&l(e,["parameters","includeRaiReason"],f);const h=a(n,["language"]);e!==void 0&&h!=null&&l(e,["parameters","language"],h);const m=a(n,["outputMimeType"]);e!==void 0&&m!=null&&l(e,["parameters","outputOptions","mimeType"],m);const y=a(n,["outputCompressionQuality"]);if(e!==void 0&&y!=null&&l(e,["parameters","outputOptions","compressionQuality"],y),a(n,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(a(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function jP(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],pe(n,i));const r=a(e,["prompt"]);r!=null&&l(t,["instances[0]","prompt"],r);const o=a(e,["config"]);return o!=null&&l(t,["config"],ZP(o,t)),t}function ek(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","name"],pe(n,i));const r=a(e,["config"]);return r!=null&&l(t,["config"],r),t}function tk(n,e,t){const i={},r=a(e,["pageSize"]);t!==void 0&&r!=null&&l(t,["_query","pageSize"],r);const o=a(e,["pageToken"]);t!==void 0&&o!=null&&l(t,["_query","pageToken"],o);const s=a(e,["filter"]);t!==void 0&&s!=null&&l(t,["_query","filter"],s);const u=a(e,["queryBase"]);return t!==void 0&&u!=null&&l(t,["_url","models_url"],ly(n,u)),i}function nk(n,e){const t={},i=a(e,["config"]);return i!=null&&l(t,["config"],tk(n,i,t)),t}function ik(n,e){const t={},i=a(n,["displayName"]);e!==void 0&&i!=null&&l(e,["displayName"],i);const r=a(n,["description"]);e!==void 0&&r!=null&&l(e,["description"],r);const o=a(n,["defaultCheckpointId"]);return e!==void 0&&o!=null&&l(e,["defaultCheckpointId"],o),t}function rk(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","name"],pe(n,i));const r=a(e,["config"]);return r!=null&&l(t,["config"],ik(r,t)),t}function ok(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","name"],pe(n,i));const r=a(e,["config"]);return r!=null&&l(t,["config"],r),t}function sk(n){const e={};if(a(n,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(a(n,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(a(n,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function ak(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],pe(n,i));const r=a(e,["contents"]);if(r!=null){let s=ft(r);Array.isArray(s)&&(s=s.map(u=>Ia(u))),l(t,["contents"],s)}const o=a(e,["config"]);return o!=null&&l(t,["config"],sk(o)),t}function lk(n){const e={};if(a(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const t=a(n,["imageBytes"]);t!=null&&l(e,["bytesBase64Encoded"],Qt(t));const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function uk(n,e){const t={},i=a(n,["numberOfVideos"]);if(e!==void 0&&i!=null&&l(e,["parameters","sampleCount"],i),a(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(a(n,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const r=a(n,["durationSeconds"]);if(e!==void 0&&r!=null&&l(e,["parameters","durationSeconds"],r),a(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const o=a(n,["aspectRatio"]);if(e!==void 0&&o!=null&&l(e,["parameters","aspectRatio"],o),a(n,["resolution"])!==void 0)throw new Error("resolution parameter is not supported in Gemini API.");const s=a(n,["personGeneration"]);if(e!==void 0&&s!=null&&l(e,["parameters","personGeneration"],s),a(n,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const u=a(n,["negativePrompt"]);e!==void 0&&u!=null&&l(e,["parameters","negativePrompt"],u);const c=a(n,["enhancePrompt"]);if(e!==void 0&&c!=null&&l(e,["parameters","enhancePrompt"],c),a(n,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");if(a(n,["lastFrame"])!==void 0)throw new Error("lastFrame parameter is not supported in Gemini API.");if(a(n,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function ck(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],pe(n,i));const r=a(e,["prompt"]);r!=null&&l(t,["instances[0]","prompt"],r);const o=a(e,["image"]);if(o!=null&&l(t,["instances[0]","image"],lk(o)),a(e,["video"])!==void 0)throw new Error("video parameter is not supported in Gemini API.");const s=a(e,["config"]);return s!=null&&l(t,["config"],uk(s,t)),t}function dk(n){const e={},t=a(n,["fps"]);t!=null&&l(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&l(e,["endOffset"],i);const r=a(n,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function fk(n){const e={},t=a(n,["displayName"]);t!=null&&l(e,["displayName"],t);const i=a(n,["data"]);i!=null&&l(e,["data"],i);const r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function hk(n){const e={},t=a(n,["displayName"]);t!=null&&l(e,["displayName"],t);const i=a(n,["fileUri"]);i!=null&&l(e,["fileUri"],i);const r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function pk(n){const e={},t=a(n,["videoMetadata"]);t!=null&&l(e,["videoMetadata"],dk(t));const i=a(n,["thought"]);i!=null&&l(e,["thought"],i);const r=a(n,["inlineData"]);r!=null&&l(e,["inlineData"],fk(r));const o=a(n,["fileData"]);o!=null&&l(e,["fileData"],hk(o));const s=a(n,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);const u=a(n,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);const c=a(n,["executableCode"]);c!=null&&l(e,["executableCode"],c);const f=a(n,["functionCall"]);f!=null&&l(e,["functionCall"],f);const h=a(n,["functionResponse"]);h!=null&&l(e,["functionResponse"],h);const m=a(n,["text"]);return m!=null&&l(e,["text"],m),e}function fr(n){const e={},t=a(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>pk(o))),l(e,["parts"],r)}const i=a(n,["role"]);return i!=null&&l(e,["role"],i),e}function mk(n){const e={},t=a(n,["anyOf"]);t!=null&&l(e,["anyOf"],t);const i=a(n,["default"]);i!=null&&l(e,["default"],i);const r=a(n,["description"]);r!=null&&l(e,["description"],r);const o=a(n,["enum"]);o!=null&&l(e,["enum"],o);const s=a(n,["example"]);s!=null&&l(e,["example"],s);const u=a(n,["format"]);u!=null&&l(e,["format"],u);const c=a(n,["items"]);c!=null&&l(e,["items"],c);const f=a(n,["maxItems"]);f!=null&&l(e,["maxItems"],f);const h=a(n,["maxLength"]);h!=null&&l(e,["maxLength"],h);const m=a(n,["maxProperties"]);m!=null&&l(e,["maxProperties"],m);const y=a(n,["maximum"]);y!=null&&l(e,["maximum"],y);const v=a(n,["minItems"]);v!=null&&l(e,["minItems"],v);const x=a(n,["minLength"]);x!=null&&l(e,["minLength"],x);const R=a(n,["minProperties"]);R!=null&&l(e,["minProperties"],R);const D=a(n,["minimum"]);D!=null&&l(e,["minimum"],D);const U=a(n,["nullable"]);U!=null&&l(e,["nullable"],U);const V=a(n,["pattern"]);V!=null&&l(e,["pattern"],V);const N=a(n,["properties"]);N!=null&&l(e,["properties"],N);const F=a(n,["propertyOrdering"]);F!=null&&l(e,["propertyOrdering"],F);const L=a(n,["required"]);L!=null&&l(e,["required"],L);const q=a(n,["title"]);q!=null&&l(e,["title"],q);const I=a(n,["type"]);return I!=null&&l(e,["type"],I),e}function gk(n){const e={},t=a(n,["featureSelectionPreference"]);return t!=null&&l(e,["featureSelectionPreference"],t),e}function yk(n){const e={},t=a(n,["method"]);t!=null&&l(e,["method"],t);const i=a(n,["category"]);i!=null&&l(e,["category"],i);const r=a(n,["threshold"]);return r!=null&&l(e,["threshold"],r),e}function _k(n){const e={};if(a(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=a(n,["description"]);t!=null&&l(e,["description"],t);const i=a(n,["name"]);i!=null&&l(e,["name"],i);const r=a(n,["parameters"]);r!=null&&l(e,["parameters"],r);const o=a(n,["parametersJsonSchema"]);o!=null&&l(e,["parametersJsonSchema"],o);const s=a(n,["response"]);s!=null&&l(e,["response"],s);const u=a(n,["responseJsonSchema"]);return u!=null&&l(e,["responseJsonSchema"],u),e}function vk(n){const e={},t=a(n,["startTime"]);t!=null&&l(e,["startTime"],t);const i=a(n,["endTime"]);return i!=null&&l(e,["endTime"],i),e}function Tk(n){const e={},t=a(n,["timeRangeFilter"]);return t!=null&&l(e,["timeRangeFilter"],vk(t)),e}function Ek(n){const e={},t=a(n,["mode"]);t!=null&&l(e,["mode"],t);const i=a(n,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function Ik(n){const e={},t=a(n,["dynamicRetrievalConfig"]);return t!=null&&l(e,["dynamicRetrievalConfig"],Ek(t)),e}function Ck(){return{}}function Ak(n){const e={},t=a(n,["apiKeyString"]);return t!=null&&l(e,["apiKeyString"],t),e}function Sk(n){const e={},t=a(n,["apiKeyConfig"]);t!=null&&l(e,["apiKeyConfig"],Ak(t));const i=a(n,["authType"]);i!=null&&l(e,["authType"],i);const r=a(n,["googleServiceAccountConfig"]);r!=null&&l(e,["googleServiceAccountConfig"],r);const o=a(n,["httpBasicAuthConfig"]);o!=null&&l(e,["httpBasicAuthConfig"],o);const s=a(n,["oauthConfig"]);s!=null&&l(e,["oauthConfig"],s);const u=a(n,["oidcConfig"]);return u!=null&&l(e,["oidcConfig"],u),e}function wk(n){const e={},t=a(n,["authConfig"]);return t!=null&&l(e,["authConfig"],Sk(t)),e}function xk(){return{}}function Ey(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(m=>_k(m))),l(e,["functionDeclarations"],h)}const i=a(n,["retrieval"]);i!=null&&l(e,["retrieval"],i);const r=a(n,["googleSearch"]);r!=null&&l(e,["googleSearch"],Tk(r));const o=a(n,["googleSearchRetrieval"]);o!=null&&l(e,["googleSearchRetrieval"],Ik(o)),a(n,["enterpriseWebSearch"])!=null&&l(e,["enterpriseWebSearch"],Ck());const u=a(n,["googleMaps"]);u!=null&&l(e,["googleMaps"],wk(u)),a(n,["urlContext"])!=null&&l(e,["urlContext"],xk());const f=a(n,["codeExecution"]);return f!=null&&l(e,["codeExecution"],f),e}function Rk(n){const e={},t=a(n,["mode"]);t!=null&&l(e,["mode"],t);const i=a(n,["allowedFunctionNames"]);return i!=null&&l(e,["allowedFunctionNames"],i),e}function Pk(n){const e={},t=a(n,["latitude"]);t!=null&&l(e,["latitude"],t);const i=a(n,["longitude"]);return i!=null&&l(e,["longitude"],i),e}function kk(n){const e={},t=a(n,["latLng"]);t!=null&&l(e,["latLng"],Pk(t));const i=a(n,["languageCode"]);return i!=null&&l(e,["languageCode"],i),e}function Mk(n){const e={},t=a(n,["functionCallingConfig"]);t!=null&&l(e,["functionCallingConfig"],Rk(t));const i=a(n,["retrievalConfig"]);return i!=null&&l(e,["retrievalConfig"],kk(i)),e}function bk(n){const e={},t=a(n,["voiceName"]);return t!=null&&l(e,["voiceName"],t),e}function Dk(n){const e={},t=a(n,["prebuiltVoiceConfig"]);return t!=null&&l(e,["prebuiltVoiceConfig"],bk(t)),e}function Nk(n){const e={},t=a(n,["voiceConfig"]);if(t!=null&&l(e,["voiceConfig"],Dk(t)),a(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const i=a(n,["languageCode"]);return i!=null&&l(e,["languageCode"],i),e}function Vk(n){const e={},t=a(n,["includeThoughts"]);t!=null&&l(e,["includeThoughts"],t);const i=a(n,["thinkingBudget"]);return i!=null&&l(e,["thinkingBudget"],i),e}function Lk(n,e,t){const i={},r=a(e,["systemInstruction"]);t!==void 0&&r!=null&&l(t,["systemInstruction"],fr(We(r)));const o=a(e,["temperature"]);o!=null&&l(i,["temperature"],o);const s=a(e,["topP"]);s!=null&&l(i,["topP"],s);const u=a(e,["topK"]);u!=null&&l(i,["topK"],u);const c=a(e,["candidateCount"]);c!=null&&l(i,["candidateCount"],c);const f=a(e,["maxOutputTokens"]);f!=null&&l(i,["maxOutputTokens"],f);const h=a(e,["stopSequences"]);h!=null&&l(i,["stopSequences"],h);const m=a(e,["responseLogprobs"]);m!=null&&l(i,["responseLogprobs"],m);const y=a(e,["logprobs"]);y!=null&&l(i,["logprobs"],y);const v=a(e,["presencePenalty"]);v!=null&&l(i,["presencePenalty"],v);const x=a(e,["frequencyPenalty"]);x!=null&&l(i,["frequencyPenalty"],x);const R=a(e,["seed"]);R!=null&&l(i,["seed"],R);const D=a(e,["responseMimeType"]);D!=null&&l(i,["responseMimeType"],D);const U=a(e,["responseSchema"]);U!=null&&l(i,["responseSchema"],mk(ho(U)));const V=a(e,["responseJsonSchema"]);V!=null&&l(i,["responseJsonSchema"],V);const N=a(e,["routingConfig"]);N!=null&&l(i,["routingConfig"],N);const F=a(e,["modelSelectionConfig"]);F!=null&&l(i,["modelConfig"],gk(F));const L=a(e,["safetySettings"]);if(t!==void 0&&L!=null){let Xe=L;Array.isArray(Xe)&&(Xe=Xe.map(hr=>yk(hr))),l(t,["safetySettings"],Xe)}const q=a(e,["tools"]);if(t!==void 0&&q!=null){let Xe=dr(q);Array.isArray(Xe)&&(Xe=Xe.map(hr=>Ey(cr(hr)))),l(t,["tools"],Xe)}const I=a(e,["toolConfig"]);t!==void 0&&I!=null&&l(t,["toolConfig"],Mk(I));const T=a(e,["labels"]);t!==void 0&&T!=null&&l(t,["labels"],T);const E=a(e,["cachedContent"]);t!==void 0&&E!=null&&l(t,["cachedContent"],Xt(n,E));const w=a(e,["responseModalities"]);w!=null&&l(i,["responseModalities"],w);const C=a(e,["mediaResolution"]);C!=null&&l(i,["mediaResolution"],C);const P=a(e,["speechConfig"]);P!=null&&l(i,["speechConfig"],Nk(Wu(P)));const S=a(e,["audioTimestamp"]);S!=null&&l(i,["audioTimestamp"],S);const ct=a(e,["thinkingConfig"]);return ct!=null&&l(i,["thinkingConfig"],Vk(ct)),i}function lp(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],pe(n,i));const r=a(e,["contents"]);if(r!=null){let s=ft(r);Array.isArray(s)&&(s=s.map(u=>fr(u))),l(t,["contents"],s)}const o=a(e,["config"]);return o!=null&&l(t,["generationConfig"],Lk(n,o,t)),t}function Fk(n,e){const t={},i=a(n,["taskType"]);e!==void 0&&i!=null&&l(e,["instances[]","task_type"],i);const r=a(n,["title"]);e!==void 0&&r!=null&&l(e,["instances[]","title"],r);const o=a(n,["outputDimensionality"]);e!==void 0&&o!=null&&l(e,["parameters","outputDimensionality"],o);const s=a(n,["mimeType"]);e!==void 0&&s!=null&&l(e,["instances[]","mimeType"],s);const u=a(n,["autoTruncate"]);return e!==void 0&&u!=null&&l(e,["parameters","autoTruncate"],u),t}function Uk(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],pe(n,i));const r=a(e,["contents"]);r!=null&&l(t,["instances[]","content"],oy(n,r));const o=a(e,["config"]);return o!=null&&l(t,["config"],Fk(o,t)),t}function Bk(n,e){const t={},i=a(n,["outputGcsUri"]);e!==void 0&&i!=null&&l(e,["parameters","storageUri"],i);const r=a(n,["negativePrompt"]);e!==void 0&&r!=null&&l(e,["parameters","negativePrompt"],r);const o=a(n,["numberOfImages"]);e!==void 0&&o!=null&&l(e,["parameters","sampleCount"],o);const s=a(n,["aspectRatio"]);e!==void 0&&s!=null&&l(e,["parameters","aspectRatio"],s);const u=a(n,["guidanceScale"]);e!==void 0&&u!=null&&l(e,["parameters","guidanceScale"],u);const c=a(n,["seed"]);e!==void 0&&c!=null&&l(e,["parameters","seed"],c);const f=a(n,["safetyFilterLevel"]);e!==void 0&&f!=null&&l(e,["parameters","safetySetting"],f);const h=a(n,["personGeneration"]);e!==void 0&&h!=null&&l(e,["parameters","personGeneration"],h);const m=a(n,["includeSafetyAttributes"]);e!==void 0&&m!=null&&l(e,["parameters","includeSafetyAttributes"],m);const y=a(n,["includeRaiReason"]);e!==void 0&&y!=null&&l(e,["parameters","includeRaiReason"],y);const v=a(n,["language"]);e!==void 0&&v!=null&&l(e,["parameters","language"],v);const x=a(n,["outputMimeType"]);e!==void 0&&x!=null&&l(e,["parameters","outputOptions","mimeType"],x);const R=a(n,["outputCompressionQuality"]);e!==void 0&&R!=null&&l(e,["parameters","outputOptions","compressionQuality"],R);const D=a(n,["addWatermark"]);e!==void 0&&D!=null&&l(e,["parameters","addWatermark"],D);const U=a(n,["enhancePrompt"]);return e!==void 0&&U!=null&&l(e,["parameters","enhancePrompt"],U),t}function Ok(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],pe(n,i));const r=a(e,["prompt"]);r!=null&&l(t,["instances[0]","prompt"],r);const o=a(e,["config"]);return o!=null&&l(t,["config"],Bk(o,t)),t}function Ca(n){const e={},t=a(n,["gcsUri"]);t!=null&&l(e,["gcsUri"],t);const i=a(n,["imageBytes"]);i!=null&&l(e,["bytesBase64Encoded"],Qt(i));const r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function $k(n){const e={},t=a(n,["maskMode"]);t!=null&&l(e,["maskMode"],t);const i=a(n,["segmentationClasses"]);i!=null&&l(e,["maskClasses"],i);const r=a(n,["maskDilation"]);return r!=null&&l(e,["dilation"],r),e}function qk(n){const e={},t=a(n,["controlType"]);t!=null&&l(e,["controlType"],t);const i=a(n,["enableControlImageComputation"]);return i!=null&&l(e,["computeControl"],i),e}function Gk(n){const e={},t=a(n,["styleDescription"]);return t!=null&&l(e,["styleDescription"],t),e}function Hk(n){const e={},t=a(n,["subjectType"]);t!=null&&l(e,["subjectType"],t);const i=a(n,["subjectDescription"]);return i!=null&&l(e,["subjectDescription"],i),e}function zk(n){const e={},t=a(n,["referenceImage"]);t!=null&&l(e,["referenceImage"],Ca(t));const i=a(n,["referenceId"]);i!=null&&l(e,["referenceId"],i);const r=a(n,["referenceType"]);r!=null&&l(e,["referenceType"],r);const o=a(n,["maskImageConfig"]);o!=null&&l(e,["maskImageConfig"],$k(o));const s=a(n,["controlImageConfig"]);s!=null&&l(e,["controlImageConfig"],qk(s));const u=a(n,["styleImageConfig"]);u!=null&&l(e,["styleImageConfig"],Gk(u));const c=a(n,["subjectImageConfig"]);return c!=null&&l(e,["subjectImageConfig"],Hk(c)),e}function Kk(n,e){const t={},i=a(n,["outputGcsUri"]);e!==void 0&&i!=null&&l(e,["parameters","storageUri"],i);const r=a(n,["negativePrompt"]);e!==void 0&&r!=null&&l(e,["parameters","negativePrompt"],r);const o=a(n,["numberOfImages"]);e!==void 0&&o!=null&&l(e,["parameters","sampleCount"],o);const s=a(n,["aspectRatio"]);e!==void 0&&s!=null&&l(e,["parameters","aspectRatio"],s);const u=a(n,["guidanceScale"]);e!==void 0&&u!=null&&l(e,["parameters","guidanceScale"],u);const c=a(n,["seed"]);e!==void 0&&c!=null&&l(e,["parameters","seed"],c);const f=a(n,["safetyFilterLevel"]);e!==void 0&&f!=null&&l(e,["parameters","safetySetting"],f);const h=a(n,["personGeneration"]);e!==void 0&&h!=null&&l(e,["parameters","personGeneration"],h);const m=a(n,["includeSafetyAttributes"]);e!==void 0&&m!=null&&l(e,["parameters","includeSafetyAttributes"],m);const y=a(n,["includeRaiReason"]);e!==void 0&&y!=null&&l(e,["parameters","includeRaiReason"],y);const v=a(n,["language"]);e!==void 0&&v!=null&&l(e,["parameters","language"],v);const x=a(n,["outputMimeType"]);e!==void 0&&x!=null&&l(e,["parameters","outputOptions","mimeType"],x);const R=a(n,["outputCompressionQuality"]);e!==void 0&&R!=null&&l(e,["parameters","outputOptions","compressionQuality"],R);const D=a(n,["editMode"]);e!==void 0&&D!=null&&l(e,["parameters","editMode"],D);const U=a(n,["baseSteps"]);return e!==void 0&&U!=null&&l(e,["parameters","editConfig","baseSteps"],U),t}function Jk(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],pe(n,i));const r=a(e,["prompt"]);r!=null&&l(t,["instances[0]","prompt"],r);const o=a(e,["referenceImages"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(c=>zk(c))),l(t,["instances[0]","referenceImages"],u)}const s=a(e,["config"]);return s!=null&&l(t,["config"],Kk(s,t)),t}function Wk(n,e){const t={},i=a(n,["includeRaiReason"]);e!==void 0&&i!=null&&l(e,["parameters","includeRaiReason"],i);const r=a(n,["outputMimeType"]);e!==void 0&&r!=null&&l(e,["parameters","outputOptions","mimeType"],r);const o=a(n,["outputCompressionQuality"]);e!==void 0&&o!=null&&l(e,["parameters","outputOptions","compressionQuality"],o);const s=a(n,["enhanceInputImage"]);e!==void 0&&s!=null&&l(e,["parameters","upscaleConfig","enhanceInputImage"],s);const u=a(n,["imagePreservationFactor"]);e!==void 0&&u!=null&&l(e,["parameters","upscaleConfig","imagePreservationFactor"],u);const c=a(n,["numberOfImages"]);e!==void 0&&c!=null&&l(e,["parameters","sampleCount"],c);const f=a(n,["mode"]);return e!==void 0&&f!=null&&l(e,["parameters","mode"],f),t}function Yk(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],pe(n,i));const r=a(e,["image"]);r!=null&&l(t,["instances[0]","image"],Ca(r));const o=a(e,["upscaleFactor"]);o!=null&&l(t,["parameters","upscaleConfig","upscaleFactor"],o);const s=a(e,["config"]);return s!=null&&l(t,["config"],Wk(s,t)),t}function Xk(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","name"],pe(n,i));const r=a(e,["config"]);return r!=null&&l(t,["config"],r),t}function Qk(n,e,t){const i={},r=a(e,["pageSize"]);t!==void 0&&r!=null&&l(t,["_query","pageSize"],r);const o=a(e,["pageToken"]);t!==void 0&&o!=null&&l(t,["_query","pageToken"],o);const s=a(e,["filter"]);t!==void 0&&s!=null&&l(t,["_query","filter"],s);const u=a(e,["queryBase"]);return t!==void 0&&u!=null&&l(t,["_url","models_url"],ly(n,u)),i}function Zk(n,e){const t={},i=a(e,["config"]);return i!=null&&l(t,["config"],Qk(n,i,t)),t}function jk(n,e){const t={},i=a(n,["displayName"]);e!==void 0&&i!=null&&l(e,["displayName"],i);const r=a(n,["description"]);e!==void 0&&r!=null&&l(e,["description"],r);const o=a(n,["defaultCheckpointId"]);return e!==void 0&&o!=null&&l(e,["defaultCheckpointId"],o),t}function eM(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],pe(n,i));const r=a(e,["config"]);return r!=null&&l(t,["config"],jk(r,t)),t}function tM(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","name"],pe(n,i));const r=a(e,["config"]);return r!=null&&l(t,["config"],r),t}function nM(n,e){const t={},i=a(n,["systemInstruction"]);e!==void 0&&i!=null&&l(e,["systemInstruction"],fr(We(i)));const r=a(n,["tools"]);if(e!==void 0&&r!=null){let s=r;Array.isArray(s)&&(s=s.map(u=>Ey(u))),l(e,["tools"],s)}const o=a(n,["generationConfig"]);return e!==void 0&&o!=null&&l(e,["generationConfig"],o),t}function iM(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],pe(n,i));const r=a(e,["contents"]);if(r!=null){let s=ft(r);Array.isArray(s)&&(s=s.map(u=>fr(u))),l(t,["contents"],s)}const o=a(e,["config"]);return o!=null&&l(t,["config"],nM(o,t)),t}function rM(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],pe(n,i));const r=a(e,["contents"]);if(r!=null){let s=ft(r);Array.isArray(s)&&(s=s.map(u=>fr(u))),l(t,["contents"],s)}const o=a(e,["config"]);return o!=null&&l(t,["config"],o),t}function oM(n){const e={},t=a(n,["uri"]);t!=null&&l(e,["gcsUri"],t);const i=a(n,["videoBytes"]);i!=null&&l(e,["bytesBase64Encoded"],Qt(i));const r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function sM(n,e){const t={},i=a(n,["numberOfVideos"]);e!==void 0&&i!=null&&l(e,["parameters","sampleCount"],i);const r=a(n,["outputGcsUri"]);e!==void 0&&r!=null&&l(e,["parameters","storageUri"],r);const o=a(n,["fps"]);e!==void 0&&o!=null&&l(e,["parameters","fps"],o);const s=a(n,["durationSeconds"]);e!==void 0&&s!=null&&l(e,["parameters","durationSeconds"],s);const u=a(n,["seed"]);e!==void 0&&u!=null&&l(e,["parameters","seed"],u);const c=a(n,["aspectRatio"]);e!==void 0&&c!=null&&l(e,["parameters","aspectRatio"],c);const f=a(n,["resolution"]);e!==void 0&&f!=null&&l(e,["parameters","resolution"],f);const h=a(n,["personGeneration"]);e!==void 0&&h!=null&&l(e,["parameters","personGeneration"],h);const m=a(n,["pubsubTopic"]);e!==void 0&&m!=null&&l(e,["parameters","pubsubTopic"],m);const y=a(n,["negativePrompt"]);e!==void 0&&y!=null&&l(e,["parameters","negativePrompt"],y);const v=a(n,["enhancePrompt"]);e!==void 0&&v!=null&&l(e,["parameters","enhancePrompt"],v);const x=a(n,["generateAudio"]);e!==void 0&&x!=null&&l(e,["parameters","generateAudio"],x);const R=a(n,["lastFrame"]);e!==void 0&&R!=null&&l(e,["instances[0]","lastFrame"],Ca(R));const D=a(n,["compressionQuality"]);return e!==void 0&&D!=null&&l(e,["parameters","compressionQuality"],D),t}function aM(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],pe(n,i));const r=a(e,["prompt"]);r!=null&&l(t,["instances[0]","prompt"],r);const o=a(e,["image"]);o!=null&&l(t,["instances[0]","image"],Ca(o));const s=a(e,["video"]);s!=null&&l(t,["instances[0]","video"],oM(s));const u=a(e,["config"]);return u!=null&&l(t,["config"],sM(u,t)),t}function lM(n){const e={},t=a(n,["fps"]);t!=null&&l(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&l(e,["endOffset"],i);const r=a(n,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function uM(n){const e={},t=a(n,["data"]);t!=null&&l(e,["data"],t);const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function cM(n){const e={},t=a(n,["fileUri"]);t!=null&&l(e,["fileUri"],t);const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function dM(n){const e={},t=a(n,["videoMetadata"]);t!=null&&l(e,["videoMetadata"],lM(t));const i=a(n,["thought"]);i!=null&&l(e,["thought"],i);const r=a(n,["inlineData"]);r!=null&&l(e,["inlineData"],uM(r));const o=a(n,["fileData"]);o!=null&&l(e,["fileData"],cM(o));const s=a(n,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);const u=a(n,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);const c=a(n,["executableCode"]);c!=null&&l(e,["executableCode"],c);const f=a(n,["functionCall"]);f!=null&&l(e,["functionCall"],f);const h=a(n,["functionResponse"]);h!=null&&l(e,["functionResponse"],h);const m=a(n,["text"]);return m!=null&&l(e,["text"],m),e}function fM(n){const e={},t=a(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>dM(o))),l(e,["parts"],r)}const i=a(n,["role"]);return i!=null&&l(e,["role"],i),e}function hM(n){const e={},t=a(n,["citationSources"]);return t!=null&&l(e,["citations"],t),e}function pM(n){const e={},t=a(n,["retrievedUrl"]);t!=null&&l(e,["retrievedUrl"],t);const i=a(n,["urlRetrievalStatus"]);return i!=null&&l(e,["urlRetrievalStatus"],i),e}function mM(n){const e={},t=a(n,["urlMetadata"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>pM(r))),l(e,["urlMetadata"],i)}return e}function gM(n){const e={},t=a(n,["content"]);t!=null&&l(e,["content"],fM(t));const i=a(n,["citationMetadata"]);i!=null&&l(e,["citationMetadata"],hM(i));const r=a(n,["tokenCount"]);r!=null&&l(e,["tokenCount"],r);const o=a(n,["finishReason"]);o!=null&&l(e,["finishReason"],o);const s=a(n,["urlContextMetadata"]);s!=null&&l(e,["urlContextMetadata"],mM(s));const u=a(n,["avgLogprobs"]);u!=null&&l(e,["avgLogprobs"],u);const c=a(n,["groundingMetadata"]);c!=null&&l(e,["groundingMetadata"],c);const f=a(n,["index"]);f!=null&&l(e,["index"],f);const h=a(n,["logprobsResult"]);h!=null&&l(e,["logprobsResult"],h);const m=a(n,["safetyRatings"]);return m!=null&&l(e,["safetyRatings"],m),e}function up(n){const e={},t=a(n,["candidates"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(u=>gM(u))),l(e,["candidates"],s)}const i=a(n,["modelVersion"]);i!=null&&l(e,["modelVersion"],i);const r=a(n,["promptFeedback"]);r!=null&&l(e,["promptFeedback"],r);const o=a(n,["usageMetadata"]);return o!=null&&l(e,["usageMetadata"],o),e}function yM(n){const e={},t=a(n,["values"]);return t!=null&&l(e,["values"],t),e}function _M(){return{}}function vM(n){const e={},t=a(n,["embeddings"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>yM(o))),l(e,["embeddings"],r)}return a(n,["metadata"])!=null&&l(e,["metadata"],_M()),e}function TM(n){const e={},t=a(n,["bytesBase64Encoded"]);t!=null&&l(e,["imageBytes"],Qt(t));const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Iy(n){const e={},t=a(n,["safetyAttributes","categories"]);t!=null&&l(e,["categories"],t);const i=a(n,["safetyAttributes","scores"]);i!=null&&l(e,["scores"],i);const r=a(n,["contentType"]);return r!=null&&l(e,["contentType"],r),e}function EM(n){const e={},t=a(n,["_self"]);t!=null&&l(e,["image"],TM(t));const i=a(n,["raiFilteredReason"]);i!=null&&l(e,["raiFilteredReason"],i);const r=a(n,["_self"]);return r!=null&&l(e,["safetyAttributes"],Iy(r)),e}function IM(n){const e={},t=a(n,["predictions"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>EM(o))),l(e,["generatedImages"],r)}const i=a(n,["positivePromptSafetyAttributes"]);return i!=null&&l(e,["positivePromptSafetyAttributes"],Iy(i)),e}function CM(n){const e={},t=a(n,["baseModel"]);t!=null&&l(e,["baseModel"],t);const i=a(n,["createTime"]);i!=null&&l(e,["createTime"],i);const r=a(n,["updateTime"]);return r!=null&&l(e,["updateTime"],r),e}function nu(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["displayName"]);i!=null&&l(e,["displayName"],i);const r=a(n,["description"]);r!=null&&l(e,["description"],r);const o=a(n,["version"]);o!=null&&l(e,["version"],o);const s=a(n,["_self"]);s!=null&&l(e,["tunedModelInfo"],CM(s));const u=a(n,["inputTokenLimit"]);u!=null&&l(e,["inputTokenLimit"],u);const c=a(n,["outputTokenLimit"]);c!=null&&l(e,["outputTokenLimit"],c);const f=a(n,["supportedGenerationMethods"]);return f!=null&&l(e,["supportedActions"],f),e}function AM(n,e){const t={},i=a(e,["nextPageToken"]);i!=null&&l(t,["nextPageToken"],i);const r=a(e,["_self"]);if(r!=null){let o=uy(r);Array.isArray(o)&&(o=o.map(s=>nu(s))),l(t,["models"],o)}return t}function SM(){return{}}function wM(n){const e={},t=a(n,["totalTokens"]);t!=null&&l(e,["totalTokens"],t);const i=a(n,["cachedContentTokenCount"]);return i!=null&&l(e,["cachedContentTokenCount"],i),e}function xM(n){const e={},t=a(n,["video","uri"]);t!=null&&l(e,["uri"],t);const i=a(n,["video","encodedVideo"]);i!=null&&l(e,["videoBytes"],Qt(i));const r=a(n,["encoding"]);return r!=null&&l(e,["mimeType"],r),e}function RM(n){const e={},t=a(n,["_self"]);return t!=null&&l(e,["video"],xM(t)),e}function PM(n){const e={},t=a(n,["generatedSamples"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>RM(s))),l(e,["generatedVideos"],o)}const i=a(n,["raiMediaFilteredCount"]);i!=null&&l(e,["raiMediaFilteredCount"],i);const r=a(n,["raiMediaFilteredReasons"]);return r!=null&&l(e,["raiMediaFilteredReasons"],r),e}function kM(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["metadata"]);i!=null&&l(e,["metadata"],i);const r=a(n,["done"]);r!=null&&l(e,["done"],r);const o=a(n,["error"]);o!=null&&l(e,["error"],o);const s=a(n,["response","generateVideoResponse"]);return s!=null&&l(e,["response"],PM(s)),e}function MM(n){const e={},t=a(n,["fps"]);t!=null&&l(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&l(e,["endOffset"],i);const r=a(n,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function bM(n){const e={},t=a(n,["displayName"]);t!=null&&l(e,["displayName"],t);const i=a(n,["data"]);i!=null&&l(e,["data"],i);const r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function DM(n){const e={},t=a(n,["displayName"]);t!=null&&l(e,["displayName"],t);const i=a(n,["fileUri"]);i!=null&&l(e,["fileUri"],i);const r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function NM(n){const e={},t=a(n,["videoMetadata"]);t!=null&&l(e,["videoMetadata"],MM(t));const i=a(n,["thought"]);i!=null&&l(e,["thought"],i);const r=a(n,["inlineData"]);r!=null&&l(e,["inlineData"],bM(r));const o=a(n,["fileData"]);o!=null&&l(e,["fileData"],DM(o));const s=a(n,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);const u=a(n,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);const c=a(n,["executableCode"]);c!=null&&l(e,["executableCode"],c);const f=a(n,["functionCall"]);f!=null&&l(e,["functionCall"],f);const h=a(n,["functionResponse"]);h!=null&&l(e,["functionResponse"],h);const m=a(n,["text"]);return m!=null&&l(e,["text"],m),e}function VM(n){const e={},t=a(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>NM(o))),l(e,["parts"],r)}const i=a(n,["role"]);return i!=null&&l(e,["role"],i),e}function LM(n){const e={},t=a(n,["citations"]);return t!=null&&l(e,["citations"],t),e}function FM(n){const e={},t=a(n,["retrievedUrl"]);t!=null&&l(e,["retrievedUrl"],t);const i=a(n,["urlRetrievalStatus"]);return i!=null&&l(e,["urlRetrievalStatus"],i),e}function UM(n){const e={},t=a(n,["urlMetadata"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>FM(r))),l(e,["urlMetadata"],i)}return e}function BM(n){const e={},t=a(n,["content"]);t!=null&&l(e,["content"],VM(t));const i=a(n,["citationMetadata"]);i!=null&&l(e,["citationMetadata"],LM(i));const r=a(n,["finishMessage"]);r!=null&&l(e,["finishMessage"],r);const o=a(n,["finishReason"]);o!=null&&l(e,["finishReason"],o);const s=a(n,["urlContextMetadata"]);s!=null&&l(e,["urlContextMetadata"],UM(s));const u=a(n,["avgLogprobs"]);u!=null&&l(e,["avgLogprobs"],u);const c=a(n,["groundingMetadata"]);c!=null&&l(e,["groundingMetadata"],c);const f=a(n,["index"]);f!=null&&l(e,["index"],f);const h=a(n,["logprobsResult"]);h!=null&&l(e,["logprobsResult"],h);const m=a(n,["safetyRatings"]);return m!=null&&l(e,["safetyRatings"],m),e}function cp(n){const e={},t=a(n,["candidates"]);if(t!=null){let c=t;Array.isArray(c)&&(c=c.map(f=>BM(f))),l(e,["candidates"],c)}const i=a(n,["createTime"]);i!=null&&l(e,["createTime"],i);const r=a(n,["responseId"]);r!=null&&l(e,["responseId"],r);const o=a(n,["modelVersion"]);o!=null&&l(e,["modelVersion"],o);const s=a(n,["promptFeedback"]);s!=null&&l(e,["promptFeedback"],s);const u=a(n,["usageMetadata"]);return u!=null&&l(e,["usageMetadata"],u),e}function OM(n){const e={},t=a(n,["truncated"]);t!=null&&l(e,["truncated"],t);const i=a(n,["token_count"]);return i!=null&&l(e,["tokenCount"],i),e}function $M(n){const e={},t=a(n,["values"]);t!=null&&l(e,["values"],t);const i=a(n,["statistics"]);return i!=null&&l(e,["statistics"],OM(i)),e}function qM(n){const e={},t=a(n,["billableCharacterCount"]);return t!=null&&l(e,["billableCharacterCount"],t),e}function GM(n){const e={},t=a(n,["predictions[]","embeddings"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>$M(o))),l(e,["embeddings"],r)}const i=a(n,["metadata"]);return i!=null&&l(e,["metadata"],qM(i)),e}function HM(n){const e={},t=a(n,["gcsUri"]);t!=null&&l(e,["gcsUri"],t);const i=a(n,["bytesBase64Encoded"]);i!=null&&l(e,["imageBytes"],Qt(i));const r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function Cy(n){const e={},t=a(n,["safetyAttributes","categories"]);t!=null&&l(e,["categories"],t);const i=a(n,["safetyAttributes","scores"]);i!=null&&l(e,["scores"],i);const r=a(n,["contentType"]);return r!=null&&l(e,["contentType"],r),e}function Xu(n){const e={},t=a(n,["_self"]);t!=null&&l(e,["image"],HM(t));const i=a(n,["raiFilteredReason"]);i!=null&&l(e,["raiFilteredReason"],i);const r=a(n,["_self"]);r!=null&&l(e,["safetyAttributes"],Cy(r));const o=a(n,["prompt"]);return o!=null&&l(e,["enhancedPrompt"],o),e}function zM(n){const e={},t=a(n,["predictions"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>Xu(o))),l(e,["generatedImages"],r)}const i=a(n,["positivePromptSafetyAttributes"]);return i!=null&&l(e,["positivePromptSafetyAttributes"],Cy(i)),e}function KM(n){const e={},t=a(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>Xu(r))),l(e,["generatedImages"],i)}return e}function JM(n){const e={},t=a(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>Xu(r))),l(e,["generatedImages"],i)}return e}function WM(n){const e={},t=a(n,["endpoint"]);t!=null&&l(e,["name"],t);const i=a(n,["deployedModelId"]);return i!=null&&l(e,["deployedModelId"],i),e}function YM(n){const e={},t=a(n,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&l(e,["baseModel"],t);const i=a(n,["createTime"]);i!=null&&l(e,["createTime"],i);const r=a(n,["updateTime"]);return r!=null&&l(e,["updateTime"],r),e}function XM(n){const e={},t=a(n,["checkpointId"]);t!=null&&l(e,["checkpointId"],t);const i=a(n,["epoch"]);i!=null&&l(e,["epoch"],i);const r=a(n,["step"]);return r!=null&&l(e,["step"],r),e}function iu(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["displayName"]);i!=null&&l(e,["displayName"],i);const r=a(n,["description"]);r!=null&&l(e,["description"],r);const o=a(n,["versionId"]);o!=null&&l(e,["version"],o);const s=a(n,["deployedModels"]);if(s!=null){let m=s;Array.isArray(m)&&(m=m.map(y=>WM(y))),l(e,["endpoints"],m)}const u=a(n,["labels"]);u!=null&&l(e,["labels"],u);const c=a(n,["_self"]);c!=null&&l(e,["tunedModelInfo"],YM(c));const f=a(n,["defaultCheckpointId"]);f!=null&&l(e,["defaultCheckpointId"],f);const h=a(n,["checkpoints"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(y=>XM(y))),l(e,["checkpoints"],m)}return e}function QM(n,e){const t={},i=a(e,["nextPageToken"]);i!=null&&l(t,["nextPageToken"],i);const r=a(e,["_self"]);if(r!=null){let o=uy(r);Array.isArray(o)&&(o=o.map(s=>iu(s))),l(t,["models"],o)}return t}function ZM(){return{}}function jM(n){const e={},t=a(n,["totalTokens"]);return t!=null&&l(e,["totalTokens"],t),e}function eb(n){const e={},t=a(n,["tokensInfo"]);return t!=null&&l(e,["tokensInfo"],t),e}function tb(n){const e={},t=a(n,["gcsUri"]);t!=null&&l(e,["uri"],t);const i=a(n,["bytesBase64Encoded"]);i!=null&&l(e,["videoBytes"],Qt(i));const r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function nb(n){const e={},t=a(n,["_self"]);return t!=null&&l(e,["video"],tb(t)),e}function ib(n){const e={},t=a(n,["videos"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>nb(s))),l(e,["generatedVideos"],o)}const i=a(n,["raiMediaFilteredCount"]);i!=null&&l(e,["raiMediaFilteredCount"],i);const r=a(n,["raiMediaFilteredReasons"]);return r!=null&&l(e,["raiMediaFilteredReasons"],r),e}function rb(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["metadata"]);i!=null&&l(e,["metadata"],i);const r=a(n,["done"]);r!=null&&l(e,["done"],r);const o=a(n,["error"]);o!=null&&l(e,["error"],o);const s=a(n,["response"]);return s!=null&&l(e,["response"],ib(s)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ob="Content-Type",sb="X-Server-Timeout",ab="User-Agent",ru="x-goog-api-client",lb="1.7.0",ub=`google-genai-sdk/${lb}`,cb="v1beta1",db="v1beta",dp=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class fb{constructor(e){var t,i;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const r={};this.clientOptions.vertexai?(r.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:cb,r.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(r.apiVersion=(i=this.clientOptions.apiVersion)!==null&&i!==void 0?i:db,r.baseUrl="https://generativelanguage.googleapis.com/"),r.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=r,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(r,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const i=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&i.push(e.apiVersion),i.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,i){const r=[this.getRequestUrlInternal(t)];return i&&r.push(this.getBaseResourcePath()),e!==""&&r.push(e),new URL(`${r.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const i=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,t,i);if(e.queryParams)for(const[s,u]of Object.entries(e.queryParams))r.searchParams.append(s,String(u));let o={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=e.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,t,e.abortSignal),this.unaryApiCall(r,o,e.httpMethod)}patchHttpOptions(e,t){const i=JSON.parse(JSON.stringify(e));for(const[r,o]of Object.entries(t))typeof o=="object"?i[r]=Object.assign(Object.assign({},i[r]),o):o!==void 0&&(i[r]=o);return i}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const i=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,t,i);(!r.searchParams.has("alt")||r.searchParams.get("alt")!=="sse")&&r.searchParams.set("alt","sse");let o={};return o.body=e.body,o=await this.includeExtraHttpOptionsToRequestInit(o,t,e.abortSignal),this.streamApiCall(r,o,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,i){if(t&&t.timeout||i){const r=new AbortController,o=r.signal;t.timeout&&(t==null?void 0:t.timeout)>0&&setTimeout(()=>r.abort(),t.timeout),i&&i.addEventListener("abort",()=>{r.abort()}),e.signal=o}return t&&t.extraBody!==null&&hb(e,t.extraBody),e.headers=await this.getHeadersInternal(t),e}async unaryApiCall(e,t,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:i})).then(async r=>(await fp(r),new Xl(r))).catch(r=>{throw r instanceof Error?r:new Error(JSON.stringify(r))})}async streamApiCall(e,t,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:i})).then(async r=>(await fp(r),this.processStreamResponse(r))).catch(r=>{throw r instanceof Error?r:new Error(JSON.stringify(r))})}processStreamResponse(e){var t;return Di(this,arguments,function*(){const r=(t=e==null?void 0:e.body)===null||t===void 0?void 0:t.getReader(),o=new TextDecoder("utf-8");if(!r)throw new Error("Response body is empty");try{let s="";for(;;){const{done:u,value:c}=yield Te(r.read());if(u){if(s.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const f=o.decode(c);try{const m=JSON.parse(f);if("error"in m){const y=JSON.parse(JSON.stringify(m.error)),v=y.status,x=y.code,R=`got status: ${v}. ${JSON.stringify(m)}`;if(x>=400&&x<600)throw new Ea({message:R,status:x})}}catch(m){if(m.name==="ApiError")throw m}s+=f;let h=s.match(dp);for(;h;){const m=h[1];try{const y=new Response(m,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield Te(new Xl(y)),s=s.slice(h[0].length),h=s.match(dp)}catch(y){throw new Error(`exception parsing stream chunk ${m}. ${y}`)}}}}finally{r.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(i=>{throw new Error(`exception ${i} sending request`)})}getDefaultHeaders(){const e={},t=ub+" "+this.clientOptions.userAgentExtra;return e[ab]=t,e[ru]=t,e[ob]="application/json",e}async getHeadersInternal(e){const t=new Headers;if(e&&e.headers){for(const[i,r]of Object.entries(e.headers))t.append(i,r);e.timeout&&e.timeout>0&&t.append(sb,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(t),t}async uploadFile(e,t){var i;const r={};t!=null&&(r.mimeType=t.mimeType,r.name=t.name,r.displayName=t.displayName),r.name&&!r.name.startsWith("files/")&&(r.name=`files/${r.name}`);const o=this.clientOptions.uploader,s=await o.stat(e);r.sizeBytes=String(s.size);const u=(i=t==null?void 0:t.mimeType)!==null&&i!==void 0?i:s.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");r.mimeType=u;const c=await this.fetchUploadUrl(r,t);return o.upload(e,c,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t){var i;let r={};t!=null&&t.httpOptions?r=t.httpOptions:r={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};const o={file:e},s=await this.request({path:Y("upload/v1beta/files",o._url),body:JSON.stringify(o),httpMethod:"POST",httpOptions:r});if(!s||!(s!=null&&s.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const u=(i=s==null?void 0:s.headers)===null||i===void 0?void 0:i["x-goog-upload-url"];if(u===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return u}}async function fp(n){var e;if(n===void 0)throw new Error("response is undefined");if(!n.ok){const t=n.status;let i;!((e=n.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?i=await n.json():i={error:{message:await n.text(),code:n.status,status:n.statusText}};const r=JSON.stringify(i);throw t>=400&&t<600?new Ea({message:r,status:t}):new Error(r)}}function hb(n,e){if(!e||Object.keys(e).length===0)return;if(n.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof n.body=="string"&&n.body.length>0)try{const o=JSON.parse(n.body);if(typeof o=="object"&&o!==null&&!Array.isArray(o))t=o;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function i(o,s){const u=Object.assign({},o);for(const c in s)if(Object.prototype.hasOwnProperty.call(s,c)){const f=s[c],h=u[c];f&&typeof f=="object"&&!Array.isArray(f)&&h&&typeof h=="object"&&!Array.isArray(h)?u[c]=i(h,f):(h&&f&&typeof h!=typeof f&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${c}". Original type: ${typeof h}, New type: ${typeof f}. Overwriting.`),u[c]=f)}return u}const r=i(t,e);n.body=JSON.stringify(r)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const pb="mcp_used/unknown";function Ay(n){for(const e of n)if(Qu(e)||typeof e=="object"&&"inputSchema"in e)return!0;return!1}function Sy(n){var e;const t=(e=n[ru])!==null&&e!==void 0?e:"";n[ru]=(t+` ${pb}`).trimStart()}function mb(n){var e,t,i;return(i=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(r=>Qu(r)))!==null&&i!==void 0?i:!1}function gb(n){var e,t,i;return(i=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(r=>!Qu(r)))!==null&&i!==void 0?i:!1}function Qu(n){return n!==null&&typeof n=="object"&&n instanceof Zu}function yb(n,e=100){return Di(this,arguments,function*(){let i,r=0;for(;r<e;){const o=yield Te(n.listTools({cursor:i}));for(const s of o.tools)yield yield Te(s),r++;if(!o.nextCursor)break;i=o.nextCursor}})}class Zu{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new Zu(e,t)}async initialize(){var e,t,i,r;if(this.mcpTools.length>0)return;const o={},s=[];for(const h of this.mcpClients)try{for(var u=!0,c=(t=void 0,Qr(yb(h))),f;f=await c.next(),e=f.done,!e;u=!0){r=f.value,u=!1;const m=r;s.push(m);const y=m.name;if(o[y])throw new Error(`Duplicate function name ${y} found in MCP tools. Please ensure function names are unique.`);o[y]=h}}catch(m){t={error:m}}finally{try{!u&&!e&&(i=c.return)&&await i.call(c)}finally{if(t)throw t.error}}this.mcpTools=s,this.functionNameToMcpClient=o}async tool(){return await this.initialize(),fw(this.mcpTools,this.config)}async callTool(e){await this.initialize();const t=[];for(const i of e)if(i.name in this.functionNameToMcpClient){const r=this.functionNameToMcpClient[i.name];let o;this.config.timeout&&(o={timeout:this.config.timeout});const s=await r.callTool({name:i.name,arguments:i.args},void 0,o);t.push({functionResponse:{name:i.name,response:s.isError?{error:s}:s}})}return t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function _b(n,e,t){const i=new jS;let r;t.data instanceof Blob?r=JSON.parse(await t.data.text()):r=JSON.parse(t.data);const o=wP(r);Object.assign(i,o),e(i)}class vb{constructor(e,t,i){this.apiClient=e,this.auth=t,this.webSocketFactory=i}async connect(e){var t,i;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const r=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),s=Ib(this.apiClient.getDefaultHeaders()),u=this.apiClient.getApiKey(),c=`${r}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${u}`;let f=()=>{};const h=new Promise(N=>{f=N}),m=e.callbacks,y=function(){f({})},v=this.apiClient,x={onopen:y,onmessage:N=>{_b(v,m.onmessage,N)},onerror:(t=m==null?void 0:m.onerror)!==null&&t!==void 0?t:function(N){},onclose:(i=m==null?void 0:m.onclose)!==null&&i!==void 0?i:function(N){}},R=this.webSocketFactory.create(c,Eb(s),x);R.connect(),await h;const D=pe(this.apiClient,e.model),U=_y({model:D}),V=tu({setup:U});return R.send(JSON.stringify(V)),new Tb(R,this.apiClient)}}class Tb{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=OR(e),i=vy(t);this.conn.send(JSON.stringify({clientContent:i}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=$R(e),i=tu(t);this.conn.send(JSON.stringify(i))}sendPlaybackControl(e){const t=tu({playbackControl:e});this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(xi.PLAY)}pause(){this.sendPlaybackControl(xi.PAUSE)}stop(){this.sendPlaybackControl(xi.STOP)}resetContext(){this.sendPlaybackControl(xi.RESET_CONTEXT)}close(){this.conn.close()}}function Eb(n){const e={};return n.forEach((t,i)=>{e[i]=t}),e}function Ib(n){const e=new Headers;for(const[t,i]of Object.entries(n))e.append(t,i);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Cb="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function Ab(n,e,t){const i=new ZS;let r;t.data instanceof Blob?r=await t.data.text():t.data instanceof ArrayBuffer?r=new TextDecoder().decode(t.data):r=t.data;const o=JSON.parse(r);if(n.isVertexAI()){const s=yP(o);Object.assign(i,s)}else{const s=gP(o);Object.assign(i,s)}e(i)}class Sb{constructor(e,t,i){this.apiClient=e,this.auth=t,this.webSocketFactory=i,this.music=new vb(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,i,r,o,s,u;const c=this.apiClient.getWebsocketBaseUrl(),f=this.apiClient.getApiVersion();let h;const m=this.apiClient.getDefaultHeaders();e.config&&e.config.tools&&Ay(e.config.tools)&&Sy(m);const y=Pb(m);if(this.apiClient.isVertexAI())h=`${c}/ws/google.cloud.aiplatform.${f}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(y);else{const E=this.apiClient.getApiKey();let w="BidiGenerateContent",C="key";E!=null&&E.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),w="BidiGenerateContentConstrained",C="access_token"),h=`${c}/ws/google.ai.generativelanguage.${f}.GenerativeService.${w}?${C}=${E}`}let v=()=>{};const x=new Promise(E=>{v=E}),R=e.callbacks,D=function(){var E;(E=R==null?void 0:R.onopen)===null||E===void 0||E.call(R),v({})},U=this.apiClient,V={onopen:D,onmessage:E=>{Ab(U,R.onmessage,E)},onerror:(t=R==null?void 0:R.onerror)!==null&&t!==void 0?t:function(E){},onclose:(i=R==null?void 0:R.onclose)!==null&&i!==void 0?i:function(E){}},N=this.webSocketFactory.create(h,Rb(y),V);N.connect(),await x;let F=pe(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&F.startsWith("publishers/")){const E=this.apiClient.getProject(),w=this.apiClient.getLocation();F=`projects/${E}/locations/${w}/`+F}let L={};this.apiClient.isVertexAI()&&((r=e.config)===null||r===void 0?void 0:r.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[zs.AUDIO]}:e.config.responseModalities=[zs.AUDIO]),!((o=e.config)===null||o===void 0)&&o.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const q=(u=(s=e.config)===null||s===void 0?void 0:s.tools)!==null&&u!==void 0?u:[],I=[];for(const E of q)if(this.isCallableTool(E)){const w=E;I.push(await w.tool())}else I.push(E);I.length>0&&(e.config.tools=I);const T={model:F,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?L=DR(this.apiClient,T):L=bR(this.apiClient,T),delete L.config,N.send(JSON.stringify(L)),new xb(N,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const wb={turnComplete:!0};class xb{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let i=[];try{i=ft(t.turns),e.isVertexAI()?i=i.map(r=>fr(r)):i=i.map(r=>Ia(r))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:i,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let i=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?i=t.functionResponses:i=[t.functionResponses],i.length===0)throw new Error("functionResponses is required.");for(const o of i){if(typeof o!="object"||o===null||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!e.isVertexAI()&&!("id"in o))throw new Error(Cb)}return{toolResponse:{functionResponses:i}}}sendClientContent(e){e=Object.assign(Object.assign({},wb),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:BR(e)}:t={realtimeInput:UR(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function Rb(n){const e={};return n.forEach((t,i)=>{e[i]=t}),e}function Pb(n){const e=new Headers;for(const[t,i]of Object.entries(n))e.append(t,i);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const hp=10;function pp(n){var e,t,i;if(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let r=!1;for(const s of(t=n==null?void 0:n.tools)!==null&&t!==void 0?t:[])if(ms(s)){r=!0;break}if(!r)return!0;const o=(i=n==null?void 0:n.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls;return o&&(o<0||!Number.isInteger(o))||o==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0):!1}function ms(n){return"callTool"in n&&typeof n.callTool=="function"}function mp(n){var e;return!(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class kb extends li{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var i,r,o,s,u;const c=await this.processParamsForMcpUsage(t);if(!mb(t)||pp(t.config))return await this.generateContentInternal(c);if(gb(t))throw new Error("Automatic function calling with CallableTools and Tools is not yet supported.");let f,h;const m=ft(c.contents),y=(o=(r=(i=c.config)===null||i===void 0?void 0:i.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&o!==void 0?o:hp;let v=0;for(;v<y&&(f=await this.generateContentInternal(c),!(!f.functionCalls||f.functionCalls.length===0));){const x=f.candidates[0].content,R=[];for(const D of(u=(s=t.config)===null||s===void 0?void 0:s.tools)!==null&&u!==void 0?u:[])if(ms(D)){const V=await D.callTool(f.functionCalls);R.push(...V)}v++,h={role:"user",parts:R},c.contents=ft(c.contents),c.contents.push(x),c.contents.push(h),mp(c.config)&&(m.push(x),m.push(h))}return mp(c.config)&&(f.automaticFunctionCallingHistory=m),f},this.generateContentStream=async t=>{if(pp(t.config)){const i=await this.processParamsForMcpUsage(t);return await this.generateContentStreamInternal(i)}else return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(i=>{var r;let o;const s=[];if(i!=null&&i.generatedImages)for(const c of i.generatedImages)c&&(c!=null&&c.safetyAttributes)&&((r=c==null?void 0:c.safetyAttributes)===null||r===void 0?void 0:r.contentType)==="Positive Prompt"?o=c==null?void 0:c.safetyAttributes:s.push(c);let u;return o?u={generatedImages:s,positivePromptSafetyAttributes:o}:u={generatedImages:s},u}),this.list=async t=>{var i;const s={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!s.config.queryBase){if(!((i=s.config)===null||i===void 0)&&i.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");s.config.filter="labels.tune-type:*"}return new Ao(oi.PAGED_ITEM_MODELS,u=>this.listInternal(u),await this.listInternal(s),s)},this.editImage=async t=>{const i={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(i.referenceImages=t.referenceImages.map(r=>r.toReferenceImageAPI())),await this.editImageInternal(i)},this.upscaleImage=async t=>{let i={numberOfImages:1,mode:"upscale"};t.config&&(i=Object.assign(Object.assign({},i),t.config));const r={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:i};return await this.upscaleImageInternal(r)}}async processParamsForMcpUsage(e){var t,i,r;const o=(t=e.config)===null||t===void 0?void 0:t.tools;if(!o)return e;const s=await Promise.all(o.map(async c=>ms(c)?await c.tool():c)),u={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:s})};if(u.config.tools=s,e.config&&e.config.tools&&Ay(e.config.tools)){const c=(r=(i=e.config.httpOptions)===null||i===void 0?void 0:i.headers)!==null&&r!==void 0?r:{};let f=Object.assign({},c);Object.keys(f).length===0&&(f=this.apiClient.getDefaultHeaders()),Sy(f),u.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:f})}return u}async initAfcToolsMap(e){var t,i,r;const o=new Map;for(const s of(i=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&i!==void 0?i:[])if(ms(s)){const u=s,c=await u.tool();for(const f of(r=c.functionDeclarations)!==null&&r!==void 0?r:[]){if(!f.name)throw new Error("Function declaration name is required.");if(o.has(f.name))throw new Error(`Duplicate tool declaration name: ${f.name}`);o.set(f.name,u)}}return o}async processAfcStream(e){var t,i,r;const o=(r=(i=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&r!==void 0?r:hp;let s=!1,u=0;const c=await this.initAfcToolsMap(e);return function(f,h,m){var y,v;return Di(this,arguments,function*(){for(var x,R,D,U;u<o;){s&&(u++,s=!1);const L=yield Te(f.processParamsForMcpUsage(m)),q=yield Te(f.generateContentStreamInternal(L)),I=[],T=[];try{for(var V=!0,N=(R=void 0,Qr(q)),F;F=yield Te(N.next()),x=F.done,!x;V=!0){U=F.value,V=!1;const E=U;if(yield yield Te(E),E.candidates&&(!((y=E.candidates[0])===null||y===void 0)&&y.content)){T.push(E.candidates[0].content);for(const w of(v=E.candidates[0].content.parts)!==null&&v!==void 0?v:[])if(u<o&&w.functionCall){if(!w.functionCall.name)throw new Error("Function call name was not returned by the model.");if(h.has(w.functionCall.name)){const C=yield Te(h.get(w.functionCall.name).callTool([w.functionCall]));I.push(...C)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${h.keys()}, mising tool: ${w.functionCall.name}`)}}}}catch(E){R={error:E}}finally{try{!V&&!x&&(D=N.return)&&(yield Te(D.call(N)))}finally{if(R)throw R.error}}if(I.length>0){s=!0;const E=new Lr;E.candidates=[{content:{role:"user",parts:I}}],yield yield Te(E);const w=[];w.push(...T),w.push({role:"user",parts:I});const C=ft(m.contents).concat(w);m.contents=C}else break}})}(this,c,e)}async generateContentInternal(e){var t,i,r,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const f=lp(this.apiClient,e);return u=Y("{model}:generateContent",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>{const m=cp(h),y=new Lr;return Object.assign(y,m),y})}else{const f=ap(this.apiClient,e);return u=Y("{model}:generateContent",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>{const m=up(h),y=new Lr;return Object.assign(y,m),y})}}async generateContentStreamInternal(e){var t,i,r,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const f=lp(this.apiClient,e);return u=Y("{model}:streamGenerateContent?alt=sse",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.requestStream({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}),s.then(function(m){return Di(this,arguments,function*(){var y,v,x,R;try{for(var D=!0,U=Qr(m),V;V=yield Te(U.next()),y=V.done,!y;D=!0){R=V.value,D=!1;const F=cp(yield Te(R.json())),L=new Lr;Object.assign(L,F),yield yield Te(L)}}catch(N){v={error:N}}finally{try{!D&&!y&&(x=U.return)&&(yield Te(x.call(U)))}finally{if(v)throw v.error}}})})}else{const f=ap(this.apiClient,e);return u=Y("{model}:streamGenerateContent?alt=sse",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.requestStream({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}),s.then(function(m){return Di(this,arguments,function*(){var y,v,x,R;try{for(var D=!0,U=Qr(m),V;V=yield Te(U.next()),y=V.done,!y;D=!0){R=V.value,D=!1;const F=up(yield Te(R.json())),L=new Lr;Object.assign(L,F),yield yield Te(L)}}catch(N){v={error:N}}finally{try{!D&&!y&&(x=U.return)&&(yield Te(x.call(U)))}finally{if(v)throw v.error}}})})}}async embedContent(e){var t,i,r,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const f=Uk(this.apiClient,e);return u=Y("{model}:predict",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>{const m=GM(h),y=new Oh;return Object.assign(y,m),y})}else{const f=QP(this.apiClient,e);return u=Y("{model}:batchEmbedContents",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>{const m=vM(h),y=new Oh;return Object.assign(y,m),y})}}async generateImagesInternal(e){var t,i,r,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const f=Ok(this.apiClient,e);return u=Y("{model}:predict",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>{const m=zM(h),y=new $h;return Object.assign(y,m),y})}else{const f=jP(this.apiClient,e);return u=Y("{model}:predict",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>{const m=IM(h),y=new $h;return Object.assign(y,m),y})}}async editImageInternal(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI()){const u=Jk(this.apiClient,e);return o=Y("{model}:predict",u._url),s=u._query,delete u.config,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>{const f=KM(c),h=new KS;return Object.assign(h,f),h})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI()){const u=Yk(this.apiClient,e);return o=Y("{model}:predict",u._url),s=u._query,delete u.config,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>{const f=JM(c),h=new JS;return Object.assign(h,f),h})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,i,r,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const f=Xk(this.apiClient,e);return u=Y("{name}",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>iu(h))}else{const f=ek(this.apiClient,e);return u=Y("{name}",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>nu(h))}}async listInternal(e){var t,i,r,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const f=Zk(this.apiClient,e);return u=Y("{models_url}",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>{const m=QM(this.apiClient,h),y=new qh;return Object.assign(y,m),y})}else{const f=nk(this.apiClient,e);return u=Y("{models_url}",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>{const m=AM(this.apiClient,h),y=new qh;return Object.assign(y,m),y})}}async update(e){var t,i,r,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const f=eM(this.apiClient,e);return u=Y("{model}",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>iu(h))}else{const f=rk(this.apiClient,e);return u=Y("{name}",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"PATCH",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>nu(h))}}async delete(e){var t,i,r,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const f=tM(this.apiClient,e);return u=Y("{name}",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(()=>{const h=ZM(),m=new Gh;return Object.assign(m,h),m})}else{const f=ok(this.apiClient,e);return u=Y("{name}",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(()=>{const h=SM(),m=new Gh;return Object.assign(m,h),m})}}async countTokens(e){var t,i,r,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const f=iM(this.apiClient,e);return u=Y("{model}:countTokens",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>{const m=jM(h),y=new Hh;return Object.assign(y,m),y})}else{const f=ak(this.apiClient,e);return u=Y("{model}:countTokens",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>{const m=wM(h),y=new Hh;return Object.assign(y,m),y})}}async computeTokens(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI()){const u=rM(this.apiClient,e);return o=Y("{model}:computeTokens",u._url),s=u._query,delete u.config,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>{const f=eb(c),h=new WS;return Object.assign(h,f),h})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideos(e){var t,i,r,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const f=aM(this.apiClient,e);return u=Y("{model}:predictLongRunning",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>rb(h))}else{const f=ck(this.apiClient,e);return u=Y("{model}:predictLongRunning",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>kM(h))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Mb(n){const e={},t=a(n,["operationName"]);t!=null&&l(e,["_url","operationName"],t);const i=a(n,["config"]);return i!=null&&l(e,["config"],i),e}function bb(n){const e={},t=a(n,["operationName"]);t!=null&&l(e,["_url","operationName"],t);const i=a(n,["config"]);return i!=null&&l(e,["config"],i),e}function Db(n){const e={},t=a(n,["operationName"]);t!=null&&l(e,["operationName"],t);const i=a(n,["resourceName"]);i!=null&&l(e,["_url","resourceName"],i);const r=a(n,["config"]);return r!=null&&l(e,["config"],r),e}function Nb(n){const e={},t=a(n,["video","uri"]);t!=null&&l(e,["uri"],t);const i=a(n,["video","encodedVideo"]);i!=null&&l(e,["videoBytes"],Qt(i));const r=a(n,["encoding"]);return r!=null&&l(e,["mimeType"],r),e}function Vb(n){const e={},t=a(n,["_self"]);return t!=null&&l(e,["video"],Nb(t)),e}function Lb(n){const e={},t=a(n,["generatedSamples"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>Vb(s))),l(e,["generatedVideos"],o)}const i=a(n,["raiMediaFilteredCount"]);i!=null&&l(e,["raiMediaFilteredCount"],i);const r=a(n,["raiMediaFilteredReasons"]);return r!=null&&l(e,["raiMediaFilteredReasons"],r),e}function Fb(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["metadata"]);i!=null&&l(e,["metadata"],i);const r=a(n,["done"]);r!=null&&l(e,["done"],r);const o=a(n,["error"]);o!=null&&l(e,["error"],o);const s=a(n,["response","generateVideoResponse"]);return s!=null&&l(e,["response"],Lb(s)),e}function Ub(n){const e={},t=a(n,["gcsUri"]);t!=null&&l(e,["uri"],t);const i=a(n,["bytesBase64Encoded"]);i!=null&&l(e,["videoBytes"],Qt(i));const r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function Bb(n){const e={},t=a(n,["_self"]);return t!=null&&l(e,["video"],Ub(t)),e}function Ob(n){const e={},t=a(n,["videos"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>Bb(s))),l(e,["generatedVideos"],o)}const i=a(n,["raiMediaFilteredCount"]);i!=null&&l(e,["raiMediaFilteredCount"],i);const r=a(n,["raiMediaFilteredReasons"]);return r!=null&&l(e,["raiMediaFilteredReasons"],r),e}function gp(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["metadata"]);i!=null&&l(e,["metadata"],i);const r=a(n,["done"]);r!=null&&l(e,["done"],r);const o=a(n,["error"]);o!=null&&l(e,["error"],o);const s=a(n,["response"]);return s!=null&&l(e,["response"],Ob(s)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class $b extends li{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,i=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const r=t.name.split("/operations/")[0];let o;return i&&"httpOptions"in i&&(o=i.httpOptions),this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:r,config:{httpOptions:o}})}else return this.getVideosOperationInternal({operationName:t.name,config:i})}async getVideosOperationInternal(e){var t,i,r,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const f=bb(e);return u=Y("{operationName}",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>gp(h))}else{const f=Mb(e);return u=Y("{operationName}",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>Fb(h))}}async fetchPredictVideosOperationInternal(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI()){const u=Db(e);return o=Y("{resourceName}:fetchPredictOperation",u._url),s=u._query,delete u.config,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>gp(c))}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function qb(n){const e={},t=a(n,["voiceName"]);return t!=null&&l(e,["voiceName"],t),e}function wy(n){const e={},t=a(n,["prebuiltVoiceConfig"]);return t!=null&&l(e,["prebuiltVoiceConfig"],qb(t)),e}function Gb(n){const e={},t=a(n,["speaker"]);t!=null&&l(e,["speaker"],t);const i=a(n,["voiceConfig"]);return i!=null&&l(e,["voiceConfig"],wy(i)),e}function Hb(n){const e={},t=a(n,["speakerVoiceConfigs"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>Gb(r))),l(e,["speakerVoiceConfigs"],i)}return e}function zb(n){const e={},t=a(n,["voiceConfig"]);t!=null&&l(e,["voiceConfig"],wy(t));const i=a(n,["multiSpeakerVoiceConfig"]);i!=null&&l(e,["multiSpeakerVoiceConfig"],Hb(i));const r=a(n,["languageCode"]);return r!=null&&l(e,["languageCode"],r),e}function Kb(n){const e={},t=a(n,["fps"]);t!=null&&l(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&l(e,["endOffset"],i);const r=a(n,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function Jb(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["data"]);t!=null&&l(e,["data"],t);const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Wb(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["fileUri"]);t!=null&&l(e,["fileUri"],t);const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Yb(n){const e={},t=a(n,["videoMetadata"]);t!=null&&l(e,["videoMetadata"],Kb(t));const i=a(n,["thought"]);i!=null&&l(e,["thought"],i);const r=a(n,["inlineData"]);r!=null&&l(e,["inlineData"],Jb(r));const o=a(n,["fileData"]);o!=null&&l(e,["fileData"],Wb(o));const s=a(n,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);const u=a(n,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);const c=a(n,["executableCode"]);c!=null&&l(e,["executableCode"],c);const f=a(n,["functionCall"]);f!=null&&l(e,["functionCall"],f);const h=a(n,["functionResponse"]);h!=null&&l(e,["functionResponse"],h);const m=a(n,["text"]);return m!=null&&l(e,["text"],m),e}function Xb(n){const e={},t=a(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>Yb(o))),l(e,["parts"],r)}const i=a(n,["role"]);return i!=null&&l(e,["role"],i),e}function Qb(n){const e={},t=a(n,["behavior"]);t!=null&&l(e,["behavior"],t);const i=a(n,["description"]);i!=null&&l(e,["description"],i);const r=a(n,["name"]);r!=null&&l(e,["name"],r);const o=a(n,["parameters"]);o!=null&&l(e,["parameters"],o);const s=a(n,["parametersJsonSchema"]);s!=null&&l(e,["parametersJsonSchema"],s);const u=a(n,["response"]);u!=null&&l(e,["response"],u);const c=a(n,["responseJsonSchema"]);return c!=null&&l(e,["responseJsonSchema"],c),e}function Zb(n){const e={},t=a(n,["startTime"]);t!=null&&l(e,["startTime"],t);const i=a(n,["endTime"]);return i!=null&&l(e,["endTime"],i),e}function jb(n){const e={},t=a(n,["timeRangeFilter"]);return t!=null&&l(e,["timeRangeFilter"],Zb(t)),e}function eD(n){const e={},t=a(n,["mode"]);t!=null&&l(e,["mode"],t);const i=a(n,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function tD(n){const e={},t=a(n,["dynamicRetrievalConfig"]);return t!=null&&l(e,["dynamicRetrievalConfig"],eD(t)),e}function nD(){return{}}function iD(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(c=>Qb(c))),l(e,["functionDeclarations"],u)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=a(n,["googleSearch"]);i!=null&&l(e,["googleSearch"],jb(i));const r=a(n,["googleSearchRetrieval"]);if(r!=null&&l(e,["googleSearchRetrieval"],tD(r)),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(a(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");a(n,["urlContext"])!=null&&l(e,["urlContext"],nD());const s=a(n,["codeExecution"]);return s!=null&&l(e,["codeExecution"],s),e}function rD(n){const e={},t=a(n,["handle"]);if(t!=null&&l(e,["handle"],t),a(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function yp(){return{}}function oD(n){const e={},t=a(n,["disabled"]);t!=null&&l(e,["disabled"],t);const i=a(n,["startOfSpeechSensitivity"]);i!=null&&l(e,["startOfSpeechSensitivity"],i);const r=a(n,["endOfSpeechSensitivity"]);r!=null&&l(e,["endOfSpeechSensitivity"],r);const o=a(n,["prefixPaddingMs"]);o!=null&&l(e,["prefixPaddingMs"],o);const s=a(n,["silenceDurationMs"]);return s!=null&&l(e,["silenceDurationMs"],s),e}function sD(n){const e={},t=a(n,["automaticActivityDetection"]);t!=null&&l(e,["automaticActivityDetection"],oD(t));const i=a(n,["activityHandling"]);i!=null&&l(e,["activityHandling"],i);const r=a(n,["turnCoverage"]);return r!=null&&l(e,["turnCoverage"],r),e}function aD(n){const e={},t=a(n,["targetTokens"]);return t!=null&&l(e,["targetTokens"],t),e}function lD(n){const e={},t=a(n,["triggerTokens"]);t!=null&&l(e,["triggerTokens"],t);const i=a(n,["slidingWindow"]);return i!=null&&l(e,["slidingWindow"],aD(i)),e}function uD(n){const e={},t=a(n,["proactiveAudio"]);return t!=null&&l(e,["proactiveAudio"],t),e}function cD(n,e){const t={},i=a(n,["generationConfig"]);e!==void 0&&i!=null&&l(e,["setup","generationConfig"],i);const r=a(n,["responseModalities"]);e!==void 0&&r!=null&&l(e,["setup","generationConfig","responseModalities"],r);const o=a(n,["temperature"]);e!==void 0&&o!=null&&l(e,["setup","generationConfig","temperature"],o);const s=a(n,["topP"]);e!==void 0&&s!=null&&l(e,["setup","generationConfig","topP"],s);const u=a(n,["topK"]);e!==void 0&&u!=null&&l(e,["setup","generationConfig","topK"],u);const c=a(n,["maxOutputTokens"]);e!==void 0&&c!=null&&l(e,["setup","generationConfig","maxOutputTokens"],c);const f=a(n,["mediaResolution"]);e!==void 0&&f!=null&&l(e,["setup","generationConfig","mediaResolution"],f);const h=a(n,["seed"]);e!==void 0&&h!=null&&l(e,["setup","generationConfig","seed"],h);const m=a(n,["speechConfig"]);e!==void 0&&m!=null&&l(e,["setup","generationConfig","speechConfig"],zb(Yu(m)));const y=a(n,["enableAffectiveDialog"]);e!==void 0&&y!=null&&l(e,["setup","generationConfig","enableAffectiveDialog"],y);const v=a(n,["systemInstruction"]);e!==void 0&&v!=null&&l(e,["setup","systemInstruction"],Xb(We(v)));const x=a(n,["tools"]);if(e!==void 0&&x!=null){let L=dr(x);Array.isArray(L)&&(L=L.map(q=>iD(cr(q)))),l(e,["setup","tools"],L)}const R=a(n,["sessionResumption"]);e!==void 0&&R!=null&&l(e,["setup","sessionResumption"],rD(R));const D=a(n,["inputAudioTranscription"]);e!==void 0&&D!=null&&l(e,["setup","inputAudioTranscription"],yp());const U=a(n,["outputAudioTranscription"]);e!==void 0&&U!=null&&l(e,["setup","outputAudioTranscription"],yp());const V=a(n,["realtimeInputConfig"]);e!==void 0&&V!=null&&l(e,["setup","realtimeInputConfig"],sD(V));const N=a(n,["contextWindowCompression"]);e!==void 0&&N!=null&&l(e,["setup","contextWindowCompression"],lD(N));const F=a(n,["proactivity"]);return e!==void 0&&F!=null&&l(e,["setup","proactivity"],uD(F)),t}function dD(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["setup","model"],pe(n,i));const r=a(e,["config"]);return r!=null&&l(t,["config"],cD(r,t)),t}function fD(n,e,t){const i={},r=a(e,["expireTime"]);t!==void 0&&r!=null&&l(t,["expireTime"],r);const o=a(e,["newSessionExpireTime"]);t!==void 0&&o!=null&&l(t,["newSessionExpireTime"],o);const s=a(e,["uses"]);t!==void 0&&s!=null&&l(t,["uses"],s);const u=a(e,["liveConnectConstraints"]);t!==void 0&&u!=null&&l(t,["bidiGenerateContentSetup"],dD(n,u));const c=a(e,["lockAdditionalFields"]);return t!==void 0&&c!=null&&l(t,["fieldMask"],c),i}function hD(n,e){const t={},i=a(e,["config"]);return i!=null&&l(t,["config"],fD(n,i,t)),t}function pD(n){const e={},t=a(n,["name"]);return t!=null&&l(e,["name"],t),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function mD(n){const e=[];for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const i=n[t];if(typeof i=="object"&&i!=null&&Object.keys(i).length>0){const r=Object.keys(i).map(o=>`${t}.${o}`);e.push(...r)}else e.push(t)}return e.join(",")}function gD(n,e){let t=null;const i=n.bidiGenerateContentSetup;if(typeof i=="object"&&i!==null&&"setup"in i){const o=i.setup;typeof o=="object"&&o!==null?(n.bidiGenerateContentSetup=o,t=o):delete n.bidiGenerateContentSetup}else i!==void 0&&delete n.bidiGenerateContentSetup;const r=n.fieldMask;if(t){const o=mD(t);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)o?n.fieldMask=o:delete n.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&r!==null&&Array.isArray(r)&&r.length>0){const s=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let u=[];r.length>0&&(u=r.map(f=>s.includes(f)?`generationConfig.${f}`:f));const c=[];o&&c.push(o),u.length>0&&c.push(...u),c.length>0?n.fieldMask=c.join(","):delete n.fieldMask}else delete n.fieldMask}else r!==null&&Array.isArray(r)&&r.length>0?n.fieldMask=r.join(","):delete n.fieldMask;return n}class yD extends li{constructor(e){super(),this.apiClient=e}async create(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const u=hD(this.apiClient,e);o=Y("auth_tokens",u._url),s=u._query,delete u.config,delete u._url,delete u._query;const c=gD(u,e.config);return r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),r.then(f=>pD(f))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function _D(n){const e={},t=a(n,["name"]);t!=null&&l(e,["_url","name"],t);const i=a(n,["config"]);return i!=null&&l(e,["config"],i),e}function vD(n,e){const t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const r=a(n,["pageToken"]);e!==void 0&&r!=null&&l(e,["_query","pageToken"],r);const o=a(n,["filter"]);return e!==void 0&&o!=null&&l(e,["_query","filter"],o),t}function TD(n){const e={},t=a(n,["config"]);return t!=null&&l(e,["config"],vD(t,e)),e}function ED(n){const e={},t=a(n,["textInput"]);t!=null&&l(e,["textInput"],t);const i=a(n,["output"]);return i!=null&&l(e,["output"],i),e}function ID(n){const e={};if(a(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const t=a(n,["examples"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>ED(r))),l(e,["examples","examples"],i)}return e}function CD(n,e){const t={};if(a(n,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=a(n,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&l(e,["displayName"],i),a(n,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const r=a(n,["epochCount"]);e!==void 0&&r!=null&&l(e,["tuningTask","hyperparameters","epochCount"],r);const o=a(n,["learningRateMultiplier"]);if(o!=null&&l(t,["tuningTask","hyperparameters","learningRateMultiplier"],o),a(n,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(a(n,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const s=a(n,["batchSize"]);e!==void 0&&s!=null&&l(e,["tuningTask","hyperparameters","batchSize"],s);const u=a(n,["learningRate"]);return e!==void 0&&u!=null&&l(e,["tuningTask","hyperparameters","learningRate"],u),t}function AD(n){const e={},t=a(n,["baseModel"]);t!=null&&l(e,["baseModel"],t);const i=a(n,["trainingDataset"]);i!=null&&l(e,["tuningTask","trainingData"],ID(i));const r=a(n,["config"]);return r!=null&&l(e,["config"],CD(r,e)),e}function SD(n){const e={},t=a(n,["name"]);t!=null&&l(e,["_url","name"],t);const i=a(n,["config"]);return i!=null&&l(e,["config"],i),e}function wD(n,e){const t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const r=a(n,["pageToken"]);e!==void 0&&r!=null&&l(e,["_query","pageToken"],r);const o=a(n,["filter"]);return e!==void 0&&o!=null&&l(e,["_query","filter"],o),t}function xD(n){const e={},t=a(n,["config"]);return t!=null&&l(e,["config"],wD(t,e)),e}function RD(n,e){const t={},i=a(n,["gcsUri"]);if(e!==void 0&&i!=null&&l(e,["supervisedTuningSpec","trainingDatasetUri"],i),a(n,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return t}function PD(n){const e={},t=a(n,["gcsUri"]);return t!=null&&l(e,["validationDatasetUri"],t),e}function kD(n,e){const t={},i=a(n,["validationDataset"]);e!==void 0&&i!=null&&l(e,["supervisedTuningSpec"],PD(i));const r=a(n,["tunedModelDisplayName"]);e!==void 0&&r!=null&&l(e,["tunedModelDisplayName"],r);const o=a(n,["description"]);e!==void 0&&o!=null&&l(e,["description"],o);const s=a(n,["epochCount"]);e!==void 0&&s!=null&&l(e,["supervisedTuningSpec","hyperParameters","epochCount"],s);const u=a(n,["learningRateMultiplier"]);e!==void 0&&u!=null&&l(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],u);const c=a(n,["exportLastCheckpointOnly"]);e!==void 0&&c!=null&&l(e,["supervisedTuningSpec","exportLastCheckpointOnly"],c);const f=a(n,["adapterSize"]);if(e!==void 0&&f!=null&&l(e,["supervisedTuningSpec","hyperParameters","adapterSize"],f),a(n,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(a(n,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");return t}function MD(n){const e={},t=a(n,["baseModel"]);t!=null&&l(e,["baseModel"],t);const i=a(n,["trainingDataset"]);i!=null&&l(e,["supervisedTuningSpec","trainingDatasetUri"],RD(i,e));const r=a(n,["config"]);return r!=null&&l(e,["config"],kD(r,e)),e}function bD(n){const e={},t=a(n,["name"]);t!=null&&l(e,["model"],t);const i=a(n,["name"]);return i!=null&&l(e,["endpoint"],i),e}function xy(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["state"]);i!=null&&l(e,["state"],sy(i));const r=a(n,["createTime"]);r!=null&&l(e,["createTime"],r);const o=a(n,["tuningTask","startTime"]);o!=null&&l(e,["startTime"],o);const s=a(n,["tuningTask","completeTime"]);s!=null&&l(e,["endTime"],s);const u=a(n,["updateTime"]);u!=null&&l(e,["updateTime"],u);const c=a(n,["description"]);c!=null&&l(e,["description"],c);const f=a(n,["baseModel"]);f!=null&&l(e,["baseModel"],f);const h=a(n,["_self"]);h!=null&&l(e,["tunedModel"],bD(h));const m=a(n,["distillationSpec"]);m!=null&&l(e,["distillationSpec"],m);const y=a(n,["experiment"]);y!=null&&l(e,["experiment"],y);const v=a(n,["labels"]);v!=null&&l(e,["labels"],v);const x=a(n,["pipelineJob"]);x!=null&&l(e,["pipelineJob"],x);const R=a(n,["serviceAccount"]);R!=null&&l(e,["serviceAccount"],R);const D=a(n,["tunedModelDisplayName"]);return D!=null&&l(e,["tunedModelDisplayName"],D),e}function DD(n){const e={},t=a(n,["nextPageToken"]);t!=null&&l(e,["nextPageToken"],t);const i=a(n,["tunedModels"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>xy(o))),l(e,["tuningJobs"],r)}return e}function ND(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["metadata"]);i!=null&&l(e,["metadata"],i);const r=a(n,["done"]);r!=null&&l(e,["done"],r);const o=a(n,["error"]);return o!=null&&l(e,["error"],o),e}function VD(n){const e={},t=a(n,["checkpointId"]);t!=null&&l(e,["checkpointId"],t);const i=a(n,["epoch"]);i!=null&&l(e,["epoch"],i);const r=a(n,["step"]);r!=null&&l(e,["step"],r);const o=a(n,["endpoint"]);return o!=null&&l(e,["endpoint"],o),e}function LD(n){const e={},t=a(n,["model"]);t!=null&&l(e,["model"],t);const i=a(n,["endpoint"]);i!=null&&l(e,["endpoint"],i);const r=a(n,["checkpoints"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>VD(s))),l(e,["checkpoints"],o)}return e}function ou(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["state"]);i!=null&&l(e,["state"],sy(i));const r=a(n,["createTime"]);r!=null&&l(e,["createTime"],r);const o=a(n,["startTime"]);o!=null&&l(e,["startTime"],o);const s=a(n,["endTime"]);s!=null&&l(e,["endTime"],s);const u=a(n,["updateTime"]);u!=null&&l(e,["updateTime"],u);const c=a(n,["error"]);c!=null&&l(e,["error"],c);const f=a(n,["description"]);f!=null&&l(e,["description"],f);const h=a(n,["baseModel"]);h!=null&&l(e,["baseModel"],h);const m=a(n,["tunedModel"]);m!=null&&l(e,["tunedModel"],LD(m));const y=a(n,["supervisedTuningSpec"]);y!=null&&l(e,["supervisedTuningSpec"],y);const v=a(n,["tuningDataStats"]);v!=null&&l(e,["tuningDataStats"],v);const x=a(n,["encryptionSpec"]);x!=null&&l(e,["encryptionSpec"],x);const R=a(n,["partnerModelTuningSpec"]);R!=null&&l(e,["partnerModelTuningSpec"],R);const D=a(n,["distillationSpec"]);D!=null&&l(e,["distillationSpec"],D);const U=a(n,["experiment"]);U!=null&&l(e,["experiment"],U);const V=a(n,["labels"]);V!=null&&l(e,["labels"],V);const N=a(n,["pipelineJob"]);N!=null&&l(e,["pipelineJob"],N);const F=a(n,["serviceAccount"]);F!=null&&l(e,["serviceAccount"],F);const L=a(n,["tunedModelDisplayName"]);return L!=null&&l(e,["tunedModelDisplayName"],L),e}function FD(n){const e={},t=a(n,["nextPageToken"]);t!=null&&l(e,["nextPageToken"],t);const i=a(n,["tuningJobs"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>ou(o))),l(e,["tuningJobs"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class UD extends li{constructor(e){super(),this.apiClient=e,this.get=async t=>await this.getInternal(t),this.list=async(t={})=>new Ao(oi.PAGED_ITEM_TUNING_JOBS,i=>this.listInternal(i),await this.listInternal(t),t),this.tune=async t=>{if(this.apiClient.isVertexAI())return await this.tuneInternal(t);{const i=await this.tuneMldevInternal(t);let r="";return i.metadata!==void 0&&i.metadata.tunedModel!==void 0?r=i.metadata.tunedModel:i.name!==void 0&&i.name.includes("/operations/")&&(r=i.name.split("/operations/")[0]),{name:r,state:Yl.JOB_STATE_QUEUED}}}}async getInternal(e){var t,i,r,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const f=SD(e);return u=Y("{name}",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>ou(h))}else{const f=_D(e);return u=Y("{name}",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>xy(h))}}async listInternal(e){var t,i,r,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const f=xD(e);return u=Y("tuningJobs",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>{const m=FD(h),y=new zh;return Object.assign(y,m),y})}else{const f=TD(e);return u=Y("tunedModels",f._url),c=f._query,delete f.config,delete f._url,delete f._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>{const m=DD(h),y=new zh;return Object.assign(y,m),y})}}async tuneInternal(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI()){const u=MD(e);return o=Y("tuningJobs",u._url),s=u._query,delete u.config,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>ou(c))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=AD(e);return o=Y("tunedModels",u._url),s=u._query,delete u.config,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>ND(c))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class BD{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const OD=1024*1024*8,$D=3,qD=1e3,GD=2,ll="x-goog-upload-status";async function HD(n,e,t){var i,r,o;let s=0,u=0,c=new Xl(new Response),f="upload";for(s=n.size;u<s;){const m=Math.min(OD,s-u),y=n.slice(u,u+m);u+m>=s&&(f+=", finalize");let v=0,x=qD;for(;v<$D&&(c=await t.request({path:"",body:y,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":f,"X-Goog-Upload-Offset":String(u),"Content-Length":String(m)}}}),!(!((i=c==null?void 0:c.headers)===null||i===void 0)&&i[ll]));)v++,await KD(x),x=x*GD;if(u+=m,((r=c==null?void 0:c.headers)===null||r===void 0?void 0:r[ll])!=="active")break;if(s<=u)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const h=await(c==null?void 0:c.json());if(((o=c==null?void 0:c.headers)===null||o===void 0?void 0:o[ll])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return h.file}async function zD(n){return{size:n.size,type:n.type}}function KD(n){return new Promise(e=>setTimeout(e,n))}class JD{async upload(e,t,i){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await HD(e,t,i)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await zD(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class WD{create(e,t,i){return new YD(e,t,i)}}class YD{constructor(e,t,i){this.url=e,this.headers=t,this.callbacks=i}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const _p="x-goog-api-key";class XD{constructor(e){this.apiKey=e}async addAuthHeaders(e){if(e.get(_p)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(_p,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const QD="gl-node/";class ZD{constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const i=zS(e,void 0,void 0);i&&(e.httpOptions?e.httpOptions.baseUrl=i:e.httpOptions={baseUrl:i}),this.apiVersion=e.apiVersion;const r=new XD(this.apiKey);this.apiClient=new fb({auth:r,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:QD+"web",uploader:new JD,downloader:new BD}),this.models=new kb(this.apiClient),this.live=new Sb(this.apiClient,r,new WD),this.batches=new v0(this.apiClient),this.chats=new Cx(this.models,this.apiClient),this.caches=new Tx(this.apiClient),this.files=new Lx(this.apiClient),this.operations=new $b(this.apiClient),this.authTokens=new yD(this.apiClient),this.tunings=new UD(this.apiClient)}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const jD="";new ZD({apiKey:jD});const eN=async(n,e,t)=>`### Erro de Configuração
Chave de API do Gemini não configurada. A análise por IA está desativada.`;/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/const Ye="Você está offline. A alteração foi salva e será sincronizada em breve.",A={appContainer:document.getElementById("app-container"),noteInput:document.getElementById("note-input"),noteIdInput:document.getElementById("note-id"),saveNoteBtn:document.getElementById("save-note-btn"),notesList:document.getElementById("notes-list"),currentDate:document.getElementById("current-date"),taskInput:document.getElementById("task-input"),addTaskBtn:document.getElementById("add-task-btn"),categorySelect:document.getElementById("category-select"),addCategoryBtn:document.getElementById("add-category-btn"),dueDateInput:document.getElementById("due-date-input"),filterContainer:document.getElementById("filter-container"),taskList:document.getElementById("task-list"),toggleCompletedBtn:document.getElementById("toggle-completed-btn"),taskDetailModal:document.getElementById("task-detail-modal"),closeDetailModalBtn:document.getElementById("close-detail-modal-btn"),detailTitleContainer:document.getElementById("detail-title-container"),detailTaskTitle:document.getElementById("detail-task-title"),detailEditContainer:document.getElementById("detail-edit-container"),detailEditInput:document.getElementById("detail-edit-input"),detailSaveBtn:document.getElementById("detail-save-btn"),detailCancelBtn:document.getElementById("detail-cancel-btn"),subtaskList:document.getElementById("subtask-list"),subtaskInput:document.getElementById("subtask-input"),addSubtaskBtn:document.getElementById("add-subtask-btn"),taskNotesList:document.getElementById("task-notes-list"),taskNoteInput:document.getElementById("task-note-input"),addTaskNoteBtn:document.getElementById("add-task-note-btn"),calendarBtn:document.getElementById("calendar-btn"),calendarModal:document.getElementById("calendar-modal"),closeCalendarBtn:document.getElementById("close-calendar-btn"),prevMonthBtn:document.getElementById("prev-month-btn"),nextMonthBtn:document.getElementById("next-month-btn"),calendarMonthYear:document.getElementById("calendar-month-year"),calendarGrid:document.getElementById("calendar-grid"),detailsDayHeader:document.getElementById("details-day-header"),detailsContent:document.getElementById("details-content"),themeToggleBtn:document.getElementById("theme-toggle-btn"),loginContainer:document.getElementById("login-container"),registerContainer:document.getElementById("register-container"),loginForm:document.getElementById("login-form"),registerForm:document.getElementById("register-form"),loginError:document.getElementById("login-error"),registerError:document.getElementById("register-error"),showRegisterBtn:document.getElementById("show-register-btn"),showLoginBtn:document.getElementById("show-login-btn"),userMenuContainer:document.getElementById("user-menu-container"),userMenuTrigger:document.getElementById("user-menu-trigger"),userMenuDropdown:document.getElementById("user-menu-dropdown"),userEmail:document.getElementById("user-email"),logoutBtn:document.getElementById("logout-btn"),categoryPopup:document.getElementById("category-popup"),categoryPopupInput:document.getElementById("category-popup-input"),categoryPopupAdd:document.getElementById("category-popup-add"),categoryPopupCancel:document.getElementById("category-popup-cancel"),aiAnalyzeBtn:document.getElementById("ai-analyze-btn"),aiAnalyzeModal:document.getElementById("ai-analyze-modal"),aiAnalyzeContent:document.getElementById("ai-analyze-content"),closeAiAnalyzeModal:document.getElementById("close-ai-analyze-modal"),connectionStatus:document.getElementById("connection-status"),connectionDot:document.getElementById("connection-dot"),connectionText:document.getElementById("connection-text"),offlineBanner:document.getElementById("offline-banner"),toastContainer:document.getElementById("toast-container"),viewToggleBtn:document.getElementById("view-toggle-btn"),viewToggleIcon:document.getElementById("view-toggle-icon"),mainContentApp:document.getElementById("main-content-app"),canvasView:document.getElementById("canvas-view"),taskCanvasContainer:document.getElementById("task-canvas-container"),taskCanvas:document.getElementById("task-canvas"),canvasLinesSvg:document.getElementById("canvas-lines-svg"),canvasTaskPopup:document.getElementById("canvas-task-popup"),canvasPopupTitle:document.getElementById("canvas-popup-title"),canvasPopupCloseBtn:document.getElementById("canvas-popup-close-btn"),canvasPopupSubtasks:document.getElementById("canvas-popup-subtasks"),canvasPopupNotes:document.getElementById("canvas-popup-notes")};let xe=null,rt,ne,Ht,we,er="Todos",Js=!1,Se=null,Ri=new Date,zn="list",ul=!navigator.onLine,O={isPanning:!1,isDragging:!1,isLinking:!1,draggedNode:null,linkStartNodeId:null,startX:0,startY:0,panOffsetX:0,panOffsetY:0,zoom:1,nodeInitialX:0,nodeInitialY:0,linkStartSide:null,linkTargetSide:null},si=[],po=[],_t={},dt={},an="todas",Nt={tasks:null,notes:null,categories:null,canvas_tasks:null,canvas_free_cards:null,task_details:null};function Ft(n){Nt[n]&&(Nt[n](),Nt[n]=null)}function tN(){Object.keys(Nt).forEach(n=>Ft(n))}const me={listeners:[],add:function(n,e,t){n&&(n.addEventListener(e,t),this.listeners.push({element:n,event:e,handler:t}))},removeAll:function(){this.listeners.forEach(({element:n,event:e,handler:t})=>{n&&n.removeEventListener(e,t)}),this.listeners=[]}};function de(n,e=4e3){if(!A.toastContainer)return;const t=document.createElement("div");t.className="toast",t.textContent=n,A.toastContainer.appendChild(t),setTimeout(()=>{t.classList.add("show")},10),setTimeout(()=>{t.classList.remove("show"),t.addEventListener("transitionend",()=>t.remove())},e)}function Ws(n){A.addTaskBtn.disabled=n,A.saveNoteBtn.disabled=n,A.addCategoryBtn.disabled=n}function vp(n){return!n||!n.toDate?"Indefinido":n.toDate().toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})}function nN(){A.currentDate&&(A.currentDate.textContent=new Date().toLocaleDateString("pt-BR",{dateStyle:"full"}))}function Ry(){A.toggleCompletedBtn&&(A.toggleCompletedBtn.innerHTML=Js?'<i class="fas fa-eye-slash"></i>':'<i class="fas fa-eye"></i>')}function su(){if(!A.connectionStatus||!A.connectionText||!A.offlineBanner)return;const n=!navigator.onLine;n?(A.connectionStatus.classList.remove("online"),A.connectionStatus.classList.add("offline"),A.connectionText.textContent="Offline",A.connectionStatus.title="Você está offline. As alterações serão salvas e sincronizadas quando reconectar.",A.aiAnalyzeBtn.disabled=!0,A.aiAnalyzeBtn.title="Análise com IA (Indisponível offline)",A.offlineBanner.classList.remove("hidden")):(A.connectionStatus.classList.remove("offline"),A.connectionStatus.classList.add("online"),A.connectionText.textContent="Online",A.connectionStatus.title="Conectado ao servidor.",A.aiAnalyzeBtn.disabled=!1,A.aiAnalyzeBtn.title="Análise com IA",A.offlineBanner.classList.add("hidden")),n&&!ul?de("Você perdeu a conexão. O aplicativo está em modo offline.",5e3):!n&&ul&&de("Conexão restaurada. Sincronizando seus dados...",4e3),ul=n}async function iN(){const n=A.taskInput.value.trim();if(!n||!ne)return;let e=A.categorySelect.value;e==="Nenhuma"&&(e=null);const t=A.dueDateInput.value,i=t?Kn.fromDate(new Date(t+"T00:00:00")):null;await mo(ne,{text:n,completed:!1,category:e,createdAt:Kn.now(),dueDate:i,subtaskCount:0,noteCount:0,completedSubtaskCount:0}),navigator.onLine||de(Ye),A.taskInput.value="",A.dueDateInput.value=""}async function Py(){console.log("[Free Card] handleAddFreeCard chamada");const n=document.getElementById("free-card-input");if(!n){console.error("[Free Card] Input não encontrado");return}const e=n.value.trim();if(console.log("[Free Card] Texto:",e),!e){console.warn("[Free Card] Texto vazio"),de("Digite um texto para o card livre");return}if(!we){console.error("[Free Card] Collection ref não encontrada"),de("Erro: Collection não configurada");return}try{console.log("[Free Card] Salvando no Firestore...");const t=await mo(we,{text:e,createdAt:Kn.now(),connections:[]});console.log("[Free Card] Documento criado com ID:",t.id),navigator.onLine?de("Card livre criado com sucesso!"):de(Ye),n.value="",Xs()}catch(t){console.error("[Free Card] Erro ao criar:",t),de("Erro ao criar card livre. Tente novamente.")}}async function rN(){const n=A.noteInput.value.trim(),e=A.noteIdInput.value;!n||!rt||(e?await Ie(ce(rt,e),{text:n}):await mo(rt,{text:n,createdAt:Kn.now()}),navigator.onLine||de(Ye),A.noteInput.value="",A.noteIdInput.value="")}function tr(){if(!ne)return;Ft("tasks");let n=er==="Todos"?$e(ne):$e(ne,je("category","==",er));Nt.tasks=Jn(n,e=>{let t=e.docs.map(i=>({id:i.id,...i.data()}));if(an==="antigas")t.sort((i,r)=>{var o,s;return(((o=i.createdAt)==null?void 0:o.toMillis())||0)-(((s=r.createdAt)==null?void 0:s.toMillis())||0)});else if(an==="novas")t.sort((i,r)=>{var o,s;return(((o=r.createdAt)==null?void 0:o.toMillis())||0)-(((s=i.createdAt)==null?void 0:s.toMillis())||0)});else if(an==="incompletas")t=t.filter(i=>(i.subtaskCount||0)>(i.completedSubtaskCount||0));else if(an==="atrasadas"){const i=new Date;i.setHours(0,0,0,0),t=t.filter(r=>r.dueDate&&r.dueDate.toDate()<i&&!r.completed)}else an==="concluidas"?t=t.filter(i=>i.completed):an==="sem-categoria"&&(t=t.filter(i=>!i.category||i.category==="Nenhuma"));!Js&&an!=="concluidas"&&(t=t.filter(i=>!i.completed)),A.taskList.innerHTML="",t.forEach(i=>oN(i.id,i))},console.error)}function oN(n,e){const t=document.createElement("div");t.className=`task-item group p-3 rounded-lg border-b ${e.completed?"bg-green-50 text-gray-500":"bg-white"}`;let i="text-gray-400";e.subtaskCount>0&&((e.completedSubtaskCount||0)===0?i="text-red-500":e.completedSubtaskCount===e.subtaskCount?i="text-green-500":i="text-yellow-500");let r="";e.subtaskCount>0&&(r+=`<span class="ml-2 ${i}" title="${e.completedSubtaskCount||0}/${e.subtaskCount} sub-tarefas concluídas"><i class="fa-solid fa-list-check"></i></span>`),e.noteCount>0&&(r+=`<span class="ml-2 text-gray-400" title="${e.noteCount} anotações"><i class="fa-solid fa-note-sticky"></i></span>`);const o=e.dueDate?`<strong>Previsão:</strong> ${vp(e.dueDate)}`:"";t.innerHTML=`
        <div class="flex items-center">
            <input type="checkbox" data-id="${n}" ${e.completed?"checked":""} class="task-checkbox h-5 w-5 rounded border-gray-300">
            <div class="task-main-content ml-4 flex-grow" data-id="${n}" data-title="${e.text}">
                <div class="flex items-center">
                    <span class="${e.completed?"line-through":""}">${e.text}</span>
                    ${r}
                </div>
                 <div class="mt-1 text-xs text-gray-500 flex items-center gap-4">
                    <span><strong>Criada:</strong> ${vp(e.createdAt)}</span>
                    <span>${o}</span>
                </div>
            </div>
            <button class="delete-task text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100" data-id="${n}"><i class="fas fa-times"></i></button>
        </div>`,t.querySelector(".task-checkbox").addEventListener("change",s=>{const u=s.target;Ie(ce(ne,n),{completed:u.checked,completedAt:u.checked?Kn.now():null}),navigator.onLine||de(Ye)}),t.querySelector(".delete-task").addEventListener("click",s=>{s.stopPropagation(),nr(ce(ne,n)),navigator.onLine||de(Ye)}),t.querySelector(".task-main-content").addEventListener("click",()=>ky(n,e.text)),A.taskList.appendChild(t)}function sN(){if(!rt)return;Ft("notes");const n=$e(rt);Nt.notes=Jn(n,e=>{A.notesList.innerHTML="",e.docs.sort((t,i)=>i.data().createdAt.toMillis()-t.data().createdAt.toMillis()).forEach(t=>aN(t.id,t.data()))},console.error)}function aN(n,e){const t=document.createElement("div");t.className="note-item bg-gray-100 p-2 rounded relative group",t.innerHTML=`<p class="note-text cursor-pointer">${e.text}</p>
        <div class="actions absolute top-1 right-1 flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity">
             <button class="edit-note text-gray-500 hover:text-blue-600"><i class="fas fa-pencil-alt fa-xs"></i></button>
             <button data-id="${n}" class="delete-note text-red-400 hover:text-red-600"><i class="fas fa-times fa-xs"></i></button>
        </div>`,t.querySelectorAll(".note-text, .edit-note").forEach(r=>{r.addEventListener("click",()=>{A.noteInput.value=e.text,A.noteIdInput.value=n,A.noteInput.focus()})}),t.querySelector(".delete-note").addEventListener("click",r=>{r.stopPropagation(),nr(ce(rt,n)),navigator.onLine||de(Ye)}),A.notesList.appendChild(t)}function lN(){Ht&&(Ft("categories"),Nt.categories=Jn(Ht,n=>{A.categorySelect.innerHTML='<option value="Nenhuma">Sem Categoria</option>',A.filterContainer.innerHTML="";const e=document.createElement("button");e.className="filter-btn px-3 py-1 text-sm rounded-full",e.textContent="Todos",e.addEventListener("click",()=>{er="Todos",tr(),cl()}),A.filterContainer.appendChild(e),n.docs.forEach(t=>{const i=t.data().name,r=document.createElement("option");r.value=i,r.textContent=i,A.categorySelect.appendChild(r);const o=document.createElement("button");o.className="filter-btn px-3 py-1 text-sm rounded-full flex items-center gap-2 group",o.textContent=i,o.dataset.category=i,o.addEventListener("click",()=>{er=i,tr(),cl()});const s=document.createElement("button");s.className="delete-category-btn text-red-500 hover:text-red-700 ml-1 opacity-0 group-hover:opacity-100 transition-opacity",s.title="Excluir categoria",s.innerHTML='<i class="fas fa-trash-alt fa-xs"></i>',s.addEventListener("click",async u=>{u.stopPropagation(),confirm(`Tem certeza que deseja excluir a categoria "${i}"? Todas as tarefas associadas ficarão sem categoria.`)&&(await nr(ce(Ht,t.id)),navigator.onLine||de(Ye))}),o.appendChild(s),A.filterContainer.appendChild(o)}),cl()},console.error))}function cl(){document.querySelectorAll(".filter-btn").forEach(n=>{n.classList.remove("active"),((n.textContent||"").replace(/<button.*<\/button>/,"").trim()==="Todos"&&er==="Todos"||n.dataset.category===er)&&n.classList.add("active")})}async function uN(n){n&&Ht&&(await v_(ce(Ht,n),{name:n}),navigator.onLine||de(Ye))}function ky(n,e){Se=n,A.detailTaskTitle.textContent=e;const t=`artifacts/${bt}/users/${xe}/tasks/${n}`,i=et(Ve,`${t}/subtasks`),r=et(Ve,`${t}/taskNotes`);Ft("task_details");const o=Jn($e(i),c=>{A.subtaskList.innerHTML="",c.docs.sort((f,h)=>f.data().createdAt.toMillis()-h.data().createdAt.toMillis()).forEach(f=>fN(f.id,f.data()))}),s=Jn($e(r),c=>{A.taskNotesList.innerHTML="",c.docs.sort((f,h)=>f.data().createdAt.toMillis()-h.data().createdAt.toMillis()).forEach(f=>pN(f.id,f.data()))});Nt.task_details=()=>{o(),s()},A.taskDetailModal.classList.remove("hidden");const u=si.find(c=>c.id===n);LN((u==null?void 0:u.category)||null)}function cN(){Ft("task_details"),A.taskDetailModal.classList.add("hidden"),Se=null,A.detailTitleContainer.classList.remove("hidden"),A.detailEditContainer.classList.add("hidden")}function au(){A.detailTitleContainer.classList.toggle("hidden"),A.detailEditContainer.classList.toggle("hidden"),A.detailEditInput.value=A.detailTaskTitle.textContent||"",A.detailEditInput.focus(),A.detailSaveBtn.onclick=async()=>{const n=A.detailEditInput.value.trim();n&&Se&&ne&&(await Ie(ce(ne,Se),{text:n}),navigator.onLine||de(Ye)),au()},A.detailCancelBtn.onclick=()=>au()}async function dN(){const n=A.subtaskInput.value.trim();if(!n||!Se||!xe||!ne)return;const e=et(Ve,`artifacts/${bt}/users/${xe}/tasks/${Se}/subtasks`);await mo(e,{text:n,completed:!1,createdAt:Kn.now()}),await Ie(ce(ne,Se),{subtaskCount:Un(1)}),navigator.onLine||de(Ye),A.subtaskInput.value=""}function fN(n,e){const t=document.createElement("div");t.className="flex items-center bg-gray-100 p-2 rounded-lg group",t.innerHTML=`
        <div class="flex-grow flex items-center">
            <input type="checkbox" data-id="${n}" ${e.completed?"checked":""} class="subtask-checkbox h-4 w-4 rounded border-gray-300">
            <span class="subtask-text ml-3 ${e.completed?"line-through text-gray-500":""}">${e.text}</span>
        </div>
        <div class="subtask-actions flex items-center gap-2 opacity-0 group-hover:opacity-100">
            <button class="edit-subtask text-gray-400 hover:text-blue-500 text-sm"><i class="fas fa-pencil-alt"></i></button>
            <button class="delete-subtask text-gray-400 hover:text-red-500 text-sm" data-id="${n}"><i class="fas fa-trash-alt"></i></button>
        </div>`,t.querySelector(".subtask-checkbox").addEventListener("change",async i=>{const r=i.target,o=r.checked?1:-1;await Ie(ce(et(Ve,`artifacts/${bt}/users/${xe}/tasks/${Se}/subtasks`),n),{completed:r.checked}),await Ie(ce(ne,Se),{completedSubtaskCount:Un(o)}),navigator.onLine||de(Ye)}),t.querySelector(".delete-subtask").addEventListener("click",async()=>{e.completed?await Ie(ce(ne,Se),{subtaskCount:Un(-1),completedSubtaskCount:Un(-1)}):await Ie(ce(ne,Se),{subtaskCount:Un(-1)}),await nr(ce(et(Ve,`artifacts/${bt}/users/${xe}/tasks/${Se}/subtasks`),n)),navigator.onLine||de(Ye)}),t.querySelector(".edit-subtask").addEventListener("click",()=>{const i=t.querySelector(".subtask-text").textContent||"";t.innerHTML=`<input type="text" class="edit-subtask-input flex-grow p-1 border rounded" value="${i}">
                        <button class="save-subtask-edit bg-green-500 text-white px-2 py-1 rounded text-sm">Salvar</button>`;const r=t.querySelector(".edit-subtask-input");r.focus(),t.querySelector(".save-subtask-edit").addEventListener("click",async()=>{const o=r.value.trim();o&&(await Ie(ce(et(Ve,`artifacts/${bt}/users/${xe}/tasks/${Se}/subtasks`),n),{text:o}),navigator.onLine||de(Ye))})}),A.subtaskList.appendChild(t)}async function hN(){const n=A.taskNoteInput.value.trim();if(!n||!Se||!xe||!ne)return;const e=et(Ve,`artifacts/${bt}/users/${xe}/tasks/${Se}/taskNotes`);await mo(e,{text:n,createdAt:Kn.now()}),await Ie(ce(ne,Se),{noteCount:Un(1)}),navigator.onLine||de(Ye),A.taskNoteInput.value=""}function pN(n,e){const t=document.createElement("div");t.className="bg-yellow-100 p-2 rounded-lg text-sm text-yellow-800 relative group",t.innerHTML=`
        <p class="task-note-text">${e.text}</p>
        <div class="task-note-actions absolute top-1 right-1 flex items-center gap-2 opacity-0 group-hover:opacity-100">
             <button class="edit-task-note text-yellow-600 hover:text-blue-600"><i class="fas fa-pencil-alt fa-xs"></i></button>
             <button class="delete-task-note text-yellow-600 hover:text-red-600" data-id="${n}"><i class="fas fa-times fa-xs"></i></button>
        </div>`,t.querySelector(".delete-task-note").addEventListener("click",async()=>{await nr(ce(et(Ve,`artifacts/${bt}/users/${xe}/tasks/${Se}/taskNotes`),n)),await Ie(ce(ne,Se),{noteCount:Un(-1)}),navigator.onLine||de(Ye)}),t.querySelector(".edit-task-note").addEventListener("click",()=>{const i=t.querySelector(".task-note-text").textContent||"";t.innerHTML=`<textarea class="edit-task-note-input w-full p-1 border rounded">${i}</textarea>
                        <button class="save-task-note-edit w-full mt-1 bg-green-500 text-white px-2 py-1 rounded text-sm">Salvar</button>`;const r=t.querySelector(".edit-task-note-input");r.focus(),t.querySelector(".save-task-note-edit").addEventListener("click",async()=>{const o=r.value.trim();o&&(await Ie(ce(et(Ve,`artifacts/${bt}/users/${xe}/tasks/${Se}/taskNotes`),n),{text:o}),navigator.onLine||de(Ye))})}),A.taskNotesList.appendChild(t)}function mN(){A.calendarModal.classList.remove("hidden"),lu()}function gN(){A.calendarModal.classList.add("hidden")}async function lu(){const n=Ri.getFullYear(),e=Ri.getMonth();A.calendarMonthYear.textContent=new Date(n,e).toLocaleDateString("pt-BR",{month:"long",year:"numeric"}),A.calendarGrid.innerHTML="";const t=await yN(n,e),i=await _N(n,e),r=new Date(n,e,1).getDay(),o=new Date(n,e+1,0).getDate();for(let s=0;s<r;s++)A.calendarGrid.appendChild(document.createElement("div"));for(let s=1;s<=o;s++){const u=document.createElement("div");if(u.className="calendar-day relative p-2 border border-gray-200 rounded-md cursor-pointer hover:bg-gray-100 flex items-center justify-center",u.textContent=s.toString(),t.has(s)){const c=document.createElement("div");c.className="calendar-day-dot",u.appendChild(c)}if(i.has(s)){const c=document.createElement("div");c.className="absolute top-1 right-1 w-2.5 h-2.5 rounded-full bg-orange-500",c.title="Tarefa pendente para este dia",u.appendChild(c)}u.addEventListener("click",()=>{document.querySelectorAll(".calendar-day.selected").forEach(c=>c.classList.remove("selected")),u.classList.add("selected"),vN(new Date(n,e,s))}),A.calendarGrid.appendChild(u)}}async function yN(n,e){if(!xe||!ne||!rt)return new Set;const t=new Date(n,e,1),i=new Date(n,e+1,0,23,59,59),r=new Set,o=$e(ne,je("createdAt",">=",t),je("createdAt","<=",i)),s=$e(rt,je("createdAt",">=",t),je("createdAt","<=",i)),[u,c]=await Promise.all([It(o),It(s)]);return u.forEach(f=>r.add(f.data().createdAt.toDate().getDate())),c.forEach(f=>r.add(f.data().createdAt.toDate().getDate())),r}async function _N(n,e){if(!xe||!ne)return new Set;const t=new Date(n,e,1),i=new Date(n,e+1,0,23,59,59),r=$e(ne,je("dueDate",">=",t),je("dueDate","<=",i),je("completed","==",!1)),o=await It(r),s=new Set;return o.forEach(u=>{const c=u.data().dueDate;c&&c.toDate&&s.add(c.toDate().getDate())}),s}async function vN(n){if(!ne||!rt)return;A.detailsDayHeader.textContent=`Atividade de ${n.toLocaleDateString("pt-BR",{dateStyle:"full"})}`,A.detailsContent.innerHTML="Carregando...";const e=new Date(n.setHours(0,0,0,0)),t=new Date(n.setHours(23,59,59,999)),i=$e(ne,je("createdAt",">=",e),je("createdAt","<=",t)),r=$e(rt,je("createdAt",">=",e),je("createdAt","<=",t)),o=$e(ne,je("dueDate",">=",e),je("dueDate","<=",t)),[s,u,c]=await Promise.all([It(i),It(r),It(o)]);let f="";c.empty||(f+='<div class="mb-4"><h4 class="font-bold text-orange-500">Tarefas agendadas para esse dia</h4>',c.forEach(h=>{const m=h.data();f+=`<span class='calendar-task-link text-orange-900 hover:underline cursor-pointer' data-taskid='${h.id}'>${m.text}</span><br>`}),f+="</div>"),f+='<div class="mb-4"><h4 class="font-bold">Tarefas criadas neste dia</h4>',s.empty?f+='<p class="text-sm">Nenhuma tarefa.</p>':s.forEach(h=>f+=`<p class="text-sm bg-gray-100 p-1 rounded mt-1">${h.data().text}</p>`),f+='</div><div><h4 class="font-bold">Anotações</h4>',u.empty?f+='<p class="text-sm">Nenhuma anotação.</p>':u.forEach(h=>f+=`<p class="text-sm bg-yellow-100 p-1 rounded mt-1">${h.data().text}</p>`),f+="</div>",A.detailsContent.innerHTML=f,A.detailsContent.querySelectorAll(".calendar-task-link").forEach(h=>{h.addEventListener("click",function(){const m=this.getAttribute("data-taskid"),y=c.docs.find(v=>v.id===m);m&&y&&ky(m,y.data().text)})})}function TN(){zn=zn==="list"?"canvas":"list";const n=zn==="list";A.mainContentApp.classList.toggle("hidden",!n),A.canvasView.classList.toggle("hidden",n),A.viewToggleIcon.className=n?"fas fa-project-diagram fa-lg":"fas fa-list-ul fa-lg",A.viewToggleBtn.title=n?"Visualização em Canvas":"Visualização em Lista";const e=document.getElementById("add-free-card-btn");e?(e.classList.toggle("hidden",n),console.log("[Free Card] Toggle view - Botão:",n?"oculto":"visível")):console.warn("[Free Card] Toggle view - Botão não encontrado"),n?(Ft("canvas_tasks"),tr()):(Ft("tasks"),requestAnimationFrame(()=>{My()}))}async function My(){!ne||!we||(Ft("canvas_tasks"),Ft("canvas_free_cards"),A.taskCanvas.innerHTML="",A.canvasLinesSvg.innerHTML="",_t={},dt={},si=[],po=[],uu(),Nt.canvas_tasks=Jn($e(ne),n=>{console.log("[Canvas Sync] Tasks onSnapshot triggered.");const e=n.docs.map(s=>({id:s.id,...s.data()}));si=e;const t=new Set(Object.keys(_t)),i=new Set(e.map(s=>s.id)),r=ed(Ve);let o=!1;e.forEach((s,u)=>{var f;let c=_t[s.id];if(s.x===void 0||s.y===void 0){const h=A.taskCanvasContainer.offsetWidth||1e3,m=Math.max(1,Math.floor(h/250));s.x=u%m*250+50,s.y=Math.floor(u/m)*120+50,r.update(ce(ne,s.id),{x:s.x,y:s.y}),o=!0}if(c){((f=O.draggedNode)==null?void 0:f.dataset.id)!==s.id&&(c.style.left=`${s.x}px`,c.style.top=`${s.y}px`);const h=c.querySelector(".canvas-task-node-text");h&&h.textContent!==s.text&&(h.textContent=s.text),s.completed?c.classList.add("completed-node"):c.classList.remove("completed-node")}else EN(s)}),o&&r.commit().catch(s=>console.warn("Falha ao salvar posições iniciais durante a sincronização.",s)),t.forEach(s=>{if(!i.has(s)){const u=_t[s];u&&(u.remove(),delete _t[s])}}),Ys()},n=>{console.error("Erro de sincronização com o canvas (tasks):",n),de("Erro de sincronização com o canvas.")}),Nt.canvas_free_cards=Jn($e(we),n=>{console.log("[Canvas Sync] Free cards onSnapshot triggered.");const e=n.docs.map(s=>({id:s.id,...s.data()}));po=e;const t=new Set(Object.keys(dt)),i=new Set(e.map(s=>s.id)),r=ed(Ve);let o=!1;e.forEach((s,u)=>{var f;let c=dt[s.id];if(s.x===void 0||s.y===void 0){const h=A.taskCanvasContainer.offsetWidth||1e3,m=Math.max(1,Math.floor(h/250));s.x=u%m*250+50,s.y=Math.floor(u/m)*120+200,r.update(ce(we,s.id),{x:s.x,y:s.y}),o=!0}if(c){((f=O.draggedNode)==null?void 0:f.dataset.id)!==s.id&&(c.style.left=`${s.x}px`,c.style.top=`${s.y}px`);const h=c.querySelector(".canvas-free-card-node-text");h&&h.textContent!==s.text&&(h.textContent=s.text)}else IN(s)}),o&&r.commit().catch(s=>console.warn("Falha ao salvar posições iniciais dos free cards durante a sincronização.",s)),t.forEach(s=>{if(!i.has(s)){const u=dt[s];u&&(u.remove(),delete dt[s])}}),Ys()},n=>{console.error("Erro de sincronização com o canvas (free cards):",n),de("Erro de sincronização com o canvas.")}))}function EN(n){const e=document.createElement("div");e.className="canvas-task-node",e.dataset.id=n.id,e.style.left=`${n.x||0}px`,e.style.top=`${n.y||0}px`,n.completed&&e.classList.add("completed-node"),e.innerHTML=`
        <p class="canvas-task-node-text">${n.text}</p>
    `,e.addEventListener("mousedown",t=>{var r,o;if(((o=(r=t.target)==null?void 0:r.classList)==null?void 0:o.contains("canvas-task-node-link-handle"))||t.shiftKey){t.stopPropagation(),O.isLinking=!0,O.linkStartNodeId=n.id;const s=jr(e,t.clientX,t.clientY);O.linkStartSide=s,A.taskCanvasContainer.classList.add("linking-mode");const u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("class","linking-line"),A.canvasLinesSvg.appendChild(u)}}),_t[n.id]=e,A.taskCanvas.appendChild(e)}function IN(n){const e=document.createElement("div");e.className="canvas-free-card-node",e.dataset.id=n.id,e.dataset.type="free-card",e.style.left=`${n.x||0}px`,e.style.top=`${n.y||0}px`,e.tabIndex=0,e.innerHTML=`
        <p class="canvas-free-card-node-text">${n.text}</p>
    `,e.addEventListener("click",t=>{t.stopPropagation(),document.querySelectorAll(".canvas-free-card-node.selected").forEach(i=>i.classList.remove("selected")),e.classList.add("selected"),e.focus()}),e.addEventListener("keydown",async t=>{(t.key==="Delete"||t.key==="Del")&&e.classList.contains("selected")&&(t.preventDefault(),we&&(await nr(ce(we,n.id)),de("Card livre excluído!")))}),e.addEventListener("mousedown",t=>{var o,s,u;const i=(s=(o=t.target)==null?void 0:o.classList)==null?void 0:s.contains("canvas-free-card-node-link-handle");if(((u=t.target)==null?void 0:u.tagName)!=="TEXTAREA"&&(i||t.shiftKey)){t.stopPropagation(),O.isLinking=!0,O.linkStartNodeId=n.id;const c=jr(e,t.clientX,t.clientY);O.linkStartSide=c,A.taskCanvasContainer.classList.add("linking-mode");const f=document.createElementNS("http://www.w3.org/2000/svg","path");f.setAttribute("class","linking-line"),A.canvasLinesSvg.appendChild(f)}}),e.addEventListener("dblclick",t=>{t.stopPropagation();const i=e.querySelector(".canvas-free-card-node-text");if(!i)return;const r=i.textContent||"",o=document.createElement("textarea");o.value=r,o.className="w-full p-2 border rounded bg-white text-blue-900",o.style.fontWeight="500",o.style.fontSize="1rem",o.style.resize="none",o.style.minHeight="48px",i.replaceWith(o),o.focus(),o.select();const s=async()=>{const u=o.value.trim();u&&u!==r&&we&&await Ie(ce(we,n.id),{text:u});const c=document.createElement("p");c.className="canvas-free-card-node-text",c.textContent=u||r,o.replaceWith(c)};o.addEventListener("blur",s),o.addEventListener("keydown",u=>{if(u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),o.blur()),u.key==="Escape"){const c=document.createElement("p");c.className="canvas-free-card-node-text",c.textContent=r,o.replaceWith(c)}})}),dt[n.id]=e,A.taskCanvas.appendChild(e)}function Ys(){if(!A.canvasLinesSvg)return;const n=A.canvasLinesSvg.querySelector(".linking-line");A.canvasLinesSvg.innerHTML="",n&&A.canvasLinesSvg.appendChild(n),si.forEach(e=>{var t;(t=e.connections)!=null&&t.length&&e.connections.forEach(i=>{let r,o,s,u;typeof i=="string"?(r=i,o=void 0,s="right",u="left"):(r=i.targetId,o=i.comment,s=i.sourceSide||"right",u=i.targetSide||"left");const c=_t[e.id],f=_t[r]||dt[r];if(c&&f){const h=document.createElementNS("http://www.w3.org/2000/svg","g"),m=Tp(c,f,!1,void 0,!1,s,u),y=m.cloneNode();if(y.setAttribute("stroke","rgba(0,0,0,0)"),y.setAttribute("stroke-width","16"),y.setAttribute("pointer-events","stroke"),y.setAttribute("class",(m.getAttribute("class")||"")+" hit-area"),y.setAttribute("tabindex","0"),h.appendChild(y),h.appendChild(m),y.addEventListener("click",L=>{L.stopPropagation(),document.querySelectorAll(".canvas-line.selected, .canvas-free-card-line.selected").forEach(q=>q.classList.remove("selected")),m.classList.add("selected"),m.tabIndex=0,y.focus()}),y.addEventListener("keydown",async L=>{if((L.key==="Delete"||L.key==="Del")&&m.classList.contains("selected")&&ne){const q=ce(ne,e.id),I=(e.connections||[]).filter(T=>typeof T=="string"?T!==r:T.targetId!==r);await Ie(q,{connections:I}),de("Conexão removida!")}}),y.addEventListener("focus",()=>m.classList.add("selected")),y.addEventListener("blur",()=>m.classList.remove("selected")),o){const L=c.offsetLeft+c.offsetWidth,q=c.offsetTop+c.offsetHeight/2,I=f.offsetLeft,T=f.offsetTop+f.offsetHeight/2,E=(L+I)/2,w=(q+T)/2,C=document.createElementNS("http://www.w3.org/2000/svg","text");C.setAttribute("x",String(E)),C.setAttribute("y",String(w-10)),C.setAttribute("text-anchor","middle"),C.setAttribute("fill","#6366f1"),C.setAttribute("font-size","13"),C.setAttribute("opacity","0.7"),C.setAttribute("pointer-events","none"),C.textContent=o,h.appendChild(C)}m.addEventListener("dblclick",L=>{L.stopPropagation();const q=(c.offsetLeft+c.offsetWidth+f.offsetLeft)/2,I=(c.offsetTop+c.offsetHeight/2+f.offsetTop+f.offsetHeight/2)/2;Ip(e.id,r,q,I,o||"")});const v=document.createElementNS("http://www.w3.org/2000/svg","svg");v.setAttribute("width","20"),v.setAttribute("height","20"),v.setAttribute("viewBox","0 0 448 512"),v.setAttribute("class","canvas-trash-icon"),v.style.display="none",v.style.position="absolute",v.style.cursor="pointer",v.innerHTML='<path fill="#ef4444" d="M135.2 17.7C140.2 7.4 150.5 0 162.3 0h123.4c11.8 0 22.1 7.4 27.1 17.7l19.8 38.3H432c8.8 0 16 7.2 16 16s-7.2 16-16 16h-16l-21.2 339.4c-2.6 41.2-36.7 72.3-77.9 72.3H131.1c-41.2 0-75.3-31.1-77.9-72.3L32 88H16C7.2 88 0 80.8 0 72s7.2-16 16-16h74.4l19.8-38.3zM131.1 464h185.8c23.2 0 42.2-17.5 43.5-40.7L381.2 88H66.8l21.2 335.3c1.3 23.2 20.3 40.7 43.5 40.7zM176 224c8.8 0 16 7.2 16 16v128c0 8.8-7.2 16-16 16s-16-7.2-16-16V240c0-8.8 7.2-16 16-16s16 7.2 16 16z"/>';const x=c.offsetLeft+c.offsetWidth,R=c.offsetTop+c.offsetHeight/2,D=f.offsetLeft,U=f.offsetTop+f.offsetHeight/2,V=(x+D)/2,N=(R+U)/2;v.setAttribute("x",String(V-10)),v.setAttribute("y",String(N-10)),v.style.pointerEvents="auto";let F=null;h.addEventListener("mouseenter",()=>{F&&clearTimeout(F),v.style.display="block"}),h.addEventListener("mouseleave",()=>{F=setTimeout(()=>{v.style.display="none"},350)}),v.addEventListener("mouseenter",()=>{F&&clearTimeout(F),v.style.display="block"}),v.addEventListener("mouseleave",()=>{F=setTimeout(()=>{v.style.display="none"},350)}),v.addEventListener("click",async L=>{if(L.stopPropagation(),ne){const q=ce(ne,e.id),I=(e.connections||[]).filter(T=>typeof T=="string"?T!==r:T.targetId!==r);await Ie(q,{connections:I}),de("Conexão removida!")}}),h.appendChild(v),A.canvasLinesSvg.appendChild(h)}else console.warn(`[Canvas Draw] FAILED to draw line: Could not find nodes in cache. Source (${e.id}): ${!!c}, Target (${r}): ${!!f}`)})}),po.forEach(e=>{var t;(t=e.connections)!=null&&t.length&&e.connections.forEach(i=>{let r,o,s,u;typeof i=="string"?(r=i,o=void 0,s="right",u="left"):(r=i.targetId,o=i.comment,s=i.sourceSide||"right",u=i.targetSide||"left");const c=dt[e.id],f=_t[r]||dt[r];if(c&&f){const h=document.createElementNS("http://www.w3.org/2000/svg","g"),m=Tp(c,f,!1,void 0,!0,s,u),y=m.cloneNode();if(y.setAttribute("stroke","rgba(0,0,0,0)"),y.setAttribute("stroke-width","16"),y.setAttribute("pointer-events","stroke"),y.setAttribute("class",(m.getAttribute("class")||"")+" hit-area"),y.setAttribute("tabindex","0"),h.appendChild(y),h.appendChild(m),y.addEventListener("click",L=>{L.stopPropagation(),document.querySelectorAll(".canvas-line.selected, .canvas-free-card-line.selected").forEach(q=>q.classList.remove("selected")),m.classList.add("selected"),m.tabIndex=0,y.focus()}),y.addEventListener("keydown",async L=>{if((L.key==="Delete"||L.key==="Del")&&m.classList.contains("selected")&&we){const q=ce(we,e.id),I=(e.connections||[]).filter(T=>typeof T=="string"?T!==r:T.targetId!==r);await Ie(q,{connections:I}),de("Conexão removida!")}}),y.addEventListener("focus",()=>m.classList.add("selected")),y.addEventListener("blur",()=>m.classList.remove("selected")),o){const L=c.offsetLeft+c.offsetWidth,q=c.offsetTop+c.offsetHeight/2,I=f.offsetLeft,T=f.offsetTop+f.offsetHeight/2,E=(L+I)/2,w=(q+T)/2,C=document.createElementNS("http://www.w3.org/2000/svg","text");C.setAttribute("x",String(E)),C.setAttribute("y",String(w-10)),C.setAttribute("text-anchor","middle"),C.setAttribute("fill","#3b82f6"),C.setAttribute("font-size","13"),C.setAttribute("opacity","0.7"),C.setAttribute("pointer-events","none"),C.textContent=o,h.appendChild(C)}m.addEventListener("dblclick",L=>{L.stopPropagation();const q=(c.offsetLeft+c.offsetWidth+f.offsetLeft)/2,I=(c.offsetTop+c.offsetHeight/2+f.offsetTop+f.offsetHeight/2)/2;Ip(e.id,r,q,I,o||"",!0)});const v=document.createElementNS("http://www.w3.org/2000/svg","svg");v.setAttribute("width","20"),v.setAttribute("height","20"),v.setAttribute("viewBox","0 0 448 512"),v.setAttribute("class","canvas-trash-icon"),v.style.display="none",v.style.position="absolute",v.style.cursor="pointer",v.innerHTML='<path fill="#ef4444" d="M135.2 17.7C140.2 7.4 150.5 0 162.3 0h123.4c11.8 0 22.1 7.4 27.1 17.7l19.8 38.3H432c8.8 0 16 7.2 16 16s-7.2 16-16 16h-16l-21.2 339.4c-2.6 41.2-36.7 72.3-77.9 72.3H131.1c-41.2 0-75.3-31.1-77.9-72.3L32 88H16C7.2 88 0 80.8 0 72s7.2-16 16-16h74.4l19.8-38.3zM131.1 464h185.8c23.2 0 42.2-17.5 43.5-40.7L381.2 88H66.8l21.2 335.3c1.3 23.2 20.3 40.7 43.5 40.7zM176 224c8.8 0 16 7.2 16 16v128c0 8.8-7.2 16-16 16s-16-7.2-16-16V240c0-8.8 7.2-16 16-16s16 7.2 16 16z"/>';const x=c.offsetLeft+c.offsetWidth,R=c.offsetTop+c.offsetHeight/2,D=f.offsetLeft,U=f.offsetTop+f.offsetHeight/2,V=(x+D)/2,N=(R+U)/2;v.setAttribute("x",String(V-10)),v.setAttribute("y",String(N-10)),v.style.pointerEvents="auto";let F=null;h.addEventListener("mouseenter",()=>{F&&clearTimeout(F),v.style.display="block"}),h.addEventListener("mouseleave",()=>{F=setTimeout(()=>{v.style.display="none"},350)}),v.addEventListener("mouseenter",()=>{F&&clearTimeout(F),v.style.display="block"}),v.addEventListener("mouseleave",()=>{F=setTimeout(()=>{v.style.display="none"},350)}),v.addEventListener("click",async L=>{if(L.stopPropagation(),we){const q=ce(we,e.id),I=(e.connections||[]).filter(T=>typeof T=="string"?T!==r:T.targetId!==r);await Ie(q,{connections:I}),de("Conexão removida!")}}),h.appendChild(v),A.canvasLinesSvg.appendChild(h)}})})}function Tp(n,e,t=!1,i,r=!1,o,s){if(A.canvasLinesSvg&&!A.canvasLinesSvg.querySelector("marker#arrowhead")){const x=document.createElementNS("http://www.w3.org/2000/svg","defs");x.innerHTML=`
            <marker id="arrowhead" markerWidth="2" markerHeight="1.2" refX="2" refY="0.6" orient="auto">
                <polygon points="0 0, 2 0.6, 0 1.2" fill="#6366f1"/>
            </marker>
        `,A.canvasLinesSvg.prepend(x)}if(A.canvasLinesSvg&&!A.canvasLinesSvg.querySelector("marker#arrowhead-blue")){const x=A.canvasLinesSvg.querySelector("defs");if(x){const R=document.createElementNS("http://www.w3.org/2000/svg","marker");R.setAttribute("id","arrowhead-blue"),R.setAttribute("markerWidth","2"),R.setAttribute("markerHeight","1.2"),R.setAttribute("refX","2"),R.setAttribute("refY","0.6"),R.setAttribute("orient","auto"),R.innerHTML='<polygon points="0 0, 2 0.6, 0 1.2" fill="#3b82f6"/>',x.appendChild(R)}}function u(x,R){const D=x.offsetLeft,U=x.offsetTop,V=x.offsetWidth,N=x.offsetHeight;switch(R){case"top":return{x:D+V/2,y:U};case"bottom":return{x:D+V/2,y:U+N};case"left":return{x:D,y:U+N/2};case"right":return{x:D+V,y:U+N/2};default:return{x:D+V,y:U+N/2}}}let c,f,h,m;c=u(n,o||"right").x,f=u(n,o||"right").y,h=u(e,s||"left").x,m=u(e,s||"left").y;const y=document.createElementNS("http://www.w3.org/2000/svg","path"),v=Math.max(50,Math.abs(h-c)*.3);return y.setAttribute("d",`M ${c} ${f} C ${c+v} ${f}, ${h-v} ${m}, ${h} ${m}`),r?(y.setAttribute("class",t?"linking-line":"canvas-free-card-line"),y.setAttribute("stroke","#3b82f6"),y.setAttribute("marker-end","url(#arrowhead-blue)")):(y.setAttribute("class",t?"linking-line":"canvas-line"),y.setAttribute("stroke","#6366f1"),y.setAttribute("marker-end","url(#arrowhead)")),y.setAttribute("stroke-width","2"),y.setAttribute("fill","none"),y.setAttribute("opacity",t?"0.7":"1"),y}function uu(){const n=`translate(${O.panOffsetX}px, ${O.panOffsetY}px) scale(${O.zoom})`;A.taskCanvas.style.transform=n,A.canvasLinesSvg.style.transform=n}async function CN(n,e){const t=si.find(c=>c.id===n);if(!t||!xe)return;A.canvasPopupTitle.textContent=t.text,A.canvasPopupSubtasks.innerHTML="<p>Carregando...</p>",A.canvasPopupNotes.innerHTML="<p>Carregando...</p>";const i=A.taskCanvasContainer.getBoundingClientRect(),r=e.getBoundingClientRect();A.canvasTaskPopup.style.left=`${r.right-i.left+5}px`,A.canvasTaskPopup.style.top=`${r.top-i.top}px`,A.canvasTaskPopup.classList.remove("hidden");const o=`artifacts/${bt}/users/${xe}/tasks/${n}`,[s,u]=await Promise.all([It($e(et(Ve,`${o}/subtasks`))),It($e(et(Ve,`${o}/taskNotes`)))]);A.canvasPopupSubtasks.innerHTML=s.empty?'<p class="text-gray-400">Nenhuma sub-tarefa.</p>':s.docs.map(c=>{const f=c.data();return`<p class="${f.completed?"completed":""}">${f.text}</p>`}).join(""),A.canvasPopupNotes.innerHTML=u.empty?'<p class="text-gray-400">Nenhuma anotação.</p>':u.docs.map(c=>`<p>${c.data().text}</p>`).join("")}function Zr(){A.canvasTaskPopup.classList.add("hidden")}const AN=()=>{me.add(A.addTaskBtn,"click",iN),me.add(A.saveNoteBtn,"click",rN),me.add(A.toggleCompletedBtn,"click",()=>{Js=!Js,Ry(),tr()}),me.add(A.closeDetailModalBtn,"click",cN),me.add(A.addSubtaskBtn,"click",dN),me.add(A.addTaskNoteBtn,"click",hN),me.add(A.calendarBtn,"click",mN),me.add(A.closeCalendarBtn,"click",gN),me.add(A.prevMonthBtn,"click",()=>{Ri.setMonth(Ri.getMonth()-1),lu()}),me.add(A.nextMonthBtn,"click",()=>{Ri.setMonth(Ri.getMonth()+1),lu()});const n=A.detailTitleContainer.querySelector(".edit-main-task-btn");n&&me.add(n,"click",au),me.add(A.addCategoryBtn,"click",u=>{u.preventDefault(),bN()}),me.add(A.themeToggleBtn,"click",NN),me.add(document,"click",u=>{const c=u.target;A.userMenuContainer.contains(c)||A.userMenuDropdown.classList.add("hidden"),!A.canvasTaskPopup.classList.contains("hidden")&&!A.canvasTaskPopup.contains(c)&&!u.target.closest(".canvas-task-node")&&Zr();const f=document.getElementById("free-card-popup");f&&!f.classList.contains("hidden")&&!f.contains(c)&&Xs(),u.target.closest(".canvas-free-card-node")||document.querySelectorAll(".canvas-free-card-node.selected").forEach(h=>h.classList.remove("selected"))}),me.add(A.logoutBtn,"click",async()=>{await __(ur),A.userMenuDropdown.classList.add("hidden")}),me.add(window,"online",su),me.add(window,"offline",su),me.add(A.viewToggleBtn,"click",TN),SN(),me.add(A.canvasPopupCloseBtn,"click",Zr);const e=document.getElementById("add-free-card-btn");console.log("[Free Card] Botão principal encontrado:",!!e),e&&(me.add(e,"click",DN),console.log("[Free Card] Event listener adicionado ao botão principal"));const t=document.getElementById("add-free-card-btn-modal");console.log("[Free Card] Botão do modal encontrado:",!!t),t&&(me.add(t,"click",Py),console.log("[Free Card] Event listener adicionado ao botão do modal"));const i=document.getElementById("close-free-card-popup-btn");console.log("[Free Card] Botão de fechar encontrado:",!!i),i&&(me.add(i,"click",Xs),console.log("[Free Card] Event listener adicionado ao botão de fechar")),A.userMenuTrigger&&me.add(A.userMenuTrigger,"click",u=>{u.stopPropagation(),A.userMenuDropdown.classList.toggle("hidden")});const r=document.getElementById("open-task-popup-btn"),o=document.getElementById("task-popup"),s=document.getElementById("close-task-popup-btn");r&&o&&r.addEventListener("click",()=>{o.classList.remove("hidden"),setTimeout(()=>{const u=document.getElementById("task-input");u&&u.focus()},50)}),s&&o&&s.addEventListener("click",()=>{o.classList.add("hidden")})};function SN(){const n=A.taskCanvasContainer,e=o=>{const s=o.target,u=s.closest(".canvas-task-node"),c=s.closest(".canvas-free-card-node"),f=u||c;if(s.classList.contains("canvas-task-node-link-handle")&&u){o.stopPropagation(),O.isLinking=!0,O.linkStartNodeId=u.dataset.id||null;const h=jr(u,o.clientX,o.clientY);O.linkStartSide=h,n.classList.add("linking-mode");const m=document.createElementNS("http://www.w3.org/2000/svg","path");m.setAttribute("class","linking-line"),A.canvasLinesSvg.appendChild(m)}else if(s.classList.contains("canvas-free-card-node-link-handle")&&c){o.stopPropagation(),O.isLinking=!0,O.linkStartNodeId=c.dataset.id||null;const h=jr(c,o.clientX,o.clientY);O.linkStartSide=h,n.classList.add("linking-mode");const m=document.createElementNS("http://www.w3.org/2000/svg","path");m.setAttribute("class","linking-line"),A.canvasLinesSvg.appendChild(m)}else f?(o.stopPropagation(),O.isDragging=!0,O.draggedNode=f,O.startX=o.clientX,O.startY=o.clientY,O.nodeInitialX=f.offsetLeft,O.nodeInitialY=f.offsetTop,f.style.zIndex="20"):(O.isPanning=!0,n.classList.add("grabbing"),O.startX=o.clientX-O.panOffsetX,O.startY=o.clientY-O.panOffsetY)},t=o=>{if(O.isLinking&&O.linkStartNodeId){const s=_t[O.linkStartNodeId]||dt[O.linkStartNodeId];if(!s)return;const u=O.linkStartSide||"right",c=n.getBoundingClientRect(),f=o.clientX-c.left,h=o.clientY-c.top,m=(f-O.panOffsetX)/O.zoom,y=(h-O.panOffsetY)/O.zoom,v=A.canvasLinesSvg.querySelector(".linking-line");if(v){const R=function(F,L){const q=F.offsetLeft,I=F.offsetTop,T=F.offsetWidth,E=F.offsetHeight;switch(L){case"top":return{x:q+T/2,y:I};case"bottom":return{x:q+T/2,y:I+E};case"left":return{x:q,y:I+E/2};case"right":return{x:q+T,y:I+E/2};default:return{x:q+T,y:I+E/2}}}(s,u),D=R.x,U=R.y,V=Math.max(50,Math.abs(m-D)*.3),N=`M ${D} ${U} C ${D+V} ${U}, ${m-V} ${y}, ${m} ${y}`;v.setAttribute("d",N)}}else if(O.isDragging&&O.draggedNode){Zr();const s=(o.clientX-O.startX)/O.zoom,u=(o.clientY-O.startY)/O.zoom;O.draggedNode.style.left=`${O.nodeInitialX+s}px`,O.draggedNode.style.top=`${O.nodeInitialY+u}px`,Ys()}else O.isPanning&&(Zr(),O.panOffsetX=o.clientX-O.startX,O.panOffsetY=o.clientY-O.startY,uu())},i=async o=>{try{const s=o.target,u=s.closest(".canvas-task-node"),c=s.closest(".canvas-free-card-node"),f=u||c;if(O.isLinking&&O.linkStartNodeId){const h=A.canvasLinesSvg.querySelector(".linking-line");if(h&&h.remove(),f&&f.dataset.id!==O.linkStartNodeId){const m=f.dataset.id,y=O.linkStartNodeId&&dt[O.linkStartNodeId],v=jr(f,o.clientX,o.clientY);if(O.linkTargetSide=v,m){const x={targetId:m,sourceSide:O.linkStartSide||"right",targetSide:v||"left"};y&&we?await Ie(ce(we,O.linkStartNodeId),{connections:td(x)}):ne&&await Ie(ce(ne,O.linkStartNodeId),{connections:td(x)})}}}else if(O.isDragging&&O.draggedNode){const h=O.draggedNode.dataset.id,m=O.draggedNode.dataset.type==="free-card",y=o.clientX-O.startX,v=o.clientY-O.startY;if(Math.abs(y)>5||Math.abs(v)>5){if(h){const x=O.draggedNode.offsetLeft,R=O.draggedNode.offsetTop;m&&we?await Ie(ce(we,h),{x,y:R}):ne&&await Ie(ce(ne,h),{x,y:R})}}else h&&!m&&CN(h,O.draggedNode)}}catch(s){console.error("Error during canvas mouseup operation:",s),de("Falha ao criar conexão. Verifique o console para detalhes.")}finally{if(O.isDragging&&O.draggedNode&&(O.draggedNode.style.zIndex="10"),O.isPanning&&n.classList.remove("grabbing"),O.isLinking){const s=A.canvasLinesSvg.querySelector(".linking-line");s&&s.remove(),n.classList.remove("linking-mode")}O.isLinking=!1,O.isDragging=!1,O.isPanning=!1,O.draggedNode=null,O.linkStartNodeId=null,O.linkStartSide=null,O.linkTargetSide=null}},r=o=>{o.preventDefault(),Zr();const s=n.getBoundingClientRect(),u=o.clientX-s.left,c=o.clientY-s.top,f=O.zoom,h=1.1;let m=o.deltaY<0?f*h:f/h;m=Math.max(.2,Math.min(m,3));const y=(u-O.panOffsetX)/f,v=(c-O.panOffsetY)/f;O.panOffsetX=u-y*m,O.panOffsetY=c-v*m,O.zoom=m,uu()};me.add(n,"mousedown",e),me.add(window,"mousemove",t),me.add(window,"mouseup",i),me.add(n,"wheel",r)}const wN=()=>{RN(),AN(),PN(),Ws(!1)},xN=()=>{me.removeAll(),tN(),A.notesList&&(A.notesList.innerHTML=""),A.taskList&&(A.taskList.innerHTML=""),A.categorySelect&&(A.categorySelect.innerHTML=""),A.filterContainer&&(A.filterContainer.innerHTML=""),A.taskCanvas&&(A.taskCanvas.innerHTML=""),A.canvasLinesSvg&&(A.canvasLinesSvg.innerHTML=""),_t={},dt={},si=[],po=[],zn="list",O={isPanning:!1,isDragging:!1,isLinking:!1,draggedNode:null,linkStartNodeId:null,startX:0,startY:0,panOffsetX:0,panOffsetY:0,zoom:1,nodeInitialX:0,nodeInitialY:0,linkStartSide:null,linkTargetSide:null},Ws(!0)},RN=()=>{if(!xe)return;const n=`artifacts/${bt}/users/${xe}`;ne=et(Ve,`${n}/tasks`),rt=et(Ve,`${n}/notes`),Ht=et(Ve,`${n}/categories`),we=et(Ve,`${n}/freeCards`),console.log("[Firestore] Collections configuradas:",{userId:xe,basePath:n,tasksCollectionRef:!!ne,notesCollectionRef:!!rt,categoriesCollectionRef:!!Ht,freeCardsCollectionRef:!!we})},PN=()=>{su(),nN(),Ry(),lN();const n=document.getElementById("add-free-card-btn");n?(n.classList.toggle("hidden",zn==="list"),console.log("[Free Card] Botão encontrado, estado inicial:",zn==="list"?"oculto":"visível")):console.warn("[Free Card] Botão não encontrado no DOM"),zn==="list"?tr():requestAnimationFrame(()=>My()),sN()};function by(){A.loginContainer.classList.remove("hidden"),A.registerContainer.classList.add("hidden"),A.loginError.textContent=""}function kN(){A.loginContainer.classList.add("hidden"),A.registerContainer.classList.remove("hidden"),A.registerError.textContent=""}A.showRegisterBtn&&(A.showRegisterBtn.onclick=kN);A.showLoginBtn&&(A.showLoginBtn.onclick=by);A.loginForm&&(A.loginForm.onsubmit=async n=>{n.preventDefault(),console.log("[DEBUG] Tentando logar..."),A.loginError.textContent="";const e=document.getElementById("login-email").value.trim(),t=document.getElementById("login-password").value;try{await Cp(ur,e,t)}catch{A.loginError.textContent="E-mail ou senha inválidos."}});A.registerForm&&(A.registerForm.onsubmit=async n=>{n.preventDefault(),A.registerError.textContent="";const e=document.getElementById("register-email").value.trim(),t=document.getElementById("register-password").value;try{await g_(ur,e,t),by(),A.loginError.textContent="Cadastro realizado! Faça login."}catch{A.registerError.textContent="Erro ao cadastrar. Verifique o e-mail e senha."}});const MN=async()=>{await uS(de),Ws(!0),y_(ur,n=>{xN(),n?(xe=n.uid,wN(),A.appContainer.classList.remove("hidden"),A.loginContainer.classList.add("hidden"),A.registerContainer.classList.add("hidden"),n.email?(A.userEmail.textContent=n.email,A.userMenuContainer.classList.remove("hidden")):A.userMenuContainer.classList.add("hidden")):(Ws(!0),xe=null,A.appContainer.classList.add("hidden"),A.loginContainer.classList.remove("hidden"),A.registerContainer.classList.add("hidden"),A.userMenuContainer.classList.add("hidden"))})};function bN(){A.categoryPopup.classList.remove("hidden"),A.categoryPopupInput.value="",setTimeout(()=>A.categoryPopupInput.focus(),50)}function ju(){A.categoryPopup.classList.add("hidden")}function DN(){const n=document.getElementById("free-card-popup");if(n){n.classList.remove("hidden"),n.style.display="flex",n.style.zIndex="99999",setTimeout(()=>{n.classList.remove("hidden"),n.style.display="flex",n.style.zIndex="99999"},50);const e=document.getElementById("free-card-input");e&&(e.value="",setTimeout(()=>e.focus(),100))}}function Xs(){const n=document.getElementById("free-card-popup");n&&(n.classList.add("hidden"),n.style.display="",n.style.zIndex="")}A.categoryPopupCancel&&(A.categoryPopupCancel.onclick=ju);A.categoryPopupAdd&&(A.categoryPopupAdd.onclick=async()=>{const n=A.categoryPopupInput.value.trim();n?(await uN(n),ju()):A.categoryPopupInput.focus()});A.categoryPopupInput&&A.categoryPopupInput.addEventListener("keydown",n=>{n.key==="Enter"&&A.categoryPopupAdd.click(),n.key==="Escape"&&ju()});const Ep=document.getElementById("free-card-input");Ep&&Ep.addEventListener("keydown",n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),Py()),n.key==="Escape"&&Xs()});function Dy(n){n==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}function NN(){const e=(localStorage.getItem("theme")||"dark")==="dark"?"light":"dark";localStorage.setItem("theme",e),Dy(e),Ny(e)}function Ny(n){A.themeToggleBtn&&(A.themeToggleBtn.innerHTML=n==="dark"?'<i class="fas fa-sun fa-lg"></i>':'<i class="fas fa-moon fa-lg"></i>',A.themeToggleBtn.title=n==="dark"?"Modo claro":"Modo escuro")}const Vy=localStorage.getItem("theme")||"dark";Dy(Vy);Ny(Vy);async function VN(){if(!ne||!rt||!navigator.onLine||!xe){de("A análise com IA requer uma conexão com a internet.");return}A.aiAnalyzeContent.innerHTML="Analisando com Gemini...",A.aiAnalyzeModal.classList.remove("hidden");try{const e=(await It($e(ne,je("completed","==",!1)))).docs.map(o=>({id:o.id,...o.data()})),i=(await It($e(rt))).docs.map(o=>({id:o.id,...o.data()}));if(e.length===0&&i.length===0){A.aiAnalyzeContent.innerHTML="Parabéns! Não há tarefas ou notas pendentes para analisar.";return}const r=await eN(xe,e,i);A.aiAnalyzeContent.innerHTML=marked.parse(r)}catch(n){console.error("Error during AI Analysis:",n),A.aiAnalyzeContent.innerHTML="Ocorreu um erro ao gerar a análise. Por favor, tente novamente."}}A.aiAnalyzeBtn&&(A.aiAnalyzeBtn.onclick=VN);A.closeAiAnalyzeModal&&(A.closeAiAnalyzeModal.onclick=()=>A.aiAnalyzeModal.classList.add("hidden"));A.aiAnalyzeModal&&A.aiAnalyzeModal.addEventListener("click",n=>{n.target===A.aiAnalyzeModal&&A.aiAnalyzeModal.classList.add("hidden")});(function(){function e(r){r.getAttribute("data-listener-added")||(r.addEventListener("click",o=>{console.log("[Categoria] Clique no botão + de categoria (observer)"),o.preventDefault();const s=document.getElementById("category-popup");console.log("[Categoria] Popup encontrado (observer):",!!s),s&&s.classList.remove("hidden");const u=document.getElementById("category-popup-input");console.log("[Categoria] Input encontrado (observer):",!!u),u&&(u.value="",setTimeout(()=>{u.focus(),console.log("[Categoria] Input focado (observer)")},50))}),r.setAttribute("data-listener-added","true"),console.log("[Categoria] Evento de clique adicionado ao botão + de categoria (observer)"))}const t=document.getElementById("add-category-btn");t&&e(t),new MutationObserver(()=>{const r=document.getElementById("add-category-btn");r&&e(r)}).observe(document.body,{childList:!0,subtree:!0})})();function LN(n){const e=document.getElementById("detail-category-select");!e||!Ht||(e.innerHTML='<option value="Nenhuma">Sem Categoria</option>',It(Ht).then(t=>{t.forEach(i=>{const r=i.data().name,o=document.createElement("option");o.value=r,o.textContent=r,e.appendChild(o)}),e.value=n||"Nenhuma"}),e.onchange=async()=>{if(!Se||!ne)return;const t=e.value==="Nenhuma"?null:e.value;await Ie(ce(ne,Se),{category:t}),de("Categoria atualizada!")})}const dl=document.getElementById("advanced-task-filter");dl&&dl.addEventListener("change",()=>{an=dl.value,tr()});function Ip(n,e,t,i,r,o=!1){const s=document.getElementById("canvas-conn-comment-input");s&&s.remove();const u=document.createElement("input");u.type="text",u.value=r,u.id="canvas-conn-comment-input",u.placeholder="Comentário...",u.style.position="absolute",u.style.left=`${t-60}px`,u.style.top=`${i-18}px`,u.style.width="120px",u.style.zIndex="10000",u.style.background="#fff",u.style.border=o?"1px solid #3b82f6":"1px solid #6366f1",u.style.borderRadius="6px",u.style.padding="2px 8px",u.style.fontSize="13px",u.style.boxShadow=o?"0 2px 8px rgba(59,130,246,0.08)":"0 2px 8px rgba(99,102,241,0.08)",u.style.opacity="0.95",u.style.outline="none",u.style.pointerEvents="auto",u.addEventListener("keydown",async c=>{if(c.key==="Enter"){if(o&&we){const f=ce(we,n),h=po.find(m=>m.id===n);if(h){let m=[];h.connections&&(m=h.connections.map(y=>typeof y=="string"&&y===e||typeof y=="object"&&y.targetId===e?{targetId:e,comment:u.value.trim()}:y)),await Ie(f,{connections:m})}}else if(ne){const f=ce(ne,n),h=si.find(m=>m.id===n);if(h){let m=[];h.connections&&(m=h.connections.map(y=>typeof y=="string"&&y===e||typeof y=="object"&&y.targetId===e?{targetId:e,comment:u.value.trim()}:y)),await Ie(f,{connections:m})}}u.remove(),Ys()}else c.key==="Escape"&&u.remove()}),setTimeout(()=>u.focus(),30),A.taskCanvasContainer.appendChild(u)}function jr(n,e,t){const i=n.getBoundingClientRect(),r=e-i.left,o=t-i.top,s=i.width,u=i.height,c=o,f=u-o,h=r,m=s-r,y=Math.min(c,f,h,m);return y===c?"top":y===f?"bottom":y===h?"left":"right"}console.log("[DEBUG] JS principal carregado");document.addEventListener("DOMContentLoaded",()=>{console.log("[DEBUG] DOM pronto")});console.log("[DEBUG] loginForm:",document.getElementById("login-form"));console.log("[DEBUG] Firebase auth:",ur);A.loginForm?(A.loginForm.onsubmit=async n=>{n.preventDefault(),console.log("[DEBUG] Clique no botão Entrar"),A.loginError.textContent="";const e=document.getElementById("login-email").value.trim(),t=document.getElementById("login-password").value;console.log("[DEBUG] Dados do formulário:",{email:e,passwordLength:t.length});try{console.log("[DEBUG] Chamando signInWithEmailAndPassword...");const i=await Cp(ur,e,t);console.log("[DEBUG] Login bem-sucedido:",i)}catch(i){console.error("[DEBUG] Erro no login:",i),A.loginError.textContent="E-mail ou senha inválidos."}},console.log("[DEBUG] Listener de login adicionado:",!!A.loginForm)):console.log("[DEBUG] loginForm NÃO encontrado");MN();
